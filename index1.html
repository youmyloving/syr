<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <title>–°—ã—Ä–æ–º–∞–Ω–∏—è ‚Äî –Ω–∞—Ç—É—Ä–∞–ª—å–Ω—ã–µ —Ñ–µ—Ä–º–µ—Ä—Å–∫–∏–µ —Å—ã—Ä—ã</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" />
  <meta name="theme-color" content="#FAF8F5" />
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  <style>
    :root {
      --bg-primary: #FAF8F5;
      --bg-secondary: #FFFFFF;
      --bg-tertiary: #F5F0E8;
      --bg-warm: #FFF8F0;
      --accent-gold: #C9A962;
      --accent-honey: #D4A84B;
      --accent-warm: #E8B86D;
      --accent-gradient: linear-gradient(135deg, #C9A962 0%, #E8B86D 50%, #D4A84B 100%);
      --text-primary: #2C2416;
      --text-secondary: #5C4D3C;
      --text-muted: #8B7D6B;
      --border-light: rgba(201, 169, 98, 0.2);
      --shadow-soft: 0 4px 20px rgba(44, 36, 22, 0.06);
      --shadow-elevated: 0 8px 32px rgba(44, 36, 22, 0.1);
      --radius-lg: 20px;
      --radius-md: 16px;
      --radius-sm: 12px;
      --font-main: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
    }

    * { box-sizing: border-box; margin: 0; padding: 0; }
    
    html { scroll-behavior: smooth; }
    
    @media (prefers-reduced-motion: reduce) {
      * { animation-duration: 0.01ms !important; animation-iteration-count: 1 !important; transition-duration: 0.01ms !important; }
    }

    body {
      font-family: var(--font-main);
      background: var(--bg-primary);
      color: var(--text-primary);
      -webkit-font-smoothing: antialiased;
      overflow-x: hidden;
    }

    #app {
      max-width: 1200px;
      margin: 0 auto;
      min-height: 100vh;
      padding-bottom: 100px;
    }

    /* Toast Notification */
    .toast {
      position: fixed;
      top: 20px;
      left: 50%;
      transform: translateX(-50%) translateY(-100px);
      background: rgba(44, 36, 22, 0.95);
      color: white;
      padding: 12px 24px;
      border-radius: 999px;
      font-size: 14px;
      font-weight: 500;
      z-index: 9999;
      opacity: 0;
      transition: all 0.3s ease;
      backdrop-filter: blur(10px);
      box-shadow: 0 4px 20px rgba(0,0,0,0.2);
      white-space: nowrap;
    }

    .toast.show {
      transform: translateX(-50%) translateY(0);
      opacity: 1;
    }

    /* Skeleton Loading */
    .skeleton-card {
      pointer-events: none;
    }
    
    .skeleton {
      background: linear-gradient(90deg, var(--bg-tertiary) 25%, #e8e0d5 50%, var(--bg-tertiary) 75%);
      background-size: 200% 100%;
      animation: loading 1.5s infinite;
      border-radius: var(--radius-sm);
    }

    @keyframes loading {
      0% { background-position: 200% 0; }
      100% { background-position: -200% 0; }
    }

    /* Header */
    .header {
      position: sticky;
      top: 0;
      z-index: 100;
      background: rgba(250, 248, 245, 0.95);
      backdrop-filter: blur(20px);
      border-bottom: 1px solid var(--border-light);
      padding: 12px 16px;
    }

    .header-top {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 12px;
    }

    .logo {
      font-size: 24px;
      font-weight: 700;
      background: var(--accent-gradient);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }

    .user-avatar {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      border: 2px solid var(--accent-gold);
      overflow: hidden;
      background: var(--bg-warm);
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 600;
      color: var(--accent-gold);
      cursor: pointer;
    }

    .user-avatar img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }

    /* Search */
    .search-container {
      position: relative;
      margin-bottom: 12px;
    }

    .search-input {
      width: 100%;
      padding: 12px 16px 12px 44px;
      border: 1px solid var(--border-light);
      border-radius: var(--radius-md);
      background: var(--bg-secondary);
      font-size: 15px;
      color: var(--text-primary);
      outline: none;
      transition: all 0.2s;
    }

    .search-input:focus {
      border-color: var(--accent-gold);
      box-shadow: 0 0 0 3px rgba(201, 169, 98, 0.1);
    }

    .search-icon {
      position: absolute;
      left: 16px;
      top: 50%;
      transform: translateY(-50%);
      color: var(--text-muted);
    }

    /* Categories */
    .categories {
      display: flex;
      gap: 8px;
      overflow-x: auto;
      padding-bottom: 4px;
      scrollbar-width: none;
    }

    .categories::-webkit-scrollbar { display: none; }

    .category-tab {
      padding: 8px 16px;
      border-radius: 999px;
      border: 1px solid var(--border-light);
      background: var(--bg-secondary);
      color: var(--text-secondary);
      font-size: 14px;
      font-weight: 500;
      cursor: pointer;
      white-space: nowrap;
      transition: all 0.2s;
    }

    .category-tab.active {
      background: var(--accent-gradient);
      color: white;
      border-color: transparent;
    }

    /* Hits Section */
    .hits-section {
      padding: 20px 16px;
      background: var(--bg-warm);
      margin: 0 -16px 20px;
    }

    .section-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 16px;
      padding: 0 16px;
    }

    .section-title {
      font-size: 20px;
      font-weight: 700;
      color: var(--text-primary);
    }

    .hits-scroll {
      display: flex;
      gap: 12px;
      overflow-x: auto;
      padding: 4px 16px;
      scrollbar-width: none;
    }

    .hits-scroll::-webkit-scrollbar { display: none; }

    .hit-card {
      flex: 0 0 280px;
      background: var(--bg-secondary);
      border-radius: var(--radius-lg);
      overflow: hidden;
      box-shadow: var(--shadow-soft);
      cursor: pointer;
      transition: transform 0.3s, box-shadow 0.3s;
    }

    .hit-card:hover {
      transform: translateY(-4px);
      box-shadow: var(--shadow-elevated);
    }

    .hit-image {
      width: 100%;
      height: 160px;
      object-fit: cover;
      background: var(--bg-tertiary);
    }

    .hit-content {
      padding: 16px;
    }

    .hit-badge {
      display: inline-block;
      padding: 4px 12px;
      background: var(--accent-gradient);
      color: white;
      font-size: 12px;
      font-weight: 700;
      border-radius: 999px;
      margin-bottom: 8px;
    }

    .hit-name {
      font-size: 16px;
      font-weight: 600;
      margin-bottom: 4px;
      color: var(--text-primary);
    }

    .hit-price {
      font-size: 18px;
      font-weight: 700;
      color: var(--accent-gold);
    }

    /* Products */
    .products-section {
      padding: 0 16px;
    }

    .products-category {
      margin-bottom: 32px;
    }

    .category-title {
      font-size: 18px;
      font-weight: 700;
      color: var(--text-primary);
      margin-bottom: 16px;
      display: flex;
      align-items: center;
      gap: 8px;
      position: sticky;
      top: 140px;
      background: var(--bg-primary);
      padding: 8px 0;
      z-index: 10;
    }

    .category-title::before {
      content: '';
      width: 4px;
      height: 20px;
      background: var(--accent-gradient);
      border-radius: 2px;
    }

    .product-grid {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 16px;
    }

    @media (min-width: 768px) {
      .product-grid { grid-template-columns: repeat(3, 1fr); }
    }

    @media (min-width: 1024px) {
      .product-grid { grid-template-columns: repeat(4, 1fr); }
    }

    .product-card {
      background: var(--bg-secondary);
      border-radius: var(--radius-lg);
      overflow: hidden;
      box-shadow: var(--shadow-soft);
      position: relative;
      transition: transform 0.3s, box-shadow 0.3s;
      display: flex;
      flex-direction: column;
      animation: fadeIn 0.4s ease;
    }

    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }

    .product-card:hover {
      transform: translateY(-4px);
      box-shadow: var(--shadow-elevated);
    }

    .product-image-wrap {
      position: relative;
      aspect-ratio: 4/3;
      overflow: hidden;
      background: var(--bg-tertiary);
      cursor: pointer;
    }

    .product-image {
      width: 100%;
      height: 100%;
      object-fit: cover;
      transition: transform 0.3s, opacity 0.3s;
    }

    .product-card:hover .product-image {
      transform: scale(1.05);
    }

    .product-badge-hit {
      position: absolute;
      top: 12px;
      left: 12px;
      padding: 6px 12px;
      background: var(--accent-gradient);
      color: white;
      font-size: 11px;
      font-weight: 700;
      border-radius: 999px;
      text-transform: uppercase;
      letter-spacing: 0.05em;
    }

    .fav-btn {
      position: absolute;
      top: 12px;
      right: 12px;
      width: 36px;
      height: 36px;
      border-radius: 50%;
      border: 1px solid var(--border-light);
      background: rgba(255, 255, 255, 0.9);
      backdrop-filter: blur(4px);
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 18px;
      color: var(--text-muted);
      transition: all 0.2s;
      z-index: 5;
    }

    .fav-btn:hover { transform: scale(1.1); }
    .fav-btn.active { color: #e74c3c; border-color: rgba(231, 76, 60, 0.3); }

    .quick-add-btn {
      position: absolute;
      bottom: 12px;
      right: 12px;
      width: 40px;
      height: 40px;
      border-radius: 50%;
      border: none;
      background: var(--accent-gradient);
      color: white;
      font-size: 24px;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      box-shadow: 0 4px 12px rgba(201, 169, 98, 0.4);
      transition: all 0.2s;
      z-index: 5;
      -webkit-tap-highlight-color: transparent;
      touch-action: manipulation;
    }

    .quick-add-btn:hover {
      transform: scale(1.1);
    }

    .quick-add-btn:active {
      transform: scale(0.95);
    }

    .quick-add-btn.adding {
      animation: btnPulse 0.4s ease;
    }

    @keyframes btnPulse {
      0% { transform: scale(1); }
      50% { transform: scale(0.85); }
      100% { transform: scale(1); }
    }

    .ripple {
      position: absolute;
      border-radius: 50%;
      background: rgba(255, 255, 255, 0.6);
      transform: scale(0);
      animation: rippleEffect 0.6s ease-out;
      pointer-events: none;
      width: 20px;
      height: 20px;
      margin-left: -10px;
      margin-top: -10px;
    }

    @keyframes rippleEffect {
      to { transform: scale(4); opacity: 0; }
    }

    .product-info {
      padding: 16px;
      flex: 1;
      display: flex;
      flex-direction: column;
    }

    .product-name {
      font-size: 15px;
      font-weight: 600;
      line-height: 1.4;
      margin-bottom: 8px;
      display: -webkit-box;
      -webkit-line-clamp: 2;
      -webkit-box-orient: vertical;
      overflow: hidden;
      color: var(--text-primary);
      cursor: pointer;
    }

    .product-footer {
      margin-top: auto;
      display: flex;
      align-items: center;
      justify-content: space-between;
    }

    .product-price {
      font-size: 18px;
      font-weight: 700;
      color: var(--accent-gold);
    }

    .variant-selector {
      margin-top: 8px;
      display: flex;
      gap: 4px;
      flex-wrap: wrap;
    }

    .variant-chip {
      padding: 4px 8px;
      border: 1px solid var(--border-light);
      border-radius: 12px;
      background: white;
      color: var(--text-secondary);
      font-size: 11px;
      cursor: pointer;
      transition: all 0.2s;
      font-weight: 500;
    }

    .variant-chip.active {
      background: var(--accent-gold);
      color: white;
      border-color: var(--accent-gold);
    }

    /* Mini Cart Bar */
    .mini-cart-bar {
      position: fixed;
      bottom: 90px;
      left: 16px;
      right: 16px;
      background: white;
      border-radius: 16px;
      padding: 12px 16px;
      box-shadow: 0 4px 20px rgba(0,0,0,0.15);
      z-index: 40;
      transform: translateY(200%);
      transition: transform 0.3s ease;
      display: flex;
      align-items: center;
      justify-content: space-between;
    }

    .mini-cart-bar.visible {
      transform: translateY(0);
    }

    .mini-cart-info {
      display: flex;
      flex-direction: column;
    }

    .mini-cart-count {
      font-size: 13px;
      color: var(--text-muted);
    }

    .mini-cart-total {
      font-size: 18px;
      font-weight: 700;
      color: var(--accent-gold);
    }

    .mini-cart-btn {
      background: var(--accent-gradient);
      color: white;
      border: none;
      padding: 10px 20px;
      border-radius: 12px;
      font-weight: 600;
      cursor: pointer;
      font-size: 14px;
    }

    /* Order History */
    .orders-list {
      display: flex;
      flex-direction: column;
      gap: 12px;
    }

    .order-card {
      background: var(--bg-secondary);
      border-radius: var(--radius-md);
      padding: 16px;
      box-shadow: var(--shadow-soft);
    }

    .order-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 12px;
    }

    .order-id {
      font-weight: 700;
      color: var(--text-primary);
    }

    .order-status {
      font-size: 12px;
      padding: 4px 12px;
      border-radius: 999px;
      font-weight: 600;
    }

    .order-status.new { background: #e3f2fd; color: #1976d2; }
    .order-status.processing { background: #fff3e0; color: #f57c00; }
    .order-status.done { background: #e8f5e9; color: #388e3c; }
    .order-status.cancelled { background: #ffebee; color: #d32f2f; }

    .order-items-preview {
      display: flex;
      gap: 8px;
      margin-bottom: 12px;
      align-items: center;
    }

    .order-item-thumb {
      width: 40px;
      height: 40px;
      border-radius: 8px;
      object-fit: cover;
      background: var(--bg-tertiary);
    }

    .order-more {
      width: 40px;
      height: 40px;
      border-radius: 8px;
      background: var(--bg-tertiary);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 12px;
      color: var(--text-muted);
    }

    .order-footer {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 12px;
      font-size: 14px;
      color: var(--text-secondary);
    }

    .order-total {
      font-weight: 700;
      color: var(--accent-gold);
      font-size: 16px;
    }

    .reorder-btn {
      width: 100%;
      padding: 10px;
      background: var(--bg-primary);
      border: 1px solid var(--border-light);
      border-radius: var(--radius-sm);
      color: var(--text-primary);
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s;
    }

    .reorder-btn:hover {
      background: var(--accent-gradient);
      color: white;
      border-color: transparent;
    }

    /* Modal */
    .modal-overlay {
      position: fixed;
      inset: 0;
      background: rgba(0, 0, 0, 0.5);
      opacity: 0;
      visibility: hidden;
      transition: all 0.3s;
      z-index: 200;
      display: flex;
      align-items: flex-end;
    }

    .modal-overlay.active {
      opacity: 1;
      visibility: visible;
    }

    .modal-sheet {
      width: 100%;
      max-height: 90vh;
      background: var(--bg-secondary);
      border-radius: var(--radius-lg) var(--radius-lg) 0 0;
      transform: translateY(100%);
      transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      overflow: hidden;
      display: flex;
      flex-direction: column;
    }

    .modal-overlay.active .modal-sheet {
      transform: translateY(0);
    }

    .modal-handle {
      width: 40px;
      height: 4px;
      background: var(--border-light);
      border-radius: 2px;
      margin: 12px auto;
    }

    .modal-header {
      padding: 0 20px 16px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      border-bottom: 1px solid var(--border-light);
    }

    .modal-title {
      font-size: 20px;
      font-weight: 700;
      color: var(--text-primary);
      padding-right: 20px;
    }

    .modal-close {
      width: 36px;
      height: 36px;
      border-radius: 50%;
      border: none;
      background: var(--bg-tertiary);
      color: var(--text-secondary);
      font-size: 20px;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.2s;
    }

    .modal-close:hover { background: var(--border-light); }

    .modal-body {
      flex: 1;
      overflow-y: auto;
      padding: 20px;
    }

    .modal-image-container {
      position: relative;
      width: 100%;
      height: 250px;
      border-radius: var(--radius-md);
      overflow: hidden;
      margin-bottom: 20px;
      background: var(--bg-tertiary);
    }

    .modal-image {
      width: 100%;
      height: 100%;
      object-fit: cover;
      transition: opacity 0.3s;
    }

    .modal-description {
      font-size: 15px;
      line-height: 1.6;
      color: var(--text-secondary);
      margin-bottom: 20px;
    }

    .variant-tabs {
      display: flex;
      gap: 8px;
      margin-bottom: 16px;
      overflow-x: auto;
      padding-bottom: 4px;
    }

    .variant-tab {
      padding: 10px 16px;
      border-radius: var(--radius-md);
      border: 1px solid var(--border-light);
      background: var(--bg-primary);
      color: var(--text-secondary);
      font-size: 14px;
      font-weight: 500;
      cursor: pointer;
      white-space: nowrap;
      transition: all 0.2s;
    }

    .variant-tab.active {
      background: var(--accent-gradient);
      color: white;
      border-color: transparent;
    }

    .weight-section {
      margin-bottom: 20px;
    }

    .section-label {
      font-size: 14px;
      font-weight: 600;
      color: var(--text-primary);
      margin-bottom: 12px;
      display: block;
    }

    .weight-pills {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
    }

    .weight-pill {
      padding: 10px 16px;
      border-radius: var(--radius-md);
      border: 1px solid var(--border-light);
      background: var(--bg-primary);
      color: var(--text-secondary);
      font-size: 14px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s;
    }

    .weight-pill:hover { border-color: var(--accent-gold); }
    .weight-pill.active {
      background: var(--accent-gradient);
      color: white;
      border-color: transparent;
    }

    .qty-section {
      display: flex;
      align-items: center;
      gap: 16px;
      margin-bottom: 24px;
    }

    .qty-label {
      font-size: 14px;
      font-weight: 600;
      color: var(--text-primary);
    }

    .qty-controls {
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .qty-btn {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      border: 1px solid var(--border-light);
      background: var(--bg-primary);
      color: var(--text-primary);
      font-size: 20px;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.2s;
    }

    .qty-btn:hover { border-color: var(--accent-gold); }

    .qty-value {
      font-size: 18px;
      font-weight: 700;
      color: var(--text-primary);
      min-width: 30px;
      text-align: center;
    }

    .price-display {
      font-size: 28px;
      font-weight: 700;
      color: var(--accent-gold);
      margin-bottom: 8px;
      display: flex;
      align-items: baseline;
      gap: 12px;
      flex-wrap: wrap;
    }

    .price-old {
      font-size: 20px;
      color: var(--text-muted);
      text-decoration: line-through;
      font-weight: 500;
    }

    .price-diff {
      font-size: 14px;
      color: #2e7d32;
      font-weight: 600;
      background: #e8f5e9;
      padding: 6px 12px;
      border-radius: 999px;
    }

    .modal-actions {
      display: flex;
      gap: 12px;
      margin-top: 24px;
    }

    .btn-fav {
      flex: 0 0 56px;
      height: 56px;
      border-radius: var(--radius-md);
      border: 1px solid var(--border-light);
      background: var(--bg-primary);
      color: var(--text-secondary);
      font-size: 24px;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.2s;
    }

    .btn-fav.active { color: #e74c3c; border-color: rgba(231, 76, 60, 0.3); }

    .button-container {
      position: relative;
      width: 100%;
      height: 80px;
      perspective: 1000px;
      z-index: 1;
    }

    .cow-arm {
      position: absolute;
      width: 50px;
      height: 80px;
      top: 0;
      pointer-events: none;
      transition: all 0.4s cubic-bezier(0.68, -0.55, 0.265, 1.55);
      opacity: 0;
      z-index: 5;
    }

    .cow-arm.left {
      left: 10px;
      transform: rotate(-20deg) translateX(20px) scale(0.8);
    }

    .cow-arm.right {
      right: 10px;
      transform: rotate(20deg) translateX(-20px) scale(0.8);
    }

    .button-container:hover .cow-arm.left {
      opacity: 1;
      transform: rotate(0deg) translateX(0) scale(1);
    }

    .button-container:hover .cow-arm.right {
      opacity: 1;
      transform: rotate(0deg) translateX(0) scale(1);
    }

    .cow-head-wrapper {
      position: absolute;
      bottom: 10px;
      left: 50%;
      transform: translateX(-50%) translateY(0);
      width: 100px;
      height: 90px;
      z-index: 5;
      pointer-events: none;
      transition: all 0.5s cubic-bezier(0.68, -0.55, 0.265, 1.55);
      filter: drop-shadow(0 4px 12px rgba(92, 74, 50, 0.2));
    }

    .button-container:hover .cow-head-wrapper {
      transform: translateX(-50%) translateY(-60px);
      z-index: 15;
    }

    .cow-button {
      position: relative;
      width: 100%;
      height: 60px;
      border: none;
      outline: none;
      background: linear-gradient(180deg, #f4e4c1 0%, #e6d5b0 100%);
      border-radius: 30px;
      cursor: pointer;
      box-shadow: 
        inset 0 2px 0 rgba(255,255,255,0.6),
        inset 0 -2px 0 rgba(139, 115, 85, 0.1),
        0 6px 0 #c9b896,
        0 8px 20px rgba(92, 74, 50, 0.25),
        0 12px 30px rgba(212, 175, 55, 0.15);
      z-index: 10;
      transform-style: preserve-3d;
      transition: all 0.2s ease;
      overflow: hidden;
    }

    .cow-button:active {
      transform: translateY(6px) scale(0.98);
      box-shadow: 
        inset 0 2px 4px rgba(139, 115, 85, 0.2),
        0 2px 0 #c9b896,
        0 4px 10px rgba(92, 74, 50, 0.2);
    }

    .button-text {
      display: block;
      font-size: 16px;
      font-weight: 700;
      color: #5c4a32;
      text-transform: uppercase;
      letter-spacing: 1.5px;
      text-shadow: 0 1px 0 rgba(255,255,255,0.5);
      position: relative;
      z-index: 12;
      transition: transform 0.3s ease;
    }

    .button-container:hover .button-text {
      transform: translateY(2px);
    }

    .sparkle {
      position: fixed;
      width: 8px;
      height: 8px;
      background: #d4af37;
      border-radius: 50%;
      pointer-events: none;
      z-index: 20;
      box-shadow: 0 0 6px #d4af37;
    }

    @keyframes fly-up-left { to { transform: translate(-30px, -40px) scale(0); opacity: 0; } }
    @keyframes fly-up-right { to { transform: translate(30px, -40px) scale(0); opacity: 0; } }
    @keyframes fly-left { to { transform: translate(-40px, 0) scale(0); opacity: 0; } }
    @keyframes fly-right { to { transform: translate(40px, 0) scale(0); opacity: 0; } }
    @keyframes fly-up { to { transform: translate(0, -50px) scale(0); opacity: 0; } }

    /* 3D Cube Loader - Styled for Cheese Theme */
    .loader-overlay {
      position: fixed;
      inset: 0;
      background: rgba(250, 248, 245, 0.98);
      display: none;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      z-index: 10000;
      gap: 40px;
    }

    .loader-overlay.active { display: flex; }

    .loader {
      --duration: 3s;
      --primary: #C9A962;
      --primary-light: #E8B86D;
      --primary-rgba: rgba(201, 169, 98, 0);
      width: 200px;
      height: 320px;
      position: relative;
      transform-style: preserve-3d;
    }

    @media (max-width: 480px) {
      .loader { zoom: 0.44; }
    }

    .loader:before, .loader:after {
      --r: 20.5deg;
      content: "";
      width: 320px;
      height: 140px;
      position: absolute;
      right: 32%;
      bottom: -11px;
      background: #F5F0E8;
      transform: translateZ(200px) rotate(var(--r));
      animation: mask var(--duration) linear forwards infinite;
    }

    .loader:after {
      --r: -20.5deg;
      right: auto;
      left: 32%;
    }

    .loader .ground {
      position: absolute;
      left: -50px;
      bottom: -120px;
      transform-style: preserve-3d;
      transform: rotateY(-47deg) rotateX(-15deg) rotateZ(15deg) scale(1);
    }

    .loader .ground div {
      transform: rotateX(90deg) rotateY(0deg) translate(-48px, -120px) translateZ(100px) scale(0);
      width: 200px;
      height: 200px;
      background: var(--primary);
      background: linear-gradient(45deg, var(--primary) 0%, var(--primary) 50%, var(--primary-light) 50%, var(--primary-light) 100%);
      transform-style: preserve-3d;
      animation: ground var(--duration) linear forwards infinite;
    }

    .loader .ground div:before, .loader .ground div:after {
      --rx: 90deg;
      --ry: 0deg;
      --x: 44px;
      --y: 162px;
      --z: -50px;
      content: "";
      width: 156px;
      height: 300px;
      opacity: 0;
      background: linear-gradient(var(--primary), var(--primary-rgba));
      position: absolute;
      transform: rotateX(var(--rx)) rotateY(var(--ry)) translate(var(--x), var(--y)) translateZ(var(--z));
      animation: ground-shine var(--duration) linear forwards infinite;
    }

    .loader .ground div:after {
      --rx: 90deg;
      --ry: 90deg;
      --x: 0;
      --y: 177px;
      --z: 150px;
    }

    .loader .box {
      --x: 0;
      --y: 0;
      position: absolute;
      animation: var(--duration) linear forwards infinite;
      transform: translate(var(--x), var(--y));
    }

    .loader .box div {
      background-color: var(--primary);
      width: 48px;
      height: 48px;
      position: relative;
      transform-style: preserve-3d;
      animation: var(--duration) ease forwards infinite;
      transform: rotateY(-47deg) rotateX(-15deg) rotateZ(15deg) scale(0);
    }

    .loader .box div:before, .loader .box div:after {
      --rx: 90deg;
      --ry: 0deg;
      --z: 24px;
      --y: -24px;
      --x: 0;
      content: "";
      position: absolute;
      background-color: inherit;
      width: inherit;
      height: inherit;
      transform: rotateX(var(--rx)) rotateY(var(--ry)) translate(var(--x), var(--y)) translateZ(var(--z));
      filter: brightness(var(--b, 1.2));
    }

    .loader .box div:after {
      --rx: 0deg;
      --ry: 90deg;
      --x: 24px;
      --y: 0;
      --b: 1.4;
    }

    .loader .box.box0 { --x: -220px; --y: -120px; left: 58px; top: 108px; }
    .loader .box.box1 { --x: -260px; --y: 120px; left: 25px; top: 120px; }
    .loader .box.box2 { --x: 120px; --y: -190px; left: 58px; top: 64px; }
    .loader .box.box3 { --x: 280px; --y: -40px; left: 91px; top: 120px; }
    .loader .box.box4 { --x: 60px; --y: 200px; left: 58px; top: 132px; }
    .loader .box.box5 { --x: -220px; --y: -120px; left: 25px; top: 76px; }
    .loader .box.box6 { --x: -260px; --y: 120px; left: 91px; top: 76px; }
    .loader .box.box7 { --x: -240px; --y: 200px; left: 58px; top: 87px; }

    .loader .box0 { animation-name: box-move0; }
    .loader .box0 div { animation-name: box-scale0; }
    .loader .box1 { animation-name: box-move1; }
    .loader .box1 div { animation-name: box-scale1; }
    .loader .box2 { animation-name: box-move2; }
    .loader .box2 div { animation-name: box-scale2; }
    .loader .box3 { animation-name: box-move3; }
    .loader .box3 div { animation-name: box-scale3; }
    .loader .box4 { animation-name: box-move4; }
    .loader .box4 div { animation-name: box-scale4; }
    .loader .box5 { animation-name: box-move5; }
    .loader .box5 div { animation-name: box-scale5; }
    .loader .box6 { animation-name: box-move6; }
    .loader .box6 div { animation-name: box-scale6; }
    .loader .box7 { animation-name: box-move7; }
    .loader .box7 div { animation-name: box-scale7; }

    @keyframes box-move0 {
      12% { transform: translate(var(--x), var(--y)); }
      25%, 52% { transform: translate(0, 0); }
      80% { transform: translate(0, -32px); }
      90%, 100% { transform: translate(0, 188px); }
    }

    @keyframes box-scale0 {
      6% { transform: rotateY(-47deg) rotateX(-15deg) rotateZ(15deg) scale(0); }
      14%, 100% { transform: rotateY(-47deg) rotateX(-15deg) rotateZ(15deg) scale(1); }
    }

    @keyframes box-move1 {
      16% { transform: translate(var(--x), var(--y)); }
      29%, 52% { transform: translate(0, 0); }
      80% { transform: translate(0, -32px); }
      90%, 100% { transform: translate(0, 188px); }
    }

    @keyframes box-scale1 {
      10% { transform: rotateY(-47deg) rotateX(-15deg) rotateZ(15deg) scale(0); }
      18%, 100% { transform: rotateY(-47deg) rotateX(-15deg) rotateZ(15deg) scale(1); }
    }

    @keyframes box-move2 {
      20% { transform: translate(var(--x), var(--y)); }
      33%, 52% { transform: translate(0, 0); }
      80% { transform: translate(0, -32px); }
      90%, 100% { transform: translate(0, 188px); }
    }

    @keyframes box-scale2 {
      14% { transform: rotateY(-47deg) rotateX(-15deg) rotateZ(15deg) scale(0); }
      22%, 100% { transform: rotateY(-47deg) rotateX(-15deg) rotateZ(15deg) scale(1); }
    }

    @keyframes box-move3 {
      24% { transform: translate(var(--x), var(--y)); }
      37%, 52% { transform: translate(0, 0); }
      80% { transform: translate(0, -32px); }
      90%, 100% { transform: translate(0, 188px); }
    }

    @keyframes box-scale3 {
      18% { transform: rotateY(-47deg) rotateX(-15deg) rotateZ(15deg) scale(0); }
      26%, 100% { transform: rotateY(-47deg) rotateX(-15deg) rotateZ(15deg) scale(1); }
    }

    @keyframes box-move4 {
      28% { transform: translate(var(--x), var(--y)); }
      41%, 52% { transform: translate(0, 0); }
      80% { transform: translate(0, -32px); }
      90%, 100% { transform: translate(0, 188px); }
    }

    @keyframes box-scale4 {
      22% { transform: rotateY(-47deg) rotateX(-15deg) rotateZ(15deg) scale(0); }
      30%, 100% { transform: rotateY(-47deg) rotateX(-15deg) rotateZ(15deg) scale(1); }
    }

    @keyframes box-move5 {
      32% { transform: translate(var(--x), var(--y)); }
      45%, 52% { transform: translate(0, 0); }
      80% { transform: translate(0, -32px); }
      90%, 100% { transform: translate(0, 188px); }
    }

    @keyframes box-scale5 {
      26% { transform: rotateY(-47deg) rotateX(-15deg) rotateZ(15deg) scale(0); }
      34%, 100% { transform: rotateY(-47deg) rotateX(-15deg) rotateZ(15deg) scale(1); }
    }

    @keyframes box-move6 {
      36% { transform: translate(var(--x), var(--y)); }
      49%, 52% { transform: translate(0, 0); }
      80% { transform: translate(0, -32px); }
      90%, 100% { transform: translate(0, 188px); }
    }

    @keyframes box-scale6 {
      30% { transform: rotateY(-47deg) rotateX(-15deg) rotateZ(15deg) scale(0); }
      38%, 100% { transform: rotateY(-47deg) rotateX(-15deg) rotateZ(15deg) scale(1); }
    }

    @keyframes box-move7 {
      40% { transform: translate(var(--x), var(--y)); }
      53%, 52% { transform: translate(0, 0); }
      80% { transform: translate(0, -32px); }
      90%, 100% { transform: translate(0, 188px); }
    }

    @keyframes box-scale7 {
      34% { transform: rotateY(-47deg) rotateX(-15deg) rotateZ(15deg) scale(0); }
      42%, 100% { transform: rotateY(-47deg) rotateX(-15deg) rotateZ(15deg) scale(1); }
    }

    @keyframes ground {
      0%, 65% { transform: rotateX(90deg) rotateY(0deg) translate(-48px, -120px) translateZ(100px) scale(0); }
      75%, 90% { transform: rotateX(90deg) rotateY(0deg) translate(-48px, -120px) translateZ(100px) scale(1); }
      100% { transform: rotateX(90deg) rotateY(0deg) translate(-48px, -120px) translateZ(100px) scale(0); }
    }

    @keyframes ground-shine {
      0%, 70% { opacity: 0; }
      75%, 87% { opacity: 0.2; }
      100% { opacity: 0; }
    }

    @keyframes mask {
      0%, 65% { opacity: 0; }
      66%, 100% { opacity: 1; }
    }

    .loader-text {
      color: var(--text-secondary);
      font-size: 16px;
      font-weight: 500;
      text-align: center;
      margin-top: 20px;
    }

    /* Bottom Nav */
    .bottom-nav {
      position: fixed;
      bottom: 0;
      left: 0;
      right: 0;
      background: var(--bg-secondary);
      border-top: 1px solid var(--border-light);
      padding: 8px 16px calc(8px + env(safe-area-inset-bottom));
      display: flex;
      justify-content: space-around;
      z-index: 50;
      box-shadow: 0 -4px 20px rgba(44, 36, 22, 0.06);
    }

    .nav-item {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 4px;
      padding: 8px 12px;
      color: var(--text-muted);
      text-decoration: none;
      font-size: 11px;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.2s;
      position: relative;
      border: none;
      background: none;
      font-family: inherit;
    }

    .nav-item.active { color: var(--accent-gold); }
    .nav-item svg { width: 24px; height: 24px; }

    .nav-badge {
      position: absolute;
      top: 4px;
      right: 4px;
      min-width: 18px;
      height: 18px;
      padding: 0 6px;
      background: var(--accent-gold);
      color: white;
      font-size: 11px;
      font-weight: 700;
      border-radius: 999px;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: transform 0.3s;
    }

    .nav-badge.pulse {
      animation: badgePulse 0.3s ease;
    }

    @keyframes badgePulse {
      0%, 100% { transform: scale(1); }
      50% { transform: scale(1.3); }
    }

    /* Cart Styles */
    .cart-item {
      display: flex;
      gap: 12px;
      padding: 16px;
      background: var(--bg-primary);
      border-radius: var(--radius-md);
      margin-bottom: 12px;
      position: relative;
      overflow: hidden;
    }

    .cart-item.removing {
      animation: slideOut 0.3s ease forwards;
    }

    @keyframes slideOut {
      to { transform: translateX(-100%); opacity: 0; }
    }

    .cart-item-image {
      width: 60px;
      height: 60px;
      border-radius: var(--radius-sm);
      object-fit: cover;
      background: var(--bg-tertiary);
    }

    .cart-item-info { flex: 1; }

    .cart-item-name {
      font-size: 15px;
      font-weight: 600;
      margin-bottom: 4px;
      color: var(--text-primary);
    }

    .cart-item-variant {
      font-size: 13px;
      color: var(--text-muted);
      margin-bottom: 8px;
    }

    .cart-item-controls {
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .cart-qty-btn {
      width: 28px;
      height: 28px;
      border-radius: 50%;
      border: 1px solid var(--border-light);
      background: var(--bg-secondary);
      color: var(--text-primary);
      font-size: 16px;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.2s;
    }

    .cart-qty-btn:hover { border-color: var(--accent-gold); }

    .cart-item-price {
      font-size: 16px;
      font-weight: 700;
      color: var(--accent-gold);
      margin-left: auto;
      align-self: center;
      text-align: right;
    }

    .cart-item-price .old {
      font-size: 13px;
      color: var(--text-muted);
      text-decoration: line-through;
      font-weight: 500;
      display: block;
    }

    .cart-item-price .new {
      display: block;
    }

    .cart-item-price .save {
      font-size: 11px;
      color: #2e7d32;
      font-weight: 600;
      background: #e8f5e9;
      padding: 2px 6px;
      border-radius: 8px;
      display: inline-block;
      margin-top: 2px;
    }

    .cart-summary {
      padding: 20px;
      background: var(--bg-warm);
      border-radius: var(--radius-md);
      margin-top: 20px;
      margin-bottom: 20px;
    }

    .cart-total-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 8px;
      font-size: 14px;
      color: var(--text-secondary);
    }

    .cart-total-row.discount {
      color: #2e7d32;
      font-weight: 600;
    }

    .cart-total {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-top: 12px;
      padding-top: 12px;
      border-top: 1px solid var(--border-light);
    }

    .cart-total-label {
      font-size: 16px;
      color: var(--text-primary);
      font-weight: 600;
    }

    .cart-total-price {
      font-size: 24px;
      font-weight: 700;
      color: var(--accent-gold);
    }

    .form-group {
      margin-bottom: 16px;
    }

    .form-label {
      display: block;
      font-size: 14px;
      font-weight: 600;
      color: var(--text-primary);
      margin-bottom: 8px;
    }

    .form-input, .form-textarea, .form-select {
      width: 100%;
      padding: 12px 16px;
      border: 1px solid var(--border-light);
      border-radius: var(--radius-md);
      background: var(--bg-secondary);
      font-size: 15px;
      color: var(--text-primary);
      outline: none;
      transition: all 0.2s;
    }

    .form-input:focus, .form-textarea:focus, .form-select:focus {
      border-color: var(--accent-gold);
      box-shadow: 0 0 0 3px rgba(201, 169, 98, 0.1);
    }

    .form-textarea {
      resize: vertical;
      min-height: 80px;
    }

    /* Empty State */
    .empty-state {
      text-align: center;
      padding: 60px 20px;
      color: var(--text-muted);
    }

    .empty-state-icon {
      font-size: 48px;
      margin-bottom: 16px;
      opacity: 0.5;
    }

    /* Profile Modal */
    .profile-info {
      text-align: center;
      padding: 20px;
    }

    .profile-avatar {
      width: 80px;
      height: 80px;
      border-radius: 50%;
      border: 3px solid var(--accent-gold);
      margin: 0 auto 16px;
      background: var(--bg-warm);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 32px;
      color: var(--accent-gold);
      font-weight: 600;
    }

    .profile-name {
      font-size: 20px;
      font-weight: 700;
      color: var(--text-primary);
      margin-bottom: 8px;
    }

    .profile-phone {
      font-size: 15px;
      color: var(--text-muted);
    }

    /* Scrollbar */
    ::-webkit-scrollbar { width: 6px; height: 6px; }
    ::-webkit-scrollbar-track { background: var(--bg-tertiary); }
    ::-webkit-scrollbar-thumb { background: var(--accent-gold); border-radius: 3px; }

    /* Offline indicator */
    .offline-indicator {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      background: #ff9800;
      color: white;
      text-align: center;
      padding: 8px;
      font-size: 14px;
      font-weight: 500;
      z-index: 9999;
      transform: translateY(-100%);
      transition: transform 0.3s;
    }

    .offline-indicator.show {
      transform: translateY(0);
    }
  </style>
<base target="_blank">
</head>
<body>
  <div id="offline-indicator" class="offline-indicator">‚ö†Ô∏è –û—Ñ–ª–∞–π–Ω —Ä–µ–∂–∏–º. –ó–∞–∫–∞–∑—ã —Å–æ—Ö—Ä–∞–Ω—è—Ç—Å—è –ª–æ–∫–∞–ª—å–Ω–æ.</div>
  <div id="toast" class="toast"></div>
  
  <div id="mini-cart-bar" class="mini-cart-bar">
    <div class="mini-cart-info">
      <span class="mini-cart-count">0 —Ç–æ–≤–∞—Ä–æ–≤</span>
      <span class="mini-cart-total">0 ‚ÇΩ</span>
    </div>
    <button class="mini-cart-btn" onclick="openCartModal()">–û—Ñ–æ—Ä–º–∏—Ç—å ‚Üí</button>
  </div>

  <div id="app">
    <header class="header">
      <div class="header-top">
        <div class="logo">–°—ã—Ä–æ–º–∞–Ω–∏—è</div>
        <div class="user-avatar" id="user-avatar" onclick="openProfileModal()">
          <span>–°</span>
        </div>
      </div>
      
      <div class="search-container">
        <span class="search-icon">üîç</span>
        <input type="text" class="search-input" id="search-input" placeholder="–ü–æ–∏—Å–∫ –ø–æ –Ω–∞–∑–≤–∞–Ω–∏—é..." />
      </div>

      <div class="categories" id="categories">
        <button class="category-tab active" data-category="all">–í—Å–µ</button>
        <button class="category-tab" data-category="cheese">–°—ã—Ä—ã</button>
        <button class="category-tab" data-category="dairy">–ú–æ–ª–æ—á–∫–∞</button>
        <button class="category-tab" data-category="sweets">–°–ª–∞–¥–æ—Å—Ç–∏</button>
        <button class="category-tab" data-category="bakery">–í—ã–ø–µ—á–∫–∞</button>
      </div>
    </header>

    <section class="hits-section">
      <div class="section-header">
        <h2 class="section-title">üî• –•–∏—Ç—ã –ø—Ä–æ–¥–∞–∂</h2>
      </div>
      <div class="hits-scroll" id="hits-scroll"></div>
    </section>

    <section class="products-section" id="products-section"></section>
  </div>

  <!-- Product Modal -->
  <div class="modal-overlay" id="product-modal">
    <div class="modal-sheet">
      <div class="modal-handle"></div>
      <div class="modal-header">
        <h3 class="modal-title" id="modal-title">–ù–∞–∑–≤–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞</h3>
        <button class="modal-close" onclick="closeProductModal()">‚úï</button>
      </div>
      <div class="modal-body">
        <div class="modal-image-container">
          <img src="" alt="" class="modal-image" id="modal-image" />
        </div>
        <p class="modal-description" id="modal-description"></p>
        <div class="variant-tabs" id="variant-tabs" style="display: none;"></div>
        <div class="weight-section" id="weight-section">
          <label class="section-label">–í—ã–±–µ—Ä–∏—Ç–µ –≤–µ—Å</label>
          <div class="weight-pills" id="weight-pills"></div>
        </div>
        <div class="qty-section">
          <span class="qty-label">–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ:</span>
          <div class="qty-controls">
            <button class="qty-btn" onclick="changeQty(-1)">‚àí</button>
            <span class="qty-value" id="qty-value">1</span>
            <button class="qty-btn" onclick="changeQty(1)">+</button>
          </div>
        </div>
        <div class="price-display">
          <span id="modal-price-old" class="price-old" style="display:none"></span>
          <span id="modal-price">0 ‚ÇΩ</span>
          <span class="price-diff" id="price-diff"></span>
        </div>
        <div class="modal-actions">
          <button class="btn-fav" id="modal-fav-btn" onclick="toggleModalFavorite()">‚ô°</button>
          <div class="button-container" style="flex: 1;">
            <svg class="cow-arm left" viewBox="0 0 60 100" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M45 20 C45 10, 35 5, 25 10 C15 15, 10 30, 15 50 C20 70, 30 85, 35 95 C38 100, 45 100, 50 95 C55 90, 50 70, 48 50 C46 35, 45 25, 45 20Z" fill="#fffdf9" stroke="#5c4a32" stroke-width="2"/>
              <ellipse cx="25" cy="30" rx="5" ry="7" fill="#5c4a32" opacity="0.6"/>
            </svg>
            <svg class="cow-arm right" viewBox="0 0 60 100" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M15 20 C15 10, 25 5, 35 10 C45 15, 50 30, 45 50 C40 70, 30 85, 25 95 C22 100, 15 100, 10 95 C5 90, 10 70, 12 50 C14 35, 15 25, 15 20Z" fill="#fffdf9" stroke="#5c4a32" stroke-width="2"/>
              <ellipse cx="35" cy="35" rx="4" ry="6" fill="#5c4a32" opacity="0.6"/>
            </svg>
            <div class="cow-head-wrapper">
              <svg viewBox="0 0 140 130" fill="none" xmlns="http://www.w3.org/2000/svg">
                <ellipse cx="25" cy="45" rx="18" ry="22" fill="#f4e4c1" stroke="#5c4a32" stroke-width="2" transform="rotate(-20 25 45)"/>
                <ellipse cx="115" cy="45" rx="18" ry="22" fill="#f4e4c1" stroke="#5c4a32" stroke-width="2" transform="rotate(20 115 45)"/>
                <ellipse cx="25" cy="45" rx="10" ry="14" fill="#e6d5b0" transform="rotate(-20 25 45)"/>
                <ellipse cx="115" cy="45" rx="10" ry="14" fill="#e6d5b0" transform="rotate(20 115 45)"/>
                <path d="M35 25 Q30 5, 40 0 Q45 10, 42 20" fill="#d4af37" stroke="#b8941d" stroke-width="1.5"/>
                <path d="M105 25 Q110 5, 100 0 Q95 10, 98 20" fill="#d4af37" stroke="#b8941d" stroke-width="1.5"/>
                <circle cx="40" cy="0" r="3" fill="#d4af37"/>
                <circle cx="100" cy="0" r="3" fill="#d4af37"/>
                <rect x="30" y="20" width="80" height="85" rx="35" fill="#fffdf9" stroke="#5c4a32" stroke-width="2"/>
                <ellipse cx="50" cy="40" rx="8" ry="10" fill="#5c4a32" opacity="0.8"/>
                <ellipse cx="95" cy="55" rx="6" ry="8" fill="#5c4a32" opacity="0.7"/>
                <circle cx="45" cy="75" r="5" fill="#5c4a32" opacity="0.6"/>
                <path d="M50 22 Q60 30, 70 22 Q80 30, 90 22" stroke="#f4e4c1" stroke-width="3" stroke-linecap="round" fill="none"/>
                <circle cx="55" cy="60" r="10" fill="white" stroke="#5c4a32" stroke-width="1.5"/>
                <circle cx="55" cy="60" r="6" fill="#5c4a32"/>
                <circle cx="57" cy="58" r="2.5" fill="white"/>
                <circle cx="85" cy="60" r="10" fill="white" stroke="#5c4a32" stroke-width="1.5"/>
                <circle cx="85" cy="60" r="6" fill="#5c4a32"/>
                <circle cx="87" cy="58" r="2.5" fill="white"/>
                <path d="M48 55 Q45 52, 42 54" stroke="#5c4a32" stroke-width="1" stroke-linecap="round" fill="none"/>
                <path d="M92 55 Q95 52, 98 54" stroke="#5c4a32" stroke-width="1" stroke-linecap="round" fill="none"/>
                <ellipse cx="70" cy="85" rx="22" ry="18" fill="#f9f0e0"/>
                <ellipse cx="70" cy="85" rx="18" ry="14" fill="#ffe4e1" opacity="0.5"/>
                <ellipse cx="64" cy="85" rx="3" ry="4" fill="#5c4a32" opacity="0.6"/>
                <ellipse cx="76" cy="85" rx="3" ry="4" fill="#5c4a32" opacity="0.6"/>
                <path d="M62 95 Q70 100, 78 95" stroke="#5c4a32" stroke-width="2" stroke-linecap="round" fill="none"/>
                <ellipse cx="45" cy="75" rx="6" ry="4" fill="#ffb6c1" opacity="0.4"/>
                <ellipse cx="95" cy="75" rx="6" ry="4" fill="#ffb6c1" opacity="0.4"/>
              </svg>
            </div>
            <button class="cow-button" onclick="addToCartWithAnimation()">
              <span class="button-text">–í –∫–æ—Ä–∑–∏–Ω—É</span>
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Cart Modal -->
  <div class="modal-overlay" id="cart-modal">
    <div class="modal-sheet" style="max-height: 95vh;">
      <div class="modal-handle"></div>
      <div class="modal-header">
        <h3 class="modal-title">–ö–æ—Ä–∑–∏–Ω–∞</h3>
        <button class="modal-close" onclick="closeCartModal()">‚úï</button>
      </div>
      <div class="modal-body" id="cart-body"></div>
    </div>
  </div>

  <!-- Profile Modal -->
  <div class="modal-overlay" id="profile-modal">
    <div class="modal-sheet" style="max-height: 80vh;">
      <div class="modal-handle"></div>
      <div class="modal-header">
        <h3 class="modal-title">–ü—Ä–æ—Ñ–∏–ª—å</h3>
        <button class="modal-close" onclick="closeProfileModal()">‚úï</button>
      </div>
      <div class="modal-body">
        <div class="profile-info">
          <div class="profile-avatar" id="profile-avatar">–°</div>
          <div class="profile-name" id="profile-name">–ì–æ—Å—Ç—å</div>
          <div class="profile-phone" id="profile-phone">–í–æ–π–¥–∏—Ç–µ —á–µ—Ä–µ–∑ Telegram</div>
        </div>
      </div>
    </div>
  </div>

  <!-- 3D Cube Loader -->
  <div class="loader-overlay" id="loader">
    <div class="loader">
      <div class="box box0">
        <div></div>
      </div>
      <div class="box box1">
        <div></div>
      </div>
      <div class="box box2">
        <div></div>
      </div>
      <div class="box box3">
        <div></div>
      </div>
      <div class="box box4">
        <div></div>
      </div>
      <div class="box box5">
        <div></div>
      </div>
      <div class="box box6">
        <div></div>
      </div>
      <div class="box box7">
        <div></div>
      </div>
      <div class="ground">
        <div></div>
      </div>
    </div>
    <div class="loader-text">–û—Ç–ø—Ä–∞–≤–ª—è–µ–º –∑–∞–∫–∞–∑...</div>
  </div>

  <!-- Bottom Navigation -->
  <nav class="bottom-nav">
    <button class="nav-item active" onclick="showMain()">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path>
        <polyline points="9 22 9 12 15 12 15 22"></polyline>
      </svg>
      <span>–ì–ª–∞–≤–Ω–∞—è</span>
    </button>
    <button class="nav-item" onclick="showFavorites()">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"></path>
      </svg>
      <span>–ò–∑–±—Ä–∞–Ω–Ω–æ–µ</span>
      <span class="nav-badge" id="fav-badge" style="display: none;">0</span>
    </button>
    <button class="nav-item" onclick="showOrderHistory()">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
        <polyline points="14 2 14 8 20 8"></polyline>
        <line x1="16" y1="13" x2="8" y2="13"></line>
        <line x1="16" y1="17" x2="8" y2="17"></line>
        <polyline points="10 9 9 9 8 9"></polyline>
      </svg>
      <span>–ó–∞–∫–∞–∑—ã</span>
    </button>
    <button class="nav-item" onclick="openCartModal()">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <circle cx="9" cy="21" r="1"></circle>
        <circle cx="20" cy="21" r="1"></circle>
        <path d="M1 1h4l2.68 13.39a2 2 0 0 0 2 1.61h9.72a2 2 0 0 0 2-1.61L23 6H6"></path>
      </svg>
      <span>–ö–æ—Ä–∑–∏–Ω–∞</span>
      <span class="nav-badge" id="cart-badge" style="display: none;">0</span>
    </button>
  </nav>

  <script>
    // ==================== CONFIG ====================
    const BACKEND = 'https://puzzlebot-webhook-handler1.onrender.com';
    const STORAGE_CART_KEY = 'syromania-cart';
    const STORAGE_FAVORITES_KEY = 'syromania-favorites';
    const STORAGE_OFFLINE_ORDERS = 'syromania-offline-orders';
    const STORAGE_ORDER_HISTORY = 'syromania-order-history';
    const DEFAULT_IMG = 'https://static.tildacdn.com/tild3134-3861-4539-a363-646133333238/__.webp';

    const DISCOUNT_THRESHOLDS = [
      { g: 500, rate: 0.05, label: '‚àí5%' },
      { g: 700, rate: 0.10, label: '‚àí10%' },
      { g: 1000, rate: 0.15, label: '‚àí15%' },
    ];

    // ==================== DATA ====================
    const PRODUCT_VARIANTS = {
      'halloumi-group': {
        displayName: '–•–∞–ª–ª—É–º–∏',
        baseGroup: 'cheese',
        priority: 1,
        variants: [
          { id: 'halloumi', name: '–•–∞–ª–ª—É–º–∏ –∫–ª–∞—Å—Å–∏—á–µ—Å–∫–∏–π', pricePerKg: 1950, img: 'https://static.tildacdn.com/tild3161-6362-4130-b134-623331346238/halloumi.webp', description: '–ò–¥–µ–∞–ª–µ–Ω –¥–ª—è –∂–∞—Ä–∫–∏ –Ω–∞ —Å–∫–æ–≤–æ—Ä–æ–¥–µ –∏–ª–∏ –≥—Ä–∏–ª–µ ‚Äî –ø–æ—è–≤–ª—è–µ—Ç—Å—è —Ö—Ä—É—Å—Ç—è—â–∞—è –∫–æ—Ä–æ—á–∫–∞. –ú–æ–∂–Ω–æ –µ—Å—Ç—å –∏ –±–µ–∑ –æ–±–∂–∞—Ä–∫–∏. –°—Ä–æ–∫ —Ö—Ä–∞–Ω–µ–Ω–∏—è: 7 —Å—É—Ç–æ–∫.', fixedWeight: 250 },
          { id: 'halloumi-paprika-oregano', name: '–•–∞–ª–ª—É–º–∏ —Å –ø–∞–ø—Ä–∏–∫–æ–π', pricePerKg: 2100, img: 'https://static.tildacdn.com/tild3133-6165-4134-b335-396662633262/halloumi-paprika-ore.webp', description: '–ò–¥–µ–∞–ª–µ–Ω –¥–ª—è –∂–∞—Ä–∫–∏ –∏–ª–∏ –±–µ–∑ –æ–±–∂–∞—Ä–∫–∏. –°—Ä–µ–¥–∏–∑–µ–º–Ω–æ–º–æ—Ä—Å–∫–∏–µ –Ω–æ—Ç–∫–∏. –°—Ä–æ–∫ —Ö—Ä–∞–Ω–µ–Ω–∏—è: 7 —Å—É—Ç–æ–∫.', fixedWeight: 250 },
          { id: 'halloumi-tomato-basil-garlic', name: '–•–∞–ª–ª—É–º–∏ —Ç–æ–º–∞—Ç-–±–∞–∑–∏–ª–∏–∫', pricePerKg: 2100, img: 'https://raw.githubusercontent.com/youmyloving/syr/main/halloumi-tomato-basil-garlic.webp', description: '–ò–¥–µ–∞–ª–µ–Ω –¥–ª—è –∂–∞—Ä–∫–∏, —Ö—Ä—É—Å—Ç—è—â–∞—è –∫–æ—Ä–æ—á–∫–∞. –ú–æ–∂–Ω–æ –µ—Å—Ç—å –∏ –±–µ–∑ –æ–±–∂–∞—Ä–∫–∏. –°—Ä–æ–∫ —Ö—Ä–∞–Ω–µ–Ω–∏—è: 7 —Å—É—Ç–æ–∫.', fixedWeight: 250 },
          { id: 'halloumi-tomato-paprika', name: '–•–∞–ª–ª—É–º–∏ —Å –≤—è–ª–µ–Ω—ã–º–∏ —Ç–æ–º–∞—Ç–∞–º–∏', pricePerKg: 2100, img: 'https://static.tildacdn.com/tild3863-3030-4439-a439-653238303862/halloumi-tomato-papr.webp', description: '–ò–¥–µ–∞–ª–µ–Ω –¥–ª—è –∂–∞—Ä–∫–∏, –ø–æ—è–≤–ª—è–µ—Ç—Å—è –∫–æ—Ä–æ—á–∫–∞. –°—Ä–æ–∫ —Ö—Ä–∞–Ω–µ–Ω–∏—è: 7 —Å—É—Ç–æ–∫.', fixedWeight: 250 }
        ]
      },
      'panir-group': {
        displayName: '–ü–∞–Ω–∏—Ä',
        baseGroup: 'cheese',
        priority: 2,
        variants: [
          { id: 'panir-classic', name: '–ü–∞–Ω–∏—Ä –∫–ª–∞—Å—Å–∏—á–µ—Å–∫–∏–π', pricePerKg: 1450, img: 'https://raw.githubusercontent.com/youmyloving/syr/main/panir-classic.webp', description: '–û—á–µ–Ω—å –Ω–µ–∂–Ω—ã–π, –º—è–≥–∫–∏–π, –º–æ–ª–æ—á–Ω—ã–π –≤–∫—É—Å. –°—Ä–æ–∫ —Ö—Ä–∞–Ω–µ–Ω–∏—è: 7 —Å—É—Ç–æ–∫.' },
          { id: 'panir-herbs', name: '–ü–∞–Ω–∏—Ä —Å –∑–µ–ª–µ–Ω—å—é', pricePerKg: 1600, img: 'https://raw.githubusercontent.com/youmyloving/syr/main/panir-herbs.webp', description: '–õ—ë–≥–∫–∏–π, —Å–≤–µ–∂–∏–π, –±—É–¥—Ç–æ –≥–ª–æ—Ç–æ–∫ –ø—Ä–æ—Ö–ª–∞–¥–Ω–æ–π –≤–æ–¥—ã –≤ –∂–∞—Ä—É. –°—Ä–æ–∫ —Ö—Ä–∞–Ω–µ–Ω–∏—è: 7 —Å—É—Ç–æ–∫.', hit: true },
          { id: 'panir-spicy', name: '–ü–∞–Ω–∏—Ä —Å–æ —Å–ø–µ—Ü–∏—è–º–∏', pricePerKg: 1650, img: 'https://raw.githubusercontent.com/youmyloving/syr/main/panir-spicy.webp', description: '–í–∫—É—Å –Ω–µ –æ—Å—Ç—Ä—ã–π –∏ –Ω–µ –ø–µ—Ä—á—ë–Ω—ã–π. –û—á–µ–Ω—å –Ω–µ–∂–Ω—ã–π, –∞—Ä–æ–º–∞—Ç–Ω—ã–π. –°—Ä–æ–∫ —Ö—Ä–∞–Ω–µ–Ω–∏—è: 7 —Å—É—Ç–æ–∫.' },
          { id: 'panir-smoked', name: '–ü–∞–Ω–∏—Ä –∫–æ–ø—á—ë–Ω—ã–π', pricePerKg: 1700, img: 'https://raw.githubusercontent.com/youmyloving/syr/main/panir-smoked.webp', description: '–ü—Ä–∏—è—Ç–Ω—ã–π –∞—Ä–æ–º–∞—Ç –∫–æ–ø—á—ë–Ω–æ—Å—Ç–∏, –≤–∫—É—Å –≥–∞—Ä–º–æ–Ω–∏—á–Ω—ã–π. –°—Ä–æ–∫ —Ö—Ä–∞–Ω–µ–Ω–∏—è: 30 —Å—É—Ç–æ–∫.' }
        ]
      },
      'sandesh-group': {
        displayName: '–°–∞–Ω–¥–µ—à',
        baseGroup: 'sweets',
        priority: 3,
        variants: [
          { id: 'sandesh-orange', name: '–°–∞–Ω–¥–µ—à –∞–ø–µ–ª—å—Å–∏–Ω–æ–≤—ã–π', pricePerUnit: 300, img: 'https://raw.githubusercontent.com/youmyloving/syr/main/sandesh-orange.webp', description: '–ù–µ–∂–Ω—ã–π —Ç–≤–æ—Ä–æ–∂–Ω—ã–π –¥–µ—Å–µ—Ä—Ç. –°–æ—Å—Ç–∞–≤: —Ü–µ–ª—å–Ω–æ–µ –º–æ–ª–æ–∫–æ, —Ç—Ä–æ—Å—Ç–Ω–∏–∫–æ–≤—ã–π —Å–∞—Ö–∞—Ä, —Ü–µ–¥—Ä–∞ –∞–ø–µ–ª—å—Å–∏–Ω–∞. –°—Ä–æ–∫ —Ö—Ä–∞–Ω–µ–Ω–∏—è: 5 —Å—É—Ç–æ–∫.' },
          { id: 'sandesh-walnut', name: '–°–∞–Ω–¥–µ—à —Å –≥—Ä–µ—Ü–∫–∏–º –æ—Ä–µ—Ö–æ–º', pricePerUnit: 300, img: 'https://raw.githubusercontent.com/youmyloving/syr/main/sandesh-walnut.webp', description: '–¢–≤–æ—Ä–æ–∂–Ω—ã–π –¥–µ—Å–µ—Ä—Ç —Å –≥—Ä–µ—Ü–∫–∏–º –æ—Ä–µ—Ö–æ–º. –°—Ä–æ–∫ —Ö—Ä–∞–Ω–µ–Ω–∏—è: 5 —Å—É—Ç–æ–∫.' },
          { id: 'sandesh-carob', name: '–°–∞–Ω–¥–µ—à —Å –∫—ç—Ä–æ–±–æ–º', pricePerUnit: 300, img: 'https://static.tildacdn.com/tild6135-6337-4266-b764-613565386238/_.webp', description: '–¢–≤–æ—Ä–æ–∂–Ω—ã–π –¥–µ—Å–µ—Ä—Ç —Å —à–æ–∫–æ–ª–∞–¥–Ω—ã–º –≤–∫—É—Å–æ–º. –°—Ä–æ–∫ —Ö—Ä–∞–Ω–µ–Ω–∏—è: 5 —Å—É—Ç–æ–∫.' }
        ]
      },
      'tvorozhnaya-massa-group': {
        displayName: '–¢–≤–æ—Ä–æ–∂–Ω–∞—è –º–∞—Å—Å–∞',
        baseGroup: 'dairy',
        priority: 4,
        variants: [
          { id: 'tvorozhnaya-massa-izum', name: '–¢–≤–æ—Ä–æ–∂–Ω–∞—è –º–∞—Å—Å–∞ —Å –∏–∑—é–º–æ–º', pricePerKg: 850, img: 'https://static.tildacdn.com/tild6630-3237-4430-b461-313634376333/tvorozhnaya-massa_.webp', description: '–¢–≤–æ—Ä–æ–∂–Ω–∞—è –º–∞—Å—Å–∞ —Å –∏–∑—é–º–æ–º. –°—Ä–æ–∫ —Ö—Ä–∞–Ω–µ–Ω–∏—è: 5 —Å—É—Ç–æ–∫.' },
          { id: 'tvorozhnaya-massa-finik', name: '–¢–≤–æ—Ä–æ–∂–Ω–∞—è –º–∞—Å—Å–∞ —Å —Ñ–∏–Ω–∏–∫–∞–º–∏', pricePerKg: 850, img: 'https://static.tildacdn.com/tild6630-3237-4430-b461-313634376333/tvorozhnaya-massa_.webp', description: '–¢–≤–æ—Ä–æ–∂–Ω–∞—è –º–∞—Å—Å–∞ —Å —Ñ–∏–Ω–∏–∫–∞–º–∏. –°—Ä–æ–∫ —Ö—Ä–∞–Ω–µ–Ω–∏—è: 5 —Å—É—Ç–æ–∫.' },
          { id: 'tvorozhnaya-massa-chernosliv', name: '–¢–≤–æ—Ä–æ–∂–Ω–∞—è –º–∞—Å—Å–∞ —Å —á–µ—Ä–Ω–æ—Å–ª–∏–≤–æ–º', pricePerKg: 850, img: 'https://static.tildacdn.com/tild6630-3237-4430-b461-313634376333/tvorozhnaya-massa_.webp', description: '–¢–≤–æ—Ä–æ–∂–Ω–∞—è –º–∞—Å—Å–∞ —Å —á–µ—Ä–Ω–æ—Å–ª–∏–≤–æ–º. –°—Ä–æ–∫ —Ö—Ä–∞–Ω–µ–Ω–∏—è: 5 —Å—É—Ç–æ–∫.' },
          { id: 'tvorozhnaya-massa-kuraga', name: '–¢–≤–æ—Ä–æ–∂–Ω–∞—è –º–∞—Å—Å–∞ —Å –∫—É—Ä–∞–≥–æ–π', pricePerKg: 850, img: 'https://static.tildacdn.com/tild6630-3237-4430-b461-313634376333/tvorozhnaya-massa_.webp', description: '–¢–≤–æ—Ä–æ–∂–Ω–∞—è –º–∞—Å—Å–∞ —Å –∫—É—Ä–∞–≥–æ–π. –°—Ä–æ–∫ —Ö—Ä–∞–Ω–µ–Ω–∏—è: 5 —Å—É—Ç–æ–∫.' }
        ]
      },
      // –ù–æ–≤—ã–µ –≥—Ä—É–ø–ø—ã
      'kosichka-group': {
        displayName: '–°—ã—Ä –∫–æ—Å–∏—á–∫–∞',
        baseGroup: 'cheese',
        priority: 5,
        variants: [
          { id: 'kosichka', name: '–°—ã—Ä –∫–æ—Å–∏—á–∫–∞', pricePerKg: 1900, img: DEFAULT_IMG, description: '–°–ª–µ–≥–∫–∞ —Å–æ–ª—ë–Ω—ã–π, –ø–æ–¥—Ö–æ–¥–∏—Ç –∫–æ –≤—Å–µ–º—É. –°—Ä–æ–∫ —Ö—Ä–∞–Ω–µ–Ω–∏—è: 7 —Å—É—Ç–æ–∫.', fixedWeight: 200 },
          { id: 'kosichka-smoked', name: '–°—ã—Ä –∫–æ—Å–∏—á–∫–∞ –∫–æ–ø—á—ë–Ω–∞—è', pricePerKg: 2000, img: 'https://raw.githubusercontent.com/youmyloving/syr/main/kosichka-smoked.webp', description: '–•–æ–ª–æ–¥–Ω–æ–µ –∫–æ–ø—á–µ–Ω–∏–µ, –ª—ë–≥–∫–∞—è —Å–æ–ª—ë–Ω–æ—Å—Ç—å. –°—Ä–æ–∫ —Ö—Ä–∞–Ω–µ–Ω–∏—è: 30 —Å—É—Ç–æ–∫.', fixedWeight: 200 }
        ]
      },
      'caciotta-group': {
        displayName: '–ö–∞—á–æ—Ç—Ç–∞',
        baseGroup: 'cheese',
        priority: 6,
        variants: [
          { id: 'caciotta', name: '–ö–∞—á–æ—Ç—Ç–∞', pricePerKg: 2200, img: 'https://static.tildacdn.com/tild6165-3265-4834-a236-366661346562/caciotta.webp', description: '–ú—è–≥–∫–∏–π –∏—Ç–∞–ª—å—è–Ω—Å–∫–∏–π —Å—ã—Ä. –°—Ä–æ–∫ —Ö—Ä–∞–Ω–µ–Ω–∏—è: 7 —Å—É—Ç–æ–∫.' },
          { id: 'caciotta-fenugreek', name: '–ö–∞—á–æ—Ç—Ç–∞ —Å –ø–∞–∂–∏—Ç–Ω–∏–∫–æ–º', pricePerKg: 2250, img: DEFAULT_IMG, description: '–° –æ—Ä–µ—Ö–æ–≤—ã–º –ø—Ä–∏–≤–∫—É—Å–æ–º –ø–∞–∂–∏—Ç–Ω–∏–∫–∞. –°—Ä–æ–∫ —Ö—Ä–∞–Ω–µ–Ω–∏—è: 7 —Å—É—Ç–æ–∫.' }
        ]
      },
      'hard-cheese-group': {
        displayName: '–¢–≤—ë—Ä–¥—ã–µ —Å—ã—Ä—ã',
        baseGroup: 'cheese',
        priority: 7,
        variants: [
          { id: 'hard-village', name: '–¢–≤—ë—Ä–¥—ã–π –¥–µ—Ä–µ–≤–µ–Ω—Å–∫–∏–π —Å—ã—Ä', pricePerKg: 1600, img: 'https://raw.githubusercontent.com/youmyloving/syr/main/hard-village.webp', description: '–¢–≤—ë—Ä–¥—ã–π –¥–µ—Ä–µ–≤–µ–Ω—Å–∫–∏–π —Å—ã—Ä –≥–æ—Ç–æ–≤–∏—Ç—Å—è –∏–∑ —Ç–≤–æ—Ä–æ–≥–∞ —Å –ø—Ä–∏–ø—Ä–∞–≤–∞–º–∏, –∫–æ—Ç–æ—Ä—ã–π –æ–±–∂–∞—Ä–∏–≤–∞–µ—Ç—Å—è. –°—Ä–æ–∫ —Ö—Ä–∞–Ω–µ–Ω–∏—è: 7 —Å—É—Ç–æ–∫.' },
          { id: 'hard-smoked', name: '–¢–≤—ë—Ä–¥—ã–π –∫–æ–ø—á—ë–Ω—ã–π —Å—ã—Ä', pricePerKg: 1800, img: 'https://static.tildacdn.com/tild6662-3930-4663-b132-316135626136/hard-smoked.webp', description: '–ì–æ—Ç–æ–≤–∏—Ç—Å—è –∏–∑ —Ç–≤–æ—Ä–æ–≥–∞ —Å –ø—Ä–∏–ø—Ä–∞–≤–∞–º–∏, –æ–±–∂–∞—Ä–∏–≤–∞–µ—Ç—Å—è, –∑–∞—Ç–µ–º –∫–æ–ø—Ç–∏—Ç—Å—è. –ù–µ–∂–Ω—ã–π –∫–æ–ø—á—ë–Ω—ã–π –≤–∫—É—Å. –°—Ä–æ–∫ —Ö—Ä–∞–Ω–µ–Ω–∏—è: –¥–æ 30 —Å—É—Ç–æ–∫.' }
        ]
      },
      'rolls-group': {
        displayName: '–°—ã—Ä–Ω—ã–µ —Ä—É–ª–µ—Ç—ã',
        baseGroup: 'cheese',
        priority: 8,
        variants: [
          { id: 'rolls-olives-walnut', name: '–†—É–ª–µ—Ç —Å –º–∞—Å–ª–∏–Ω–∞–º–∏ –∏ –≥—Ä–µ—Ü–∫–∏–º –æ—Ä–µ—Ö–æ–º', pricePerKg: 1700, img: 'https://raw.githubusercontent.com/youmyloving/syr/main/rolls-olives-walnut.webp', description: '–ú–æ–∂–Ω–æ –ø–æ–¥–∞—Ç—å –∫–∞–∫ –∑–∞–∫—É—Å–∫—É –∫ –ª—é–±–æ–º—É —Å—Ç–æ–ª—É ‚Äî –¥–æ–º–∞—à–Ω–µ–º—É –∏–ª–∏ –ø—Ä–∞–∑–¥–Ω–∏—á–Ω–æ–º—É. –°—Ä–æ–∫ —Ö—Ä–∞–Ω–µ–Ω–∏—è: 7 —Å—É—Ç–æ–∫.' },
          { id: 'rolls-apricot-cedar', name: '–†—É–ª–µ—Ç —Å –∫—É—Ä–∞–≥–æ–π –∏ –∫–µ–¥—Ä–æ–≤—ã–º –æ—Ä–µ—Ö–æ–º', pricePerKg: 1700, img: 'https://raw.githubusercontent.com/youmyloving/syr/main/rolls-apricot-cedar.webp', description: '–°–ª–µ–≥–∫–∞ —Å–ª–∞–¥–∫–æ–≤–∞—Ç—ã–π –±–ª–∞–≥–æ–¥–∞—Ä—è —Ç–≤–æ—Ä–æ–∂–Ω–æ–º—É —Å—ã—Ä—É, –∫—É—Ä–∞–≥–µ –∏ –æ—Ä–µ—Ö–∞–º. –°—Ä–æ–∫ —Ö—Ä–∞–Ω–µ–Ω–∏—è: 7 —Å—É—Ç–æ–∫.' }
        ]
      },
      'cookies-group': {
        displayName: '–ü–µ—á–µ–Ω—å–µ',
        baseGroup: 'bakery',
        priority: 9,
        variants: [
          { id: 'cookies-tvorog', name: '–ü–µ—á–µ–Ω—å–µ —Ç–≤–æ—Ä–æ–∂–Ω–æ–µ', pricePerKg: 600, img: 'https://raw.githubusercontent.com/youmyloving/foto/8e1c70a1f95f629fe6e91a9165fa200ad6c14d5e/tvorpech.webp', description: '–ú—è–≥–∫–æ–µ –¥–æ–º–∞—à–Ω–µ–µ –ø–µ—á–µ–Ω—å–µ –Ω–∞ —Ç–≤–æ—Ä–æ–≥–µ.' },
          { id: 'cookies-oat', name: '–ü–µ—á–µ–Ω—å–µ –æ–≤—Å—è–Ω–æ–µ', pricePerKg: 600, img: DEFAULT_IMG, description: '–û–≤—Å—è–Ω–æ–µ –ø–µ—á–µ–Ω—å–µ –∫ —á–∞—é.' },
          { id: 'cookies-nut', name: '–û—Ä–µ—Ö–æ–≤—ã–µ –ø–∞–ª—å—á–∏–∫–∏', pricePerKg: 700, img: 'https://static.tildacdn.com/tild3035-6230-4434-b363-303434366630/cookies-nut.webp', description: '–ü–µ—á–µ–Ω—å–µ —Å –æ—Ä–µ—Ö–∞–º–∏ ‚Äî —Ö—Ä—É—Å—Ç—è—â–∏–µ –ø–∞–ª—å—á–∏–∫–∏.' },
          { id: 'cookies-carob', name: '–ü–µ—á–µ–Ω—å–µ –∫—ç—Ä–æ–±–æ–≤–æ–µ', pricePerKg: 600, img: DEFAULT_IMG, description: '–ü–µ—á–µ–Ω—å–µ —Å –∫—ç—Ä–æ–±–æ–º –≤–º–µ—Å—Ç–æ –∫–∞–∫–∞–æ.' },
          { id: 'cookies-sandy', name: '–ü–µ—á–µ–Ω—å–µ –ø–µ—Å–æ—á–Ω–æ–µ', pricePerKg: 600, img: DEFAULT_IMG, description: '–†–∞—Å—Å—ã–ø—á–∞—Ç–æ–µ –ø–µ—Å–æ—á–Ω–æ–µ –ø–µ—á–µ–Ω—å–µ.' }
        ]
      },
      'muffin-group': {
        displayName: '–ö–µ–∫—Å—ã',
        baseGroup: 'bakery',
        priority: 10,
        variants: [
          { id: 'muffin-plain', name: '–ö–µ–∫—Å—ã –æ–±—ã—á–Ω—ã–µ', pricePerKg: 500, img: DEFAULT_IMG, description: '–î–æ–º–∞—à–Ω–∏–µ –∫–µ–∫—Å—ã.' },
          { id: 'muffin-carob', name: '–ö–µ–∫—Å—ã —Å –∫—ç—Ä–æ–±–æ–º', pricePerKg: 550, img: 'https://raw.githubusercontent.com/youmyloving/foto/8e1c70a1f95f629fe6e91a9165fa200ad6c14d5e/carobkeks.webp', description: '–ö–µ–∫—Å—ã —Å –∫—ç—Ä–æ–±–æ–º.' },
          { id: 'muffin-raisin', name: '–ö–µ–∫—Å—ã —Å –∏–∑—é–º–æ–º', pricePerKg: 550, img: 'https://static.tildacdn.com/tild3465-3162-4436-a235-363763383339/muffin-raisin.webp', description: '–ö–µ–∫—Å—ã —Å –∏–∑—é–º–æ–º.' }
        ]
      },
      'casserole-group': {
        displayName: '–¢–≤–æ—Ä–æ–∂–Ω–∞—è –∑–∞–ø–µ–∫–∞–Ω–∫–∞',
        baseGroup: 'bakery',
        priority: 11,
        variants: [
          { id: 'casserole-plain', name: '–ó–∞–ø–µ–∫–∞–Ω–∫–∞ –∫–ª–∞—Å—Å–∏—á–µ—Å–∫–∞—è', pricePerUnit: 260, img: DEFAULT_IMG, description: '–î–æ–º–∞—à–Ω—è—è —Ç–≤–æ—Ä–æ–∂–Ω–∞—è –∑–∞–ø–µ–∫–∞–Ω–∫–∞ –±–µ–∑ –¥–æ–±–∞–≤–æ–∫.' },
          { id: 'casserole-raisin', name: '–ó–∞–ø–µ–∫–∞–Ω–∫–∞ —Å –∏–∑—é–º–æ–º', pricePerUnit: 260, img: DEFAULT_IMG, description: '–ó–∞–ø–µ–∫–∞–Ω–∫–∞ —Å –∏–∑—é–º–æ–º.' }
        ]
      },
      'coconut-kuchen-group': {
        displayName: '–ö–æ–∫–æ—Å–æ–≤—ã–π –ø–∏—Ä–æ–≥',
        baseGroup: 'bakery',
        priority: 12,
        variants: [
          { id: 'coconut-kuchen-1kg', name: '–ö–æ–∫–æ—Å–æ–≤—ã–π –ø–∏—Ä–æ–≥ 1 –∫–≥', pricePerUnit: 1800, img: DEFAULT_IMG, description: '–ö–æ–∫–æ—Å–æ–≤—ã–π –ø–∏—Ä–æ–≥ (—Ñ–æ—Ä–º–∞ ~1 –∫–≥).' },
          { id: 'coconut-kuchen-05kg', name: '–ö–æ–∫–æ—Å–æ–≤—ã–π –ø–∏—Ä–æ–≥ 0.5 –∫–≥', pricePerUnit: 1000, img: DEFAULT_IMG, description: '–ö–æ–∫–æ—Å–æ–≤—ã–π –ø–∏—Ä–æ–≥ (—Ñ–æ—Ä–º–∞ ~0.5 –∫–≥).' }
        ]
      },
      'napoleon-group': {
        displayName: '–¢–æ—Ä—Ç –ù–∞–ø–æ–ª–µ–æ–Ω',
        baseGroup: 'bakery',
        priority: 13,
        variants: [
          { id: 'napoleon-1kg', name: '–ù–∞–ø–æ–ª–µ–æ–Ω 1 –∫–≥', pricePerUnit: 1300, img: DEFAULT_IMG, description: '–ö–ª–∞—Å—Å–∏—á–µ—Å–∫–∏–π –ù–∞–ø–æ–ª–µ–æ–Ω (–æ–∫–æ–ª–æ 1 –∫–≥).' },
          { id: 'napoleon-05kg', name: '–ù–∞–ø–æ–ª–µ–æ–Ω 0.5 –∫–≥', pricePerUnit: 750, img: DEFAULT_IMG, description: '–ö–ª–∞—Å—Å–∏—á–µ—Å–∫–∏–π –ù–∞–ø–æ–ª–µ–æ–Ω (–æ–∫–æ–ª–æ 0.5 –∫–≥).' }
        ]
      },
      'bliny-group': {
        displayName: '–ë–ª–∏–Ω—ã',
        baseGroup: 'bakery',
        priority: 14,
        variants: [
          { id: 'bliny-10', name: '–ë–ª–∏–Ω—ã (10 —à—Ç)', pricePerUnit: 330, img: DEFAULT_IMG, description: '–¢–æ–Ω–∫–∏–µ –±–ª–∏–Ω—á–∏–∫–∏, 10 —à—Ç.' },
          { id: 'bliny-5', name: '–ë–ª–∏–Ω—ã (5 —à—Ç)', pricePerUnit: 220, img: DEFAULT_IMG, description: '–¢–æ–Ω–∫–∏–µ –±–ª–∏–Ω—á–∏–∫–∏, 5 —à—Ç.' },
          { id: 'bliny-tvorog-5', name: '–ë–ª–∏–Ω—ã —Å —Ç–≤–æ—Ä–æ–≥–æ–º (5 —à—Ç)', pricePerUnit: 300, img: DEFAULT_IMG, description: '–ë–ª–∏–Ω—ã —Å –Ω–∞—á–∏–Ω–∫–æ–π –∏–∑ —Ç–≤–æ—Ä–æ–≥–∞ –∏–ª–∏ —Ç–≤–æ—Ä–æ–≥–∞ —Å –∏–∑—é–º–æ–º.' }
        ]
      },
      'syrniki-group': {
        displayName: '–°—ã—Ä–Ω–∏–∫–∏',
        baseGroup: 'bakery',
        priority: 15,
        variants: [
          { id: 'syrniki-10', name: '–°—ã—Ä–Ω–∏–∫–∏ (10 —à—Ç)', pricePerUnit: 520, img: DEFAULT_IMG, description: '–î–æ–º–∞—à–Ω–∏–µ —Å—ã—Ä–Ω–∏–∫–∏, 10 —à—Ç.' },
          { id: 'syrniki-5', name: '–°—ã—Ä–Ω–∏–∫–∏ (5 —à—Ç)', pricePerUnit: 280, img: DEFAULT_IMG, description: '–î–æ–º–∞—à–Ω–∏–µ —Å—ã—Ä–Ω–∏–∫–∏, 5 —à—Ç.' }
        ]
      },
      'chapati-group': {
        displayName: '–ß–∞–ø–∞—Ç–∏',
        baseGroup: 'bakery',
        priority: 16,
        variants: [
          { id: 'chapati-10', name: '–ß–∞–ø–∞—Ç–∏ (10 —à—Ç)', pricePerUnit: 270, img: 'https://static.tildacdn.com/tild6332-6239-4538-b839-356132356236/chapati-10.webp', description: '–°–æ—Å—Ç–∞–≤: –º—É–∫–∞ –ø—à–µ–Ω–∏—á–Ω–∞—è –≤—ã—Å—à–µ–≥–æ —Å–æ—Ä—Ç–∞, —Ä–∂–∞–Ω–∞—è –º—É–∫–∞, –≤–æ–¥–∞, —Å–æ–ª—å, —Å–ª–∏–≤–æ—á–Ω–æ–µ –º–∞—Å–ª–æ. –°—Ä–æ–∫ —Ö—Ä–∞–Ω–µ–Ω–∏—è: 2 —Å—É—Ç–æ–∫ –≤ —Ö–æ–ª–æ–¥–∏–ª—å–Ω–∏–∫–µ.' },
          { id: 'chapati-wholewheat-10', name: '–ß–∞–ø–∞—Ç–∏ —Ü–µ–ª—å–Ω–æ–∑–µ—Ä–Ω–æ–≤—ã–µ (10 —à—Ç)', pricePerUnit: 320, img: DEFAULT_IMG, description: '–ß–∞–ø–∞—Ç–∏ –∏–∑ —Ü–µ–ª—å–Ω–æ–∑–µ—Ä–Ω–æ–≤–æ–π –º—É–∫–∏.' }
        ]
      },
      'potato-cake-group': {
        displayName: '–ü–∏—Ä–æ–∂–Ω–æ–µ –ö–∞—Ä—Ç–æ—à–∫–∞',
        baseGroup: 'sweets',
        priority: 17,
        variants: [
          { id: 'potato-cake-5', name: '–ö–∞—Ä—Ç–æ—à–∫–∞ (5 —à—Ç)', pricePerUnit: 400, img: 'https://static.tildacdn.com/tild3961-6133-4632-b162-396333663962/potato-cake-2.webp', description: '–î–æ–º–∞—à–Ω–∏–µ –ø–∏—Ä–æ–∂–Ω—ã–µ ¬´–ö–∞—Ä—Ç–æ—à–∫–∞¬ª –∏–∑ —Ü–µ–ª—å–Ω–æ–∑–µ—Ä–Ω–æ–≤–æ–π –º—É–∫–∏ –∏ –≤–∞—Ä—ë–Ω–æ–π —Å–≥—É—â—ë–Ω–∫–∏. –í –∫–æ—Ä–æ–±–∫–µ 5 —à—Ç.' },
          { id: 'potato-cake-2', name: '–ö–∞—Ä—Ç–æ—à–∫–∞ (2 —à—Ç)', pricePerUnit: 190, img: 'https://static.tildacdn.com/tild3961-6133-4632-b162-396333663962/potato-cake-2.webp', description: '–î–æ–º–∞—à–Ω–∏–µ –ø–∏—Ä–æ–∂–Ω—ã–µ ¬´–ö–∞—Ä—Ç–æ—à–∫–∞¬ª (2 —à—Ç) –∏–∑ —Ü–µ–ª—å–Ω–æ–∑–µ—Ä–Ω–æ–≤–æ–π –º—É–∫–∏ –∏ –≤–∞—Ä—ë–Ω–æ–π —Å–≥—É—â—ë–Ω–∫–∏.' }
        ]
      }
    };

    const INDIVIDUAL_PRODUCTS = [
      { id: 'mozzarella', name: '–ú–æ—Ü–∞—Ä–µ–ª–ª–∞', group: 'cheese', pricePerKg: 2000, img: 'https://raw.githubusercontent.com/youmyloving/syr/main/mozzarella.webp', description: '–ù–∏—Ç–∏ –º–æ—Ü–∞—Ä–µ–ª–ª—ã –≤ –Ω–µ–∂–Ω–æ–π –æ–±–æ–ª–æ—á–∫–µ. –°—Ä–æ–∫ —Ö—Ä–∞–Ω–µ–Ω–∏—è: 3‚Äì5 —Å—É—Ç–æ–∫.', fixedWeight: 200, hit: true },
      { id: 'buratta', name: '–ë—É—Ä–∞—Ç—Ç–∞', group: 'cheese', pricePerKg: 2100, img: DEFAULT_IMG, description: '–ú–µ—à–æ—á–µ–∫ –∏–∑ –º–æ—Ü–∞—Ä–µ–ª–ª—ã —Å –Ω–∞—á–∏–Ω–∫–æ–π –∏–∑ —Å—Ç—Ä–∞—á–∞—Ç–µ–ª–ª—ã. –°—Ä–æ–∫ —Ö—Ä–∞–Ω–µ–Ω–∏—è: 3‚Äì5 —Å—É—Ç–æ–∫.', fixedWeight: 250 },
      { id: 'stracciatella', name: '–°—Ç—Ä–∞—á–∞—Ç–µ–ª–ª–∞', group: 'cheese', pricePerKg: 2150, img: 'https://static.tildacdn.com/tild3832-6430-4462-b663-353438383930/stracciatella.webp', description: '–ù–∏—Ç–∏ –º–æ—Ü–∞—Ä–µ–ª–ª—ã –≤ —Å–ª–∏–≤–∫–∞—Ö. –°—Ä–æ–∫ —Ö—Ä–∞–Ω–µ–Ω–∏—è: 5‚Äì7 —Å—É—Ç–æ–∫.' },
      { id: 'suluguni', name: '–°—É–ª—É–≥—É–Ω–∏', group: 'cheese', pricePerKg: 1700, img: 'https://static.tildacdn.com/tild3238-3866-4366-a436-623236363261/suluguni.webp', description: '–£–º–µ—Ä–µ–Ω–Ω–æ —Å–æ–ª—ë–Ω—ã–π, —Å–ª–æ–∏—Å—Ç—ã–π –∏ —ç–ª–∞—Å—Ç–∏—á–Ω—ã–π. –°—Ä–æ–∫ —Ö—Ä–∞–Ω–µ–Ω–∏—è: 7 —Å—É—Ç–æ–∫.' },
      { id: 'suluguni-smoked', name: '–°—É–ª—É–≥—É–Ω–∏ –∫–æ–ø—á—ë–Ω—ã–π', group: 'cheese', pricePerKg: 1800, img: 'https://static.tildacdn.com/tild6435-3838-4463-b431-353765323333/suluguni-smoked.webp', description: '–° –ª—ë–≥–∫–æ–π –∫–æ–ø—á—ë–Ω–æ—Å—Ç—å—é. –°—Ä–æ–∫ —Ö—Ä–∞–Ω–µ–Ω–∏—è: 30 —Å—É—Ç–æ–∫.' },
      { id: 'imeretian', name: '–ò–º–µ—Ä–µ—Ç–∏–Ω—Å–∫–∏–π', group: 'cheese', pricePerKg: 1500, img: 'https://raw.githubusercontent.com/youmyloving/syr/main/imeretian.webp', description: '–ü—Ä–µ–∫—Ä–∞—Å–Ω—ã–π —Ä–∞—Å—Å–æ–ª—å–Ω—ã–π —Å—ã—Ä. –°—Ä–æ–∫ —Ö—Ä–∞–Ω–µ–Ω–∏—è: 7 —Å—É—Ç–æ–∫.' },
      { id: 'imeretian-dill-garlic', name: '–ò–º–µ—Ä–µ—Ç–∏–Ω—Å–∫–∏–π —Å –∑–µ–ª–µ–Ω—å—é –∏ —á–µ—Å–Ω–æ–∫–æ–º', group: 'cheese', pricePerKg: 1600, img: 'https://static.tildacdn.com/tild6435-3539-4337-a561-386438636230/__.webp', description: '–°–≤–µ–∂–∏–π —Ä–∞—Å—Å–æ–ª—å–Ω—ã–π —Å—ã—Ä —Å –∞—Ä–æ–º–∞—Ç–Ω–æ–π –∑–µ–ª–µ–Ω—å—é –∏ —á–µ—Å–Ω–æ–∫–æ–º. –°—Ä–æ–∫ —Ö—Ä–∞–Ω–µ–Ω–∏—è: 7 —Å—É—Ç–æ–∫.' },
      { id: 'spicy-klubok', name: '–ü—Ä—è–Ω—ã–µ –∫–ª—É–±–æ—á–∫–∏', group: 'cheese', pricePerKg: 1950, img: 'https://static.tildacdn.com/tild3463-6166-4665-a439-323264653939/spicy-klubok.webp', description: '–ù–µ—Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π –≤–∫—É—Å–Ω—ã–π —Å—ã—Ä. –°—Ä–æ–∫ —Ö—Ä–∞–Ω–µ–Ω–∏—è: 7 —Å—É—Ç–æ–∫.', fixedWeight: 150, hit: true },
      { id: 'ricotta', name: '–¢–≤–æ—Ä–æ–∂–Ω—ã–π —Å—ã—Ä (—Ä–∏–∫–æ—Ç—Ç–∞)', group: 'cheese', pricePerKg: 1400, img: 'https://raw.githubusercontent.com/youmyloving/syr/main/ricotta.webp', description: '–ù–µ–∂–Ω—ã–π —Å—ã—Ä. –°—Ä–æ–∫ —Ö—Ä–∞–Ω–µ–Ω–∏—è: 7 —Å—É—Ç–æ–∫.' },
      { id: 'ricotta-herbs', name: '–¢–≤–æ—Ä–æ–∂–Ω—ã–π —Å—ã—Ä —Å –∑–µ–ª–µ–Ω—å—é', group: 'cheese', pricePerKg: 1500, img: 'https://raw.githubusercontent.com/youmyloving/syr/main/ricotta-herbs.webp', description: '–ù–µ–∂–Ω—ã–π, —Å–≤–µ–∂–∏–π, —É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–π. –°—Ä–æ–∫ —Ö—Ä–∞–Ω–µ–Ω–∏—è: 7 —Å—É—Ç–æ–∫.' },
      
      // –ú–æ–ª–æ—á–∫–∞
      { id: 'milk', name: '–ú–æ–ª–æ–∫–æ', group: 'dairy', pricePerL: 150, img: 'https://raw.githubusercontent.com/youmyloving/foto/8e1c70a1f95f629fe6e91a9165fa200ad6c14d5e/milk.webp', description: '–ú–æ–ª–æ–∫–æ –æ—Ç–±–æ—Ä–Ω–æ–µ —Ü–µ–ª—å–Ω–æ–µ. –°—Ä–æ–∫ —Ö—Ä–∞–Ω–µ–Ω–∏—è: 3‚Äì5 —Å—É—Ç–æ–∫.', volumes: [0.5, 1] },
      { id: 'milk-topped', name: '–ú–æ–ª–æ–∫–æ —Ç–æ–ø–ª—ë–Ω–æ–µ', group: 'dairy', pricePerL: 250, img: 'https://static.tildacdn.com/tild3839-3163-4066-a633-306366346631/milk-topped.webp', description: '–ù–∞—Å—Ç–æ—è—â–µ–µ —Ü–µ–ª—å–Ω–æ–µ —Ç–æ–ø–ª—ë–Ω–æ–µ –º–æ–ª–æ–∫–æ. –°—Ä–æ–∫ —Ö—Ä–∞–Ω–µ–Ω–∏—è: 5‚Äì7 —Å—É—Ç–æ–∫.', volumes: [0.5, 1] },
      { id: 'yogurt', name: '–ô–æ–≥—É—Ä—Ç', group: 'dairy', pricePerL: 260, img: DEFAULT_IMG, description: '–°–∞–º—ã–π –Ω–∞—Å—Ç–æ—è—â–∏–π –π–æ–≥—É—Ä—Ç –∏–∑ –æ—Ç–±–æ—Ä–Ω–æ–≥–æ –º–æ–ª–æ–∫–∞ –∏ –Ω–∞—Ç—É—Ä–∞–ª—å–Ω–æ–π –∑–∞–∫–≤–∞—Å–∫–∏. –°—Ä–æ–∫ —Ö—Ä–∞–Ω–µ–Ω–∏—è: 5 —Å—É—Ç–æ–∫.', volumes: [0.5, 1] },
      { id: 'ryazhenka', name: '–†—è–∂–µ–Ω–∫–∞', group: 'dairy', pricePerL: 280, img: DEFAULT_IMG, description: '–ù–∞—Ç—É—Ä–∞–ª—å–Ω–∞—è —Ä—è–∂–µ–Ω–∫–∞ –∏–∑ –º–æ–ª–æ–∫–∞. –°—Ä–æ–∫ —Ö—Ä–∞–Ω–µ–Ω–∏—è: –¥–æ 5 —Å—É—Ç–æ–∫.', volumes: [0.5, 1] },
      { id: 'misti-dahi', name: '–ú–∏—Å—Ç—Ö–∏-–î–∞—Ö–∏', group: 'dairy', pricePerL: 300, img: DEFAULT_IMG, description: '–ö–∏—Å–ª–æ–º–æ–ª–æ—á–Ω—ã–π –Ω–∞–ø–∏—Ç–æ–∫. –°—Ä–æ–∫ —Ö—Ä–∞–Ω–µ–Ω–∏—è: 5 —Å—É—Ç–æ–∫.', volumes: [0.5, 1] },
      { id: 'whey', name: '–°—ã–≤–æ—Ä–æ—Ç–∫–∞', group: 'dairy', pricePerL: 60, img: DEFAULT_IMG, description: '–ú–æ–ª–æ—á–Ω—ã–π –Ω–∏–∑–∫–æ–∫–∞–ª–æ—Ä–∏–π–Ω—ã–π –ø—Ä–æ–¥—É–∫—Ç. –°—Ä–æ–∫ —Ö—Ä–∞–Ω–µ–Ω–∏—è: 3 —Å—É—Ç–æ–∫.', volumes: [1] },
      { id: 'cream', name: '–°–ª–∏–≤–∫–∏ (33‚Äì36%)', group: 'dairy', pricePerL: 1450, img: 'https://static.tildacdn.com/tild3163-3665-4636-a537-303830323163/cream.webp', description: '–ù–∞—Ç—É—Ä–∞–ª—å–Ω—ã–µ —Å–≤–µ–∂–∏–µ —Å–ª–∏–≤–∫–∏. –°—Ä–æ–∫ —Ö—Ä–∞–Ω–µ–Ω–∏—è: 5 —Å—É—Ç–æ–∫. –ù–∞ 3‚Äì4 —Å—É—Ç–∫–∏ –º–æ–≥—É—Ç —Å—Ç–∞—Ç—å —Å–º–µ—Ç–∞–Ω–æ–π.', volumes: [0.2, 0.5, 1] },
      { id: 'tvorog', name: '–¢–≤–æ—Ä–æ–≥', group: 'dairy', pricePerKg: 700, img: 'https://static.tildacdn.com/tild3136-3730-4134-b466-613138343764/tvorog.webp', description: '–¢–≤–æ—Ä–æ–∂–Ω—ã–π –Ω–µ–∂–Ω—ã–π –≤–∫—É—Å. –°—Ä–æ–∫ —Ö—Ä–∞–Ω–µ–Ω–∏—è: 3‚Äì5 —Å—É—Ç–æ–∫.' },
      { id: 'butter', name: '–°–ª–∏–≤–æ—á–Ω–æ–µ –º–∞—Å–ª–æ (—à–∞—Ä–∏–∫)', group: 'dairy', pricePerKg: 2100, img: 'https://raw.githubusercontent.com/youmyloving/syr/main/butter.webp', description: '–ù–∞—Ç—É—Ä–∞–ª—å–Ω–æ–µ —Å–ª–∏–≤–æ—á–Ω–æ–µ –º–∞—Å–ª–æ, –∫–∞–∫ –≥–æ—Ç–æ–≤–∏–ª–∞ –±–∞–±—É—à–∫–∞. –ë–µ–∑ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è —Å–∞—Ö–∞—Ä–∞ –∏–ª–∏ —Å–æ–ª–∏. –ü—Ä–∏–±–ª–∏–∑–∏—Ç–µ–ª—å–Ω—ã–π –≤–µ—Å —à–∞—Ä–∏–∫–∞ ‚Äî 200 –≥.', fixedWeight: 200 },
      { id: 'ghee', name: '–¢–æ–ø–ª—ë–Ω–æ–µ –º–∞—Å–ª–æ (–ì–•–ò)', group: 'dairy', pricePerKg: 2900, img: DEFAULT_IMG, description: '–°–æ—Å—Ç–∞–≤: —Å–ª–∏–≤–æ—á–Ω–æ–µ –º–∞—Å–ª–æ. –ñ–∏—Ä–Ω–æ—Å—Ç—å ~99%. –ò–¥–µ–∞–ª—å–Ω–æ –¥–ª—è –∂–∞—Ä–∫–∏. –°—Ä–æ–∫ —Ö—Ä–∞–Ω–µ–Ω–∏—è: –±–æ–ª—å—à–µ 10 –ª–µ—Ç.' },
      { id: 'condensed-milk', name: '–í–∞—Ä—ë–Ω–∞—è —Å–≥—É—â—ë–Ω–∫–∞', group: 'dairy', pricePerKg: 1000, img: DEFAULT_IMG, description: '–ù–∞—Ç—É—Ä–∞–ª—å–Ω–∞—è –≤–∞—Ä—ë–Ω–∞—è —Å–≥—É—â—ë–Ω–∫–∞, –≥—É—Å—Ç–∞—è –∏ –∫–∞—Ä–∞–º–µ–ª—å–Ω–∞—è. –°—Ä–æ–∫ —Ö—Ä–∞–Ω–µ–Ω–∏—è: 7 —Å—É—Ç–æ–∫.' },
      
      // –°–ª–∞–¥–æ—Å—Ç–∏
      { id: 'barfi-classic', name: '–ë—É—Ä—Ñ–∏ –∫–ª–∞—Å—Å–∏—á–µ—Å–∫–∏–π (–Ω–∞–±–æ—Ä)', group: 'sweets', pricePerUnit: 350, img: 'https://static.tildacdn.com/tild3430-3231-4562-b164-366638313434/barfi-classic.webp', description: '–ù–µ–∂–Ω—ã–π –º–æ–ª–æ—á–Ω—ã–π –¥–µ—Å–µ—Ä—Ç. –í –Ω–∞–±–æ—Ä–µ 5 —à—Ç.', hit: true },
      { id: 'barfi-hazelnut', name: '–ë—É—Ä—Ñ–∏ —Å —Ñ—É–Ω–¥—É–∫–æ–º (–Ω–∞–±–æ—Ä)', group: 'sweets', pricePerUnit: 350, img: 'https://static.tildacdn.com/tild3065-3332-4466-a536-353130343264/barfi-hazelnut.webp', description: '–ë—É—Ä—Ñ–∏ —Å —Ñ—É–Ω–¥—É–∫–æ–º, 5 —à—Ç –≤ –Ω–∞–±–æ—Ä–µ.' },
      { id: 'barfi-sesame', name: '–ë—É—Ä—Ñ–∏ –∫—É–Ω–∂—É—Ç–Ω—ã–π (–Ω–∞–±–æ—Ä)', group: 'sweets', pricePerUnit: 490, img: 'https://static.tildacdn.com/tild3439-6135-4861-a531-316233303166/_.webp', description: '–ë—É—Ä—Ñ–∏ —Å –∫—É–Ω–∂—É—Ç–æ–º, 7 —à—Ç –≤ –Ω–∞–±–æ—Ä–µ.', hit: true },
      { id: 'halva', name: '–•–∞–ª–≤–∞', group: 'sweets', pricePerUnit: 200, img: 'https://static.tildacdn.com/tild3566-6566-4464-b531-306364646164/photo.webp', description: '–°–∞–º–∞—è –Ω–∞—Å—Ç–æ—è—â–∞—è —Ö–∞–ª–≤–∞. –ù–∞—Ç—É—Ä–∞–ª—å–Ω—ã–π —Å–æ—Å—Ç–∞–≤: —Ç—Ä–æ—Å—Ç–Ω–∏–∫–æ–≤—ã–π —Å–∞—Ö–∞—Ä, –≤–æ–¥–∞, —Å–µ–º–µ–Ω–∞ –ø–æ–¥—Å–æ–ª–Ω–µ—á–Ω–∏–∫–∞, —Å–ª–∏–≤–æ—á–Ω–æ–µ –º–∞—Å–ª–æ. –°—Ä–æ–∫ —Ö—Ä–∞–Ω–µ–Ω–∏—è: 14 –¥–Ω–µ–π.' },
      
      // –í—ã–ø–µ—á–∫–∞ –æ—Ç–¥–µ–ª—å–Ω–∞—è
      { id: 'crazy-cake', name: '–°—É–º–∞—Å—à–µ–¥—à–∏–π –ø–∏—Ä–æ–≥', group: 'bakery', pricePerUnit: 600, img: DEFAULT_IMG, description: '–î–æ–º–∞—à–Ω–∏–π –ø–∏—Ä–æ–≥ –∫ —á–∞—é.' },
      { id: 'apple-pie', name: '–Ø–±–ª–æ—á–Ω—ã–π –ø–∏—Ä–æ–≥', group: 'bakery', pricePerUnit: 560, img: DEFAULT_IMG, description: '–î–æ–º–∞—à–Ω–∏–π —è–±–ª–æ—á–Ω—ã–π –ø–∏—Ä–æ–≥.' }
    ];

    const ALL_PRODUCTS = [
      ...INDIVIDUAL_PRODUCTS,
      ...Object.values(PRODUCT_VARIANTS).flatMap(g => g.variants.map(v => ({...v, group: g.baseGroup, isVariant: true, groupId: Object.keys(PRODUCT_VARIANTS).find(k => PRODUCT_VARIANTS[k] === g)})))
    ];

    const HITS = [
      { id: 'spicy-klubok', name: '–ü—Ä—è–Ω—ã–π –∫–ª—É–±–æ–∫', reason: '–ë–µ—Å—Ç—Å–µ–ª–ª–µ—Ä' },
      { id: 'halloumi-paprika-oregano', name: '–•–∞–ª–ª—É–º–∏ —Å –ø–∞–ø—Ä–∏–∫–æ–π', reason: '–ù–æ–≤–∏–Ω–∫–∞' },
      { id: 'panir-herbs', name: '–ü–∞–Ω–∏—Ä —Å –∑–µ–ª–µ–Ω—å—é', reason: '–¢–æ–ø' },
      { id: 'sandesh-orange', name: '–°–∞–Ω–¥–µ—à –∞–ø–µ–ª—å—Å–∏–Ω–æ–≤—ã–π', reason: '–•–∏—Ç' },
      { id: 'barfi-sesame', name: '–ë—É—Ä—Ñ–∏ –∫—É–Ω–∂—É—Ç–Ω—ã–π', reason: '–í—ã–±–æ—Ä –Ω–µ–¥–µ–ª–∏' }
    ];

    // ==================== STATE ====================
    let cart = [];
    let favorites = new Set();
    let currentProduct = null;
    let currentVariant = null;
    let selectedWeight = 500;
    let selectedVolume = null;
    let currentQty = 1;
    let currentCategory = 'all';
    let isOnline = navigator.onLine;
    let orderHistory = [];

    // ==================== UTILS ====================
    const fmtRub = (n) => new Intl.NumberFormat('ru-RU', { maximumFractionDigits: 0 }).format(Math.round(n)) + ' ‚ÇΩ';
    const el = (id) => document.getElementById(id);

    function showToast(message) {
      const toast = el('toast');
      toast.textContent = message;
      toast.classList.add('show');
      setTimeout(() => toast.classList.remove('show'), 2000);
    }

    // ==================== INIT ====================
    document.addEventListener('DOMContentLoaded', () => {
      loadState();
      setupTelegram();
      setupNetworkListeners();
      showSkeletons();
      setTimeout(() => {
        renderHits();
        renderProductsByCategory();
        updateBadges();
        renderMiniCart();
      }, 500);
      
      const params = new URLSearchParams(window.location.search);
      const productId = params.get('product');
      if (productId) setTimeout(() => openProductModal(productId), 800);
    });

    function loadState() {
      try {
        const savedCart = localStorage.getItem(STORAGE_CART_KEY);
        if (savedCart) cart = JSON.parse(savedCart);
        const savedFav = localStorage.getItem(STORAGE_FAVORITES_KEY);
        if (savedFav) favorites = new Set(JSON.parse(savedFav));
        const savedHistory = localStorage.getItem(STORAGE_ORDER_HISTORY);
        if (savedHistory) orderHistory = JSON.parse(savedHistory);
      } catch (e) { console.error(e); }
    }

    function saveState() {
      try {
        localStorage.setItem(STORAGE_CART_KEY, JSON.stringify(cart));
        localStorage.setItem(STORAGE_FAVORITES_KEY, JSON.stringify([...favorites]));
        localStorage.setItem(STORAGE_ORDER_HISTORY, JSON.stringify(orderHistory));
      } catch (e) { console.error(e); }
    }

    function setupNetworkListeners() {
      window.addEventListener('online', () => {
        isOnline = true;
        el('offline-indicator').classList.remove('show');
        showToast('–ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ');
        syncOfflineOrders();
      });
      
      window.addEventListener('offline', () => {
        isOnline = false;
        el('offline-indicator').classList.add('show');
      });
    }

    function setupTelegram() {
      if (window.Telegram?.WebApp) {
        const tg = window.Telegram.WebApp;
        tg.ready();
        tg.expand();
        
        const user = tg.initDataUnsafe?.user;
        if (user) {
          const avatar = el('user-avatar');
          const profileAvatar = el('profile-avatar');
          if (user.photo_url) {
            avatar.innerHTML = `<img src="${user.photo_url}" alt="">`;
            profileAvatar.innerHTML = `<img src="${user.photo_url}" alt="" style="width:100%;height:100%;object-fit:cover;">`;
          } else {
            const initial = (user.first_name || 'U')[0].toUpperCase();
            avatar.innerHTML = `<span>${initial}</span>`;
            profileAvatar.textContent = initial;
          }
          el('profile-name').textContent = user.first_name || '–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å';
          el('profile-phone').textContent = user.username ? `@${user.username}` : 'Telegram –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å';
        }
      }
    }

    // ==================== RENDER ====================
    function showSkeletons() {
      const container = el('products-section');
      container.innerHTML = '';
      for (let i = 0; i < 6; i++) {
        const div = document.createElement('div');
        div.className = 'product-card skeleton-card';
        div.innerHTML = `
          <div class="skeleton" style="height:160px;width:100%"></div>
          <div style="padding:16px">
            <div class="skeleton" style="height:20px;width:80%;margin-bottom:8px"></div>
            <div class="skeleton" style="height:16px;width:40%"></div>
          </div>
        `;
        container.appendChild(div);
      }
    }

    function renderHits() {
      const container = el('hits-scroll');
      container.innerHTML = HITS.map(hit => {
        const product = ALL_PRODUCTS.find(p => p.id === hit.id);
        if (!product) return '';
        const price = product.pricePerKg ? fmtRub(product.pricePerKg) + '/–∫–≥' : product.pricePerUnit ? fmtRub(product.pricePerUnit) : '';
        return `
          <div class="hit-card" onclick="openProductModal('${hit.id}')">
            <img src="${product.img || DEFAULT_IMG}" class="hit-image" alt="${product.name}" onerror="this.src='${DEFAULT_IMG}'">
            <div class="hit-content">
              <span class="hit-badge">${hit.reason}</span>
              <div class="hit-name">${product.name}</div>
              <div class="hit-price">${price}</div>
            </div>
          </div>
        `;
      }).join('');
    }

    function renderProductsByCategory(searchTerm = '') {
      const container = el('products-section');
      container.innerHTML = '';
      
      const categories = [
        { id: 'cheese', title: '–°—ã—Ä—ã', icon: 'üßÄ' },
        { id: 'dairy', title: '–ú–æ–ª–æ—á–∫–∞', icon: 'ü•õ' },
        { id: 'sweets', title: '–°–ª–∞–¥–æ—Å—Ç–∏', icon: 'üçÆ' },
        { id: 'bakery', title: '–í—ã–ø–µ—á–∫–∞', icon: 'ü•ê' }
      ];

      let productsToRender = [...ALL_PRODUCTS].sort((a, b) => {
        const pa = a.groupId ? (PRODUCT_VARIANTS[a.groupId]?.priority || 99) : 99;
        const pb = b.groupId ? (PRODUCT_VARIANTS[b.groupId]?.priority || 99) : 99;
        return pa - pb;
      });

      categories.forEach(cat => {
        if (currentCategory !== 'all' && currentCategory !== cat.id) return;
        
        let catProducts = productsToRender.filter(p => {
          const matchesSearch = p.name.toLowerCase().includes(searchTerm.toLowerCase());
          const matchesCategory = p.group === cat.id;
          return matchesSearch && matchesCategory;
        });

        if (catProducts.length === 0) return;

        const section = document.createElement('div');
        section.className = 'products-category';
        
        section.innerHTML = `
          <h3 class="category-title">${cat.icon} ${cat.title}</h3>
          <div class="product-grid">
            ${catProducts.map(product => {
              const isFav = favorites.has(product.id);
              const priceText = product.pricePerKg ? fmtRub(product.pricePerKg) + '/–∫–≥' : 
                               product.pricePerUnit ? fmtRub(product.pricePerUnit) : 
                               product.pricePerL ? fmtRub(product.pricePerL) + '/–ª' : '';
              
              const groupVariants = product.groupId ? PRODUCT_VARIANTS[product.groupId]?.variants : null;
              const hasMultipleVariants = groupVariants && groupVariants.length > 1;
              
              return `
                <div class="product-card" data-product-id="${product.id}">
                  <div class="product-image-wrap" onclick="openProductModal('${product.id}')">
                    <img src="${product.img || DEFAULT_IMG}" class="product-image" alt="${product.name}" onerror="this.src='${DEFAULT_IMG}'">
                    ${product.hit ? '<span class="product-badge-hit">–•–ò–¢</span>' : ''}
                    <button class="fav-btn ${isFav ? 'active' : ''}" onclick="event.stopPropagation(); toggleFavorite('${product.id}')" data-id="${product.id}">
                      ${isFav ? '‚ô•' : '‚ô°'}
                    </button>
                    <button class="quick-add-btn" onclick="event.stopPropagation(); window.quickAdd('${product.id}', this)" title="–ë—ã—Å—Ç—Ä–æ –¥–æ–±–∞–≤–∏—Ç—å">+</button>
                  </div>
                  <div class="product-info" onclick="openProductModal('${product.id}')">
                    <div class="product-name">${product.name}</div>
                    <div class="product-footer">
                      <div class="product-price">${priceText}</div>
                    </div>
                    ${hasMultipleVariants ? `
                      <div class="variant-selector" onclick="event.stopPropagation()">
                        ${groupVariants.map(v => `
                          <button class="variant-chip ${v.id === product.id ? 'active' : ''}" onclick="window.switchVariantInGrid('${product.groupId}', '${v.id}', this)">
                            ${v.name.split(' ').pop()}
                          </button>
                        `).join('')}
                      </div>
                    ` : ''}
                  </div>
                </div>
              `;
            }).join('')}
          </div>
        `;
        
        container.appendChild(section);
      });
    }

    // ==================== ACTIONS ====================
    window.switchVariantInGrid = function(groupId, variantId, btn) {
      event.stopPropagation();
      const group = PRODUCT_VARIANTS[groupId];
      const variant = group.variants.find(v => v.id === variantId);
      if (!variant) return;
      
      const card = btn.closest('.product-card');
      const img = card.querySelector('.product-image');
      img.style.opacity = '0.5';
      setTimeout(() => {
        img.src = variant.img || DEFAULT_IMG;
        img.style.opacity = '1';
      }, 200);
      
      card.querySelector('.product-name').textContent = variant.name;
      const priceText = variant.pricePerKg ? fmtRub(variant.pricePerKg) + '/–∫–≥' : 
                       variant.pricePerUnit ? fmtRub(variant.pricePerUnit) : '';
      card.querySelector('.product-price').textContent = priceText;
      
      card.querySelector('.product-image-wrap').setAttribute('onclick', `openProductModal('${variantId}')`);
      card.querySelector('.product-info').setAttribute('onclick', `openProductModal('${variantId}')`);
      card.querySelector('.quick-add-btn').setAttribute('onclick', `event.stopPropagation(); window.quickAdd('${variantId}', this)`);
      
      const favBtn = card.querySelector('.fav-btn');
      favBtn.setAttribute('onclick', `event.stopPropagation(); toggleFavorite('${variantId}')`);
      favBtn.dataset.id = variantId;
      favBtn.classList.toggle('active', favorites.has(variantId));
      favBtn.innerHTML = favorites.has(variantId) ? '‚ô•' : '‚ô°';
      
      card.querySelectorAll('.variant-chip').forEach(chip => chip.classList.remove('active'));
      btn.classList.add('active');
      
      const badge = card.querySelector('.product-badge-hit');
      if (badge && !variant.hit) badge.remove();
      else if (!badge && variant.hit) {
        const newBadge = document.createElement('span');
        newBadge.className = 'product-badge-hit';
        newBadge.textContent = '–•–ò–¢';
        card.querySelector('.product-image-wrap').insertBefore(newBadge, card.querySelector('.fav-btn'));
      }
    }

    window.quickAdd = function(productId, btnElement) {
      let product = ALL_PRODUCTS.find(p => p.id === productId);
      if (!product) return;

      let weight = 500, volume = null;
      if (product.fixedWeight) weight = product.fixedWeight;
      else if (product.volumes) { weight = null; volume = product.volumes[0]; }
      else if (product.weights) weight = product.weights[0];

      const cartItem = {
        id: product.id, name: product.name, img: product.img, group: product.group,
        weight, volume, pricePerKg: product.pricePerKg, pricePerUnit: product.pricePerUnit, pricePerL: product.pricePerL, qty: 1
      };

      const existing = cart.find(item => item.id === cartItem.id && item.weight === cartItem.weight && item.volume === cartItem.volume);
      if (existing) existing.qty++;
      else cart.push(cartItem);

      saveState();
      updateBadges();
      renderMiniCart();

      if (btnElement) {
        btnElement.classList.add('adding');
        setTimeout(() => btnElement.classList.remove('adding'), 400);
        
        const ripple = document.createElement('span');
        ripple.className = 'ripple';
        btnElement.appendChild(ripple);
        setTimeout(() => ripple.remove(), 600);
      }

      const cartBadge = el('cart-badge');
      if (cartBadge) {
        cartBadge.classList.add('pulse');
        setTimeout(() => cartBadge.classList.remove('pulse'), 300);
      }

      showToast('–î–æ–±–∞–≤–ª–µ–Ω–æ –≤ –∫–æ—Ä–∑–∏–Ω—É');
      if (window.Telegram?.WebApp?.HapticFeedback) window.Telegram.WebApp.HapticFeedback.impactOccurred('light');
    }

    // ==================== MODAL ====================
    function openProductModal(productId) {
      let product = ALL_PRODUCTS.find(p => p.id === productId);
      if (!product) return;

      currentProduct = product;
      currentVariant = product;
      currentQty = 1;
      el('qty-value').textContent = '1';
      el('modal-title').textContent = product.name;
      el('modal-description').textContent = product.description || '';
      el('modal-image').src = product.img || DEFAULT_IMG;
      
      const tabsContainer = el('variant-tabs');
      if (product.groupId && PRODUCT_VARIANTS[product.groupId]) {
        const group = PRODUCT_VARIANTS[product.groupId];
        if (group.variants.length > 1) {
          tabsContainer.style.display = 'flex';
          tabsContainer.innerHTML = group.variants.map((v) => `
            <button class="variant-tab ${v.id === product.id ? 'active' : ''}" onclick="switchVariant('${product.groupId}', '${v.id}')">
              ${v.name.split(' ').pop()}
            </button>
          `).join('');
        } else tabsContainer.style.display = 'none';
      } else tabsContainer.style.display = 'none';

      setupWeightPills(product);
      
      const favBtn = el('modal-fav-btn');
      favBtn.classList.toggle('active', favorites.has(productId));
      favBtn.dataset.id = productId;

      updateModalPrice();
      el('product-modal').classList.add('active');
      document.body.style.overflow = 'hidden';
    }

    function switchVariant(groupId, variantId) {
      const group = PRODUCT_VARIANTS[groupId];
      const variant = group.variants.find(v => v.id === variantId);
      if (!variant) return;
      
      currentVariant = variant;
      el('modal-title').textContent = variant.name;
      el('modal-description').textContent = variant.description;
      const img = el('modal-image');
      img.style.opacity = 0;
      setTimeout(() => { img.src = variant.img || DEFAULT_IMG; img.style.opacity = 1; }, 150);

      document.querySelectorAll('.variant-tab').forEach(tab => {
        tab.classList.toggle('active', tab.textContent.includes(variant.name.split(' ').pop()));
      });

      setupWeightPills(variant);
      updateModalPrice();
    }

    function setupWeightPills(product) {
      const container = el('weight-pills');
      const section = el('weight-section');
      selectedWeight = 500; selectedVolume = null;
      
      if (product.fixedWeight) {
        section.style.display = 'block';
        container.innerHTML = `<div class="weight-pill active">${product.fixedWeight} –≥</div>`;
        selectedWeight = product.fixedWeight;
      } else if (product.volumes) {
        section.style.display = 'block';
        container.innerHTML = product.volumes.map((v, idx) => `
          <button class="weight-pill ${idx === 0 ? 'active' : ''}" onclick="selectVolume(${v}, this)">${v} –ª</button>
        `).join('');
        selectedVolume = product.volumes[0];
        selectedWeight = null;
      } else if (product.weights) {
        section.style.display = 'block';
        container.innerHTML = product.weights.map((w, idx) => `
          <button class="weight-pill ${idx === 0 ? 'active' : ''}" onclick="selectWeight(${w}, this)">${w} –≥</button>
        `).join('');
        selectedWeight = product.weights[0];
      } else if (product.pricePerKg) {
        section.style.display = 'block';
        const weights = [100, 200, 300, 400, 500, 600, 700, 800, 900, 1000];
        container.innerHTML = weights.map(w => `
          <button class="weight-pill ${w === 500 ? 'active' : ''}" onclick="selectWeight(${w}, this)">${w}–≥</button>
        `).join('');
        selectedWeight = 500;
      } else {
        section.style.display = 'none';
        selectedWeight = null;
      }
    }

    function selectWeight(weight, btn) {
      selectedWeight = weight; selectedVolume = null;
      document.querySelectorAll('.weight-pill').forEach(pill => pill.classList.remove('active'));
      btn.classList.add('active');
      updateModalPrice();
    }

    function selectVolume(volume, btn) {
      selectedVolume = volume; selectedWeight = null;
      document.querySelectorAll('.weight-pill').forEach(pill => pill.classList.remove('active'));
      btn.classList.add('active');
      updateModalPrice();
    }

    function changeQty(delta) {
      currentQty = Math.max(1, currentQty + delta);
      el('qty-value').textContent = currentQty;
      updateModalPrice();
    }

    function updateModalPrice() {
      if (!currentVariant) return;
      let basePrice = 0, priceText = '', diffText = '', oldPriceText = '';
      
      // –°—á–∏—Ç–∞–µ–º —Å —É—á–µ—Ç–æ–º –æ–±—â–µ–≥–æ –≤–µ—Å–∞ –≤ –∫–æ—Ä–∑–∏–Ω–µ –¥–ª—è —Å–∫–∏–¥–∫–∏
      let totalWeightForDiscount = 0;
      if (currentVariant.group === 'cheese' && currentVariant.pricePerKg) {
        const existingQty = cart
          .filter(item => item.id === currentVariant.id)
          .reduce((sum, item) => sum + (item.weight || 0) * item.qty, 0);
        // –î–ª—è –º–æ–¥–∞–ª–∫–∏ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —Ü–µ–Ω—É –∫–∞–∫ –µ—Å–ª–∏ –±—ã –¥–æ–±–∞–≤–∏–ª–∏ —Ç–µ–∫—É—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∫ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–º—É
        const simulatedTotalWeight = existingQty + (selectedWeight || 0) * currentQty;
        
        let discountRate = 0;
        let discountLabel = '';
        for (const threshold of DISCOUNT_THRESHOLDS) {
          if (simulatedTotalWeight >= threshold.g) {
            discountRate = threshold.rate;
            discountLabel = threshold.label;
          }
        }
        
        if (selectedWeight) {
          basePrice = (selectedWeight / 1000) * currentVariant.pricePerKg * currentQty;
          if (discountRate > 0) {
            const discounted = basePrice * (1 - discountRate);
            oldPriceText = fmtRub(basePrice);
            priceText = fmtRub(discounted);
            diffText = `–í—ã–≥–æ–¥–∞ ${fmtRub(basePrice - discounted)} (${discountLabel})`;
          } else {
            priceText = fmtRub(basePrice);
          }
        }
      } else {
        if (currentVariant.pricePerKg && selectedWeight) {
          basePrice = (selectedWeight / 1000) * currentVariant.pricePerKg * currentQty;
          priceText = fmtRub(basePrice);
        } else if (currentVariant.pricePerUnit) {
          basePrice = currentVariant.pricePerUnit * currentQty;
          priceText = fmtRub(basePrice);
        } else if (currentVariant.pricePerL && selectedVolume) {
          basePrice = currentVariant.pricePerL * selectedVolume * currentQty;
          priceText = fmtRub(basePrice);
        }
      }

      const oldPriceEl = el('modal-price-old');
      if (oldPriceText) {
        oldPriceEl.style.display = 'inline';
        oldPriceEl.textContent = oldPriceText;
      } else {
        oldPriceEl.style.display = 'none';
      }
      
      el('modal-price').textContent = priceText;
      el('price-diff').textContent = diffText;
    }

    function toggleFavorite(id) {
      if (favorites.has(id)) {
        favorites.delete(id);
        showToast('–£–¥–∞–ª–µ–Ω–æ –∏–∑ –∏–∑–±—Ä–∞–Ω–Ω–æ–≥–æ');
      } else {
        favorites.add(id);
        showToast('–î–æ–±–∞–≤–ª–µ–Ω–æ –≤ –∏–∑–±—Ä–∞–Ω–Ω–æ–µ');
      }
      saveState();
      updateBadges();
      renderProductsByCategory(el('search-input').value);
    }

    function toggleModalFavorite() {
      const btn = el('modal-fav-btn');
      toggleFavorite(btn.dataset.id);
      btn.classList.toggle('active', favorites.has(btn.dataset.id));
    }

    function closeProductModal() {
      el('product-modal').classList.remove('active');
      document.body.style.overflow = '';
    }

    function addToCartWithAnimation() {
      if (!currentVariant) return;
      
      let weight = selectedWeight, volume = selectedVolume;
      if (currentVariant.fixedWeight) weight = currentVariant.fixedWeight;
      else if (currentVariant.volumes && !volume) volume = currentVariant.volumes[0];
      
      const cartItem = {
        id: currentVariant.id,
        name: currentVariant.name,
        img: currentVariant.img,
        group: currentVariant.group,
        weight,
        volume,
        pricePerKg: currentVariant.pricePerKg,
        pricePerUnit: currentVariant.pricePerUnit,
        pricePerL: currentVariant.pricePerL,
        qty: currentQty
      };

      const existing = cart.find(item => 
        item.id === cartItem.id && 
        item.weight === cartItem.weight && 
        item.volume === cartItem.volume
      );
      
      if (existing) existing.qty += currentQty;
      else cart.push(cartItem);

      saveState();
      updateBadges();
      renderMiniCart();

      // Sparkle animation
      const btn = document.querySelector('.cow-button');
      const rect = btn.getBoundingClientRect();
      for (let i = 0; i < 8; i++) {
        const sparkle = document.createElement('div');
        sparkle.className = 'sparkle';
        sparkle.style.left = rect.left + rect.width/2 + 'px';
        sparkle.style.top = rect.top + rect.height/2 + 'px';
        sparkle.style.animation = `fly-${['up-left','up-right','left','right','up'][i%5]} 0.6s ease-out forwards`;
        document.body.appendChild(sparkle);
        setTimeout(() => sparkle.remove(), 600);
      }

      closeProductModal();
      showToast('–î–æ–±–∞–≤–ª–µ–Ω–æ –≤ –∫–æ—Ä–∑–∏–Ω—É');
    }

    // ==================== CART ====================
    function renderMiniCart() {
      const miniCart = el('mini-cart-bar');
      const cartCount = cart.reduce((sum, item) => sum + item.qty, 0);
      
      if (cartCount === 0) {
        miniCart.classList.remove('visible');
        return;
      }
      
      const total = calculateCartTotal();
      miniCart.querySelector('.mini-cart-count').textContent = cartCount + ' ' + declOfNum(cartCount, ['—Ç–æ–≤–∞—Ä', '—Ç–æ–≤–∞—Ä–∞', '—Ç–æ–≤–∞—Ä–æ–≤']);
      miniCart.querySelector('.mini-cart-total').textContent = fmtRub(total);
      miniCart.classList.add('visible');
    }

    function declOfNum(n, titles) {
      return titles[n%10===1 && n%100!==11 ? 0 : n%10>=2 && n%10<=4 && (n%100<10 || n%100>=20) ? 1 : 2];
    }

    // –ò–°–ü–†–ê–í–õ–ï–ù–û: –°–∫–∏–¥–∫–∞ —Å—á–∏—Ç–∞–µ—Ç—Å—è –æ—Ç —Å—É–º–º–∞—Ä–Ω–æ–≥–æ –≤–µ—Å–∞ –ø–æ –≤—Å–µ–º –ø–æ–∑–∏—Ü–∏—è–º –æ–¥–Ω–æ–≥–æ —Ç–æ–≤–∞—Ä–∞
    function calculateItemDiscount(item) {
      if (item.group !== 'cheese' || !item.pricePerKg || !item.weight) return { rate: 0, label: '' };
      
      // –°—á–∏—Ç–∞–µ–º –æ–±—â–∏–π –≤–µ—Å –ø–æ –≤—Å–µ–º –ø–æ–∑–∏—Ü–∏—è–º —ç—Ç–æ–≥–æ —Ç–æ–≤–∞—Ä–∞ –≤ –∫–æ—Ä–∑–∏–Ω–µ
      const totalWeight = cart
        .filter(cartItem => cartItem.id === item.id)
        .reduce((sum, cartItem) => sum + (cartItem.weight || 0) * cartItem.qty, 0);
      
      for (let i = DISCOUNT_THRESHOLDS.length - 1; i >= 0; i--) {
        if (totalWeight >= DISCOUNT_THRESHOLDS[i].g) {
          return { rate: DISCOUNT_THRESHOLDS[i].rate, label: DISCOUNT_THRESHOLDS[i].label };
        }
      }
      return { rate: 0, label: '' };
    }

    function calculateCartTotal() {
      return cart.reduce((sum, item) => {
        if (item.pricePerKg && item.weight) {
          const { rate } = calculateItemDiscount(item);
          return sum + ((item.weight / 1000) * item.pricePerKg * (1 - rate) * item.qty);
        } else if (item.pricePerUnit) return sum + (item.pricePerUnit * item.qty);
        else if (item.pricePerL && item.volume) return sum + (item.pricePerL * item.volume * item.qty);
        return sum;
      }, 0);
    }

    function calculateCartSubtotal() {
      return cart.reduce((sum, item) => {
        if (item.pricePerKg && item.weight) {
          return sum + ((item.weight / 1000) * item.pricePerKg * item.qty);
        } else if (item.pricePerUnit) return sum + (item.pricePerUnit * item.qty);
        else if (item.pricePerL && item.volume) return sum + (item.pricePerL * item.volume * item.qty);
        return sum;
      }, 0);
    }

    function openCartModal() {
      const body = el('cart-body');
      
      if (cart.length === 0) {
        body.innerHTML = `
          <div class="empty-state">
            <div class="empty-state-icon">üõí</div>
            <p>–í–∞—à–∞ –∫–æ—Ä–∑–∏–Ω–∞ –ø—É—Å—Ç–∞</p>
            <p style="font-size: 14px; margin-top: 8px;">–î–æ–±–∞–≤—å—Ç–µ —Ç–æ–≤–∞—Ä—ã –∏–∑ –∫–∞—Ç–∞–ª–æ–≥–∞</p>
          </div>
        `;
      } else {
        body.innerHTML = cart.map((item, idx) => {
          let basePrice = 0, finalPrice = 0;
          const { rate, label } = calculateItemDiscount(item);
          
          if (item.pricePerKg && item.weight) {
            basePrice = (item.weight / 1000) * item.pricePerKg * item.qty;
            finalPrice = basePrice * (1 - rate);
          } else if (item.pricePerUnit) {
            basePrice = item.pricePerUnit * item.qty;
            finalPrice = basePrice;
          } else if (item.pricePerL && item.volume) {
            basePrice = item.pricePerL * item.volume * item.qty;
            finalPrice = basePrice;
          }

          const variantText = item.volume ? `${item.volume} –ª` : `${item.weight} –≥`;
          const hasDiscount = rate > 0;
          
          return `
            <div class="cart-item" data-idx="${idx}">
              <img src="${item.img || DEFAULT_IMG}" class="cart-item-image" alt="">
              <div class="cart-item-info">
                <div class="cart-item-name">${item.name}</div>
                <div class="cart-item-variant">${variantText} √ó ${item.qty}</div>
                <div class="cart-item-controls">
                  <button class="cart-qty-btn" onclick="changeCartQty(${idx}, -1)">‚àí</button>
                  <span>${item.qty}</span>
                  <button class="cart-qty-btn" onclick="changeCartQty(${idx}, 1)">+</button>
                </div>
              </div>
              <div class="cart-item-price">
                ${hasDiscount ? `<span class="old">${fmtRub(basePrice)}</span>` : ''}
                <span class="new">${fmtRub(finalPrice)}</span>
                ${hasDiscount ? `<span class="save">–°–∫–∏–¥–∫–∞ ${label}</span>` : ''}
              </div>
            </div>
          `;
        }).join('');

        const subtotal = calculateCartSubtotal();
        const total = calculateCartTotal();
        const totalDiscount = subtotal - total;

        body.innerHTML += `
          <div class="cart-summary">
            ${totalDiscount > 0 ? `
              <div class="cart-total-row">
                <span>–°—É–º–º–∞ –±–µ–∑ —Å–∫–∏–¥–∫–∏:</span>
                <span>${fmtRub(subtotal)}</span>
              </div>
              <div class="cart-total-row discount">
                <span>–í–∞—à–∞ –≤—ã–≥–æ–¥–∞:</span>
                <span>‚àí${fmtRub(totalDiscount)}</span>
              </div>
            ` : ''}
            <div class="cart-total">
              <span class="cart-total-label">–ò—Ç–æ–≥–æ –∫ –æ–ø–ª–∞—Ç–µ:</span>
              <span class="cart-total-price">${fmtRub(total)}</span>
            </div>
            <div class="form-group">
              <label class="form-label">–ì–æ—Ä–æ–¥</label>
              <select class="form-select" id="checkout-city">
                <option value="–ü–µ–Ω–∑–∞">–ü–µ–Ω–∑–∞</option>
                <option value="–ú–æ—Å–∫–≤–∞">–ú–æ—Å–∫–≤–∞</option>
              </select>
            </div>
            <div class="form-group">
              <label class="form-label">–¢–µ–ª–µ—Ñ–æ–Ω</label>
              <input type="tel" class="form-input" id="checkout-phone" placeholder="+7 (999) 999-99-99">
            </div>
            <div class="form-group">
              <label class="form-label">–ê–¥—Ä–µ—Å –¥–æ—Å—Ç–∞–≤–∫–∏</label>
              <textarea class="form-textarea" id="checkout-address" placeholder="–£–ª–∏—Ü–∞, –¥–æ–º, –∫–≤–∞—Ä—Ç–∏—Ä–∞"></textarea>
            </div>
            <div class="form-group">
              <label class="form-label">–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π</label>
              <textarea class="form-textarea" id="checkout-comment" placeholder="–ü–æ–∂–µ–ª–∞–Ω–∏—è –∫ –∑–∞–∫–∞–∑—É"></textarea>
            </div>
            <button class="cow-button" style="width:100%;height:56px;border-radius:16px;margin-top:10px" onclick="submitOrder()">
              <span class="button-text">–û—Ñ–æ—Ä–º–∏—Ç—å –∑–∞–∫–∞–∑</span>
            </button>
          </div>
        `;
      }
      
      el('cart-modal').classList.add('active');
      document.body.style.overflow = 'hidden';
    }

    function closeCartModal() {
      el('cart-modal').classList.remove('active');
      document.body.style.overflow = '';
    }

    function changeCartQty(idx, delta) {
      if (!cart[idx]) return;
      cart[idx].qty += delta;
      if (cart[idx].qty <= 0) {
        const item = document.querySelector(`.cart-item[data-idx="${idx}"]`);
        if (item) {
          item.classList.add('removing');
          setTimeout(() => {
            cart.splice(idx, 1);
            saveState();
            updateBadges();
            renderMiniCart();
            openCartModal();
          }, 300);
        } else {
          cart.splice(idx, 1);
          saveState();
          updateBadges();
          renderMiniCart();
          openCartModal();
        }
      } else {
        saveState();
        updateBadges();
        renderMiniCart();
        openCartModal();
      }
    }

    // ==================== ORDERS ====================
    async function submitOrder() {
      const phone = el('checkout-phone').value;
      const address = el('checkout-address').value;
      if (!phone || !address) { showToast('–ó–∞–ø–æ–ª–Ω–∏—Ç–µ —Ç–µ–ª–µ—Ñ–æ–Ω –∏ –∞–¥—Ä–µ—Å'); return; }

      const payload = {
        items: cart,
        contact: { phone, address, city: el('checkout-city').value, comment: el('checkout-comment').value },
        telegram_user_id: window.Telegram?.WebApp?.initDataUnsafe?.user?.id,
        timestamp: Date.now()
      };

      if (!isOnline) {
        const offlineOrders = JSON.parse(localStorage.getItem(STORAGE_OFFLINE_ORDERS) || '[]');
        offlineOrders.push(payload);
        localStorage.setItem(STORAGE_OFFLINE_ORDERS, JSON.stringify(offlineOrders));
        showToast('–ó–∞–∫–∞–∑ —Å–æ—Ö—Ä–∞–Ω–µ–Ω –ª–æ–∫–∞–ª—å–Ω–æ');
        closeCartModal();
        cart = [];
        saveState();
        updateBadges();
        renderMiniCart();
        return;
      }

      await sendOrderToServer(payload);
    }

    async function sendOrderToServer(payload) {
      el('loader').classList.add('active');
      try {
        const response = await fetch(`${BACKEND}/api/order`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(payload)
        });
        
        if (!response.ok) throw new Error('Server error');
        
        const data = await response.json();
        
        orderHistory.unshift({
          id: data.orderId,
          items: payload.items,
          total: calculateCartTotal(),
          status: 'new',
          created_at: new Date().toISOString()
        });
        saveState();
        
        el('loader').classList.remove('active');
        cart = [];
        saveState();
        updateBadges();
        renderMiniCart();
        closeCartModal();
        showToast(`–ó–∞–∫–∞–∑ #${data.orderId} –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω!`);
        
        if (window.Telegram?.WebApp?.HapticFeedback) window.Telegram.WebApp.HapticFeedback.notificationOccurred('success');
      } catch (err) {
        console.error(err);
        el('loader').classList.remove('active');
        showToast('–û—à–∏–±–∫–∞ —Å–µ—Ç–∏. –°–æ—Ö—Ä–∞–Ω–µ–Ω–æ –ª–æ–∫–∞–ª—å–Ω–æ.');
        const offlineOrders = JSON.parse(localStorage.getItem(STORAGE_OFFLINE_ORDERS) || '[]');
        offlineOrders.push(payload);
        localStorage.setItem(STORAGE_OFFLINE_ORDERS, JSON.stringify(offlineOrders));
      }
    }

    async function syncOfflineOrders() {
      const offlineOrders = JSON.parse(localStorage.getItem(STORAGE_OFFLINE_ORDERS) || '[]');
      if (offlineOrders.length === 0) return;
      
      showToast(`–û—Ç–ø—Ä–∞–≤–∫–∞ ${offlineOrders.length} —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã—Ö –∑–∞–∫–∞–∑–æ–≤...`);
      
      for (const order of offlineOrders) {
        try {
          await fetch(`${BACKEND}/api/order`, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(order)
          });
        } catch (e) { console.error('Sync failed', e); }
      }
      
      localStorage.removeItem(STORAGE_OFFLINE_ORDERS);
      showToast('–í—Å–µ –∑–∞–∫–∞–∑—ã —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞–Ω—ã!');
    }

    function showOrderHistory() {
      document.querySelectorAll('.nav-item').forEach((item, idx) => {
        item.classList.toggle('active', idx === 2);
      });
      
      const container = el('products-section');
      
      if (orderHistory.length === 0) {
        container.innerHTML = `
          <div class="empty-state" style="padding: 60px 20px;">
            <div class="empty-state-icon">üìã</div>
            <p>–ò—Å—Ç–æ—Ä–∏—è –∑–∞–∫–∞–∑–æ–≤ –ø—É—Å—Ç–∞</p>
          </div>
        `;
        return;
      }
      
      container.innerHTML = `
        <div class="products-category">
          <h3 class="category-title">üìã –ò—Å—Ç–æ—Ä–∏—è –∑–∞–∫–∞–∑–æ–≤</h3>
          <div class="orders-list">
            ${orderHistory.map(order => `
              <div class="order-card">
                <div class="order-header">
                  <span class="order-id">–ó–∞–∫–∞–∑ #${order.id}</span>
                  <span class="order-status status-${order.status}">${getStatusText(order.status)}</span>
                </div>
                <div class="order-items-preview">
                  ${order.items.slice(0, 3).map(item => `
                    <img src="${item.img || DEFAULT_IMG}" class="order-item-thumb" alt="">
                  `).join('')}
                  ${order.items.length > 3 ? `<span class="order-more">+${order.items.length - 3}</span>` : ''}
                </div>
                <div class="order-footer">
                  <span class="order-date">${new Date(order.created_at).toLocaleDateString()}</span>
                  <span class="order-total">${fmtRub(order.total)}</span>
                </div>
                <button class="reorder-btn" onclick="reorder(${order.id})">‚Üª –ü–æ–≤—Ç–æ—Ä–∏—Ç—å –∑–∞–∫–∞–∑</button>
              </div>
            `).join('')}
          </div>
        </div>
      `;
    }

    function getStatusText(status) {
      const map = { 'new': '–ù–æ–≤—ã–π', 'processing': '–í –æ–±—Ä–∞–±–æ—Ç–∫–µ', 'done': '–í—ã–ø–æ–ª–Ω–µ–Ω', 'cancelled': '–û—Ç–º–µ–Ω–µ–Ω' };
      return map[status] || status;
    }

    function reorder(orderId) {
      const order = orderHistory.find(o => o.id === orderId);
      if (!order) return;
      
      order.items.forEach(item => {
        cart.push({...item, qty: item.qty || 1});
      });
      
      saveState();
      updateBadges();
      renderMiniCart();
      showToast('–¢–æ–≤–∞—Ä—ã –¥–æ–±–∞–≤–ª–µ–Ω—ã –≤ –∫–æ—Ä–∑–∏–Ω—É');
      openCartModal();
    }

    // ==================== NAVIGATION ====================
    function showMain() {
      document.querySelectorAll('.nav-item').forEach((item, idx) => item.classList.toggle('active', idx === 0));
      currentCategory = 'all';
      document.querySelectorAll('.category-tab').forEach(t => t.classList.remove('active'));
      document.querySelector('.category-tab[data-category="all"]').classList.add('active');
      renderProductsByCategory();
      window.scrollTo({ top: 0, behavior: 'smooth' });
    }

    function showFavorites() {
      document.querySelectorAll('.nav-item').forEach((item, idx) => item.classList.toggle('active', idx === 1));
      const container = el('products-section');
      const favProducts = ALL_PRODUCTS.filter(p => favorites.has(p.id));
      
      if (favProducts.length === 0) {
        container.innerHTML = `<div class="empty-state" style="padding: 60px 20px;"><div class="empty-state-icon">‚ô°</div><p>–ù–µ—Ç –∏–∑–±—Ä–∞–Ω–Ω—ã—Ö —Ç–æ–≤–∞—Ä–æ–≤</p></div>`;
      } else {
        container.innerHTML = `
          <div class="products-category">
            <h3 class="category-title">‚ô° –ò–∑–±—Ä–∞–Ω–Ω–æ–µ</h3>
            <div class="product-grid">
              ${favProducts.map(product => {
                const priceText = product.pricePerKg ? fmtRub(product.pricePerKg) + '/–∫–≥' : fmtRub(product.pricePerUnit);
                const groupVariants = product.groupId ? PRODUCT_VARIANTS[product.groupId]?.variants : null;
                const hasMultipleVariants = groupVariants && groupVariants.length > 1;
                return `
                  <div class="product-card" data-product-id="${product.id}">
                    <div class="product-image-wrap" onclick="openProductModal('${product.id}')">
                      <img src="${product.img || DEFAULT_IMG}" class="product-image" alt="${product.name}">
                      ${product.hit ? '<span class="product-badge-hit">–•–ò–¢</span>' : ''}
                      <button class="fav-btn active" onclick="event.stopPropagation(); toggleFavorite('${product.id}')">‚ô•</button>
                      <button class="quick-add-btn" onclick="event.stopPropagation(); window.quickAdd('${product.id}', this)">+</button>
                    </div>
                    <div class="product-info" onclick="openProductModal('${product.id}')">
                      <div class="product-name">${product.name}</div>
                      <div class="product-footer"><div class="product-price">${priceText}</div></div>
                      ${hasMultipleVariants ? `
                        <div class="variant-selector" onclick="event.stopPropagation()">
                          ${groupVariants.map(v => `
                            <button class="variant-chip ${v.id === product.id ? 'active' : ''}" onclick="window.switchVariantInGrid('${product.groupId}', '${v.id}', this)">
                              ${v.name.split(' ').pop()}
                            </button>
                          `).join('')}
                        </div>
                      ` : ''}
                    </div>
                  </div>
                `;
              }).join('')}
            </div>
          </div>
        `;
      }
    }

    function openProfileModal() {
      el('profile-modal').classList.add('active');
      document.body.style.overflow = 'hidden';
    }

    function closeProfileModal() {
      el('profile-modal').classList.remove('active');
      document.body.style.overflow = '';
    }

    function updateBadges() {
      const cartCount = cart.reduce((sum, item) => sum + item.qty, 0);
      const favCount = favorites.size;
      
      const cartBadge = el('cart-badge');
      const favBadge = el('fav-badge');
      
      cartBadge.textContent = cartCount;
      cartBadge.style.display = cartCount > 0 ? 'flex' : 'none';
      
      favBadge.textContent = favCount;
      favBadge.style.display = favCount > 0 ? 'flex' : 'none';

      document.querySelectorAll('.fav-btn').forEach(btn => {
        const id = btn.dataset.id;
        if (id) {
          btn.classList.toggle('active', favorites.has(id));
          btn.innerHTML = favorites.has(id) ? '‚ô•' : '‚ô°';
        }
      });
    }

    // Search listener
    document.addEventListener('DOMContentLoaded', () => {
      el('search-input').addEventListener('input', (e) => {
        renderProductsByCategory(e.target.value);
      });
      
      document.querySelectorAll('.category-tab').forEach(tab => {
        tab.addEventListener('click', () => {
          document.querySelectorAll('.category-tab').forEach(t => t.classList.remove('active'));
          tab.classList.add('active');
          currentCategory = tab.dataset.category;
          renderProductsByCategory(el('search-input').value);
        });
      });
    });
  </script>
</body>
</html>
