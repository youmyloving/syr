<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover" />
  <title>–°—ã—Ä–æ–º–∞–Ω–∏—è</title>
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  <style>
    :root{
      --bg-color:#F8EFDA;--text-color:#2E2A23;--hint-color:#8A7F6A;--link-color:#8B5E34;--button-color:#8B5E34;--button-text-color:#fff;
      --secondary-bg-color:#FFF6E7;--header-bg-color:#FFF9EF;--section-bg-color:#fff;--border-color:#E7D8BF;--error-color:#E74C3C;--success-color:#2E8B57;
      --font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,Helvetica,Arial,sans-serif;--radius-lg:12px
    }
    *{box-sizing:border-box}
    body{margin:0;background:var(--bg-color);color:var(--text-color);font-family:var(--font-family);font-size:16px;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}
    #app{display:flex;flex-direction:column;min-height:100vh}
    header{background:var(--header-bg-color);border-bottom:1px solid var(--border-color);padding:10px;position:sticky;top:0;z-index:3}
    .user-profile{display:flex;align-items:center;gap:10px;margin-bottom:10px}
    .user-avatar{width:32px;height:32px;border-radius:50%;background:var(--secondary-bg-color);display:flex;align-items:center;justify-content:center;font-size:16px;color:var(--hint-color);overflow:hidden}
    .user-avatar img{width:100%;height:100%;object-fit:cover}
    .user-name{font-weight:600}
    .search-container{margin-bottom:10px}
    #search-input{width:100%;padding:10px;border:1px solid var(--border-color);border-radius:10px;background:var(--secondary-bg-color);color:var(--text-color);font-size:16px}
    .filters-container{display:flex;gap:10px;align-items:center;flex-wrap:wrap}
    #category-filter{padding:8px;border:1px solid var(--border-color);border-radius:10px;background:var(--secondary-bg-color);color:var(--text-color);flex-grow:1}
    .toggle{display:flex;align-items:center;gap:6px;cursor:pointer;white-space:nowrap}
    main{flex-grow:1;padding:10px;padding-bottom:100px}
    .section-block{margin:20px 0}
    .section-title{font-size:18px;font-weight:800;margin:0 0 10px;opacity:.9}
    .product-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(160px,1fr));gap:14px}
    .product-card{border:1px solid var(--border-color);border-radius:var(--radius-lg);padding:10px;background:var(--section-bg-color);cursor:pointer;display:flex;flex-direction:column;transition:transform .18s,box-shadow .18s;position:relative}
    .product-card:hover{transform:translateY(-4px);box-shadow:0 6px 16px rgba(0,0,0,.08)}
    .product-media{width:100%;aspect-ratio:1/1;border-radius:10px;background:var(--secondary-bg-color);display:grid;place-items:center;overflow:hidden;margin-bottom:8px}
    .product-media img{width:100%;height:100%;object-fit:cover}
    .ico{font-size:40px}
    .name{font-weight:700;font-size:14px;margin-bottom:4px}
    .price{color:var(--hint-color);font-size:13px}
    .badge-piece{position:absolute;top:10px;left:10px;background:#fff;border:1px solid var(--border-color);border-radius:999px;padding:4px 8px;font-size:12px;font-weight:700}
    .fav-btn{position:absolute;top:10px;right:10px;background:#fff;border:1px solid var(--border-color);border-radius:999px;width:32px;height:32px;display:grid;place-items:center;cursor:pointer}
    .fav-btn span{font-size:18px;line-height:1}
    .favorites-rail{display:flex;gap:10px;overflow:auto;padding-bottom:4px}
    .fav-chip{border:1px solid var(--border-color);background:#fff;border-radius:20px;padding:8px 12px;font-size:14px;white-space:nowrap;cursor:pointer}
    .cart-footer{position:sticky;bottom:0;background:var(--header-bg-color);border-top:1px solid var(--border-color);padding:10px;display:flex;gap:10px;align-items:center;z-index:2}
    #open-cart-btn{background:var(--button-color);color:var(--button-text-color);padding:12px 20px;border-radius:24px;cursor:pointer;border:none;font-size:16px;font-weight:700;width:100%;max-width:420px;transition:filter .2s}
    #open-cart-btn:hover{filter:brightness(108%)}
    #open-cart-btn:disabled{background:var(--hint-color);cursor:not-allowed}
    dialog{border:1px solid var(--border-color);border-radius:var(--radius-lg);padding:0;background:var(--section-bg-color);color:var(--text-color);width:92vw;max-width:480px;max-height:84vh;overflow:hidden;box-shadow:0 12px 30px rgba(0,0,0,.18)}
    dialog::backdrop{background:rgba(0,0,0,.5);backdrop-filter:blur(4px)}
    .modal-header{padding:14px 16px;border-bottom:1px solid var(--border-color);display:flex;justify-content:space-between;align-items:center;background:var(--header-bg-color);position:sticky;top:0;z-index:1}
    .modal-header h2{margin:0;font-size:18px}
    .modal-close{background:none;border:none;font-size:24px;cursor:pointer;color:var(--hint-color);padding:0;line-height:1;border-radius:50%;width:32px;height:32px;display:grid;place-items:center}
    .modal-close:hover{background:var(--secondary-bg-color)}
    .modal-body{padding:14px 16px;overflow:auto;max-height:68vh}
    .form-group{margin-bottom:12px}
    .form-group label{display:block;margin-bottom:6px;font-size:14px;font-weight:600}
    .form-group select,.form-group input,.form-group textarea{width:100%;padding:10px;border:1px solid var(--border-color);border-radius:10px;background:var(--secondary-bg-color);color:var(--text-color);font-size:16px}
    .form-row{display:flex;gap:10px}
    .form-row .form-group{flex:1}
    .price-display{font-size:18px;font-weight:800;text-align:center;margin:12px 0}
    .btn{padding:12px 20px;border:none;border-radius:10px;font-size:16px;font-weight:700;cursor:pointer;width:100%;transition:transform .08s,filter .18s}
    .btn:active{transform:scale(.98)}
    .btn-primary{background:var(--button-color);color:var(--button-text-color)}
    .btn-primary:hover{filter:brightness(108%)}
    .btn-secondary{background:var(--secondary-bg-color);color:var(--text-color);border:1px solid var(--border-color)}
    .btn-secondary:hover{background:#fdeed6}
    .tiny{font-size:12px;color:var(--hint-color)}
    .cart-item{display:flex;justify-content:space-between;align-items:center;padding:10px 0;border-bottom:1px solid var(--border-color)}
    .cart-item:last-child{border-bottom:none}
    .cart-item-info{flex-grow:1;padding-right:10px}
    .cart-item-name{font-weight:800}
    .cart-item-variant{font-size:13px;color:var(--hint-color)}
    .cart-item-price{font-size:14px}
    .discount-hint{color:var(--success-color);font-size:12px;margin-top:4px}
    .cart-item-controls{display:flex;align-items:center;gap:8px}
    .qty-control{display:flex;align-items:center;border:1px solid var(--border-color);border-radius:10px;overflow:hidden}
    .qty-control button{background:none;border:none;width:32px;height:32px;cursor:pointer;font-size:18px;color:var(--text-color);display:grid;place-items:center}
    .qty-control button:hover{background:var(--secondary-bg-color)}
    .qty-control span{padding:0 10px;min-width:30px;text-align:center}
    .cart-summary{margin-top:14px;padding-top:12px;border-top:2px solid var(--border-color);font-size:18px;font-weight:900;text-align:right}
    .cart-note{margin-top:6px;font-size:12px;color:var(--hint-color);text-align:right}
    .error-text{color:var(--error-color);font-size:13px;margin-top:6px}
    .product-modal-media{width:100%;aspect-ratio:4/3;border-radius:10px;background:var(--secondary-bg-color);display:grid;place-items:center;overflow:hidden;margin-bottom:10px}
    .product-modal-media img{width:100%;height:100%;object-fit:cover}
    .piece-badge-inline{display:inline-block;border:1px solid var(--border-color);border-radius:999px;padding:4px 8px;margin-left:6px;font-size:12px}
  </style>
</head>
<body>
<div id="app">
  <header>
    <div class="user-profile" id="user-profile"></div>
    <div class="search-container">
      <input type="search" id="search-input" placeholder="–ü–æ–∏—Å–∫ –ø–æ –Ω–∞–∑–≤–∞–Ω–∏—é..." />
    </div>
    <div class="filters-container">
      <select id="category-filter">
        <option value="">–í—Å–µ –≥—Ä—É–ø–ø—ã</option>
        <option>–†–∞—Å—Å–æ–ª—å–Ω—ã–µ —Å—ã—Ä—ã</option>
        <option>–ú—è–≥–∫–∏–µ —Å—ã—Ä—ã</option>
        <option>–¢–≤—ë—Ä–¥—ã–µ —Å—ã—Ä—ã</option>
        <option>–°—ã—Ä–Ω—ã–µ —Ä—É–ª–µ—Ç—ã</option>
        <option>–ú–æ–ª–æ—á–Ω–∞—è –ø—Ä–æ–¥—É–∫—Ü–∏—è</option>
        <option>–°–ª–∞–¥–æ—Å—Ç–∏</option>
        <option>–í—ã–ø–µ—á–∫–∞</option>
      </select>
      <label class="toggle"><input type="checkbox" id="only-cheese-checkbox" /> –¢–æ–ª—å–∫–æ —Å—ã—Ä—ã</label>
      <label class="toggle"><input type="checkbox" id="only-fav-checkbox" /> –ò–∑–±—Ä–∞–Ω–Ω–æ–µ</label>
    </div>
    <div id="favorites-rail" class="favorites-rail" style="margin-top:8px;display:none;"></div>
  </header>

  <main id="main-content"></main>

  <footer class="cart-footer">
    <button id="open-cart-btn" disabled>–ö–æ—Ä–∑–∏–Ω–∞ –ø—É—Å—Ç–∞</button>
  </footer>
</div>

<!-- Product modal -->
<dialog id="product-modal">
  <div class="modal-header">
    <h2 id="product-modal-title"></h2>
    <button class="modal-close" onclick="closeProductModal()">&times;</button>
  </div>
  <div class="modal-body">
    <div class="product-modal-media"><img id="product-modal-img" alt="" /></div>
    <p class="description tiny" id="product-modal-description"></p>

    <div class="form-group">
      <label for="product-variant-select">–í–∞—Ä–∏–∞–Ω—Ç</label>
      <select id="product-variant-select"></select>
      <div class="tiny" id="piece-badge-inline" style="display:none"></div>
    </div>

    <div class="form-row">
      <div class="form-group">
        <label for="product-qty-input">–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ</label>
        <input type="number" id="product-qty-input" value="1" min="1" />
      </div>
      <div class="form-group" id="custom-weight-wrap" style="display:none">
        <label for="custom-weight-input">–°–≤–æ–π –≤–µ—Å (–≥)</label>
        <input type="number" id="custom-weight-input" min="50" step="10" placeholder="–Ω–∞–ø—Ä–∏–º–µ—Ä, 350" />
        <div class="tiny">–î–ª—è —Ç–æ–≤–∞—Ä–æ–≤ –ø–æ —Ü–µ–Ω–µ –∑–∞ –∫–≥</div>
      </div>
    </div>

    <div class="price-display" id="product-modal-price">0 ‚ÇΩ</div>
    <button class="btn btn-primary" id="add-to-cart-btn">–î–æ–±–∞–≤–∏—Ç—å –≤ –∫–æ—Ä–∑–∏–Ω—É</button>
  </div>
</dialog>

<!-- Cart + checkout -->
<dialog id="cart-modal">
  <div class="modal-header">
    <h2>–ö–æ—Ä–∑–∏–Ω–∞</h2>
    <button class="modal-close" onclick="closeCartModal()">&times;</button>
  </div>
  <div class="modal-body" id="cart-modal-body"></div>
</dialog>

<script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
<script>
/* ===================== CONFIG ===================== */
const BACKEND = 'https://puzzlebot-webhook-handler1.onrender.com';
const CURRENCY = 'RUB';
const ROUND = Math.round;
const DISCOUNT_THRESHOLDS = [
  { g: 1000, rate: 0.15 }, { g: 700, rate: 0.10 }, { g: 500, rate: 0.05 }
];
// –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ –ø—Ä–æ–º–æ–∫–æ–¥—ã (–ª—É—á—à–µ –ø—Ä–æ–≤–µ—Ä—è—Ç—å –Ω–∞ –±—ç–∫–µ–Ω–¥–µ)
const PROMO_CODES = {
  // 'SYRO10': { type: 'percent', value: 10, note: '–°–∫–∏–¥–∫–∞ 10%' },
  // 'WELCOME50': { type: 'flat', value: 50, note: '–°–∫–∏–¥–∫–∞ 50 ‚ÇΩ' },
};
const ONLY_CHEESE_FILTER_DEFAULT = false;
const PAYLOAD_SCHEMA_VERSION = 'v2';
const STORAGE_CART_KEY = 'syromania-cart';
const STORAGE_CHECKOUT_KEY = 'syromania-checkout';
const STORAGE_FAV_KEY = 'syromania-favorites';

const fmtRub = (n) => new Intl.NumberFormat('ru-RU').format(n) + ' ‚ÇΩ';

/* ===================== DATA ===================== */
const PRODUCTS = [
  /* ----------- –†–ê–°–°–û–õ–¨–ù–´–ï –°–´–†–´ (isCheese: true) ----------- */
  { id:'suluguni', name:'–°—É–ª—É–≥—É–Ω–∏', group:'–†–∞—Å—Å–æ–ª—å–Ω—ã–µ —Å—ã—Ä—ã', cat:'–°—ã—Ä—ã', isCheese:true, pricePerKg:1700, img:'https://static.tildacdn.com/tild3238-3866-4366-a436-623236363261/suluguni.webp',
    description:'–£–º–µ—Ä–µ–Ω–Ω–æ —Å–æ–ª—ë–Ω—ã–π –≤–∫—É—Å, –ø–ª–æ—Ç–Ω–∞—è, —Å–ª–æ–∏—Å—Ç–∞—è –∏ —ç–ª–∞—Å—Ç–∏—á–Ω–∞—è –∫–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ü–∏—è. –°—Ä–æ–∫ —Ö—Ä–∞–Ω–µ–Ω–∏—è: 7 —Å—É—Ç–æ–∫.' },
  { id:'suluguni-smoked', name:'–°—É–ª—É–≥—É–Ω–∏ –∫–æ–ø—á—ë–Ω—ã–π', group:'–†–∞—Å—Å–æ–ª—å–Ω—ã–µ —Å—ã—Ä—ã', cat:'–°—ã—Ä—ã', isCheese:true, pricePerKg:1800, img:'https://static.tildacdn.com/tild6435-3838-4463-b431-353765323333/suluguni-smoked.webp',
    description:'–° –ª—ë–≥–∫–æ–π –∫–æ–ø—á—ë–Ω–æ—Å—Ç—å—é, –ø–ª–æ—Ç–Ω–∞—è –∏ —ç–ª–∞—Å—Ç–∏—á–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞. –°—Ä–æ–∫ —Ö—Ä–∞–Ω–µ–Ω–∏—è: –¥–æ 30 —Å—É—Ç–æ–∫.' },
  { id:'imeretian', name:'–ò–º–µ—Ä–µ—Ç–∏–Ω—Å–∫–∏–π', group:'–†–∞—Å—Å–æ–ª—å–Ω—ã–µ —Å—ã—Ä—ã', cat:'–°—ã—Ä—ã', isCheese:true, pricePerKg:1500, img:'https://raw.githubusercontent.com/youmyloving/syr/main/imeretian.webp',
    description:'–ü—Ä–µ–∫—Ä–∞—Å–Ω—ã–π —Ä–∞—Å—Å–æ–ª—å–Ω—ã–π —Å—ã—Ä, –ø–æ–¥—Ö–æ–¥–∏—Ç –∫–æ –≤—Å–µ–º –±–ª—é–¥–∞–º. –°—Ä–æ–∫ —Ö—Ä–∞–Ω–µ–Ω–∏—è: 7 —Å—É—Ç–æ–∫.' },
  { id:'imeretian-dill-garlic', name:'–ò–º–µ—Ä–µ—Ç–∏–Ω—Å–∫–∏–π —Å —É–∫—Ä–æ–ø–æ–º –∏ —á–µ—Å–Ω–æ–∫–æ–º', group:'–†–∞—Å—Å–æ–ª—å–Ω—ã–µ —Å—ã—Ä—ã', cat:'–°—ã—Ä—ã', isCheese:true, pricePerKg:1600, img:'https://raw.githubusercontent.com/youmyloving/syr/main/imeretian.webp',
    description:'–°–≤–µ–∂–∏–π —Ä–∞—Å—Å–æ–ª—å–Ω—ã–π —Å—ã—Ä —Å –∞—Ä–æ–º–∞—Ç–Ω–æ–π –∑–µ–ª–µ–Ω—å—é –∏ —á–µ—Å–Ω–æ–∫–æ–º. –°—Ä–æ–∫ —Ö—Ä–∞–Ω–µ–Ω–∏—è: 7 —Å—É—Ç–æ–∫.' },
  { id:'halloumi', name:'–•–∞–ª–ª—É–º–∏ (–∫–ª–∞—Å—Å–∏—á–µ—Å–∫–∏–π)', group:'–†–∞—Å—Å–æ–ª—å–Ω—ã–µ —Å—ã—Ä—ã', cat:'–°—ã—Ä—ã', isCheese:true, pricePerKg:1950, img:'https://static.tildacdn.com/tild3161-6362-4130-b134-623331346238/halloumi.webp',
    description:'–ò–¥–µ–∞–ª–µ–Ω –¥–ª—è –∂–∞—Ä–∫–∏ –Ω–∞ —Å–∫–æ–≤–æ—Ä–æ–¥–µ –∏–ª–∏ –≥—Ä–∏–ª–µ ‚Äî –ø–æ—è–≤–ª—è–µ—Ç—Å—è —Ö—Ä—É—Å—Ç—è—â–∞—è –∫–æ—Ä–æ—á–∫–∞. –°—Ä–æ–∫ —Ö—Ä–∞–Ω–µ–Ω–∏—è: 7 —Å—É—Ç–æ–∫.' },
  { id:'halloumi-paprika-oregano', name:'–•–∞–ª–ª—É–º–∏ —Å –ø–∞–ø—Ä–∏–∫–æ–π –∏ –æ—Ä–µ–≥–∞–Ω–æ', group:'–†–∞—Å—Å–æ–ª—å–Ω—ã–µ —Å—ã—Ä—ã', cat:'–°—ã—Ä—ã', isCheese:true, pricePerKg:2100, img:'https://static.tildacdn.com/tild3133-6165-4134-b335-396662633262/halloumi-paprika-ore.webp',
    description:'–ò–¥–µ–∞–ª–µ–Ω –¥–ª—è –∂–∞—Ä–∫–∏; –ø–∏–∫–∞–Ω—Ç–Ω—ã–µ —Å–ø–µ—Ü–∏–∏. –°—Ä–æ–∫ —Ö—Ä–∞–Ω–µ–Ω–∏—è: 7 —Å—É—Ç–æ–∫.' },
  { id:'halloumi-tomato-basil-garlic', name:'–•–∞–ª–ª—É–º–∏ —Ç–æ–º–∞—Ç-–±–∞–∑–∏–ª–∏–∫-—á–µ—Å–Ω–æ–∫', group:'–†–∞—Å—Å–æ–ª—å–Ω—ã–µ —Å—ã—Ä—ã', cat:'–°—ã—Ä—ã', isCheese:true, pricePerKg:2100, img:'https://raw.githubusercontent.com/youmyloving/syr/main/halloumi-tomato-basil-garlic.webp',
    description:'–° —Ç—Ä–æ–π–∫–æ–π –∞—Ä–æ–º–∞—Ç–æ–≤ ‚Äî —Ç–æ–º–∞—Ç, –±–∞–∑–∏–ª–∏–∫, —á–µ—Å–Ω–æ–∫. –°—Ä–æ–∫ —Ö—Ä–∞–Ω–µ–Ω–∏—è: 7 —Å—É—Ç–æ–∫.' },
  { id:'halloumi-tomato-paprika', name:'–•–∞–ª–ª—É–º–∏ —Å –≤—è–ª–µ–Ω—ã–º–∏ –ø–æ–º–∏–¥–æ—Ä–∞–º–∏ –∏ –ø–∞–ø—Ä–∏–∫–æ–π', group:'–†–∞—Å—Å–æ–ª—å–Ω—ã–µ —Å—ã—Ä—ã', cat:'–°—ã—Ä—ã', isCheese:true, pricePerKg:2100, img:'https://static.tildacdn.com/tild3863-3030-4439-a439-653238303862/halloumi-tomato-papr.webp',
    description:'–° –≤—è–ª–µ–Ω—ã–º–∏ —Ç–æ–º–∞—Ç–∞–º–∏ –∏ –ø–∞–ø—Ä–∏–∫–æ–π. –°—Ä–æ–∫ —Ö—Ä–∞–Ω–µ–Ω–∏—è: 7 —Å—É—Ç–æ–∫.' },
  { id:'kosichka', name:'–ö–æ—Å–∏—á–∫–∞ (1 —à—Ç ~200 –≥)', group:'–†–∞—Å—Å–æ–ª—å–Ω—ã–µ —Å—ã—Ä—ã', cat:'–°—ã—Ä—ã', isCheese:true, pricePerKg:1900, img:'https://raw.githubusercontent.com/youmyloving/syr/main/rolls-olives-walnut.webp',
    description:'–°–ª–µ–≥–∫–∞ —Å–æ–ª—ë–Ω—ã–π, –ø–æ–¥—Ö–æ–¥–∏—Ç –∫–æ –≤—Å–µ–º—É. –°—Ä–æ–∫ —Ö—Ä–∞–Ω–µ–Ω–∏—è: 7 —Å—É—Ç–æ–∫.' },
  { id:'kosichka-smoked', name:'–ö–æ—Å–∏—á–∫–∞ –∫–æ–ø—á—ë–Ω–∞—è (1 —à—Ç ~200 –≥)', group:'–†–∞—Å—Å–æ–ª—å–Ω—ã–µ —Å—ã—Ä—ã', cat:'–°—ã—Ä—ã', isCheese:true, pricePerKg:2000, img:'https://raw.githubusercontent.com/youmyloving/syr/main/kosichka-smoked.webp',
    description:'–•–æ–ª–æ–¥–Ω–æ–µ –∫–æ–ø—á–µ–Ω–∏–µ, –ª—ë–≥–∫–∞—è —Å–æ–ª—ë–Ω–æ—Å—Ç—å. –°—Ä–æ–∫ —Ö—Ä–∞–Ω–µ–Ω–∏—è: 30 —Å—É—Ç–æ–∫.' },
  { id:'spicy-klubok', name:'–ü—Ä—è–Ω—ã–µ –∫–ª—É–±–æ—á–∫–∏ (1 —à—Ç ~150 –≥)', group:'–†–∞—Å—Å–æ–ª—å–Ω—ã–µ —Å—ã—Ä—ã', cat:'–°—ã—Ä—ã', isCheese:true, pricePerKg:1950, img:'https://static.tildacdn.com/tild3463-6166-4665-a439-323264653939/spicy-klubok.webp',
    description:'–ù–µ—Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π –≤–∫—É—Å–Ω—ã–π —Å—ã—Ä, –Ω–µ —Å–∏–ª—å–Ω–æ —Å–æ–ª—ë–Ω—ã–π. –°—Ä–æ–∫ —Ö—Ä–∞–Ω–µ–Ω–∏—è: 7 —Å—É—Ç–æ–∫.' },

  /* ----------- –ú–Ø–ì–ö–ò–ï –°–´–†–´ (isCheese: true) ----------- */
  { id:'mozzarella', name:'–ú–æ—Ü–∞—Ä–µ–ª–ª–∞ (1 —à—Ç ~200 –≥)', group:'–ú—è–≥–∫–∏–µ —Å—ã—Ä—ã', cat:'–°—ã—Ä—ã', isCheese:true, pricePerKg:2000, img:'https://raw.githubusercontent.com/youmyloving/syr/main/mozzarella.webp',
    description:'–ù–µ–∂–Ω—ã–π —Å–≤–µ–∂–∏–π —Å—ã—Ä. –°—Ä–æ–∫ —Ö—Ä–∞–Ω–µ–Ω–∏—è: 3‚Äì5 —Å—É—Ç–æ–∫.' },
  { id:'buratta', name:'–ë—É—Ä—Ä–∞—Ç–∞ (1 —à—Ç ~250 –≥)', group:'–ú—è–≥–∫–∏–µ —Å—ã—Ä—ã', cat:'–°—ã—Ä—ã', isCheese:true, pricePerKg:2100, img:'https://raw.githubusercontent.com/youmyloving/syr/main/mozzarella-2.webp',
    description:'–ú–µ—à–æ—á–µ–∫ –∏–∑ –º–æ—Ü–∞—Ä–µ–ª–ª—ã —Å –Ω–∞—á–∏–Ω–∫–æ–π –∏–∑ —Å—Ç—Ä–∞—á–∞—Ç–µ–ª–ª—ã. –°—Ä–æ–∫ —Ö—Ä–∞–Ω–µ–Ω–∏—è: 3‚Äì5 —Å—É—Ç–æ–∫.' },
  { id:'stracciatella', name:'–°—Ç—Ä–∞—á–∞—Ç–µ–ª–ª–∞', group:'–ú—è–≥–∫–∏–µ —Å—ã—Ä—ã', cat:'–°—ã—Ä—ã', isCheese:true, pricePerKg:2150, img:'https://static.tildacdn.com/tild3832-6430-4462-b663-353438383930/stracciatella.webp',
    description:'–ù–∏—Ç–∏ –º–æ—Ü–∞—Ä–µ–ª–ª—ã –≤ —Å–ª–∏–≤–∫–∞—Ö. –°—Ä–æ–∫ —Ö—Ä–∞–Ω–µ–Ω–∏—è: 5‚Äì7 —Å—É—Ç–æ–∫.' },
  { id:'ricotta', name:'–¢–≤–æ—Ä–æ–∂–Ω—ã–π —Å—ã—Ä (—Ä–∏–∫–æ—Ç—Ç–∞)', group:'–ú—è–≥–∫–∏–µ —Å—ã—Ä—ã', cat:'–°—ã—Ä—ã', isCheese:true, pricePerKg:1400, img:'https://raw.githubusercontent.com/youmyloving/syr/main/panir-classic.webp',
    description:'–ù–µ–∂–Ω—ã–π —Å—ã—Ä, –ø–æ–¥—Ö–æ–¥–∏—Ç –∏ –∫ –±—É—Ç–µ—Ä–±—Ä–æ–¥–∞–º, –∏ –∫ –±–ª—é–¥–∞–º. –°—Ä–æ–∫ —Ö—Ä–∞–Ω–µ–Ω–∏—è: 7 —Å—É—Ç–æ–∫.' },
  { id:'ricotta-herbs', name:'–†–∏–∫–æ—Ç—Ç–∞ —Å —É–∫—Ä–æ–ø–æ–º –∏ –∑–µ–ª–µ–Ω—å—é', group:'–ú—è–≥–∫–∏–µ —Å—ã—Ä—ã', cat:'–°—ã—Ä—ã', isCheese:true, pricePerKg:1500, img:'https://raw.githubusercontent.com/youmyloving/syr/main/panir-herbs.webp',
    description:'–ù–µ–∂–Ω—ã–π, —Å–≤–µ–∂–∏–π, —É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–π. –°—Ä–æ–∫ —Ö—Ä–∞–Ω–µ–Ω–∏—è: 7 —Å—É—Ç–æ–∫.' },
  { id:'caciotta', name:'–ö–∞—á–æ—Ç—Ç–∞', group:'–ú—è–≥–∫–∏–µ —Å—ã—Ä—ã', cat:'–°—ã—Ä—ã', isCheese:true, pricePerKg:2200, img:'https://static.tildacdn.com/tild6165-3265-4834-a236-366661346562/caciotta.webp',
    description:'–ú—è–≥–∫–∏–π –∏—Ç–∞–ª—å—è–Ω—Å–∫–∏–π —Å—ã—Ä.' },
  { id:'caciotta-fenugreek', name:'–ö–∞—á–æ—Ç—Ç–∞ —Å –ø–∞–∂–∏—Ç–Ω–∏–∫–æ–º', group:'–ú—è–≥–∫–∏–µ —Å—ã—Ä—ã', cat:'–°—ã—Ä—ã', isCheese:true, pricePerKg:2250, img:'https://static.tildacdn.com/tild6165-3265-4834-a236-366661346562/caciotta.webp',
    description:'–° –æ—Ä–µ—Ö–æ–≤—ã–º –ø—Ä–∏–≤–∫—É—Å–æ–º –ø–∞–∂–∏—Ç–Ω–∏–∫–∞.' },

  { id:'panir-classic', name:'–ê–¥—ã–≥–µ–π—Å–∫–∏–π (–ø–∞–Ω–∏—Ä) –∫–ª–∞—Å—Å–∏—á–µ—Å–∫–∏–π', group:'–ú—è–≥–∫–∏–µ —Å—ã—Ä—ã', cat:'–°—ã—Ä—ã', isCheese:true, pricePerKg:1450, img:'https://raw.githubusercontent.com/youmyloving/syr/main/panir-classic.webp',
    description:'–û—á–µ–Ω—å –Ω–µ–∂–Ω—ã–π, –º—è–≥–∫–∏–π, –º–æ–ª–æ—á–Ω—ã–π –≤–∫—É—Å. –°—Ä–æ–∫ —Ö—Ä–∞–Ω–µ–Ω–∏—è: 7 —Å—É—Ç–æ–∫.' },
  { id:'panir-herbs', name:'–ê–¥—ã–≥–µ–π—Å–∫–∏–π (–ø–∞–Ω–∏—Ä) —Å –∑–µ–ª–µ–Ω—å—é', group:'–ú—è–≥–∫–∏–µ —Å—ã—Ä—ã', cat:'–°—ã—Ä—ã', isCheese:true, pricePerKg:1600, img:'https://raw.githubusercontent.com/youmyloving/syr/main/panir-herbs.webp',
    description:'–õ—ë–≥–∫–∏–π, —Å–≤–µ–∂–∏–π ‚Äî –±—É–¥—Ç–æ –≥–ª–æ—Ç–æ–∫ –ø—Ä–æ—Ö–ª–∞–¥–Ω–æ–π –≤–æ–¥—ã. –°—Ä–æ–∫ —Ö—Ä–∞–Ω–µ–Ω–∏—è: 7 —Å—É—Ç–æ–∫.' },
  { id:'panir-spicy', name:'–ê–¥—ã–≥–µ–π—Å–∫–∏–π (–ø–∞–Ω–∏—Ä) —Å –ø—Ä—è–Ω–æ—Å—Ç—è–º–∏', group:'–ú—è–≥–∫–∏–µ —Å—ã—Ä—ã', cat:'–°—ã—Ä—ã', isCheese:true, pricePerKg:1650, img:'https://raw.githubusercontent.com/youmyloving/syr/main/panir-spicy.webp',
    description:'–ù–µ –æ—Å—Ç—Ä—ã–π, –æ—á–µ–Ω—å –∞—Ä–æ–º–∞—Ç–Ω—ã–π. –°—Ä–æ–∫ —Ö—Ä–∞–Ω–µ–Ω–∏—è: 7 —Å—É—Ç–æ–∫.' },
  { id:'panir-smoked', name:'–ê–¥—ã–≥–µ–π—Å–∫–∏–π (–ø–∞–Ω–∏—Ä) –∫–æ–ø—á—ë–Ω—ã–π', group:'–ú—è–≥–∫–∏–µ —Å—ã—Ä—ã', cat:'–°—ã—Ä—ã', isCheese:true, pricePerKg:1700, img:'https://raw.githubusercontent.com/youmyloving/syr/main/panir-smoked.webp',
    description:'–ü—Ä–∏—è—Ç–Ω—ã–π –∞—Ä–æ–º–∞—Ç –∫–æ–ø—á—ë–Ω–æ—Å—Ç–∏, –≥–∞—Ä–º–æ–Ω–∏—á–Ω—ã–π –≤–∫—É—Å. –°—Ä–æ–∫ —Ö—Ä–∞–Ω–µ–Ω–∏—è: 30 —Å—É—Ç–æ–∫.' },

  /* ----------- –¢–í–Å–†–î–´–ï –°–´–†–´ (isCheese: true) ----------- */
  { id:'hard-village', name:'–¢–≤—ë—Ä–¥—ã–π –ø–æ-–¥–µ—Ä–µ–≤–µ–Ω—Å–∫–∏', group:'–¢–≤—ë—Ä–¥—ã–µ —Å—ã—Ä—ã', cat:'–°—ã—Ä—ã', isCheese:true, pricePerKg:1600, img:'https://raw.githubusercontent.com/youmyloving/syr/main/hard-village.webp',
    description:'–ì–æ—Ç–æ–≤–∏—Ç—Å—è –∏–∑ —Ç–≤–æ—Ä–æ–≥–∞ —Å –ø—Ä–∏–ø—Ä–∞–≤–∞–º–∏, –æ–±–∂–∞—Ä–∏–≤–∞–µ—Ç—Å—è. –°—Ä–æ–∫ —Ö—Ä–∞–Ω–µ–Ω–∏—è: 7 —Å—É—Ç–æ–∫.' },
  { id:'hard-smoked', name:'–¢–≤—ë—Ä–¥—ã–π –∫–æ–ø—á—ë–Ω—ã–π', group:'–¢–≤—ë—Ä–¥—ã–µ —Å—ã—Ä—ã', cat:'–°—ã—Ä—ã', isCheese:true, pricePerKg:1800, img:'https://static.tildacdn.com/tild6662-3930-4663-b132-316135626136/hard-smoked.webp',
    description:'–û–±–∂–∞—Ä–µ–Ω–Ω—ã–π, –∑–∞—Ç–µ–º –∫–æ–ø—á—ë–Ω–Ω—ã–π ‚Äî –Ω–µ–∂–Ω—ã–π –∫–æ–ø—á—ë–Ω—ã–π –≤–∫—É—Å. –°—Ä–æ–∫ —Ö—Ä–∞–Ω–µ–Ω–∏—è: –¥–æ 30 —Å—É—Ç–æ–∫.' },

  /* ----------- –°–´–†–ù–´–ï –†–£–õ–ï–¢–´ (isCheese: true) ----------- */
  { id:'rolls-olives-walnut', name:'–°—ã—Ä–Ω—ã–π —Ä—É–ª–µ—Ç (–º–∞—Å–ª–∏–Ω—ã, –≥—Ä–µ—Ü–∫–∏–π –æ—Ä–µ—Ö, –∑–µ–ª–µ–Ω—å)', group:'–°—ã—Ä–Ω—ã–µ —Ä—É–ª–µ—Ç—ã', cat:'–°—ã—Ä—ã', isCheese:true, pricePerKg:1700, img:'https://raw.githubusercontent.com/youmyloving/syr/main/rolls-olives-walnut.webp',
    description:'–ó–∞–∫—É—Å–∫–∞ –∫ –ª—é–±–æ–º—É —Å—Ç–æ–ª—É. –°—Ä–æ–∫ —Ö—Ä–∞–Ω–µ–Ω–∏—è: 7 —Å—É—Ç–æ–∫.' },
  { id:'rolls-apricot-cedar', name:'–°—ã—Ä–Ω—ã–π —Ä—É–ª–µ—Ç (–∫—É—Ä–∞–≥–∞, –∫–µ–¥—Ä–æ–≤—ã–µ –æ—Ä–µ—à–∫–∏)', group:'–°—ã—Ä–Ω—ã–µ —Ä—É–ª–µ—Ç—ã', cat:'–°—ã—Ä—ã', isCheese:true, pricePerKg:1700, img:'https://raw.githubusercontent.com/youmyloving/syr/main/rolls-apricot-cedar.webp',
    description:'–°–ª–µ–≥–∫–∞ —Å–ª–∞–¥–∫–æ–≤–∞—Ç—ã–π –≤–∞—Ä–∏–∞–Ω—Ç —Å –∫—É—Ä–∞–≥–æ–π. –°—Ä–æ–∫ —Ö—Ä–∞–Ω–µ–Ω–∏—è: 7 —Å—É—Ç–æ–∫.' },

  /* ----------- –ú–û–õ–û–ß–ù–ê–Ø –ü–†–û–î–£–ö–¶–ò–Ø ----------- */
  { id:'milk', name:'–ú–æ–ª–æ–∫–æ', group:'–ú–æ–ª–æ—á–Ω–∞—è –ø—Ä–æ–¥—É–∫—Ü–∏—è', cat:'–ú–æ–ª–æ—á–Ω–∞—è –ø—Ä–æ–¥—É–∫—Ü–∏—è', pricePerL:150, img:'https://static.tildacdn.com/tild3136-3730-4134-b466-613138343764/tvorog.webp',
    description:'–ú–æ–ª–æ–∫–æ –æ—Ç–±–æ—Ä–Ω–æ–µ —Ü–µ–ª—å–Ω–æ–µ, –æ—Ö–ª–∞–∂–¥—ë–Ω–Ω–æ–µ. –ö–∞–∫ –∏–∑ –¥–µ—Ç—Å—Ç–≤–∞! –°—Ä–æ–∫ —Ö—Ä–∞–Ω–µ–Ω–∏—è: 3‚Äì5 —Å—É—Ç–æ–∫ –≤ —Ö–æ–ª–æ–¥–∏–ª—å–Ω–∏–∫–µ.' },
  { id:'milk-topped', name:'–ú–æ–ª–æ–∫–æ —Ç–æ–ø–ª—ë–Ω–æ–µ', group:'–ú–æ–ª–æ—á–Ω–∞—è –ø—Ä–æ–¥—É–∫—Ü–∏—è', cat:'–ú–æ–ª–æ—á–Ω–∞—è –ø—Ä–æ–¥—É–∫—Ü–∏—è', pricePerL:250, img:'https://static.tildacdn.com/tild3839-3163-4066-a633-306366346631/milk-topped.webp',
    description:'–ù–∞—Å—Ç–æ—è—â–µ–µ —Ü–µ–ª—å–Ω–æ–µ —Ç–æ–ø–ª—ë–Ω–æ–µ –º–æ–ª–æ–∫–æ. –ì—É—Å—Ç–æ–≤–∞—Ç–∞—è –∫–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ü–∏—è. –°—Ä–æ–∫ —Ö—Ä–∞–Ω–µ–Ω–∏—è: 5‚Äì7 —Å—É—Ç–æ–∫.' },
  { id:'yogurt', name:'–ô–æ–≥—É—Ä—Ç –∫–ª–∞—Å—Å–∏—á–µ—Å–∫–∏–π', group:'–ú–æ–ª–æ—á–Ω–∞—è –ø—Ä–æ–¥—É–∫—Ü–∏—è', cat:'–ú–æ–ª–æ—á–Ω–∞—è –ø—Ä–æ–¥—É–∫—Ü–∏—è', pricePerL:260, img:'https://static.tildacdn.com/tild3163-3665-4636-a537-303830323163/cream.webp',
    description:'–ù–∞—Ç—É—Ä–∞–ª—å–Ω—ã–π –π–æ–≥—É—Ä—Ç. –°—Ä–æ–∫ —Ö—Ä–∞–Ω–µ–Ω–∏—è: 5 —Å—É—Ç–æ–∫.' },
  { id:'ryazhenka', name:'–†—è–∂–µ–Ω–∫–∞', group:'–ú–æ–ª–æ—á–Ω–∞—è –ø—Ä–æ–¥—É–∫—Ü–∏—è', cat:'–ú–æ–ª–æ—á–Ω–∞—è –ø—Ä–æ–¥—É–∫—Ü–∏—è', pricePerL:280, img:'https://static.tildacdn.com/tild3163-3665-4636-a537-303830323163/cream.webp',
    description:'–ù–∞—Ç—É—Ä–∞–ª—å–Ω–∞—è —Ä—è–∂–µ–Ω–∫–∞. –õ—é–±–∏–º–µ–π—à–∏–π –Ω–∞–ø–∏—Ç–æ–∫ –¥–µ—Ç–µ–π! –°—Ä–æ–∫ —Ö—Ä–∞–Ω–µ–Ω–∏—è: –¥–æ 5 —Å—É—Ç–æ–∫.' },
  { id:'misthi-dahi', name:'–ú–∏—Å—Ç—Ö–∏-–î–∞—Ö–∏', group:'–ú–æ–ª–æ—á–Ω–∞—è –ø—Ä–æ–¥—É–∫—Ü–∏—è', cat:'–ú–æ–ª–æ—á–Ω–∞—è –ø—Ä–æ–¥—É–∫—Ü–∏—è', pricePerL:300, img:'https://static.tildacdn.com/tild3163-3665-4636-a537-303830323163/cream.webp',
    description:'–¢—Ä–∞–¥–∏—Ü–∏–æ–Ω–Ω—ã–π –∫–∏—Å–ª–æ–º–æ–ª–æ—á–Ω—ã–π –Ω–∞–ø–∏—Ç–æ–∫. 300 ‚ÇΩ/–ª, 150 ‚ÇΩ/0.5 –ª.' },
  { id:'whey', name:'–°—ã–≤–æ—Ä–æ—Ç–∫–∞', group:'–ú–æ–ª–æ—á–Ω–∞—è –ø—Ä–æ–¥—É–∫—Ü–∏—è', cat:'–ú–æ–ª–æ—á–Ω–∞—è –ø—Ä–æ–¥—É–∫—Ü–∏—è', pricePerL:60, img:'https://static.tildacdn.com/tild3163-3665-4636-a537-303830323163/cream.webp',
    description:'–ù–∏–∑–∫–æ–∫–∞–ª–æ—Ä–∏–π–Ω—ã–π –ø—Ä–æ–¥—É–∫—Ç, –ø–æ–±–æ—á–Ω—ã–π –ø—Ä–∏ –∏–∑–≥–æ—Ç–æ–≤–ª–µ–Ω–∏–∏ —Å—ã—Ä–∞. –°—Ä–æ–∫ —Ö—Ä–∞–Ω–µ–Ω–∏—è: 3 —Å—É—Ç–æ–∫.' },
  { id:'cream', name:'–°–ª–∏–≤–∫–∏ (33‚Äì36%)', group:'–ú–æ–ª–æ—á–Ω–∞—è –ø—Ä–æ–¥—É–∫—Ü–∏—è', cat:'–ú–æ–ª–æ—á–Ω–∞—è –ø—Ä–æ–¥—É–∫—Ü–∏—è', pricePerL:1450, img:'https://static.tildacdn.com/tild3163-3665-4636-a537-303830323163/cream.webp',
    description:'–ù–∞—Ç—É—Ä–∞–ª—å–Ω—ã–µ —Å–≤–µ–∂–∏–µ —Å–ª–∏–≤–∫–∏. –°—Ä–æ–∫ —Ö—Ä–∞–Ω–µ–Ω–∏—è: 5 —Å—É—Ç–æ–∫ (–Ω–∞ 3‚Äì4 —Å—É—Ç–∫–∏ –º–æ–≥—É—Ç —Å—Ç–∞—Ç—å —Å–º–µ—Ç–∞–Ω–æ–π).' },
  { id:'tvorog', name:'–¢–≤–æ—Ä–æ–≥', group:'–ú–æ–ª–æ—á–Ω–∞—è –ø—Ä–æ–¥—É–∫—Ü–∏—è', cat:'–ú–æ–ª–æ—á–Ω–∞—è –ø—Ä–æ–¥—É–∫—Ü–∏—è', pricePerKg:700, img:'https://static.tildacdn.com/tild3136-3730-4134-b466-613138343764/tvorog.webp',
    description:'–ù–µ–∂–Ω—ã–π –≤–∫—É—Å, –ø—Ä–∞–≤–∏–ª—å–Ω–∞—è –∑–µ—Ä–Ω–∏—Å—Ç–æ—Å—Ç—å. –•–æ—Ä–æ—à–æ –ø–µ—Ä–µ–Ω–æ—Å–∏—Ç –∑–∞–º–æ—Ä–æ–∑–∫—É. –°—Ä–æ–∫: 3‚Äì5 —Å—É—Ç–æ–∫.' },
  { id:'butter', name:'–ú–∞—Å–ª–æ —Å–ª–∏–≤–æ—á–Ω–æ–µ (1 —à—Ç ~200 –≥)', group:'–ú–æ–ª–æ—á–Ω–∞—è –ø—Ä–æ–¥—É–∫—Ü–∏—è', cat:'–ú–æ–ª–æ—á–Ω–∞—è –ø—Ä–æ–¥—É–∫—Ü–∏—è', pricePerKg:2100, pricePerUnit:360, img:'https://raw.githubusercontent.com/youmyloving/syr/main/butter.webp',
    description:'–ö–∞–∫ —É –±–∞–±—É—à–∫–∏: –∏–∑ –æ—Ç–±–æ—Ä–Ω—ã—Ö —Å–ª–∏–≤–æ–∫, –≤—Ä—É—á–Ω—É—é. –°—Ä–æ–∫ —Ö—Ä–∞–Ω–µ–Ω–∏—è: –¥–æ 180 —Å—É—Ç–æ–∫ –ø—Ä–∏ t¬∞ –¥–æ +15¬∞C.' },
  { id:'ghee', name:'–¢–æ–ø–ª—ë–Ω–æ–µ –º–∞—Å–ª–æ (–ì–•–ò)', group:'–ú–æ–ª–æ—á–Ω–∞—è –ø—Ä–æ–¥—É–∫—Ü–∏—è', cat:'–ú–æ–ª–æ—á–Ω–∞—è –ø—Ä–æ–¥—É–∫—Ü–∏—è', pricePerKg:2900, img:'https://static.tildacdn.com/tild3163-3665-4636-a537-303830323163/cream.webp',
    description:'–ß–∏—Å—Ç—ã–π –º–æ–ª–æ—á–Ω—ã–π –∂–∏—Ä ~99%. –ò–¥–µ–∞–ª—å–Ω–æ –¥–ª—è –∂–∞—Ä–∫–∏. –°—Ä–æ–∫ —Ö—Ä–∞–Ω–µ–Ω–∏—è: –ª–µ—Ç 10+.' },
  { id:'condensed-milk', name:'–í–∞—Ä—ë–Ω–∞—è —Å–≥—É—â—ë–Ω–∫–∞', group:'–ú–æ–ª–æ—á–Ω–∞—è –ø—Ä–æ–¥—É–∫—Ü–∏—è', cat:'–ú–æ–ª–æ—á–Ω–∞—è –ø—Ä–æ–¥—É–∫—Ü–∏—è', pricePerKg:1000, img:'https://static.tildacdn.com/tild3163-3665-4636-a537-303830323163/cream.webp',
    description:'–°–æ—Å—Ç–∞–≤: —Ü–µ–ª—å–Ω–æ–µ –º–æ–ª–æ–∫–æ, —Ç—Ä–æ—Å—Ç–Ω–∏–∫–æ–≤—ã–π —Å–∞—Ö–∞—Ä. –ì—É—Å—Ç–∞—è –∏ –∫–∞—Ä–∞–º–µ–ª—å–Ω–∞—è. –°—Ä–æ–∫: 7 —Å—É—Ç–æ–∫.' },
  { id:'tvorozhnaya-massa-raisin', name:'–¢–≤–æ—Ä–æ–∂–Ω–∞—è –º–∞—Å—Å–∞ (–∏–∑—é–º)', group:'–ú–æ–ª–æ—á–Ω–∞—è –ø—Ä–æ–¥—É–∫—Ü–∏—è', cat:'–ú–æ–ª–æ—á–Ω–∞—è –ø—Ä–æ–¥—É–∫—Ü–∏—è', pricePerKg:850, img:'https://static.tildacdn.com/tild6630-3237-4430-b461-313634376333/tvorozhnaya-massa_.webp',
    description:'–¢–≤–æ—Ä–æ–≥, —Å–ª–∏–≤–∫–∏, —Ç—Ä–æ—Å—Ç–Ω–∏–∫–æ–≤—ã–π —Å–∞—Ö–∞—Ä –∏ –∏–∑—é–º. –°—Ä–æ–∫: 5 —Å—É—Ç–æ–∫.' },
  { id:'tvorozhnaya-massa-date', name:'–¢–≤–æ—Ä–æ–∂–Ω–∞—è –º–∞—Å—Å–∞ (—Ñ–∏–Ω–∏–∫–∏)', group:'–ú–æ–ª–æ—á–Ω–∞—è –ø—Ä–æ–¥—É–∫—Ü–∏—è', cat:'–ú–æ–ª–æ—á–Ω–∞—è –ø—Ä–æ–¥—É–∫—Ü–∏—è', pricePerKg:850, img:'https://static.tildacdn.com/tild6334-3636-4432-a132-306531366333/tvorozhnaya-massa_.webp',
    description:'–¢–≤–æ—Ä–æ–≥, —Å–ª–∏–≤–∫–∏, —Ç—Ä–æ—Å—Ç–Ω–∏–∫–æ–≤—ã–π —Å–∞—Ö–∞—Ä –∏ —Ñ–∏–Ω–∏–∫–∏. –°—Ä–æ–∫: 5 —Å—É—Ç–æ–∫.' },
  { id:'tvorozhnaya-massa-prune', name:'–¢–≤–æ—Ä–æ–∂–Ω–∞—è –º–∞—Å—Å–∞ (—á–µ—Ä–Ω–æ—Å–ª–∏–≤)', group:'–ú–æ–ª–æ—á–Ω–∞—è –ø—Ä–æ–¥—É–∫—Ü–∏—è', cat:'–ú–æ–ª–æ—á–Ω–∞—è –ø—Ä–æ–¥—É–∫—Ü–∏—è', pricePerKg:850, img:'https://static.tildacdn.com/tild3333-3365-4063-a162-306230313233/tvorozhnaya-massa_.webp',
    description:'–¢–≤–æ—Ä–æ–≥, —Å–ª–∏–≤–∫–∏, —Ç—Ä–æ—Å—Ç–Ω–∏–∫–æ–≤—ã–π —Å–∞—Ö–∞—Ä –∏ —á–µ—Ä–Ω–æ—Å–ª–∏–≤. –°—Ä–æ–∫: 5 —Å—É—Ç–æ–∫.' },

  /* ----------- –°–õ–ê–î–û–°–¢–ò ----------- */
  { id:'sandesh-orange', name:'–°–∞–Ω–¥–µ—à (–∞–ø–µ–ª—å—Å–∏–Ω) ‚Äî 5 —à—Ç', group:'–°–ª–∞–¥–æ—Å—Ç–∏', cat:'–°–ª–∞–¥–æ—Å—Ç–∏', pricePerUnit:300, img:'https://raw.githubusercontent.com/youmyloving/syr/main/sandesh-orange.webp',
    description:'–ú–æ–ª–æ–∫–æ, —Ç—Ä–æ—Å—Ç–Ω–∏–∫–æ–≤—ã–π —Å–∞—Ö–∞—Ä, —Ü–µ–¥—Ä–∞ –∞–ø–µ–ª—å—Å–∏–Ω–∞. –°—Ä–æ–∫: 5 —Å—É—Ç–æ–∫.' },
  { id:'sandesh-walnut', name:'–°–∞–Ω–¥–µ—à (–≥—Ä–µ—Ü–∫–∏–π –æ—Ä–µ—Ö) ‚Äî 5 —à—Ç', group:'–°–ª–∞–¥–æ—Å—Ç–∏', cat:'–°–ª–∞–¥–æ—Å—Ç–∏', pricePerUnit:300, img:'https://raw.githubusercontent.com/youmyloving/syr/main/sandesh-walnut.webp',
    description:'–ú–æ–ª–æ–∫–æ, —Ç—Ä–æ—Å—Ç–Ω–∏–∫–æ–≤—ã–π —Å–∞—Ö–∞—Ä, –≥—Ä–µ—Ü–∫–∏–π –æ—Ä–µ—Ö. –°—Ä–æ–∫: 5 —Å—É—Ç–æ–∫.' },
  { id:'sandesh-carob', name:'–°–∞–Ω–¥–µ—à (–∫—ç—Ä–æ–±) ‚Äî 5 —à—Ç', group:'–°–ª–∞–¥–æ—Å—Ç–∏', cat:'–°–ª–∞–¥–æ—Å—Ç–∏', pricePerUnit:300, img:'https://raw.githubusercontent.com/youmyloving/syr/main/sandesh-orange.webp',
    description:'–®–æ–∫–æ–ª–∞–¥–Ω—ã–π –≤–∫—É—Å –±–ª–∞–≥–æ–¥–∞—Ä—è –∫—ç—Ä–æ–±—É –∏ –∫–æ–∫–æ—Å—É. –°—Ä–æ–∫: 5 —Å—É—Ç–æ–∫.' },
  { id:'barfi-classic', name:'–ë—É—Ä—Ñ–∏ –∫–ª–∞—Å—Å–∏—á–µ—Å–∫–∏–π ‚Äî 5 —à—Ç', group:'–°–ª–∞–¥–æ—Å—Ç–∏', cat:'–°–ª–∞–¥–æ—Å—Ç–∏', pricePerUnit:350, img:'https://static.tildacdn.com/tild3430-3231-4562-b164-366638313434/barfi-classic.webp',
    description:'–ù–µ–∂–Ω–∞—è –∏–Ω–¥–∏–π—Å–∫–∞—è —Å–ª–∞–¥–æ—Å—Ç—å.' },
  { id:'barfi-hazelnut', name:'–ë—É—Ä—Ñ–∏ —Ñ—É–Ω–¥—É–∫ ‚Äî 5 —à—Ç', group:'–°–ª–∞–¥–æ—Å—Ç–∏', cat:'–°–ª–∞–¥–æ—Å—Ç–∏', pricePerUnit:350, img:'https://static.tildacdn.com/tild3065-3332-4466-a536-353130343264/barfi-hazelnut.webp',
    description:'–° –æ—Ä–µ—Ö–æ–≤–æ–π –Ω–æ—Ç–∫–æ–π —Ñ—É–Ω–¥—É–∫–∞.' },
  { id:'barfi-sesame', name:'–ë—É—Ä—Ñ–∏ –∫—É–Ω–∂—É—Ç–Ω—ã–π ‚Äî 7 —à—Ç', group:'–°–ª–∞–¥–æ—Å—Ç–∏', cat:'–°–ª–∞–¥–æ—Å—Ç–∏', pricePerUnit:490, img:'https://raw.githubusercontent.com/youmyloving/syr/main/rolls-olives-walnut.webp',
    description:'–° –∫—É–Ω–∂—É—Ç–æ–º.' },
  { id:'halva', name:'–•–∞–ª–≤–∞ ‚Äî 0.2 –∫–≥', group:'–°–ª–∞–¥–æ—Å—Ç–∏', cat:'–°–ª–∞–¥–æ—Å—Ç–∏', pricePerUnit:200, img:'https://raw.githubusercontent.com/youmyloving/syr/main/rolls-olives-walnut.webp',
    description:'–°–æ—Å—Ç–∞–≤: —Ç—Ä–æ—Å—Ç–Ω–∏–∫–æ–≤—ã–π —Å–∞—Ö–∞—Ä, –≤–æ–¥–∞, —Å–µ–º–µ–Ω–∞ –ø–æ–¥—Å–æ–ª–Ω–µ—á–Ω–∏–∫–∞, —Å–ª–∏–≤–æ—á–Ω–æ–µ –º–∞—Å–ª–æ. –°—Ä–æ–∫: 14 –¥–Ω–µ–π.' },
  { id:'potato-cake-5', name:'–ü–∏—Ä–æ–∂–Ω–æ–µ ¬´–ö–∞—Ä—Ç–æ—à–∫–∞¬ª ‚Äî 5 —à—Ç', group:'–°–ª–∞–¥–æ—Å—Ç–∏', cat:'–°–ª–∞–¥–æ—Å—Ç–∏', pricePerUnit:400, img:'https://static.tildacdn.com/tild3961-6133-4632-b162-396333663962/potato-cake-2.webp',
    description:'–ò–∑ —Ü–µ–ª—å–Ω–æ–∑–µ—Ä–Ω. –º—É–∫–∏, —Å –¥–æ–º–∞—à–Ω–µ–π —Å–≥—É—â—ë–Ω–∫–æ–π.' },
  { id:'potato-cake-2', name:'–ü–∏—Ä–æ–∂–Ω–æ–µ ¬´–ö–∞—Ä—Ç–æ—à–∫–∞¬ª ‚Äî 2 —à—Ç', group:'–°–ª–∞–¥–æ—Å—Ç–∏', cat:'–°–ª–∞–¥–æ—Å—Ç–∏', pricePerUnit:190, img:'https://static.tildacdn.com/tild3961-6133-4632-b162-396333663962/potato-cake-2.webp',
    description:'–ò–∑ —Ü–µ–ª—å–Ω–æ–∑–µ—Ä–Ω. –º—É–∫–∏, —Å –¥–æ–º–∞—à–Ω–µ–π —Å–≥—É—â—ë–Ω–∫–æ–π.' },

  /* ----------- –í–´–ü–ï–ß–ö–ê ----------- */
  { id:'cookies-nut', name:'–û—Ä–µ—Ö–æ–≤—ã–µ –ø–∞–ª—å—á–∏–∫–∏ (–ø–µ—á–µ–Ω—å–µ)', group:'–í—ã–ø–µ—á–∫–∞', cat:'–°–ª–∞–¥–æ—Å—Ç–∏ –∏ –≤—ã–ø–µ—á–∫–∞', pricePerKg:700, img:'https://static.tildacdn.com/tild3035-6230-4434-b363-303434366630/cookies-nut.webp',
    description:'–° —Ö—Ä—É—Å—Ç—è—â–∏–º–∏ –æ—Ä–µ—Ö–∞–º–∏.' },
  { id:'muffin-raisin', name:'–ö–µ–∫—Å—ã –∏–∑—é–º', group:'–í—ã–ø–µ—á–∫–∞', cat:'–°–ª–∞–¥–æ—Å—Ç–∏ –∏ –≤—ã–ø–µ—á–∫–∞', pricePerKg:550, img:'https://static.tildacdn.com/tild3465-3162-4436-a235-363763383339/muffin-raisin.webp',
    description:'–ù–µ–∂–Ω—ã–µ –∫–µ–∫—Å—ã —Å –∏–∑—é–º–æ–º.' },
  { id:'apple-pie', name:'–Ø–±–ª–æ—á–Ω—ã–π –ø–∏—Ä–æ–≥ (900 –≥)', group:'–í—ã–ø–µ—á–∫–∞', cat:'–°–ª–∞–¥–æ—Å—Ç–∏ –∏ –≤—ã–ø–µ—á–∫–∞', pricePerUnit:560, img:'https://raw.githubusercontent.com/youmyloving/syr/main/rolls-olives-walnut.webp',
    description:'–î–æ–º–∞—à–Ω–∏–π –ø–∏—Ä–æ–≥.' },
  { id:'chapati-10', name:'–ß–∞–ø–∞—Ç–∏ ‚Äî 10 —à—Ç', group:'–í—ã–ø–µ—á–∫–∞', cat:'–°–ª–∞–¥–æ—Å—Ç–∏ –∏ –≤—ã–ø–µ—á–∫–∞', pricePerUnit:270, img:'https://static.tildacdn.com/tild6332-6239-4538-b839-356132356236/chapati-10.webp',
    description:'–ü—à–µ–Ω–∏—Ü–∞/—Ä–æ–∂—å, –≤–æ–¥–∞, —Å–æ–ª—å, —Å–ª–∏–≤–æ—á–Ω–æ–µ –º–∞—Å–ª–æ. –°—Ä–æ–∫: 2 —Å—É—Ç–æ–∫.' },
  { id:'chapati-wholewheat-10', name:'–ß–∞–ø–∞—Ç–∏ (—Ü/–∑) ‚Äî 10 —à—Ç', group:'–í—ã–ø–µ—á–∫–∞', cat:'–°–ª–∞–¥–æ—Å—Ç–∏ –∏ –≤—ã–ø–µ—á–∫–∞', pricePerUnit:320, img:'https://static.tildacdn.com/tild6332-6239-4538-b839-356132356236/chapati-10.webp',
    description:'–ò–∑ —Ü–µ–ª—å–Ω–æ–∑–µ—Ä–Ω–æ–≤–æ–π –º—É–∫–∏.' }
];

/* –í–∞—Ä–∏–∞–Ω—Ç—ã (–≤–∫–ª—é—á–∞—è —Ä—É—á–Ω–æ–π –≤–µ—Å) */
const VARIANT_RULES = {
  // –†–∞—Å—Å–æ–ª—å–Ω—ã–µ ‚Äî –∑–∞–¥–∞–¥–∏–º –≥–¥–µ –≤–µ—Å –∏–ª–∏ ¬´—à—Ç (–≥)¬ª
  'suluguni': w(100,1000,100),
  'suluguni-smoked': w(100,1000,100),
  'imeretian': w(100,1000,100),
  'imeretian-dill-garlic': w(100,1000,100),
  'halloumi': f(['1 —à—Ç (200 –≥)','1 —à—Ç (250 –≥)']),
  'halloumi-paprika-oregano': f(['1 —à—Ç (200 –≥)','1 —à—Ç (250 –≥)']),
  'halloumi-tomato-basil-garlic': f(['1 —à—Ç (200 –≥)','1 —à—Ç (250 –≥)']),
  'halloumi-tomato-paprika': f(['1 —à—Ç (200 –≥)','1 —à—Ç (250 –≥)']),
  'kosichka': f(['1 —à—Ç (200 –≥)']),
  'kosichka-smoked': f(['1 —à—Ç (200 –≥)']),
  'spicy-klubok': f(['1 —à—Ç (150 –≥)']),

  // –ú—è–≥–∫–∏–µ
  'mozzarella': f(['1 —à—Ç (200 –≥)']),
  'buratta': f(['1 —à—Ç (250 –≥)']),
  'stracciatella': f(['200 –≥','250 –≥','300 –≥','500 –≥']),
  'ricotta': f(['200 –≥','250 –≥','300 –≥','450 –≥']),
  'ricotta-herbs': f(['200 –≥','250 –≥','300 –≥','450 –≥']),
  'caciotta': w(200,1000,100),
  'caciotta-fenugreek': w(200,1000,100),
  'panir-classic': f(['200 –≥','300 –≥','400 –≥','500 –≥','1000 –≥']),
  'panir-herbs': f(['200 –≥','300 –≥','400 –≥','500 –≥','1000 –≥']),
  'panir-spicy': f(['200 –≥','300 –≥','400 –≥','500 –≥','1000 –≥']),
  'panir-smoked': f(['200 –≥','300 –≥','400 –≥','500 –≥','1000 –≥']),

  // –¢–≤—ë—Ä–¥—ã–µ
  'hard-village': f(['200 –≥','300 –≥','400 –≥','500 –≥','1000 –≥']),
  'hard-smoked': f(['200 –≥','300 –≥','400 –≥','500 –≥','1000 –≥']),

  // –†—É–ª–µ—Ç—ã
  'rolls-olives-walnut': w(100,1000,50),
  'rolls-apricot-cedar': w(100,1000,50),

  // –ú–æ–ª–æ—á–Ω–∞—è
  'milk': f(['0.5 –ª','1 –ª']),
  'milk-topped': f(['0.5 –ª','1 –ª']),
  'yogurt': f(['0.5 –ª','1 –ª']),
  'ryazhenka': f(['0.5 –ª','1 –ª']),
  'misthi-dahi': f(['0.5 –ª','1 –ª']),
  'whey': f(['1 –ª']),
  'cream': f(['0.2 –ª','0.5 –ª','1 –ª']),
  'tvorog': w(500,2000,500),
  'butter': f(['1 —à—Ç (200 –≥)']),
  'ghee': f(['200 –≥','500 –≥','1000 –≥']),
  'condensed-milk': w(200,1000,100),
  'tvorozhnaya-massa-raisin': w(200,1000,100),
  'tvorozhnaya-massa-date': w(200,1000,100),
  'tvorozhnaya-massa-prune': w(200,1000,100),

  // –°–ª–∞–¥–æ—Å—Ç–∏
  'sandesh-orange': f(['5 —à—Ç']),
  'sandesh-walnut': f(['5 —à—Ç']),
  'sandesh-carob': f(['5 —à—Ç']),
  'barfi-classic': f(['5 —à—Ç']),
  'barfi-hazelnut': f(['5 —à—Ç']),
  'barfi-sesame': f(['7 —à—Ç']),
  'halva': f(['0.2 –∫–≥']),
  'potato-cake-5': f(['5 —à—Ç']),
  'potato-cake-2': f(['2 —à—Ç']),

  // –í—ã–ø–µ—á–∫–∞
  'cookies-nut': w(250,2000,250),
  'muffin-raisin': w(250,2000,250),
  'apple-pie': f(['900 –≥']),
  'chapati-10': f(['10 —à—Ç']),
  'chapati-wholewheat-10': f(['10 —à—Ç'])
};
function f(options){return {type:'fixed', options}}
function w(min,max,step){return {type:'weight', unit:'–≥', min, max, step, allowCustom:true}}

/* ===================== STATE ===================== */
let cart = [];
let favorites = new Set();
let currentProduct = null;
let filteredGroups = []; // [{groupTitle, products:[...] }]
let checkoutState = { phone:'', address:'', comment:'', promo:'' };

/* ===================== INIT ===================== */
document.addEventListener('DOMContentLoaded', init);
function init(){
  loadState();
  setupTelegramWebApp();
  renderUserProfile();
  setupEventListeners();
  applyTheme();
  filterAndRender();
  updateCartUI();
  renderFavoritesRail();
}

/* ===================== TELEGRAM ===================== */
function setupTelegramWebApp(){
  try{
    if(window.Telegram && window.Telegram.WebApp){
      const webApp = window.Telegram.WebApp;
      webApp.ready(); webApp.expand();
      webApp.MainButton.setText('–û—Ñ–æ—Ä–º–∏—Ç—å –∑–∞–∫–∞–∑').onClick(openCartModal).hide();
      webApp.BackButton.onClick(()=>{
        const pm=document.getElementById('product-modal'), cm=document.getElementById('cart-modal');
        if(cm.open) closeCartModal(); else if(pm.open) closeProductModal();
      });
    }
  }catch(_){}
}
function applyTheme(){
  const root=document.documentElement;
  root.style.setProperty('--bg-color','#F8EFDA');
}

/* ===================== STORAGE ===================== */
function loadState(){
  try{
    const savedCart = localStorage.getItem(STORAGE_CART_KEY);
    if(savedCart) cart = JSON.parse(savedCart);
  }catch{ cart = []; }
  try{
    const savedCheckout = localStorage.getItem(STORAGE_CHECKOUT_KEY);
    if(savedCheckout) checkoutState = JSON.parse(savedCheckout);
  }catch{}
  try{
    const fav = localStorage.getItem(STORAGE_FAV_KEY);
    if(fav) favorites = new Set(JSON.parse(fav));
  }catch{}
}
function saveState(){
  try{ localStorage.setItem(STORAGE_CART_KEY, JSON.stringify(cart)); }catch{}
  try{ localStorage.setItem(STORAGE_CHECKOUT_KEY, JSON.stringify(checkoutState)); }catch{}
  try{ localStorage.setItem(STORAGE_FAV_KEY, JSON.stringify(Array.from(favorites))); }catch{}
}

/* ===================== UI EVENTS ===================== */
function setupEventListeners(){
  document.getElementById('search-input').addEventListener('input', filterAndRender);
  document.getElementById('category-filter').addEventListener('change', filterAndRender);
  document.getElementById('only-cheese-checkbox').addEventListener('change', filterAndRender);
  document.getElementById('only-fav-checkbox').addEventListener('change', filterAndRender);
  document.getElementById('open-cart-btn').addEventListener('click', openCartModal);
  document.getElementById('add-to-cart-btn').addEventListener('click', addToCart);
  document.getElementById('product-variant-select').addEventListener('change', onVariantChange);
  document.getElementById('product-qty-input').addEventListener('input', updateProductModalPrice);
  document.getElementById('custom-weight-input').addEventListener('input', updateProductModalPrice);
}

/* ===================== RENDER MAIN ===================== */
const GROUP_ORDER = ['–†–∞—Å—Å–æ–ª—å–Ω—ã–µ —Å—ã—Ä—ã','–ú—è–≥–∫–∏–µ —Å—ã—Ä—ã','–¢–≤—ë—Ä–¥—ã–µ —Å—ã—Ä—ã','–°—ã—Ä–Ω—ã–µ —Ä—É–ª–µ—Ç—ã','–ú–æ–ª–æ—á–Ω–∞—è –ø—Ä–æ–¥—É–∫—Ü–∏—è','–°–ª–∞–¥–æ—Å—Ç–∏','–í—ã–ø–µ—á–∫–∞'];

function filterAndRender(){
  const q=(document.getElementById('search-input').value||'').toLowerCase().trim();
  const groupFilter=document.getElementById('category-filter').value;
  const onlyCheese=document.getElementById('only-cheese-checkbox').checked;
  const onlyFav=document.getElementById('only-fav-checkbox').checked;

  const list = PRODUCTS.filter(p=>{
    const inQuery = p.name.toLowerCase().includes(q);
    const inGroup = !groupFilter || p.group===groupFilter;
    const passCheese = !onlyCheese || p.isCheese===true;
    const passFav = !onlyFav || favorites.has(p.id);
    return inQuery && inGroup && passCheese && passFav;
  });

  const groups = {};
  list.forEach(p=>{ if(!groups[p.group]) groups[p.group]=[]; groups[p.group].push(p); });

  filteredGroups = GROUP_ORDER.filter(g=>groups[g] && groups[g].length)
    .map(g=>({group:g, products:groups[g]}));

  renderMainSections();
}

function renderMainSections(){
  const main=document.getElementById('main-content');
  main.innerHTML='';

  if(filteredGroups.length===0){
    main.innerHTML='<p class="tiny" style="text-align:center">–ù–∏—á–µ–≥–æ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ</p>';
    return;
  }

  filteredGroups.forEach(block=>{
    const sec=document.createElement('section');
    sec.className='section-block';
    sec.innerHTML=`<h3 class="section-title">${block.group}</h3>`;
    const grid=document.createElement('div');
    grid.className='product-grid';
    block.products.forEach(p=>grid.appendChild(renderProductCard(p)));
    sec.appendChild(grid);
    main.appendChild(sec);
  });
}

function renderProductCard(product){
  const card=document.createElement('div');
  card.className='product-card';
  card.onclick=()=>openProductModal(product.id);

  const approx = getApproxPricePerPiece(product); // number | null

  const favBtn=document.createElement('button');
  favBtn.className='fav-btn';
  favBtn.type='button';
  favBtn.onclick=(ev)=>{ev.stopPropagation(); toggleFavorite(product.id);};
  favBtn.innerHTML=`<span>${favorites.has(product.id)?'‚òÖ':'‚òÜ'}</span>`;

  const media=document.createElement('div');
  media.className='product-media';
  media.innerHTML = product.img
    ? `<img src="${product.img}" alt="${escapeHtml(product.name)}" />`
    : `<div class="ico">${'üßÄ'}</div>`;

  const name=document.createElement('div');
  name.className='name';
  name.textContent=product.name;

  const price=document.createElement('div');
  price.className='price';
  price.textContent=getPriceText(product);

  if(approx){
    const badge=document.createElement('div');
    badge.className='badge-piece';
    badge.textContent=`‚âà ${fmtRub(approx)} / —à—Ç`;
    card.appendChild(badge);
  }

  card.appendChild(favBtn);
  card.appendChild(media);
  card.appendChild(name);
  card.appendChild(price);

  return card;
}

function renderFavoritesRail(){
  const rail=document.getElementById('favorites-rail');
  const favItems=PRODUCTS.filter(p=>favorites.has(p.id));
  if(favItems.length===0){ rail.style.display='none'; rail.innerHTML=''; return; }
  rail.style.display='flex';
  rail.innerHTML='';
  favItems.forEach(p=>{
    const chip=document.createElement('div');
    chip.className='fav-chip';
    chip.textContent=p.name;
    chip.onclick=()=>openProductModal(p.id);
    rail.appendChild(chip);
  });
}

/* ===================== PRODUCT MODAL ===================== */
function openProductModal(productId){
  currentProduct = PRODUCTS.find(p=>p.id===productId);
  if(!currentProduct) return;
  const modal=document.getElementById('product-modal');
  document.getElementById('product-modal-title').textContent=currentProduct.name;
  const imgEl=document.getElementById('product-modal-img');
  imgEl.src=currentProduct.img||'';
  imgEl.alt=currentProduct.name||'';
  document.getElementById('product-modal-description').textContent=currentProduct.description||'';

  renderVariantSelector();
  onVariantChange();
  modal.showModal();
  if(window.Telegram && window.Telegram.WebApp) window.Telegram.WebApp.BackButton.show();
}
function closeProductModal(){
  document.getElementById('product-modal').close();
  currentProduct=null;
  if(window.Telegram && window.Telegram.WebApp) window.Telegram.WebApp.BackButton.hide();
}

function renderVariantSelector(){
  const select=document.getElementById('product-variant-select');
  select.innerHTML='';
  const rule = VARIANT_RULES[currentProduct.id];
  if(!rule){ select.innerHTML='<option>–í–∞—Ä–∏–∞–Ω—Ç –Ω–µ –æ–ø—Ä–µ–¥–µ–ª—ë–Ω</option>'; return; }

  if(rule.type==='fixed'){
    rule.options.forEach(opt=>{
      const o=document.createElement('option');
      o.value=opt; o.textContent=opt; select.appendChild(o);
    });
    document.getElementById('custom-weight-wrap').style.display = currentProduct.pricePerKg ? 'block':'none';
  }else if(rule.type==='weight'){
    for(let value=rule.min; value<=rule.max; value+=rule.step){
      const o=document.createElement('option');
      o.value=`${value} ${rule.unit}`; o.textContent=`${value} ${rule.unit}`; select.appendChild(o);
    }
    document.getElementById('custom-weight-wrap').style.display = rule.allowCustom ? 'block':'none';
  }
}

function onVariantChange(){
  // –ø–æ–∫–∞–∑–∞—Ç—å inline-–±–µ–π–¥–∂ –¥–ª—è ¬´1 —à—Ç (...)¬ª
  const v=document.getElementById('product-variant-select').value||'';
  const inline=document.getElementById('piece-badge-inline');
  const approx = approxFromVariant(currentProduct, v);
  if(approx){ inline.style.display='inline-block'; inline.textContent=`‚âà ${fmtRub(approx)} / —à—Ç`; }
  else inline.style.display='none';

  updateProductModalPrice();
}

function updateProductModalPrice(){
  if(!currentProduct) return;
  const variant=(document.getElementById('product-variant-select').value||'');
  const qty=parseInt(document.getElementById('product-qty-input').value)||1;
  const customG = parseInt(document.getElementById('custom-weight-input').value)||0;

  // –µ—Å–ª–∏ –µ—Å—Ç—å —Ä—É—á–Ω–æ–π –≤–µ—Å ‚Äî –ø–æ–¥–º–µ–Ω–∏–º –≤–∞—Ä–∏–∞–Ω—Ç
  let v = variant;
  if(customG>0 && currentProduct.pricePerKg){
    v = `${customG} –≥`;
  }
  const price = calculatePrice(currentProduct.id, v, qty);
  document.getElementById('product-modal-price').textContent = fmtRub(price.finalPrice);
}

/* ===================== FAVORITES ===================== */
function toggleFavorite(id){
  if(favorites.has(id)) favorites.delete(id); else favorites.add(id);
  saveState();
  renderFavoritesRail();
  filterAndRender();
}

/* ===================== CART ===================== */
function addToCart(){
  if(!currentProduct) return;
  const variantSel=document.getElementById('product-variant-select').value||'';
  const qty=parseInt(document.getElementById('product-qty-input').value)||1;
  const customG = parseInt(document.getElementById('custom-weight-input').value)||0;

  let variant = variantSel;
  if(customG>0 && currentProduct.pricePerKg) variant = `${customG} –≥`;

  const ix = cart.findIndex(i=>i.id===currentProduct.id && i.variant===variant);
  if(ix>-1) cart[ix].qty += qty;
  else cart.push({ id: currentProduct.id, name: currentProduct.name, group: currentProduct.group, cat: currentProduct.cat, variant, qty });

  saveState(); updateCartUI(); closeProductModal();
  if(window.Telegram?.WebApp?.HapticFeedback) window.Telegram.WebApp.HapticFeedback.impactOccurred('medium');
}

function updateCartUI(){
  const totalCount = cart.reduce((s,i)=>s+i.qty,0);
  const totalSum = cart.reduce((s,i)=>s+calculatePrice(i.id,i.variant,i.qty).finalPrice,0);
  const btn=document.getElementById('open-cart-btn');
  if(cart.length>0){
    btn.disabled=false;
    btn.textContent=`–ö–æ—Ä–∑–∏–Ω–∞ (${totalCount}) ‚Äî ${fmtRub(totalSum)}`;
    if(window.Telegram && window.Telegram.WebApp) window.Telegram.WebApp.MainButton.show();
  }else{
    btn.disabled=true; btn.textContent='–ö–æ—Ä–∑–∏–Ω–∞ –ø—É—Å—Ç–∞';
    if(window.Telegram && window.Telegram.WebApp) window.Telegram.WebApp.MainButton.hide();
  }
}

function openCartModal(){
  renderCartModal();
  document.getElementById('cart-modal').showModal();
  if(window.Telegram && window.Telegram.WebApp) window.Telegram.WebApp.BackButton.show();
}
function closeCartModal(){
  document.getElementById('cart-modal').close();
  if(window.Telegram && window.Telegram.WebApp) window.Telegram.WebApp.BackButton.hide();
}

function renderCartModal(){
  const body=document.getElementById('cart-modal-body');
  body.innerHTML='';
  if(cart.length===0){ body.innerHTML='<p>–ö–æ—Ä–∑–∏–Ω–∞ –ø—É—Å—Ç–∞</p>'; return; }

  let subtotal=0;
  cart.forEach((item,index)=>{
    const price=calculatePrice(item.id,item.variant,item.qty); subtotal+=price.finalPrice;
    const discountRate=getDiscountRateForProduct(item.id);
    const discountHint = discountRate>0 ? `<div class="discount-hint">–°–∫–∏–¥–∫–∞ ${ROUND(discountRate*100)}% –ø—Ä–∏–º–µ–Ω–µ–Ω–∞</div>`:'';

    const div=document.createElement('div');
    div.className='cart-item';
    div.innerHTML=`
      <div class="cart-item-info">
        <div class="cart-item-name">${item.name}</div>
        <div class="cart-item-variant">${escapeHtml(item.variant)}</div>
        <div class="cart-item-price">${fmtRub(price.finalPrice)}</div>
        ${discountHint}
      </div>
      <div class="cart-item-controls">
        <div class="qty-control">
          <button onclick="changeItemQty(${index},-1)">‚àí</button>
          <span>${item.qty}</span>
          <button onclick="changeItemQty(${index},1)">+</button>
        </div>
      </div>`;
    body.appendChild(div);
  });

  // –ü—Ä–æ–º–æ–∫–æ–¥
  const promoWrap=document.createElement('div');
  promoWrap.className='form-row';
  promoWrap.innerHTML=`
    <div class="form-group" style="flex:1">
      <label for="checkout-promo">–ü—Ä–æ–º–æ–∫–æ–¥</label>
      <input id="checkout-promo" placeholder="–í–≤–µ–¥–∏—Ç–µ –ø—Ä–æ–º–æ–∫–æ–¥" value="${escapeHtmlAttrRestore(checkoutState.promo)}" />
      <div class="tiny">–ü—Ä–æ–º–æ–∫–æ–¥—ã –ª—É—á—à–µ –ø—Ä–æ–≤–µ—Ä—è—Ç—å –Ω–∞ –±—ç–∫–µ–Ω–¥–µ.</div>
    </div>
    <div class="form-group" style="width:120px;align-self:flex-end">
      <button class="btn btn-secondary" onclick="applyPromo()">–ü—Ä–∏–º–µ–Ω–∏—Ç—å</button>
    </div>`;
  body.appendChild(promoWrap);

  let promoDiscountValue=0, promoNote='';
  if(checkoutState.promo && PROMO_CODES[checkoutState.promo?.trim().toUpperCase()]){
    const p = PROMO_CODES[checkoutState.promo.trim().toUpperCase()];
    if(p.type==='percent') promoDiscountValue = Math.max(0, ROUND(subtotal * p.value/100));
    else if(p.type==='flat') promoDiscountValue = Math.min(subtotal, p.value|0);
    promoNote = p.note || '';
  }

  const total = Math.max(0, subtotal - promoDiscountValue);

  const summary=document.createElement('div');
  summary.className='cart-summary';
  summary.innerHTML = `
    <div>–°—É–º–º–∞: ${fmtRub(subtotal)}</div>
    ${promoDiscountValue>0?`<div style="font-weight:700;color:var(--success-color)">–ü—Ä–æ–º–æ: ‚àí${fmtRub(promoDiscountValue)} ${promoNote?`<span class="tiny">(${promoNote})</span>`:''}</div>`:''}
    <div style="margin-top:6px">–ò—Ç–æ–≥–æ: ${fmtRub(total)}</div>
  `;
  body.appendChild(summary);

  // –ï—Å–ª–∏ –≤ –∫–æ—Ä–∑–∏–Ω–µ –µ—Å—Ç—å —Å—ã—Ä—ã ‚Äî –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ –æ –≤–∑–≤–µ—à–∏–≤–∞–Ω–∏–∏
  if(hasCheeseInCart()){
    const note=document.createElement('div');
    note.className='cart-note';
    note.textContent='–û–∫–æ–Ω—á–∞—Ç–µ–ª—å–Ω–∞—è —Å—É–º–º–∞ –±—É–¥–µ—Ç –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∞ –ø–æ—Å–ª–µ –≤–∑–≤–µ—à–∏–≤–∞–Ω–∏—è –≤ –¥–µ–Ω—å –¥–æ—Å—Ç–∞–≤–∫–∏ (–¥–ª—è —Å—ã—Ä–æ–≤).';
    body.appendChild(note);
  }

  // –§–æ—Ä–º–∞ –¥–æ—Å—Ç–∞–≤–∫–∏
  const checkout=document.createElement('div');
  checkout.innerHTML=`
    <div class="section-title" style="margin-top:14px">–ö–æ–Ω—Ç–∞–∫—Ç—ã –∏ –¥–æ—Å—Ç–∞–≤–∫–∞</div>
    <div class="form-group">
      <label for="checkout-phone">–¢–µ–ª–µ—Ñ–æ–Ω –¥–ª—è —Å–≤—è–∑–∏</label>
      <input type="tel" id="checkout-phone" inputmode="tel" placeholder="+7 999 999-99-99" />
      <div class="tiny">–ú–æ–∂–Ω–æ –≤ –ª—é–±–æ–º —Ñ–æ—Ä–º–∞—Ç–µ ‚Äî –ø—Ä–∏–≤–µ–¥—ë–º –∫ —Å—Ç–∞–Ω–¥–∞—Ä—Ç—É.</div>
    </div>
    <div class="form-group">
      <label for="checkout-address">–ê–¥—Ä–µ—Å –¥–æ—Å—Ç–∞–≤–∫–∏</label>
      <textarea id="checkout-address" rows="3" placeholder="–ì–æ—Ä–æ–¥, —É–ª–∏—Ü–∞, –¥–æ–º, –ø–æ–¥—ä–µ–∑–¥/—ç—Ç–∞–∂/–∫–≤."></textarea>
    </div>
    <div class="form-group">
      <label for="checkout-comment">–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π –∫ –∑–∞–∫–∞–∑—É</label>
      <textarea id="checkout-comment" rows="3" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –ø–æ–∑–≤–æ–Ω–∏—Ç—å –ø–µ—Ä–µ–¥ –¥–æ—Å—Ç–∞–≤–∫–æ–π, –±–µ–∑ —á–µ—Å–Ω–æ–∫–∞ –∏ —Ç.–ø."></textarea>
    </div>
    <div id="checkout-errors" class="error-text" style="display:none"></div>
    <button class="btn btn-primary" onclick="sendOrder()">–û—Ç–ø—Ä–∞–≤–∏—Ç—å –∑–∞–∫–∞–∑</button>
  `;
  body.appendChild(checkout);

  // –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–∏–º –∑–Ω–∞—á–µ–Ω–∏—è
  document.getElementById('checkout-phone').value = escapeHtmlAttrRestore(checkoutState.phone);
  document.getElementById('checkout-address').value = escapeHtmlAttrRestore(checkoutState.address);
  document.getElementById('checkout-comment').value = escapeHtmlAttrRestore(checkoutState.comment);

  // —Å–ª—É—à–∞—Ç–µ–ª–∏
  document.getElementById('checkout-phone').addEventListener('input', e=>{ checkoutState.phone=e.target.value; saveState(); });
  document.getElementById('checkout-address').addEventListener('input', e=>{ checkoutState.address=e.target.value; saveState(); });
  document.getElementById('checkout-comment').addEventListener('input', e=>{ checkoutState.comment=e.target.value; saveState(); });
}

function changeItemQty(index,delta){
  cart[index].qty += delta;
  if(cart[index].qty<=0) cart.splice(index,1);
  saveState(); updateCartUI(); renderCartModal();
}

function hasCheeseInCart(){
  return cart.some(it=>{
    const p=PRODUCTS.find(pp=>pp.id===it.id);
    return p?.isCheese===true;
  });
}

/* ===================== CHECKOUT ===================== */
function applyPromo(){
  const input=document.getElementById('checkout-promo');
  checkoutState.promo = (input.value||'').trim();
  saveState();
  renderCartModal();
}

function normalizePhone(input){
  if(!input) return '';
  const digits=(''+input).replace(/\D+/g,'');
  if(digits.length===11 && (digits.startsWith('7')||digits.startsWith('8'))) return '+7'+digits.slice(1);
  if(digits.length===10) return '+7'+digits;
  if((''+input).trim().startsWith('+')) return '+'+digits;
  return digits? '+'+digits : '';
}

function getCheckoutData(){
  const phoneRaw=(document.getElementById('checkout-phone').value||'').trim();
  const phone=normalizePhone(phoneRaw);
  const address=(document.getElementById('checkout-address').value||'').trim();
  const comment=(document.getElementById('checkout-comment').value||'').trim();
  checkoutState={...checkoutState, phone:phoneRaw, address, comment}; saveState();
  return { phoneRaw, phone, address, comment, promo:(checkoutState.promo||'').trim().toUpperCase() };
}

function validateCheckout(data){
  const errs=[];
  if(!data.phone) errs.push('–£–∫–∞–∂–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π —Ç–µ–ª–µ—Ñ–æ–Ω –¥–ª—è —Å–≤—è–∑–∏.');
  if(data.address.length<5) errs.push('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, —É–∫–∞–∂–∏—Ç–µ –∞–¥—Ä–µ—Å –¥–æ—Å—Ç–∞–≤–∫–∏.');
  return errs;
}

function showCheckoutErrors(errors){
  const box=document.getElementById('checkout-errors');
  if(!errors||errors.length===0){ box.style.display='none'; box.textContent=''; return; }
  box.style.display='block'; box.textContent=errors.join(' ');
}

function sendOrder(){
  if(cart.length===0) return;
  const contact=getCheckoutData();
  const errors=validateCheckout(contact);
  if(errors.length){
    showCheckoutErrors(errors);
    if(window.Telegram?.WebApp?.HapticFeedback) window.Telegram.WebApp.HapticFeedback.notificationOccurred('error');
    return;
  }
  showCheckoutErrors([]);

  const payload={
    type:'cart', source:'miniapp', currency:CURRENCY, items:[], total:0,
    contact:{ phone:contact.phone, phone_raw:contact.phoneRaw, address:contact.address, comment:contact.comment },
    meta:{ ts:Date.now(), schema_ver:PAYLOAD_SCHEMA_VERSION, promo_code:contact.promo || null }
  };

  let grand=0;
  cart.forEach(item=>{
    const price=calculatePrice(item.id,item.variant,item.qty); grand+=price.finalPrice;
    payload.items.push({
      id:item.id, name:item.name, group:item.group, cat:item.cat, variant:item.variant, qty:item.qty,
      unit_price_base: price.basePrice/Math.max(item.qty,1),
      discount_rate: price.discountRate,
      unit_price: price.finalPrice/Math.max(item.qty,1),
      line_total: price.finalPrice
    });
  });

  // –ø—Ä–∏–º–µ–Ω–∏–º –ø—Ä–æ–º–æ –∫ –∏—Ç–æ–≥–æ–≤–æ–π —Å—É–º–º–µ (–∏–Ω—Ñ–æ—Ä–º–∞—Ç–∏–≤–Ω–æ)
  let promoDiscount=0;
  if(checkoutState.promo && PROMO_CODES[checkoutState.promo]){
    const p=PROMO_CODES[checkoutState.promo];
    if(p.type==='percent') promoDiscount = Math.max(0, ROUND(grand*p.value/100));
    else if(p.type==='flat') promoDiscount = Math.min(grand, p.value|0);
  }
  payload.total = Math.max(0, grand - promoDiscount);
  payload.meta.promo_discount = promoDiscount;

  // Telegram info
  if(window.Telegram && window.Telegram.WebApp){
    const tg=window.Telegram.WebApp;
    payload.telegram={ platform:tg.platform, init_data: !!tg.initData };
    if(tg.initDataUnsafe?.user){
      payload.telegram.user={
        id:tg.initDataUnsafe.user.id, username:tg.initDataUnsafe.user.username,
        first_name:tg.initDataUnsafe.user.first_name, last_name:tg.initDataUnsafe.user.last_name
      };
    }
  }

  axios.post(`${BACKEND}/order`, payload)
    .then(()=>{
      if(window.Telegram?.WebApp){
        window.Telegram.WebApp.showAlert('–°–ø–∞—Å–∏–±–æ! –í–∞—à –∑–∞–∫–∞–∑ –ø—Ä–∏–Ω—è—Ç. –ú—ã —Å–≤—è–∂–µ–º—Å—è –ø–æ —Ç–µ–ª–µ—Ñ–æ–Ω—É –¥–ª—è –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è.');
        window.Telegram.WebApp.HapticFeedback?.notificationOccurred('success');
      }else alert('–í–∞—à –∑–∞–∫–∞–∑ –ø—Ä–∏–Ω—è—Ç');
      cart=[]; saveState(); updateCartUI(); closeCartModal();
      window.Telegram?.WebApp?.close();
    })
    .catch(()=>{
      if(window.Telegram?.WebApp){
        window.Telegram.WebApp.showAlert('–ù–µ —É–¥–∞–ª–æ—Å—å –æ—Ç–ø—Ä–∞–≤–∏—Ç—å –∑–∞–∫–∞–∑. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç –∏ –ø–æ–ø—Ä–æ–±—É–π—Ç–µ –µ—â—ë —Ä–∞–∑.');
        window.Telegram.WebApp.HapticFeedback?.notificationOccurred('error');
      }else alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ –∑–∞–∫–∞–∑–∞');
    });
}

/* ===================== PRICING ===================== */
function parseVariant(variantString){
  if(!variantString) return null;
  //  "200 –≥", "1 —à—Ç (200 –≥)", "0.5 –ª", "1 –∫–≥"
  const match = variantString.match(/(\d+(?:[\.,]\d+)?)\s*(–≥|–∫–≥|–ª|—à—Ç)/i);
  if(match){
    const value=parseFloat(match[1].replace(',','.'));
    let unit=match[2].toLowerCase();
    if(unit==='–≥') return {value, unit:'g'};
    if(unit==='–∫–≥') return {value, unit:'kg'};
    if(unit==='–ª') return {value, unit:'l'};
    if(unit==='—à—Ç') return {value, unit:'pc'};
  }
  // "900 –≥" already matched above
  // check "(200 –≥)" in text
  const gramInPar = variantString.match(/\((\d+(?:[\.,]\d+)?)\s*–≥\)/i);
  if(gramInPar){
    const g=parseFloat(gramInPar[1].replace(',','.'));
    return {value:g, unit:'g'};
  }
  // special "1+ –∫–≥" (–Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Å–µ–π—á–∞—Å)
  return null;
}

function calculatePrice(productId, variant, qty){
  const product=PRODUCTS.find(p=>p.id===productId);
  if(!product) return { basePrice:0, finalPrice:0, discountRate:0 };
  const rule=VARIANT_RULES[productId];
  let basePrice=0;

  if(rule && rule.type==='fixed' && product.pricePerUnit){
    basePrice = product.pricePerUnit * qty;
  }else{
    const parsed=parseVariant(variant||'');
    if(!parsed){
      // –µ—Å–ª–∏ —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –≤–∞—Ä–∏–∞–Ω—Ç, –Ω–æ —Å—á–∏—Ç–∞–µ–º –ø–æ –∫–≥ (–Ω–∞–ø—Ä–∏–º–µ—Ä "200 –≥")
      // –∏–ª–∏ –ø—É—Å—Ç–æ ‚Äî –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ —Ä–∞–¥–∏ 0
      return { basePrice:0, finalPrice:0, discountRate:0 };
    }
    if(product.pricePerKg){
      if(parsed.unit==='g') basePrice = (parsed.value/1000)*product.pricePerKg;
      else if(parsed.unit==='kg') basePrice = parsed.value*product.pricePerKg;
      else if(parsed.unit==='pc'){
        // "1 —à—Ç (200 –≥)" ‚Äî –¥–æ—Å—Ç–∞–Ω–µ–º –≥—Ä–∞–º–º—ã
        const gm = (variant||'').match(/\((\d+(?:[\.,]\d+)?)\s*–≥\)/i);
        if(gm) basePrice = (parseFloat(gm[1].replace(',','.'))/1000)*product.pricePerKg;
      }
    }else if(product.pricePerL){
      if(parsed.unit==='l') basePrice = parsed.value * product.pricePerL;
      else if(parsed.unit==='g'){ /* not applicable */ }
    }else if(product.pricePerUnit){
      basePrice = product.pricePerUnit;
    }
    basePrice *= qty;
  }

  const discountRate = getDiscountRateForProduct(productId);
  const finalPrice = ROUND(basePrice * (1 - discountRate));
  return { basePrice: ROUND(basePrice), finalPrice, discountRate };
}

function getDiscountRateForProduct(productId){
  const product=PRODUCTS.find(p=>p.id===productId);
  if(!product || product.cat!=='–°—ã—Ä—ã') return 0;
  const totalWeightGrams = cart.filter(i=>i.id===productId).reduce((sum,i)=>{
    const p=parseVariant(i.variant);
    if(p?.unit==='g') return sum + p.value * i.qty;
    if(p?.unit==='kg') return sum + p.value*1000 * i.qty;
    if(p?.unit==='pc'){
      const m=i.variant.match(/\((\d+(?:[\.,]\d+)?)\s*–≥\)/i);
      if(m) return sum + parseFloat(m[1].replace(',','.'))* i.qty;
    }
    return sum;
  },0);
  let rate=0; for(const t of DISCOUNT_THRESHOLDS){ if(totalWeightGrams>=t.g) rate=t.rate; }
  return rate;
}

function getPriceText(product){
  if(product.pricePerKg) return `${fmtRub(product.pricePerKg)} / –∫–≥`;
  if(product.pricePerL) return `${fmtRub(product.pricePerL)} / –ª`;
  if(product.pricePerUnit) return `${fmtRub(product.pricePerUnit)}`;
  return '–¶–µ–Ω–∞ –Ω–µ —É–∫–∞–∑–∞–Ω–∞';
}

function getApproxPricePerPiece(product){
  // –ü–æ –ø–µ—Ä–≤–æ–π –æ–ø—Ü–∏–∏ ¬´1 —à—Ç (X –≥)¬ª –µ—Å–ª–∏ –µ—Å—Ç—å –∏ –µ—Å—Ç—å —Ü–µ–Ω–∞ –∑–∞ –∫–≥
  const rule=VARIANT_RULES[product.id];
  if(!product.pricePerKg || !rule) return null;
  let sample=null;
  if(rule.type==='fixed'){
    sample = rule.options.find(o=>/—à—Ç\s*\(\s*\d+/.test(o));
  }
  if(!sample) return null;
  const m=sample.match(/\((\d+(?:[\.,]\d+)?)\s*–≥\)/i);
  if(!m) return null;
  const g=parseFloat(m[1].replace(',','.'));
  return ROUND(product.pricePerKg * (g/1000));
}

function approxFromVariant(product, variant){
  if(!product?.pricePerKg) return null;
  const m=(variant||'').match(/\((\d+(?:[\.,]\d+)?)\s*–≥\)/i);
  if(!m) return null;
  const g=parseFloat(m[1].replace(',','.'));
  return ROUND(product.pricePerKg * (g/1000));
}

/* ===================== HELPERS ===================== */
function escapeHtml(s){ return (s||'').replace(/[<>&"]/g, c=>({ '<':'&lt;','>':'&gt;','&':'&amp;','"':'&quot;' }[c])); }
function escapeHtmlAttrRestore(s){ return (s||''); }

/* ===================== END ===================== */
</script>
</body>
</html>
