<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <title>–°—ã—Ä–æ–º–∞–Ω–∏—è ‚Äî –ü—Ä–µ–º–∏—É–º –º–æ–ª–æ—á–Ω–∞—è –ø—Ä–æ–¥—É–∫—Ü–∏—è</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" />
  <meta name="theme-color" content="#F5F0E8" />
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Playfair+Display:wght@600;700&display=swap" rel="stylesheet">

  <style>
    :root {
      --brand-primary: #C9A87C;
      --brand-secondary: #8B7355;
      --brand-dark: #5C4A3A;
      --brand-gradient: linear-gradient(135deg, #D4B896 0%, #C9A87C 50%, #B8956E 100%);
      --brand-soft: #F5F0E8;
      
      --bg-color: #FAF8F5;
      --card-bg: #FFFFFF;
      --elevated-bg: #FFFFFF;
      --header-bg: rgba(253, 251, 247, 0.92);
      --text-primary: #2C2416;
      --text-secondary: #6B5D4D;
      --text-tertiary: #9B8B7A;
      --border-color: #E8E0D5;
      --danger: #E74C3C;
      --success: #27AE60;
      --warning: #F39C12;

      --radius-sm: 8px;
      --radius-md: 12px;
      --radius-lg: 20px;
      --radius-xl: 28px;
      --shadow-sm: 0 2px 8px rgba(92, 74, 58, 0.06);
      --shadow-md: 0 8px 24px rgba(92, 74, 58, 0.10);
      --shadow-lg: 0 16px 48px rgba(92, 74, 58, 0.15);
      --shadow-hover: 0 20px 60px rgba(92, 74, 58, 0.20);

      --font-main: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
      --font-display: 'Playfair Display', Georgia, serif;
      --safe-bottom: env(safe-area-inset-bottom, 0px);
      --ease-out: cubic-bezier(0.16, 1, 0.3, 1);
      --ease-spring: cubic-bezier(0.34, 1.56, 0.64, 1);
    }

    * {
      box-sizing: border-box;
      -webkit-tap-highlight-color: transparent;
    }

    html {
      scroll-behavior: smooth;
    }

    body {
      margin: 0;
      font-family: var(--font-main);
      background: var(--bg-color);
      color: var(--text-primary);
      -webkit-font-smoothing: antialiased;
      line-height: 1.5;
      overflow-x: hidden;
    }

    #app {
      max-width: 600px;
      margin: 0 auto;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      position: relative;
    }

    /* Header */
    header {
      position: sticky;
      top: 0;
      z-index: 100;
      padding: 16px;
      background: var(--header-bg);
      backdrop-filter: blur(20px) saturate(180%);
      -webkit-backdrop-filter: blur(20px) saturate(180%);
      border-bottom: 1px solid rgba(232, 224, 213, 0.6);
      transition: all 0.3s var(--ease-out);
    }

    header.scrolled {
      box-shadow: var(--shadow-md);
      padding-top: 12px;
      padding-bottom: 12px;
    }

    .header-top {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 16px;
    }

    #user-profile {
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .user-avatar {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      background: var(--brand-gradient);
      display: flex;
      align-items: center;
      justify-content: center;
      overflow: hidden;
      font-weight: 600;
      font-size: 15px;
      color: white;
      box-shadow: var(--shadow-sm);
      border: 2px solid rgba(255,255,255,0.6);
    }

    .user-avatar img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }

    .user-name {
      font-size: 14px;
      font-weight: 600;
      color: var(--text-primary);
      letter-spacing: -0.2px;
    }

    .brand-title {
      font-family: var(--font-display);
      font-weight: 700;
      font-size: 24px;
      background: linear-gradient(135deg, var(--brand-secondary) 0%, var(--brand-primary) 100%);
      -webkit-background-clip: text;
      background-clip: text;
      color: transparent;
      letter-spacing: -0.5px;
    }

    /* Search */
    .search-container {
      position: relative;
      margin-bottom: 16px;
    }

    .search-icon {
      position: absolute;
      left: 16px;
      top: 50%;
      transform: translateY(-50%);
      color: var(--text-tertiary);
      font-size: 16px;
      pointer-events: none;
    }

    #search-input {
      width: 100%;
      padding: 14px 16px 14px 44px;
      border-radius: var(--radius-xl);
      border: 1px solid var(--border-color);
      font-size: 15px;
      background: var(--card-bg);
      color: var(--text-primary);
      outline: none;
      transition: all 0.2s ease;
      font-family: inherit;
      box-shadow: var(--shadow-sm);
    }

    #search-input:focus {
      border-color: var(--brand-primary);
      box-shadow: 0 0 0 4px rgba(201, 168, 124, 0.12);
    }

    #search-input::placeholder {
      color: var(--text-tertiary);
    }

    /* Filters */
    .filters-container {
      display: flex;
      gap: 8px;
      overflow-x: auto;
      padding-bottom: 4px;
      scrollbar-width: none;
      -ms-overflow-style: none;
    }

    .filters-container::-webkit-scrollbar {
      display: none;
    }

    .filter-chip {
      flex-shrink: 0;
      padding: 10px 20px;
      border-radius: var(--radius-xl);
      border: 1px solid var(--border-color);
      background: var(--card-bg);
      font-size: 14px;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.25s var(--ease-out);
      white-space: nowrap;
      color: var(--text-secondary);
      box-shadow: var(--shadow-sm);
    }

    .filter-chip:hover {
      background: var(--brand-soft);
      transform: translateY(-1px);
    }

    .filter-chip.active {
      background: var(--brand-gradient);
      color: white;
      border-color: transparent;
      box-shadow: var(--shadow-md);
      font-weight: 600;
    }

    /* Favorites Bar */
    #favorites-bar {
      display: none;
      margin-top: 12px;
      padding-top: 12px;
      border-top: 1px dashed var(--border-color);
      gap: 8px;
      overflow-x: auto;
      scrollbar-width: none;
    }

    #favorites-bar.visible {
      display: flex;
    }

    .fav-chip {
      flex-shrink: 0;
      padding: 8px 16px;
      border-radius: var(--radius-xl);
      border: none;
      background: var(--brand-soft);
      font-size: 13px;
      font-weight: 500;
      color: var(--brand-secondary);
      cursor: pointer;
      transition: all 0.2s ease;
      border: 1px solid transparent;
    }

    .fav-chip:hover {
      background: #EDE6D8;
      border-color: var(--brand-primary);
      transform: translateY(-1px);
    }

    /* Main Content */
    main {
      flex: 1;
      padding: 16px;
      padding-bottom: calc(120px + var(--safe-bottom));
    }

    .section {
      margin-bottom: 32px;
      animation: fadeInUp 0.5s var(--ease-out);
    }

    @keyframes fadeInUp {
      from { opacity: 0; transform: translateY(20px); }
      to { opacity: 1; transform: translateY(0); }
    }

    .section-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 16px;
      padding: 0 4px;
    }

    .section-title {
      font-family: var(--font-display);
      font-size: 22px;
      font-weight: 700;
      color: var(--text-primary);
      display: flex;
      align-items: center;
      gap: 10px;
      letter-spacing: -0.3px;
    }

    .section-title::before {
      content: '';
      width: 4px;
      height: 24px;
      background: var(--brand-gradient);
      border-radius: 2px;
    }

    .section-count {
      font-size: 14px;
      color: var(--text-tertiary);
      font-weight: 600;
      background: var(--brand-soft);
      padding: 4px 12px;
      border-radius: 20px;
    }

    /* Product Grid */
    .product-grid {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 16px;
    }

    @media (min-width: 480px) {
      .product-grid {
        grid-template-columns: repeat(3, 1fr);
        gap: 20px;
      }
    }

    .product-card {
      background: var(--card-bg);
      border-radius: var(--radius-lg);
      overflow: hidden;
      box-shadow: var(--shadow-sm);
      display: flex;
      flex-direction: column;
      cursor: pointer;
      transition: all 0.4s var(--ease-out);
      position: relative;
      border: 1px solid transparent;
    }

    .product-card:hover {
      transform: translateY(-6px);
      box-shadow: var(--shadow-hover);
      border-color: rgba(201, 168, 124, 0.2);
    }

    .product-card:active {
      transform: scale(0.98);
    }

    .product-image-wrapper {
      position: relative;
      width: 100%;
      padding-top: 85%;
      background: linear-gradient(135deg, #F5F0E8 0%, #EDE6D8 100%);
      overflow: hidden;
    }

    .product-thumb {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      object-fit: cover;
      transition: transform 0.6s var(--ease-out);
    }

    .product-card:hover .product-thumb {
      transform: scale(1.08);
    }

    .product-badge {
      position: absolute;
      top: 10px;
      right: 10px;
      background: rgba(255, 255, 255, 0.95);
      padding: 6px 10px;
      border-radius: 20px;
      font-size: 11px;
      font-weight: 700;
      color: var(--brand-secondary);
      backdrop-filter: blur(8px);
      box-shadow: 0 2px 8px rgba(0,0,0,0.08);
      border: 1px solid rgba(0,0,0,0.04);
    }

    .product-info {
      padding: 16px;
      flex: 1;
      display: flex;
      flex-direction: column;
      gap: 6px;
    }

    .product-name {
      font-size: 15px;
      font-weight: 600;
      color: var(--text-primary);
      line-height: 1.35;
      display: -webkit-box;
      -webkit-line-clamp: 2;
      -webkit-box-orient: vertical;
      overflow: hidden;
      min-height: 40px;
    }

    .product-price-row {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-top: auto;
      padding-top: 10px;
    }

    .product-price {
      font-size: 16px;
      font-weight: 700;
      color: var(--brand-secondary);
      letter-spacing: -0.3px;
    }

    .product-unit {
      font-size: 12px;
      color: var(--text-tertiary);
      font-weight: 500;
      margin-top: 2px;
    }

    .fav-btn {
      width: 36px;
      height: 36px;
      border-radius: 50%;
      border: none;
      background: var(--brand-soft);
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 20px;
      transition: all 0.3s var(--ease-spring);
      color: var(--text-tertiary);
    }

    .fav-btn:hover {
      background: #FCE8E6;
      transform: scale(1.15);
    }

    .fav-btn.active {
      background: #FCE8E6;
      color: #E74C3C;
    }

    /* Empty State */
    .empty-state {
      text-align: center;
      padding: 80px 20px;
      color: var(--text-tertiary);
    }

    .empty-icon {
      font-size: 64px;
      margin-bottom: 20px;
      opacity: 0.4;
    }

    .empty-text {
      font-size: 17px;
      font-weight: 500;
      color: var(--text-secondary);
    }

    /* Cart Footer */
    .cart-footer {
      position: fixed;
      left: 0;
      right: 0;
      bottom: 0;
      z-index: 90;
      padding: 16px 20px calc(16px + var(--safe-bottom));
      background: linear-gradient(to top, rgba(250, 248, 245, 1) 0%, rgba(250, 248, 245, 0.9) 100%);
      backdrop-filter: blur(20px);
    }

    .cart-button {
      width: 100%;
      max-width: 560px;
      margin: 0 auto;
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 16px 24px;
      border-radius: var(--radius-xl);
      border: none;
      background: var(--brand-gradient);
      color: white;
      font-family: inherit;
      font-size: 16px;
      font-weight: 600;
      cursor: pointer;
      box-shadow: var(--shadow-lg), 0 4px 20px rgba(201, 168, 124, 0.3);
      transition: all 0.3s var(--ease-out);
      position: relative;
      overflow: hidden;
    }

    .cart-button:disabled {
      opacity: 0.5;
      cursor: not-allowed;
      transform: none;
      box-shadow: none;
    }

    .cart-button:not(:disabled):hover {
      transform: translateY(-3px);
      box-shadow: var(--shadow-hover), 0 8px 30px rgba(201, 168, 124, 0.4);
    }

    .cart-button:not(:disabled):active {
      transform: translateY(-1px);
    }

    .cart-info {
      display: flex;
      align-items: center;
      gap: 14px;
    }

    .cart-count {
      background: rgba(255, 255, 255, 0.25);
      padding: 6px 14px;
      border-radius: 20px;
      font-size: 15px;
      font-weight: 700;
      backdrop-filter: blur(4px);
    }

    .cart-total {
      font-size: 19px;
      font-weight: 700;
    }

    .cart-arrow {
      font-size: 24px;
      opacity: 0.9;
      transition: transform 0.3s ease;
    }

    .cart-button:not(:disabled):hover .cart-arrow {
      transform: translateX(4px);
    }

    /* Modals */
    dialog {
      border: none;
      padding: 0;
      border-radius: var(--radius-lg) var(--radius-lg) 0 0;
      max-width: 600px;
      width: 100%;
      max-height: 92vh;
      margin: auto 0 0 0;
      box-shadow: 0 -10px 60px rgba(0, 0, 0, 0.25);
      animation: slideUp 0.4s var(--ease-out);
      background: var(--card-bg);
      position: fixed;
      bottom: 0;
      left: 50%;
      transform: translateX(-50%);
      overflow: hidden;
    }

    @media (min-width: 600px) {
      dialog {
        border-radius: var(--radius-lg);
        margin: auto;
        max-height: 88vh;
        animation: popIn 0.4s var(--ease-out);
      }
    }

    @keyframes slideUp {
      from { transform: translateX(-50%) translateY(100%); opacity: 0; }
      to { transform: translateX(-50%) translateY(0); opacity: 1; }
    }

    @keyframes popIn {
      from { transform: translateX(-50%) scale(0.9); opacity: 0; }
      to { transform: translateX(-50%) scale(1); opacity: 1; }
    }

    dialog::backdrop {
      background: rgba(44, 36, 22, 0.6);
      backdrop-filter: blur(8px);
      animation: fadeIn 0.3s ease;
    }

    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }

    .modal-header {
      position: sticky;
      top: 0;
      z-index: 10;
      padding: 20px 24px;
      background: var(--card-bg);
      border-bottom: 1px solid var(--border-color);
      display: flex;
      align-items: center;
      justify-content: space-between;
    }

    .modal-title {
      font-family: var(--font-display);
      font-size: 22px;
      font-weight: 700;
      margin: 0;
      padding-right: 40px;
      color: var(--text-primary);
    }

    .modal-close {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      border: none;
      background: var(--brand-soft);
      font-size: 28px;
      line-height: 1;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      color: var(--text-secondary);
      transition: all 0.3s var(--ease-spring);
    }

    .modal-close:hover {
      background: #FCE8E6;
      color: var(--danger);
      transform: rotate(90deg);
    }

    .modal-body {
      padding: 24px;
      overflow-y: auto;
      max-height: calc(92vh - 80px);
    }

    /* Product Modal */
    .product-image-large {
      width: 100%;
      aspect-ratio: 4/3;
      object-fit: cover;
      border-radius: var(--radius-md);
      margin-bottom: 20px;
      background: linear-gradient(135deg, #F5F0E8 0%, #EDE6D8 100%);
      box-shadow: var(--shadow-sm);
    }

    .product-description {
      font-size: 15px;
      line-height: 1.7;
      color: var(--text-secondary);
      margin-bottom: 24px;
      padding: 20px;
      background: var(--brand-soft);
      border-radius: var(--radius-md);
      border-left: 4px solid var(--brand-primary);
    }

    .form-group {
      margin-bottom: 24px;
    }

    .form-label {
      display: block;
      font-size: 13px;
      font-weight: 700;
      color: var(--text-primary);
      margin-bottom: 10px;
      text-transform: uppercase;
      letter-spacing: 0.8px;
    }

    /* Modern Weight Selector */
    .weight-selector {
      display: flex;
      flex-direction: column;
      gap: 12px;
    }

    .weight-chips {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
    }

    .weight-chip {
      padding: 12px 20px;
      border-radius: var(--radius-xl);
      border: 2px solid var(--border-color);
      background: var(--card-bg);
      font-size: 15px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.25s var(--ease-out);
      color: var(--text-secondary);
      min-width: 70px;
      text-align: center;
    }

    .weight-chip:hover {
      border-color: var(--brand-primary);
      color: var(--brand-secondary);
      transform: translateY(-2px);
    }

    .weight-chip.active {
      background: var(--brand-gradient);
      color: white;
      border-color: transparent;
      box-shadow: var(--shadow-md);
    }

    .weight-chip.custom {
      border-style: dashed;
      color: var(--brand-secondary);
    }

    .custom-weight-input-wrapper {
      display: none;
      animation: fadeIn 0.3s ease;
      margin-top: 8px;
    }

    .custom-weight-input-wrapper.visible {
      display: flex;
      gap: 12px;
      align-items: center;
    }

    .custom-weight-input {
      flex: 1;
      padding: 14px 18px;
      border-radius: var(--radius-md);
      border: 2px solid var(--border-color);
      font-size: 17px;
      font-weight: 600;
      text-align: center;
      font-family: inherit;
      color: var(--text-primary);
      transition: all 0.2s ease;
    }

    .custom-weight-input:focus {
      outline: none;
      border-color: var(--brand-primary);
      box-shadow: 0 0 0 4px rgba(201, 168, 124, 0.12);
    }

    .weight-hint {
      font-size: 13px;
      color: var(--text-tertiary);
      margin-top: 8px;
      line-height: 1.5;
      font-style: italic;
    }

    .price-display {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin: 28px 0;
      padding: 24px;
      background: linear-gradient(135deg, var(--brand-soft) 0%, #F9F6F1 100%);
      border-radius: var(--radius-lg);
      border: 2px solid rgba(201, 168, 124, 0.2);
      position: relative;
      overflow: hidden;
    }

    .price-display::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 4px;
      background: var(--brand-gradient);
    }

    .price-label {
      font-size: 14px;
      font-weight: 600;
      color: var(--text-secondary);
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    .price-value {
      font-size: 32px;
      font-weight: 700;
      color: var(--brand-dark);
      letter-spacing: -1px;
    }

    .price-old {
      font-size: 18px;
      text-decoration: line-through;
      color: var(--text-tertiary);
      margin-right: 12px;
      font-weight: 500;
    }

    .btn-primary {
      width: 100%;
      padding: 18px;
      border-radius: var(--radius-xl);
      border: none;
      background: var(--brand-gradient);
      color: white;
      font-family: inherit;
      font-size: 17px;
      font-weight: 700;
      cursor: pointer;
      box-shadow: var(--shadow-md);
      transition: all 0.3s var(--ease-out);
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 10px;
      letter-spacing: 0.3px;
    }

    .btn-primary:hover:not(:disabled) {
      transform: translateY(-3px);
      box-shadow: var(--shadow-lg);
    }

    .btn-primary:active:not(:disabled) {
      transform: translateY(-1px);
    }

    .btn-primary:disabled {
      opacity: 0.6;
      cursor: not-allowed;
    }

    /* Cart Modal */
    .cart-items {
      display: flex;
      flex-direction: column;
      gap: 16px;
      margin-bottom: 24px;
    }

    .cart-item {
      display: flex;
      gap: 16px;
      padding: 20px;
      background: var(--brand-soft);
      border-radius: var(--radius-lg);
      position: relative;
      transition: all 0.3s ease;
      border: 1px solid transparent;
    }

    .cart-item:hover {
      border-color: var(--border-color);
      transform: translateX(4px);
    }

    .cart-item-image {
      width: 72px;
      height: 72px;
      border-radius: var(--radius-md);
      object-fit: cover;
      background: var(--border-color);
      flex-shrink: 0;
      box-shadow: var(--shadow-sm);
    }

    .cart-item-content {
      flex: 1;
      min-width: 0;
      display: flex;
      flex-direction: column;
      justify-content: center;
    }

    .cart-item-name {
      font-weight: 700;
      font-size: 15px;
      margin-bottom: 4px;
      color: var(--text-primary);
    }

    .cart-item-variant {
      font-size: 13px;
      color: var(--text-secondary);
      margin-bottom: 8px;
      word-break: break-word;
      font-weight: 500;
    }

    .cart-item-price {
      font-weight: 700;
      color: var(--brand-secondary);
      font-size: 17px;
      letter-spacing: -0.3px;
    }

    .cart-item-discount {
      font-size: 12px;
      color: var(--success);
      font-weight: 700;
      margin-top: 4px;
      display: inline-flex;
      align-items: center;
      gap: 4px;
    }

    .cart-item-controls {
      display: flex;
      flex-direction: column;
      align-items: flex-end;
      justify-content: space-between;
      gap: 12px;
    }

    .qty-control {
      display: flex;
      align-items: center;
      gap: 10px;
      background: var(--card-bg);
      border-radius: var(--radius-xl);
      padding: 6px;
      box-shadow: var(--shadow-sm);
      border: 1px solid var(--border-color);
    }

    .qty-btn {
      width: 36px;
      height: 36px;
      border-radius: 50%;
      border: none;
      background: transparent;
      font-size: 20px;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      color: var(--text-primary);
      transition: all 0.2s var(--ease-spring);
      font-weight: 300;
    }

    .qty-btn:hover {
      background: var(--brand-soft);
      transform: scale(1.1);
    }

    .qty-btn:active {
      transform: scale(0.9);
    }

    .qty-value {
      min-width: 28px;
      text-align: center;
      font-weight: 700;
      font-size: 16px;
      color: var(--text-primary);
    }

    .remove-btn {
      width: 32px;
      height: 32px;
      border-radius: 50%;
      border: none;
      background: transparent;
      color: var(--text-tertiary);
      cursor: pointer;
      font-size: 20px;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.2s ease;
    }

    .remove-btn:hover {
      background: #FCE8E6;
      color: var(--danger);
      transform: rotate(12deg);
    }

    .cart-summary-section {
      border-top: 2px solid var(--border-color);
      padding-top: 24px;
      margin-top: 24px;
    }

    .summary-row {
      display: flex;
      justify-content: space-between;
      margin-bottom: 14px;
      font-size: 15px;
      color: var(--text-secondary);
    }

    .summary-row.total {
      font-size: 22px;
      font-weight: 700;
      color: var(--text-primary);
      margin-top: 18px;
      padding-top: 18px;
      border-top: 2px dashed var(--border-color);
      font-family: var(--font-display);
    }

    .promo-input {
      width: 100%;
      padding: 14px 18px;
      border-radius: var(--radius-md);
      border: 2px solid var(--border-color);
      font-size: 15px;
      margin-top: 8px;
      text-transform: uppercase;
      font-family: inherit;
      font-weight: 600;
      letter-spacing: 1px;
      transition: all 0.2s ease;
    }

    .promo-input:focus {
      outline: none;
      border-color: var(--brand-primary);
    }

    .checkout-section {
      margin-top: 28px;
      padding-top: 28px;
      border-top: 2px solid var(--border-color);
    }

    .section-subtitle {
      font-size: 18px;
      font-weight: 700;
      margin-bottom: 20px;
      color: var(--text-primary);
      font-family: var(--font-display);
    }

    .form-select, .form-input, .form-textarea {
      width: 100%;
      padding: 14px 18px;
      border-radius: var(--radius-md);
      border: 2px solid var(--border-color);
      font-size: 15px;
      background: var(--card-bg);
      color: var(--text-primary);
      font-family: inherit;
      outline: none;
      transition: all 0.2s ease;
    }

    .form-select:focus, .form-input:focus, .form-textarea:focus {
      border-color: var(--brand-primary);
      box-shadow: 0 0 0 4px rgba(201, 168, 124, 0.12);
    }

    .form-textarea {
      resize: vertical;
      min-height: 100px;
      line-height: 1.5;
    }

    .error-message {
      color: var(--danger);
      font-size: 14px;
      margin-top: 12px;
      padding: 14px;
      background: #FCE8E6;
      border-radius: var(--radius-md);
      display: none;
      font-weight: 500;
      border-left: 4px solid var(--danger);
    }

    .error-message.visible {
      display: block;
      animation: shake 0.5s ease;
    }

    @keyframes shake {
      0%, 100% { transform: translateX(0); }
      25% { transform: translateX(-6px); }
      75% { transform: translateX(6px); }
    }

    .weighing-notice {
      margin-top: 20px;
      padding: 16px;
      background: linear-gradient(135deg, #FFF9E6 0%, #FFF3CD 100%);
      border: 2px solid #FFEAA7;
      border-radius: var(--radius-md);
      font-size: 14px;
      color: #856404;
      display: flex;
      align-items: flex-start;
      gap: 10px;
      font-weight: 500;
      line-height: 1.5;
    }

    .weighing-notice::before {
      content: '‚ö†Ô∏è';
      font-size: 20px;
    }

    /* Toast Notification */
    .toast {
      position: fixed;
      top: 24px;
      left: 50%;
      transform: translateX(-50%) translateY(-120%);
      background: var(--text-primary);
      color: white;
      padding: 16px 28px;
      border-radius: var(--radius-xl);
      font-size: 15px;
      font-weight: 600;
      z-index: 1000;
      opacity: 0;
      transition: all 0.4s var(--ease-spring);
      box-shadow: var(--shadow-lg);
      pointer-events: none;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .toast.visible {
      transform: translateX(-50%) translateY(0);
      opacity: 1;
    }

    .toast.success {
      background: var(--success);
    }

    .toast.error {
      background: var(--danger);
    }

    /* Utility */
    .hidden {
      display: none !important;
    }

    .text-secondary {
      color: var(--text-secondary);
    }

    /* Animations */
    @keyframes pulse {
      0%, 100% { transform: scale(1); }
      50% { transform: scale(1.05); }
    }

    .pulse {
      animation: pulse 2s infinite;
    }
  </style>
</head>
<body>
  <div id="app">
    <header id="main-header">
      <div class="header-top">
        <div id="user-profile">
          <div class="user-avatar"><span>–°</span></div>
          <div class="user-name">–ì–æ—Å—Ç—å</div>
        </div>
        <div class="brand-title">–°—ã—Ä–æ–º–∞–Ω–∏—è</div>
      </div>

      <div class="search-container">
        <span class="search-icon">üîç</span>
        <input type="search" id="search-input" placeholder="–ü–æ–∏—Å–∫ –ø–æ –Ω–∞–∑–≤–∞–Ω–∏—é..." autocomplete="off">
      </div>

      <div class="filters-container" id="filters-container">
        <button class="filter-chip active" data-filter="all">–í—Å–µ</button>
        <button class="filter-chip" data-filter="cheese">–¢–æ–ª—å–∫–æ —Å—ã—Ä—ã</button>
        <button class="filter-chip" data-filter="fav">–ò–∑–±—Ä–∞–Ω–Ω–æ–µ</button>
      </div>

      <div id="favorites-bar"></div>
    </header>

    <main id="main"></main>

    <div class="cart-footer">
      <button id="open-cart-btn" class="cart-button" disabled>
        <div class="cart-info">
          <span class="cart-count">0</span>
          <span>–ö–æ—Ä–∑–∏–Ω–∞ –ø—É—Å—Ç–∞</span>
        </div>
        <span class="cart-arrow">‚Üí</span>
      </button>
    </div>
  </div>

  <!-- Toast -->
  <div id="toast" class="toast"></div>

  <!-- Product Modal -->
  <dialog id="product-modal">
    <div class="modal-header">
      <h2 class="modal-title" id="product-modal-title"></h2>
      <button class="modal-close" onclick="closeProductModal()">√ó</button>
    </div>
    <div class="modal-body">
      <img id="product-modal-image" class="product-image-large" src="" alt="">
      <div class="product-description" id="product-modal-description"></div>

      <div class="form-group" id="variant-group">
        <label class="form-label">–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ</label>
        <div id="weight-selector-container"></div>
        <div class="weight-hint" id="variant-hint"></div>
      </div>

      <div class="form-group" id="flavor-group" style="display: none;">
        <label class="form-label">–í–∫—É—Å</label>
        <select id="product-flavor-select" class="form-select"></select>
      </div>

      <div class="form-group">
        <label class="form-label">–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —É–ø–∞–∫–æ–≤–æ–∫</label>
        <div class="qty-control" style="width: fit-content;">
          <button type="button" class="qty-btn" onclick="adjustQty(-1)">‚àí</button>
          <span class="qty-value" id="product-qty-display">1</span>
          <button type="button" class="qty-btn" onclick="adjustQty(1)">+</button>
        </div>
      </div>

      <div class="price-display" id="price-display">
        <div>
          <div class="price-label">–ò—Ç–æ–≥–æ</div>
        </div>
        <div style="text-align: right;">
          <span class="price-old" id="price-old" style="display: none;"></span>
          <span class="price-value" id="price-value">0 ‚ÇΩ</span>
        </div>
      </div>

      <button class="btn-primary" id="add-to-cart-btn" onclick="addToCart()">
        <span>üõí</span>
        <span>–î–æ–±–∞–≤–∏—Ç—å –≤ –∫–æ—Ä–∑–∏–Ω—É</span>
      </button>
    </div>
  </dialog>

  <!-- Cart Modal -->
  <dialog id="cart-modal">
    <div class="modal-header">
      <h2 class="modal-title">–ö–æ—Ä–∑–∏–Ω–∞</h2>
      <button class="modal-close" onclick="closeCartModal()">√ó</button>
    </div>
    <div class="modal-body" id="cart-modal-body">
      <!-- Dynamic content -->
    </div>
  </dialog>

  <script>
    // ===== Configuration =====
    const BACKEND = 'https://puzzlebot-webhook-handler1.onrender.com';
    const CURRENCY = 'RUB';
    const STORAGE_CART_KEY = 'syromania-cart-v3';
    const STORAGE_FAV_KEY = 'syromania-favorites';
    const STORAGE_CHECKOUT_KEY = 'syromania-checkout';
    const DEFAULT_IMG = 'https://static.tildacdn.com/tild3134-3861-4539-a363-646133333238/__.webp';
    
    const DISCOUNT_THRESHOLDS = [
      { g: 500, rate: 0.05, label: '5%' },
      { g: 700, rate: 0.10, label: '10%' },
      { g: 1000, rate: 0.15, label: '15%' }
    ];

    const GROUPS = [
      { id: 'brined', title: '–†–∞—Å—Å–æ–ª—å–Ω—ã–µ —Å—ã—Ä—ã' },
      { id: 'soft', title: '–ú—è–≥–∫–∏–µ —Å—ã—Ä—ã' },
      { id: 'hard', title: '–¢–≤—ë—Ä–¥—ã–µ —Å—ã—Ä—ã' },
      { id: 'rolls', title: '–°—ã—Ä–Ω—ã–µ —Ä—É–ª–µ—Ç—ã' },
      { id: 'dairy', title: '–ú–æ–ª–æ—á–Ω–∞—è –ø—Ä–æ–¥—É–∫—Ü–∏—è' },
      { id: 'sweets', title: '–°–ª–∞–¥–æ—Å—Ç–∏' },
      { id: 'bakery', title: '–í—ã–ø–µ—á–∫–∞' }
    ];

    const CHEESE_GROUP_IDS = new Set(['brined', 'soft', 'hard', 'rolls']);

    // ===== Products Data =====
    const PRODUCTS = [
      // –†–∞—Å—Å–æ–ª—å–Ω—ã–µ —Å—ã—Ä—ã
      {
        id: 'mozzarella',
        name: '–ú–æ—Ü–∞—Ä–µ–ª–ª–∞',
        group: 'brined',
        pricePerKg: 2000,
        ico: 'üßÄ',
        description: '–ù–∏—Ç–∏ –º–æ—Ü–∞—Ä–µ–ª–ª—ã –≤ –Ω–µ–∂–Ω–æ–π –æ–±–æ–ª–æ—á–∫–µ. –°—Ä–æ–∫ —Ö—Ä–∞–Ω–µ–Ω–∏—è: 3‚Äì5 —Å—É—Ç–æ–∫. –ò–¥–µ–∞–ª—å–Ω–∞ –∫ —Å–∞–ª–∞—Ç–∞–º.',
        img: 'https://raw.githubusercontent.com/youmyloving/syr/main/mozzarella.webp',
        pieceWeightGrams: 200
      },
      {
        id: 'buratta',
        name: '–ë—É—Ä–∞—Ç—Ç–∞',
        group: 'brined',
        pricePerKg: 2100,
        ico: 'üßÄ',
        description: '–ú–µ—à–æ—á–µ–∫ –∏–∑ –º–æ—Ü–∞—Ä–µ–ª–ª—ã —Å –Ω–∞—á–∏–Ω–∫–æ–π –∏–∑ —Å—Ç—Ä–∞—á–∞—Ç–µ–ª–ª—ã. –°—Ä–æ–∫ —Ö—Ä–∞–Ω–µ–Ω–∏—è: 3‚Äì5 —Å—É—Ç–æ–∫.',
        img: DEFAULT_IMG,
        pieceWeightGrams: 250
      },
      {
        id: 'stracciatella',
        name: '–°—Ç—Ä–∞—á–∞—Ç–µ–ª–ª–∞',
        group: 'brined',
        pricePerKg: 2150,
        ico: 'üßÄ',
        description: '–ù–∏—Ç–∏ –º–æ—Ü–∞—Ä–µ–ª–ª—ã –≤ —Å–ª–∏–≤–∫–∞—Ö. –°—Ä–æ–∫ —Ö—Ä–∞–Ω–µ–Ω–∏—è: 5‚Äì7 —Å—É—Ç–æ–∫.',
        img: 'https://static.tildacdn.com/tild3832-6430-4462-b663-353438383930/stracciatella.webp'
      },
      {
        id: 'suluguni',
        name: '–°—É–ª—É–≥—É–Ω–∏',
        group: 'brined',
        pricePerKg: 1700,
        ico: 'üßÄ',
        description: '–£–º–µ—Ä–µ–Ω–Ω–æ —Å–æ–ª—ë–Ω—ã–π, —Å–ª–æ–∏—Å—Ç—ã–π –∏ —ç–ª–∞—Å—Ç–∏—á–Ω—ã–π. –°—Ä–æ–∫ —Ö—Ä–∞–Ω–µ–Ω–∏—è: 7 —Å—É—Ç–æ–∫.',
        img: 'https://static.tildacdn.com/tild3238-3866-4366-a436-623236363261/suluguni.webp'
      },
      {
        id: 'suluguni-smoked',
        name: '–°—É–ª—É–≥—É–Ω–∏ –∫–æ–ø—á—ë–Ω—ã–π',
        group: 'brined',
        pricePerKg: 1800,
        ico: 'üí®',
        description: '–° –ª—ë–≥–∫–æ–π –∫–æ–ø—á—ë–Ω–æ—Å—Ç—å—é, –ø–ª–æ—Ç–Ω–∞—è –∏ —ç–ª–∞—Å—Ç–∏—á–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞. –°—Ä–æ–∫ —Ö—Ä–∞–Ω–µ–Ω–∏—è: 30 —Å—É—Ç–æ–∫.',
        img: 'https://static.tildacdn.com/tild6435-3838-4463-b431-353765323333/suluguni-smoked.webp'
      },
      {
        id: 'imeretian',
        name: '–ò–º–µ—Ä–µ—Ç–∏–Ω—Å–∫–∏–π',
        group: 'brined',
        pricePerKg: 1500,
        ico: 'üßÄ',
        description: '–ü—Ä–µ–∫—Ä–∞—Å–Ω—ã–π —Ä–∞—Å—Å–æ–ª—å–Ω—ã–π —Å—ã—Ä, –ø–æ–¥—Ö–æ–¥–∏—Ç –∫–æ –≤—Å–µ–º –±–ª—é–¥–∞–º. –°—Ä–æ–∫ —Ö—Ä–∞–Ω–µ–Ω–∏—è: 7 —Å—É—Ç–æ–∫.',
        img: 'https://raw.githubusercontent.com/youmyloving/syr/main/imeretian.webp'
      },
      {
        id: 'imeretian-dill-garlic',
        name: '–ò–º–µ—Ä–µ—Ç–∏–Ω—Å–∫–∏–π —Å –∑–µ–ª–µ–Ω—å—é –∏ —á–µ—Å–Ω–æ–∫–æ–º',
        group: 'brined',
        pricePerKg: 1600,
        ico: 'üßÑ',
        description: '–°–≤–µ–∂–∏–π —Ä–∞—Å—Å–æ–ª—å–Ω—ã–π —Å—ã—Ä —Å –∞—Ä–æ–º–∞—Ç–Ω–æ–π –∑–µ–ª–µ–Ω—å—é –∏ —á–µ—Å–Ω–æ–∫–æ–º. –°—Ä–æ–∫ —Ö—Ä–∞–Ω–µ–Ω–∏—è: 7 —Å—É—Ç–æ–∫.',
        img: 'https://static.tildacdn.com/tild6435-3539-4337-a561-386438636230/__.webp'
      },
      {
        id: 'halloumi',
        name: '–•–∞–ª–ª—É–º–∏ (–∫–ª–∞—Å—Å–∏—á–µ—Å–∫–∏–π)',
        group: 'brined',
        pricePerKg: 1950,
        ico: 'üî•',
        description: '–ò–¥–µ–∞–ª–µ–Ω –¥–ª—è –∂–∞—Ä–∫–∏ –Ω–∞ —Å–∫–æ–≤–æ—Ä–æ–¥–µ –∏–ª–∏ –≥—Ä–∏–ª–µ ‚Äî –ø–æ—è–≤–ª—è–µ—Ç—Å—è —Ö—Ä—É—Å—Ç—è—â–∞—è –∫–æ—Ä–æ—á–∫–∞. –°—Ä–æ–∫ —Ö—Ä–∞–Ω–µ–Ω–∏—è: 7 —Å—É—Ç–æ–∫.',
        img: 'https://static.tildacdn.com/tild3161-6362-4130-b134-623331346238/halloumi.webp',
        pieceWeightGrams: 225,
        pieceWeightRangeText: '200‚Äì250 –≥'
      },
      {
        id: 'halloumi-paprika-oregano',
        name: '–•–∞–ª–ª—É–º–∏ —Å –ø–∞–ø—Ä–∏–∫–æ–π –∏ –æ—Ä–µ–≥–∞–Ω–æ',
        group: 'brined',
        pricePerKg: 2100,
        ico: 'üå∂Ô∏è',
        description: '–ò–¥–µ–∞–ª–µ–Ω –¥–ª—è –∂–∞—Ä–∫–∏ –∏–ª–∏ –±–µ–∑ –æ–±–∂–∞—Ä–∫–∏. –°—Ä–µ–¥–∏–∑–µ–º–Ω–æ–º–æ—Ä—Å–∫–∏–µ –Ω–æ—Ç–∫–∏. –°—Ä–æ–∫ —Ö—Ä–∞–Ω–µ–Ω–∏—è: 7 —Å—É—Ç–æ–∫.',
        img: 'https://static.tildacdn.com/tild3133-6165-4134-b335-396662633262/halloumi-paprika-ore.webp',
        pieceWeightGrams: 225,
        pieceWeightRangeText: '200‚Äì250 –≥'
      },
      {
        id: 'halloumi-tomato-basil-garlic',
        name: '–•–∞–ª–ª—É–º–∏ —Ç–æ–º–∞—Ç-–±–∞–∑–∏–ª–∏–∫-—á–µ—Å–Ω–æ–∫',
        group: 'brined',
        pricePerKg: 2100,
        ico: 'üçÖ',
        description: '–ò–¥–µ–∞–ª–µ–Ω –¥–ª—è –∂–∞—Ä–∫–∏, —Ö—Ä—É—Å—Ç—è—â–∞—è –∫–æ—Ä–æ—á–∫–∞. –°—Ä–æ–∫ —Ö—Ä–∞–Ω–µ–Ω–∏—è: 7 —Å—É—Ç–æ–∫.',
        img: 'https://raw.githubusercontent.com/youmyloving/syr/main/halloumi-tomato-basil-garlic.webp',
        pieceWeightGrams: 225,
        pieceWeightRangeText: '200‚Äì250 –≥'
      },
      {
        id: 'halloumi-tomato-paprika',
        name: '–•–∞–ª–ª—É–º–∏ —Å –≤—è–ª–µ–Ω—ã–º–∏ —Ç–æ–º–∞—Ç–∞–º–∏',
        group: 'brined',
        pricePerKg: 2100,
        ico: 'üçÖ',
        description: '–ò–¥–µ–∞–ª–µ–Ω –¥–ª—è –∂–∞—Ä–∫–∏, –ø–æ—è–≤–ª—è–µ—Ç—Å—è –∫–æ—Ä–æ—á–∫–∞. –°—Ä–æ–∫ —Ö—Ä–∞–Ω–µ–Ω–∏—è: 7 —Å—É—Ç–æ–∫.',
        img: 'https://static.tildacdn.com/tild3863-3030-4439-a439-653238303862/halloumi-tomato-papr.webp',
        pieceWeightGrams: 225,
        pieceWeightRangeText: '200‚Äì250 –≥'
      },
      {
        id: 'kosichka',
        name: '–°—ã—Ä –∫–æ—Å–∏—á–∫–∞',
        group: 'brined',
        pricePerKg: 1900,
        ico: 'ü•®',
        description: '–°–ª–µ–≥–∫–∞ —Å–æ–ª—ë–Ω—ã–π, –ø–æ–¥—Ö–æ–¥–∏—Ç –∫–æ –≤—Å–µ–º—É. –°—Ä–æ–∫ —Ö—Ä–∞–Ω–µ–Ω–∏—è: 7 —Å—É—Ç–æ–∫.',
        img: DEFAULT_IMG,
        pieceWeightGrams: 200
      },
      {
        id: 'kosichka-smoked',
        name: '–°—ã—Ä –∫–æ—Å–∏—á–∫–∞ –∫–æ–ø—á—ë–Ω–∞—è',
        group: 'brined',
        pricePerKg: 2000,
        ico: 'üí®',
        description: '–•–æ–ª–æ–¥–Ω–æ–µ –∫–æ–ø—á–µ–Ω–∏–µ, –ª—ë–≥–∫–∞—è —Å–æ–ª—ë–Ω–æ—Å—Ç—å. –°—Ä–æ–∫ —Ö—Ä–∞–Ω–µ–Ω–∏—è: 30 —Å—É—Ç–æ–∫.',
        img: 'https://raw.githubusercontent.com/youmyloving/syr/main/kosichka-smoked.webp',
        pieceWeightGrams: 200
      },
      {
        id: 'spicy-klubok',
        name: '–ü—Ä—è–Ω—ã–µ –∫–ª—É–±–æ—á–∫–∏',
        group: 'brined',
        pricePerKg: 1950,
        ico: 'üå∂Ô∏è',
        description: '–ù–µ—Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π –≤–∫—É—Å–Ω—ã–π —Å—ã—Ä, –Ω–µ —Å–∏–ª—å–Ω–æ —Å–æ–ª—ë–Ω—ã–π. –°—Ä–æ–∫ —Ö—Ä–∞–Ω–µ–Ω–∏—è: 7 —Å—É—Ç–æ–∫.',
        img: 'https://static.tildacdn.com/tild3463-6166-4665-a439-323264653939/spicy-klubok.webp',
        pieceWeightGrams: 150
      },

      // –ú—è–≥–∫–∏–µ —Å—ã—Ä—ã
      {
        id: 'ricotta',
        name: '–¢–≤–æ—Ä–æ–∂–Ω—ã–π —Å—ã—Ä (—Ä–∏–∫–æ—Ç—Ç–∞)',
        group: 'soft',
        pricePerKg: 1400,
        ico: 'ü•õ',
        description: '–ù–µ–∂–Ω—ã–π —Å—ã—Ä, –ø–æ–¥—Ö–æ–¥–∏—Ç –∏ –∫ –±—É—Ç–µ—Ä–±—Ä–æ–¥–∞–º, –∏ –∫ –±–ª—é–¥–∞–º. –°—Ä–æ–∫ —Ö—Ä–∞–Ω–µ–Ω–∏—è: 7 —Å—É—Ç–æ–∫.',
        img: 'https://raw.githubusercontent.com/youmyloving/syr/main/ricotta.webp'
      },
      {
        id: 'ricotta-herbs',
        name: '–¢–≤–æ—Ä–æ–∂–Ω—ã–π —Å—ã—Ä —Å –∑–µ–ª–µ–Ω—å—é (—Ä–∏–∫–æ—Ç—Ç–∞)',
        group: 'soft',
        pricePerKg: 1500,
        ico: 'üåø',
        description: '–ù–µ–∂–Ω—ã–π, —Å–≤–µ–∂–∏–π, —É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–π. –°—Ä–æ–∫ —Ö—Ä–∞–Ω–µ–Ω–∏—è: 7 —Å—É—Ç–æ–∫.',
        img: 'https://raw.githubusercontent.com/youmyloving/syr/main/ricotta-herbs.webp'
      },
      {
        id: 'caciotta',
        name: '–ö–∞—á–æ—Ç—Ç–∞',
        group: 'soft',
        pricePerKg: 2200,
        ico: 'üßÄ',
        description: '–ú—è–≥–∫–∏–π –∏—Ç–∞–ª—å—è–Ω—Å–∫–∏–π —Å—ã—Ä. –°—Ä–æ–∫ —Ö—Ä–∞–Ω–µ–Ω–∏—è: 7 —Å—É—Ç–æ–∫.',
        img: 'https://static.tildacdn.com/tild6165-3265-4834-a236-366661346562/caciotta.webp'
      },
      {
        id: 'caciotta-fenugreek',
        name: '–ö–∞—á–æ—Ç—Ç–∞ —Å –ø–∞–∂–∏—Ç–Ω–∏–∫–æ–º',
        group: 'soft',
        pricePerKg: 2250,
        ico: 'üåø',
        description: '–° –æ—Ä–µ—Ö–æ–≤—ã–º –ø—Ä–∏–≤–∫—É—Å–æ–º –ø–∞–∂–∏—Ç–Ω–∏–∫–∞. –°—Ä–æ–∫ —Ö—Ä–∞–Ω–µ–Ω–∏—è: 7 —Å—É—Ç–æ–∫.',
        img: DEFAULT_IMG
      },
      {
        id: 'panir-classic',
        name: '–ê–¥—ã–≥–µ–π—Å–∫–∏–π —Å—ã—Ä (–ø–∞–Ω–∏—Ä) –∫–ª–∞—Å—Å–∏—á–µ—Å–∫–∏–π',
        group: 'soft',
        pricePerKg: 1450,
        ico: 'üßÄ',
        description: '–û—á–µ–Ω—å –Ω–µ–∂–Ω—ã–π, –º—è–≥–∫–∏–π, –º–æ–ª–æ—á–Ω—ã–π –≤–∫—É—Å. –°—Ä–æ–∫ —Ö—Ä–∞–Ω–µ–Ω–∏—è: 7 —Å—É—Ç–æ–∫.',
        img: 'https://raw.githubusercontent.com/youmyloving/syr/main/panir-classic.webp'
      },
      {
        id: 'panir-herbs',
        name: '–ê–¥—ã–≥–µ–π—Å–∫–∏–π —Å—ã—Ä (–ø–∞–Ω–∏—Ä) —Å –∑–µ–ª–µ–Ω—å—é',
        group: 'soft',
        pricePerKg: 1600,
        ico: 'üåø',
        description: '–õ—ë–≥–∫–∏–π, —Å–≤–µ–∂–∏–π, –±—É–¥—Ç–æ –≥–ª–æ—Ç–æ–∫ –ø—Ä–æ—Ö–ª–∞–¥–Ω–æ–π –≤–æ–¥—ã –≤ –∂–∞—Ä—É. –°—Ä–æ–∫ —Ö—Ä–∞–Ω–µ–Ω–∏—è: 7 —Å—É—Ç–æ–∫.',
        img: 'https://raw.githubusercontent.com/youmyloving/syr/main/panir-herbs.webp'
      },
      {
        id: 'panir-spicy',
        name: '–ê–¥—ã–≥–µ–π—Å–∫–∏–π —Å—ã—Ä (–ø–∞–Ω–∏—Ä) —Å–æ —Å–ø–µ—Ü–∏—è–º–∏',
        group: 'soft',
        pricePerKg: 1650,
        ico: 'üå∂Ô∏è',
        description: '–í–∫—É—Å –Ω–µ –æ—Å—Ç—Ä—ã–π –∏ –Ω–µ –ø–µ—Ä—á—ë–Ω—ã–π. –û—á–µ–Ω—å –Ω–µ–∂–Ω—ã–π, –∞—Ä–æ–º–∞—Ç–Ω—ã–π. –°—Ä–æ–∫ —Ö—Ä–∞–Ω–µ–Ω–∏—è: 7 —Å—É—Ç–æ–∫.',
        img: 'https://raw.githubusercontent.com/youmyloving/syr/main/panir-spicy.webp'
      },
      {
        id: 'panir-smoked',
        name: '–ê–¥—ã–≥–µ–π—Å–∫–∏–π –∫–æ–ø—á—ë–Ω—ã–π (–ø–∞–Ω–∏—Ä)',
        group: 'soft',
        pricePerKg: 1700,
        ico: 'üí®',
        description: '–ü—Ä–∏—è—Ç–Ω—ã–π –∞—Ä–æ–º–∞—Ç –∫–æ–ø—á—ë–Ω–æ—Å—Ç–∏, –≤–∫—É—Å –≥–∞—Ä–º–æ–Ω–∏—á–Ω—ã–π. –°—Ä–æ–∫ —Ö—Ä–∞–Ω–µ–Ω–∏—è: 30 —Å—É—Ç–æ–∫.',
        img: 'https://raw.githubusercontent.com/youmyloving/syr/main/panir-smoked.webp'
      },

      // –¢–≤—ë—Ä–¥—ã–µ —Å—ã—Ä—ã
      {
        id: 'hard-village',
        name: '–¢–≤—ë—Ä–¥—ã–π –¥–µ—Ä–µ–≤–µ–Ω—Å–∫–∏–π —Å—ã—Ä',
        group: 'hard',
        pricePerKg: 1600,
        ico: 'üßÄ',
        description: '–ì–æ—Ç–æ–≤–∏—Ç—Å—è –∏–∑ —Ç–≤–æ—Ä–æ–≥–∞ —Å –ø—Ä–∏–ø—Ä–∞–≤–∞–º–∏, –∫–æ—Ç–æ—Ä—ã–π –æ–±–∂–∞—Ä–∏–≤–∞–µ—Ç—Å—è. –°—Ä–æ–∫ —Ö—Ä–∞–Ω–µ–Ω–∏—è: 7 —Å—É—Ç–æ–∫.',
        img: 'https://raw.githubusercontent.com/youmyloving/syr/main/hard-village.webp'
      },
      {
        id: 'hard-smoked',
        name: '–¢–≤—ë—Ä–¥—ã–π –∫–æ–ø—á—ë–Ω—ã–π —Å—ã—Ä',
        group: 'hard',
        pricePerKg: 1800,
        ico: 'üí®',
        description: '–ì–æ—Ç–æ–≤–∏—Ç—Å—è –∏–∑ —Ç–≤–æ—Ä–æ–≥–∞ —Å –ø—Ä–∏–ø—Ä–∞–≤–∞–º–∏, –æ–±–∂–∞—Ä–∏–≤–∞–µ—Ç—Å—è, –∑–∞—Ç–µ–º –∫–æ–ø—Ç–∏—Ç—Å—è. –°—Ä–æ–∫ —Ö—Ä–∞–Ω–µ–Ω–∏—è: –¥–æ 30 —Å—É—Ç–æ–∫.',
        img: 'https://static.tildacdn.com/tild6662-3930-4663-b132-316135626136/hard-smoked.webp'
      },

      // –°—ã—Ä–Ω—ã–µ —Ä—É–ª–µ—Ç—ã
      {
        id: 'rolls-olives-walnut',
        name: '–°—ã—Ä–Ω—ã–π —Ä—É–ª–µ—Ç —Å –º–∞—Å–ª–∏–Ω–∞–º–∏ –∏ –≥—Ä–µ—Ü–∫–∏–º –æ—Ä–µ—Ö–æ–º',
        group: 'rolls',
        pricePerKg: 1700,
        ico: 'ü•ú',
        description: '–ú–æ–∂–Ω–æ –ø–æ–¥–∞—Ç—å –∫–∞–∫ –∑–∞–∫—É—Å–∫—É –∫ –ª—é–±–æ–º—É —Å—Ç–æ–ª—É. –°—Ä–æ–∫ —Ö—Ä–∞–Ω–µ–Ω–∏—è: 7 —Å—É—Ç–æ–∫.',
        img: 'https://raw.githubusercontent.com/youmyloving/syr/main/rolls-olives-walnut.webp'
      },
      {
        id: 'rolls-apricot-cedar',
        name: '–°—ã—Ä–Ω—ã–π —Ä—É–ª–µ—Ç —Å –∫—É—Ä–∞–≥–æ–π –∏ –∫–µ–¥—Ä–æ–≤—ã–º –æ—Ä–µ—Ö–æ–º',
        group: 'rolls',
        pricePerKg: 1700,
        ico: 'üçë',
        description: '–°–ª–µ–≥–∫–∞ —Å–ª–∞–¥–∫–æ–≤–∞—Ç—ã–π –±–ª–∞–≥–æ–¥–∞—Ä—è —Ç–≤–æ—Ä–æ–∂–Ω–æ–º—É —Å—ã—Ä—É. –°—Ä–æ–∫ —Ö—Ä–∞–Ω–µ–Ω–∏—è: 7 —Å—É—Ç–æ–∫.',
        img: 'https://raw.githubusercontent.com/youmyloving/syr/main/rolls-apricot-cedar.webp'
      },

      // –ú–æ–ª–æ—á–Ω–∞—è –ø—Ä–æ–¥—É–∫—Ü–∏—è
      {
        id: 'milk',
        name: '–ú–æ–ª–æ–∫–æ',
        group: 'dairy',
        pricePerL: 150,
        ico: 'ü•õ',
        description: '–ú–æ–ª–æ–∫–æ –æ—Ç–±–æ—Ä–Ω–æ–µ —Ü–µ–ª—å–Ω–æ–µ, –æ—Ö–ª–∞–∂–¥—ë–Ω–Ω–æ–µ. –°—Ä–æ–∫ —Ö—Ä–∞–Ω–µ–Ω–∏—è: 3‚Äì5 —Å—É—Ç–æ–∫.',
        img: DEFAULT_IMG
      },
      {
        id: 'milk-topped',
        name: '–ú–æ–ª–æ–∫–æ —Ç–æ–ø–ª—ë–Ω–æ–µ',
        group: 'dairy',
        pricePerL: 250,
        ico: 'ü•õ',
        description: '–ù–∞—Å—Ç–æ—è—â–µ–µ —Ü–µ–ª—å–Ω–æ–µ —Ç–æ–ø–ª—ë–Ω–æ–µ –º–æ–ª–æ–∫–æ. –°—Ä–æ–∫ —Ö—Ä–∞–Ω–µ–Ω–∏—è: 5‚Äì7 —Å—É—Ç–æ–∫.',
        img: 'https://static.tildacdn.com/tild3839-3163-4066-a633-306366346631/milk-topped.webp'
      },
      {
        id: 'yogurt',
        name: '–ô–æ–≥—É—Ä—Ç',
        group: 'dairy',
        pricePerL: 260,
        ico: 'ü•õ',
        description: '–°–∞–º—ã–π –Ω–∞—Å—Ç–æ—è—â–∏–π –π–æ–≥—É—Ä—Ç –∏–∑ –æ—Ç–±–æ—Ä–Ω–æ–≥–æ –º–æ–ª–æ–∫–∞. –°—Ä–æ–∫ —Ö—Ä–∞–Ω–µ–Ω–∏—è: 5 —Å—É—Ç–æ–∫.',
        img: DEFAULT_IMG
      },
      {
        id: 'ryazhenka',
        name: '–†—è–∂–µ–Ω–∫–∞',
        group: 'dairy',
        pricePerL: 280,
        ico: 'ü•õ',
        description: '–ù–∞—Ç—É—Ä–∞–ª—å–Ω–∞—è —Ä—è–∂–µ–Ω–∫–∞ –∏–∑ –º–æ–ª–æ–∫–∞. –°—Ä–æ–∫ —Ö—Ä–∞–Ω–µ–Ω–∏—è: –¥–æ 5 —Å—É—Ç–æ–∫.',
        img: DEFAULT_IMG
      },
      {
        id: 'misti-dahi',
        name: '–ú–∏—Å—Ç—Ö–∏-–î–∞—Ö–∏',
        group: 'dairy',
        pricePerL: 300,
        ico: 'ü•õ',
        description: '–ö–∏—Å–ª–æ–º–æ–ª–æ—á–Ω—ã–π –Ω–∞–ø–∏—Ç–æ–∫. –°—Ä–æ–∫ —Ö—Ä–∞–Ω–µ–Ω–∏—è: 5 —Å—É—Ç–æ–∫.',
        img: DEFAULT_IMG
      },
      {
        id: 'whey',
        name: '–°—ã–≤–æ—Ä–æ—Ç–∫–∞',
        group: 'dairy',
        pricePerL: 60,
        ico: 'üíß',
        description: '–ú–æ–ª–æ—á–Ω—ã–π –Ω–∏–∑–∫–æ–∫–∞–ª–æ—Ä–∏–π–Ω—ã–π –ø—Ä–æ–¥—É–∫—Ç. –°—Ä–æ–∫ —Ö—Ä–∞–Ω–µ–Ω–∏—è: 3 —Å—É—Ç–æ–∫.',
        img: DEFAULT_IMG
      },
      {
        id: 'cream',
        name: '–°–ª–∏–≤–∫–∏ (33‚Äì36%)',
        group: 'dairy',
        pricePerKg: 1450,
        ico: 'ü•õ',
        description: '–ù–∞—Ç—É—Ä–∞–ª—å–Ω—ã–µ —Å–≤–µ–∂–∏–µ —Å–ª–∏–≤–∫–∏. –°—Ä–æ–∫ —Ö—Ä–∞–Ω–µ–Ω–∏—è: 5 —Å—É—Ç–æ–∫.',
        img: 'https://static.tildacdn.com/tild3163-3665-4636-a537-303830323163/cream.webp'
      },
      {
        id: 'tvorog',
        name: '–¢–≤–æ—Ä–æ–≥',
        group: 'dairy',
        pricePerKg: 700,
        ico: 'ü•õ',
        description: '–¢–≤–æ—Ä–æ–∂–Ω—ã–π –Ω–µ–∂–Ω—ã–π –≤–∫—É—Å. –°—Ä–æ–∫ —Ö—Ä–∞–Ω–µ–Ω–∏—è: 3‚Äì5 —Å—É—Ç–æ–∫. –û—Ç–ª–∏—á–Ω–æ –ø–µ—Ä–µ–Ω–æ—Å–∏—Ç –∑–∞–º–æ—Ä–æ–∑–∫—É.',
        img: 'https://static.tildacdn.com/tild3136-3730-4134-b466-613138343764/tvorog.webp'
      },
      {
        id: 'butter',
        name: '–°–ª–∏–≤–æ—á–Ω–æ–µ –º–∞—Å–ª–æ (—à–∞—Ä–∏–∫)',
        group: 'dairy',
        pricePerKg: 2100,
        ico: 'üßà',
        description: '–ù–∞—Ç—É—Ä–∞–ª—å–Ω–æ–µ —Å–ª–∏–≤–æ—á–Ω–æ–µ –º–∞—Å–ª–æ, –∫–∞–∫ –≥–æ—Ç–æ–≤–∏–ª–∞ –±–∞–±—É—à–∫–∞. –ü—Ä–∏–±–ª–∏–∑–∏—Ç–µ–ª—å–Ω—ã–π –≤–µ—Å —à–∞—Ä–∏–∫–∞ ‚Äî 200 –≥.',
        img: 'https://raw.githubusercontent.com/youmyloving/syr/main/butter.webp',
        pieceWeightGrams: 200
      },
      {
        id: 'ghee',
        name: '–¢–æ–ø–ª—ë–Ω–æ–µ –º–∞—Å–ª–æ (–ì–•–ò)',
        group: 'dairy',
        pricePerKg: 2900,
        ico: 'üßà',
        description: '–°–æ—Å—Ç–∞–≤: —Å–ª–∏–≤–æ—á–Ω–æ–µ –º–∞—Å–ª–æ. –ñ–∏—Ä–Ω–æ—Å—Ç—å ~99%. –°—Ä–æ–∫ —Ö—Ä–∞–Ω–µ–Ω–∏—è: –±–æ–ª—å—à–µ 10 –ª–µ—Ç.',
        img: DEFAULT_IMG
      },
      {
        id: 'condensed-milk',
        name: '–í–∞—Ä—ë–Ω–∞—è —Å–≥—É—â—ë–Ω–∫–∞',
        group: 'dairy',
        pricePerKg: 1000,
        ico: 'ü•õ',
        description: '–ù–∞—Ç—É—Ä–∞–ª—å–Ω–∞—è –≤–∞—Ä—ë–Ω–∞—è —Å–≥—É—â—ë–Ω–∫–∞, –≥—É—Å—Ç–∞—è –∏ –∫–∞—Ä–∞–º–µ–ª—å–Ω–∞—è. –°—Ä–æ–∫ —Ö—Ä–∞–Ω–µ–Ω–∏—è: 7 —Å—É—Ç–æ–∫.',
        img: DEFAULT_IMG
      },
      {
        id: 'tvorozhnaya-massa',
        name: '–¢–≤–æ—Ä–æ–∂–Ω–∞—è –º–∞—Å—Å–∞',
        group: 'dairy',
        pricePerKg: 850,
        ico: 'ü•õ',
        description: '–¢–≤–æ—Ä–æ–∂–Ω–∞—è –º–∞—Å—Å–∞ —Å –∏–∑—é–º–æ–º, —Ñ–∏–Ω–∏–∫–∞–º–∏, —á–µ—Ä–Ω–æ—Å–ª–∏–≤–æ–º –∏–ª–∏ –∫—É—Ä–∞–≥–æ–π. –°—Ä–æ–∫ —Ö—Ä–∞–Ω–µ–Ω–∏—è: 5 —Å—É—Ç–æ–∫.',
        img: 'https://static.tildacdn.com/tild6630-3237-4430-b461-313634376333/tvorozhnaya-massa_.webp',
        flavors: ['–° –∏–∑—é–º–æ–º', '–° —Ñ–∏–Ω–∏–∫–∞–º–∏', '–° —á–µ—Ä–Ω–æ—Å–ª–∏–≤–æ–º', '–° –∫—É—Ä–∞–≥–æ–π']
      },

      // –°–ª–∞–¥–æ—Å—Ç–∏
      {
        id: 'sandesh-orange',
        name: '–°–∞–Ω–¥–µ—à –∞–ø–µ–ª—å—Å–∏–Ω–æ–≤—ã–π',
        group: 'sweets',
        pricePerUnit: 300,
        ico: 'üçÆ',
        description: '–ù–µ–∂–Ω—ã–π —Ç–≤–æ—Ä–æ–∂–Ω—ã–π –¥–µ—Å–µ—Ä—Ç. –°–æ—Å—Ç–∞–≤: —Ü–µ–ª—å–Ω–æ–µ –º–æ–ª–æ–∫–æ, —Ç—Ä–æ—Å—Ç–Ω–∏–∫–æ–≤—ã–π —Å–∞—Ö–∞—Ä, —Ü–µ–¥—Ä–∞ –∞–ø–µ–ª—å—Å–∏–Ω–∞. –°—Ä–æ–∫ —Ö—Ä–∞–Ω–µ–Ω–∏—è: 5 —Å—É—Ç–æ–∫.',
        img: 'https://raw.githubusercontent.com/youmyloving/syr/main/sandesh-orange.webp'
      },
      {
        id: 'sandesh-walnut',
        name: '–°–∞–Ω–¥–µ—à —Å –≥—Ä–µ—Ü–∫–∏–º –æ—Ä–µ—Ö–æ–º',
        group: 'sweets',
        pricePerUnit: 300,
        ico: 'üçÆ',
        description: '–¢–≤–æ—Ä–æ–∂–Ω—ã–π –¥–µ—Å–µ—Ä—Ç —Å –≥—Ä–µ—Ü–∫–∏–º –æ—Ä–µ—Ö–æ–º. –°–æ—Å—Ç–∞–≤: —Ü–µ–ª—å–Ω–æ–µ –º–æ–ª–æ–∫–æ, —Ç—Ä–æ—Å—Ç–Ω–∏–∫–æ–≤—ã–π —Å–∞—Ö–∞—Ä, –≥—Ä–µ—Ü–∫–∏–π –æ—Ä–µ—Ö. –°—Ä–æ–∫ —Ö—Ä–∞–Ω–µ–Ω–∏—è: 5 —Å—É—Ç–æ–∫.',
        img: 'https://raw.githubusercontent.com/youmyloving/syr/main/sandesh-walnut.webp'
      },
      {
        id: 'sandesh-carob',
        name: '–°–∞–Ω–¥–µ—à —Å –∫—ç—Ä–æ–±–æ–º',
        group: 'sweets',
        pricePerUnit: 300,
        ico: 'üçÆ',
        description: '–¢–≤–æ—Ä–æ–∂–Ω—ã–π –¥–µ—Å–µ—Ä—Ç —Å —à–æ–∫–æ–ª–∞–¥–Ω—ã–º –≤–∫—É—Å–æ–º –±–ª–∞–≥–æ–¥–∞—Ä—è –∫—ç—Ä–æ–±—É. –°—Ä–æ–∫ —Ö—Ä–∞–Ω–µ–Ω–∏—è: 5 —Å—É—Ç–æ–∫.',
        img: 'https://static.tildacdn.com/tild6135-6337-4266-b764-613565386238/_.webp'
      },
      {
        id: 'barfi-classic',
        name: '–ë—É—Ä—Ñ–∏ –∫–ª–∞—Å—Å–∏—á–µ—Å–∫–∏–π (–Ω–∞–±–æ—Ä)',
        group: 'sweets',
        pricePerUnit: 350,
        ico: 'üçÆ',
        description: '–ù–µ–∂–Ω—ã–π –º–æ–ª–æ—á–Ω—ã–π –¥–µ—Å–µ—Ä—Ç. –í –Ω–∞–±–æ—Ä–µ 5 —à—Ç.',
        img: 'https://static.tildacdn.com/tild3430-3231-4562-b164-366638313434/barfi-classic.webp'
      },
      {
        id: 'barfi-hazelnut',
        name: '–ë—É—Ä—Ñ–∏ —Å —Ñ—É–Ω–¥—É–∫–æ–º (–Ω–∞–±–æ—Ä)',
        group: 'sweets',
        pricePerUnit: 350,
        ico: 'üçÆ',
        description: '–ë—É—Ä—Ñ–∏ —Å —Ñ—É–Ω–¥—É–∫–æ–º, 5 —à—Ç –≤ –Ω–∞–±–æ—Ä–µ.',
        img: 'https://static.tildacdn.com/tild3065-3332-4466-a536-353130343264/barfi-hazelnut.webp'
      },
      {
        id: 'barfi-sesame',
        name: '–ë—É—Ä—Ñ–∏ –∫—É–Ω–∂—É—Ç–Ω—ã–π (–Ω–∞–±–æ—Ä)',
        group: 'sweets',
        pricePerUnit: 490,
        ico: 'üçÆ',
        description: '–ë—É—Ä—Ñ–∏ —Å –∫—É–Ω–∂—É—Ç–æ–º, 7 —à—Ç –≤ –Ω–∞–±–æ—Ä–µ.',
        img: 'https://static.tildacdn.com/tild3439-6135-4861-a531-316233303166/_.webp'
      },
      {
        id: 'halva',
        name: '–•–∞–ª–≤–∞',
        group: 'sweets',
        pricePerUnit: 200,
        ico: 'üçØ',
        description: '–°–∞–º–∞—è –Ω–∞—Å—Ç–æ—è—â–∞—è —Ö–∞–ª–≤–∞. –°–æ—Å—Ç–∞–≤: —Ç—Ä–æ—Å—Ç–Ω–∏–∫–æ–≤—ã–π —Å–∞—Ö–∞—Ä, –≤–æ–¥–∞, —Å–µ–º–µ–Ω–∞ –ø–æ–¥—Å–æ–ª–Ω–µ—á–Ω–∏–∫–∞, —Å–ª–∏–≤–æ—á–Ω–æ–µ –º–∞—Å–ª–æ. –°—Ä–æ–∫ —Ö—Ä–∞–Ω–µ–Ω–∏—è: 14 –¥–Ω–µ–π.',
        img: 'https://static.tildacdn.com/tild3566-6566-4464-b531-306364646164/photo.webp'
      },
      {
        id: 'potato-cake-5',
        name: '–ü–∏—Ä–æ–∂–Ω–æ–µ ¬´–ö–∞—Ä—Ç–æ—à–∫–∞¬ª (5 —à—Ç)',
        group: 'sweets',
        pricePerUnit: 400,
        ico: 'üç∞',
        description: '–î–æ–º–∞—à–Ω–∏–µ –ø–∏—Ä–æ–∂–Ω—ã–µ ¬´–ö–∞—Ä—Ç–æ—à–∫–∞¬ª –∏–∑ —Ü–µ–ª—å–Ω–æ–∑–µ—Ä–Ω–æ–≤–æ–π –º—É–∫–∏. –í –∫–æ—Ä–æ–±–∫–µ 5 —à—Ç.',
        img: 'https://static.tildacdn.com/tild3961-6133-4632-b162-396333663962/potato-cake-2.webp'
      },
      {
        id: 'potato-cake-2',
        name: '–ü–∏—Ä–æ–∂–Ω–æ–µ ¬´–ö–∞—Ä—Ç–æ—à–∫–∞¬ª (2 —à—Ç)',
        group: 'sweets',
        pricePerUnit: 190,
        ico: 'üç∞',
        description: '–î–æ–º–∞—à–Ω–∏–µ –ø–∏—Ä–æ–∂–Ω—ã–µ ¬´–ö–∞—Ä—Ç–æ—à–∫–∞¬ª (2 —à—Ç).',
        img: 'https://static.tildacdn.com/tild3961-6133-4632-b162-396333663962/potato-cake-2.webp'
      },

      // –í—ã–ø–µ—á–∫–∞
      {
        id: 'cookies-tvorog',
        name: '–ü–µ—á–µ–Ω—å–µ —Ç–≤–æ—Ä–æ–∂–Ω–æ–µ',
        group: 'bakery',
        pricePerKg: 600,
        ico: 'üç™',
        description: '–ú—è–≥–∫–æ–µ –¥–æ–º–∞—à–Ω–µ–µ –ø–µ—á–µ–Ω—å–µ –Ω–∞ —Ç–≤–æ—Ä–æ–≥–µ.',
        img: DEFAULT_IMG
      },
      {
        id: 'cookies-oat',
        name: '–ü–µ—á–µ–Ω—å–µ –æ–≤—Å—è–Ω–æ–µ',
        group: 'bakery',
        pricePerKg: 600,
        ico: 'üç™',
        description: '–û–≤—Å—è–Ω–æ–µ –ø–µ—á–µ–Ω—å–µ –∫ —á–∞—é.',
        img: DEFAULT_IMG
      },
      {
        id: 'cookies-nut',
        name: '–û—Ä–µ—Ö–æ–≤—ã–µ –ø–∞–ª—å—á–∏–∫–∏',
        group: 'bakery',
        pricePerKg: 700,
        ico: 'üç™',
        description: '–ü–µ—á–µ–Ω—å–µ —Å –æ—Ä–µ—Ö–∞–º–∏ ‚Äî —Ö—Ä—É—Å—Ç—è—â–∏–µ –ø–∞–ª—å—á–∏–∫–∏.',
        img: 'https://static.tildacdn.com/tild3035-6230-4434-b363-303434366630/cookies-nut.webp'
      },
      {
        id: 'cookies-carob',
        name: '–ü–µ—á–µ–Ω—å–µ –∫—ç—Ä–æ–±–æ–≤–æ–µ',
        group: 'bakery',
        pricePerKg: 600,
        ico: 'üç™',
        description: '–ü–µ—á–µ–Ω—å–µ —Å –∫—ç—Ä–æ–±–æ–º –≤–º–µ—Å—Ç–æ –∫–∞–∫–∞–æ.',
        img: DEFAULT_IMG
      },
      {
        id: 'cookies-sandy',
        name: '–ü–µ—á–µ–Ω—å–µ –ø–µ—Å–æ—á–Ω–æ–µ',
        group: 'bakery',
        pricePerKg: 600,
        ico: 'üç™',
        description: '–†–∞—Å—Å—ã–ø—á–∞—Ç–æ–µ –ø–µ—Å–æ—á–Ω–æ–µ –ø–µ—á–µ–Ω—å–µ.',
        img: DEFAULT_IMG
      },
      {
        id: 'muffin-plain',
        name: '–ö–µ–∫—Å—ã –æ–±—ã—á–Ω—ã–µ',
        group: 'bakery',
        pricePerKg: 500,
        ico: 'üßÅ',
        description: '–î–æ–º–∞—à–Ω–∏–µ –∫–µ–∫—Å—ã.',
        img: DEFAULT_IMG
      },
      {
        id: 'muffin-carob',
        name: '–ö–µ–∫—Å—ã —Å –∫—ç—Ä–æ–±–æ–º',
        group: 'bakery',
        pricePerKg: 550,
        ico: 'üßÅ',
        description: '–ö–µ–∫—Å—ã —Å –∫—ç—Ä–æ–±–æ–º.',
        img: DEFAULT_IMG
      },
      {
        id: 'muffin-raisin',
        name: '–ö–µ–∫—Å—ã —Å –∏–∑—é–º–æ–º',
        group: 'bakery',
        pricePerKg: 550,
        ico: 'üßÅ',
        description: '–ö–µ–∫—Å—ã —Å –∏–∑—é–º–æ–º.',
        img: 'https://static.tildacdn.com/tild3465-3162-4436-a235-363763383339/muffin-raisin.webp'
      },
      {
        id: 'casserole-plain',
        name: '–¢–≤–æ—Ä–æ–∂–Ω–∞—è –∑–∞–ø–µ–∫–∞–Ω–∫–∞',
        group: 'bakery',
        pricePerUnit: 260,
        ico: 'üçÆ',
        description: '–î–æ–º–∞—à–Ω—è—è —Ç–≤–æ—Ä–æ–∂–Ω–∞—è –∑–∞–ø–µ–∫–∞–Ω–∫–∞ –±–µ–∑ –¥–æ–±–∞–≤–æ–∫.',
        img: DEFAULT_IMG
      },
      {
        id: 'casserole-raisin',
        name: '–¢–≤–æ—Ä–æ–∂–Ω–∞—è –∑–∞–ø–µ–∫–∞–Ω–∫–∞ —Å –∏–∑—é–º–æ–º',
        group: 'bakery',
        pricePerUnit: 260,
        ico: 'üçÆ',
        description: '–ó–∞–ø–µ–∫–∞–Ω–∫–∞ —Å –∏–∑—é–º–æ–º.',
        img: DEFAULT_IMG
      },
      {
        id: 'crazy-cake',
        name: '–°—É–º–∞—Å—à–µ–¥—à–∏–π –ø–∏—Ä–æ–≥',
        group: 'bakery',
        pricePerUnit: 600,
        ico: 'üç∞',
        description: '–î–æ–º–∞—à–Ω–∏–π –ø–∏—Ä–æ–≥ –∫ —á–∞—é.',
        img: DEFAULT_IMG
      },
      {
        id: 'coconut-kuchen-1kg',
        name: '–ö–æ–∫–æ—Å–æ–≤—ã–π –ø–∏—Ä–æ–≥ 1 –∫–≥',
        group: 'bakery',
        pricePerUnit: 1800,
        ico: 'üç∞',
        description: '–ö–æ–∫–æ—Å–æ–≤—ã–π –ø–∏—Ä–æ–≥ (—Ñ–æ—Ä–º–∞ ~1 –∫–≥).',
        img: DEFAULT_IMG
      },
      {
        id: 'coconut-kuchen-05kg',
        name: '–ö–æ–∫–æ—Å–æ–≤—ã–π –ø–∏—Ä–æ–≥ 0.5 –∫–≥',
        group: 'bakery',
        pricePerUnit: 1000,
        ico: 'üç∞',
        description: '–ö–æ–∫–æ—Å–æ–≤—ã–π –ø–∏—Ä–æ–≥ (—Ñ–æ—Ä–º–∞ ~0.5 –∫–≥).',
        img: DEFAULT_IMG
      },
      {
        id: 'napoleon-1kg',
        name: '–¢–æ—Ä—Ç ¬´–ù–∞–ø–æ–ª–µ–æ–Ω¬ª 1 –∫–≥',
        group: 'bakery',
        pricePerUnit: 1300,
        ico: 'üç∞',
        description: '–ö–ª–∞—Å—Å–∏—á–µ—Å–∫–∏–π –ù–∞–ø–æ–ª–µ–æ–Ω (–æ–∫–æ–ª–æ 1 –∫–≥).',
        img: DEFAULT_IMG
      },
      {
        id: 'napoleon-05kg',
        name: '–¢–æ—Ä—Ç ¬´–ù–∞–ø–æ–ª–µ–æ–Ω¬ª 0.5 –∫–≥',
        group: 'bakery',
        pricePerUnit: 750,
        ico: 'üç∞',
        description: '–ö–ª–∞—Å—Å–∏—á–µ—Å–∫–∏–π –ù–∞–ø–æ–ª–µ–æ–Ω (–æ–∫–æ–ª–æ 0.5 –∫–≥).',
        img: DEFAULT_IMG
      },
      {
        id: 'apple-pie',
        name: '–Ø–±–ª–æ—á–Ω—ã–π –ø–∏—Ä–æ–≥',
        group: 'bakery',
        pricePerUnit: 560,
        ico: 'ü•ß',
        description: '–î–æ–º–∞—à–Ω–∏–π —è–±–ª–æ—á–Ω—ã–π –ø–∏—Ä–æ–≥.',
        img: DEFAULT_IMG
      },
      {
        id: 'bliny-10',
        name: '–ë–ª–∏–Ω—ã (10 —à—Ç)',
        group: 'bakery',
        pricePerUnit: 330,
        ico: 'ü•û',
        description: '–¢–æ–Ω–∫–∏–µ –±–ª–∏–Ω—á–∏–∫–∏, 10 —à—Ç.',
        img: DEFAULT_IMG
      },
      {
        id: 'bliny-5',
        name: '–ë–ª–∏–Ω—ã (5 —à—Ç)',
        group: 'bakery',
        pricePerUnit: 220,
        ico: 'ü•û',
        description: '–¢–æ–Ω–∫–∏–µ –±–ª–∏–Ω—á–∏–∫–∏, 5 —à—Ç.',
        img: DEFAULT_IMG
      },
      {
        id: 'bliny-tvorog-5',
        name: '–ë–ª–∏–Ω—ã —Å —Ç–≤–æ—Ä–æ–≥–æ–º/–∏–∑—é–º–æ–º (5 —à—Ç)',
        group: 'bakery',
        pricePerUnit: 300,
        ico: 'ü•û',
        description: '–ë–ª–∏–Ω—ã —Å –Ω–∞—á–∏–Ω–∫–æ–π –∏–∑ —Ç–≤–æ—Ä–æ–≥–∞ –∏–ª–∏ —Ç–≤–æ—Ä–æ–≥–∞ —Å –∏–∑—é–º–æ–º.',
        img: DEFAULT_IMG
      },
      {
        id: 'syrniki-10',
        name: '–°—ã—Ä–Ω–∏–∫–∏ (10 —à—Ç)',
        group: 'bakery',
        pricePerUnit: 520,
        ico: 'ü•û',
        description: '–î–æ–º–∞—à–Ω–∏–µ —Å—ã—Ä–Ω–∏–∫–∏, 10 —à—Ç.',
        img: DEFAULT_IMG
      },
      {
        id: 'syrniki-5',
        name: '–°—ã—Ä–Ω–∏–∫–∏ (5 —à—Ç)',
        group: 'bakery',
        pricePerUnit: 280,
        ico: 'ü•û',
        description: '–î–æ–º–∞—à–Ω–∏–µ —Å—ã—Ä–Ω–∏–∫–∏, 5 —à—Ç.',
        img: DEFAULT_IMG
      },
      {
        id: 'chapati-10',
        name: '–ß–∞–ø–∞—Ç–∏ (10 —à—Ç)',
        group: 'bakery',
        pricePerUnit: 270,
        ico: 'ü´ì',
        description: '–°–æ—Å—Ç–∞–≤: –º—É–∫–∞ –ø—à–µ–Ω–∏—á–Ω–∞—è –≤—ã—Å—à–µ–≥–æ —Å–æ—Ä—Ç–∞, —Ä–∂–∞–Ω–∞—è –º—É–∫–∞, –≤–æ–¥–∞, —Å–æ–ª—å, —Å–ª–∏–≤–æ—á–Ω–æ–µ –º–∞—Å–ª–æ. –°—Ä–æ–∫ —Ö—Ä–∞–Ω–µ–Ω–∏—è: 2 —Å—É—Ç–æ–∫.',
        img: 'https://static.tildacdn.com/tild6332-6239-4538-b839-356132356236/chapati-10.webp'
      },
      {
        id: 'chapati-wholewheat-10',
        name: '–ß–∞–ø–∞—Ç–∏ —Ü–µ–ª—å–Ω–æ–∑–µ—Ä–Ω–æ–≤—ã–µ (10 —à—Ç)',
        group: 'bakery',
        pricePerUnit: 320,
        ico: 'ü´ì',
        description: '–ß–∞–ø–∞—Ç–∏ –∏–∑ —Ü–µ–ª—å–Ω–æ–∑–µ—Ä–Ω–æ–≤–æ–π –º—É–∫–∏.',
        img: DEFAULT_IMG
      }
    ];

    // Variant Rules
    const VARIANT_RULES = {
      'mozzarella': { type: 'fixed', options: ['1 —à—Ç (‚âà200 –≥)'], defaultWeight: 200 },
      'buratta': { type: 'fixed', options: ['1 —à—Ç (‚âà250 –≥)'], defaultWeight: 250 },
      'halloumi': { type: 'fixed', options: ['1 —à—Ç (‚âà225 –≥)'], defaultWeight: 225 },
      'halloumi-paprika-oregano': { type: 'fixed', options: ['1 —à—Ç (‚âà225 –≥)'], defaultWeight: 225 },
      'halloumi-tomato-basil-garlic': { type: 'fixed', options: ['1 —à—Ç (‚âà225 –≥)'], defaultWeight: 225 },
      'halloumi-tomato-paprika': { type: 'fixed', options: ['1 —à—Ç (‚âà225 –≥)'], defaultWeight: 225 },
      'kosichka': { type: 'fixed', options: ['1 —à—Ç (‚âà200 –≥)'], defaultWeight: 200 },
      'kosichka-smoked': { type: 'fixed', options: ['1 —à—Ç (‚âà200 –≥)'], defaultWeight: 200 },
      'spicy-klubok': { type: 'fixed', options: ['1 —à—Ç (‚âà150 –≥)'], defaultWeight: 150 },
      
      'milk': { type: 'fixed', options: ['0.5 –ª', '1 –ª'], isLiquid: true },
      'milk-topped': { type: 'fixed', options: ['0.5 –ª', '1 –ª'], isLiquid: true },
      'yogurt': { type: 'fixed', options: ['0.5 –ª', '1 –ª'], isLiquid: true },
      'ryazhenka': { type: 'fixed', options: ['0.5 –ª', '1 –ª'], isLiquid: true },
      'misti-dahi': { type: 'fixed', options: ['0.5 –ª', '1 –ª'], isLiquid: true },
      'whey': { type: 'fixed', options: ['1 –ª'], isLiquid: true },
      'cream': { type: 'weight', unit: '–≥', step: 100, min: 200, max: 2000 }, // –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ: —Å–ª–∏–≤–∫–∏ –ø–æ 100–≥ –æ—Ç 200–≥
      'tvorog': { type: 'weight', unit: '–≥', step: 250, min: 250, max: 2000 },
      'tvorozhnaya-massa': { type: 'weight', unit: '–≥', step: 100, min: 200, max: 2000 },
      'condensed-milk': { type: 'weight', unit: '–≥', step: 100, min: 200, max: 2000 },
      
      'butter': { type: 'fixed', options: ['1 —à—Ç (‚âà200 –≥)'], defaultWeight: 200 },
      'ghee': { type: 'fixed', options: ['200 –≥', '500 –≥', '1000 –≥'] },
      
      'sandesh-orange': { type: 'fixed', options: ['1 –Ω–∞–±–æ—Ä (5 —à—Ç)'] },
      'sandesh-walnut': { type: 'fixed', options: ['1 –Ω–∞–±–æ—Ä (5 —à—Ç)'] },
      'sandesh-carob': { type: 'fixed', options: ['1 –Ω–∞–±–æ—Ä (5 —à—Ç)'] },
      'barfi-classic': { type: 'fixed', options: ['1 –Ω–∞–±–æ—Ä (5 —à—Ç)'] },
      'barfi-hazelnut': { type: 'fixed', options: ['1 –Ω–∞–±–æ—Ä (5 —à—Ç)'] },
      'barfi-sesame': { type: 'fixed', options: ['1 –Ω–∞–±–æ—Ä (7 —à—Ç)'] },
      'halva': { type: 'fixed', options: ['200 –≥'] },
      'potato-cake-5': { type: 'fixed', options: ['5 —à—Ç'] },
      'potato-cake-2': { type: 'fixed', options: ['2 —à—Ç'] },
      
      'cookies-tvorog': { type: 'weight', unit: '–≥', step: 50, min: 200, max: 2000 },
      'cookies-oat': { type: 'weight', unit: '–≥', step: 50, min: 200, max: 2000 },
      'cookies-nut': { type: 'weight', unit: '–≥', step: 50, min: 200, max: 2000 },
      'cookies-carob': { type: 'weight', unit: '–≥', step: 50, min: 200, max: 2000 },
      'cookies-sandy': { type: 'weight', unit: '–≥', step: 50, min: 200, max: 2000 },
      
      'muffin-plain': { type: 'weight', unit: '–≥', step: 50, min: 200, max: 2000 },
      'muffin-carob': { type: 'weight', unit: '–≥', step: 50, min: 200, max: 2000 },
      'muffin-raisin': { type: 'weight', unit: '–≥', step: 50, min: 200, max: 2000 },
      
      'casserole-plain': { type: 'fixed', options: ['1 —à—Ç'] },
      'casserole-raisin': { type: 'fixed', options: ['1 —à—Ç'] },
      'crazy-cake': { type: 'fixed', options: ['1 —à—Ç'] },
      'coconut-kuchen-1kg': { type: 'fixed', options: ['1 —Ç–æ—Ä—Ç (1 –∫–≥)'] },
      'coconut-kuchen-05kg': { type: 'fixed', options: ['1 —Ç–æ—Ä—Ç (0.5 –∫–≥)'] },
      'napoleon-1kg': { type: 'fixed', options: ['1 —Ç–æ—Ä—Ç (1 –∫–≥)'] },
      'napoleon-05kg': { type: 'fixed', options: ['1 —Ç–æ—Ä—Ç (0.5 –∫–≥)'] },
      'apple-pie': { type: 'fixed', options: ['1 –ø–∏—Ä–æ–≥'] },
      
      'bliny-10': { type: 'fixed', options: ['10 —à—Ç'] },
      'bliny-5': { type: 'fixed', options: ['5 —à—Ç'] },
      'bliny-tvorog-5': { type: 'fixed', options: ['5 —à—Ç'] },
      'syrniki-10': { type: 'fixed', options: ['10 —à—Ç'] },
      'syrniki-5': { type: 'fixed', options: ['5 —à—Ç'] },
      'chapati-10': { type: 'fixed', options: ['10 —à—Ç'] },
      'chapati-wholewheat-10': { type: 'fixed', options: ['10 —à—Ç'] }
    };

    // ===== State =====
    let cart = [];
    let favorites = new Set();
    let currentProduct = null;
    let currentQty = 1;
    let currentVariant = null;
    let checkoutState = { phone: '', address: '', comment: '', promo: '', city: '–ü–µ–Ω–∑–∞' };
    let currentFilter = 'all';

    // ===== Initialization =====
    document.addEventListener('DOMContentLoaded', init);

    function init() {
      loadState();
      setupTelegram();
      setupEventListeners();
      renderUserProfile();
      renderCategories();
      filterAndRender();
      updateCartUI();
    }

    function loadState() {
      try {
        const savedCart = localStorage.getItem(STORAGE_CART_KEY);
        if (savedCart) cart = JSON.parse(savedCart);
      } catch (e) { console.error('Error loading cart:', e); }
      
      try {
        const savedFav = localStorage.getItem(STORAGE_FAV_KEY);
        if (savedFav) favorites = new Set(JSON.parse(savedFav));
      } catch (e) { console.error('Error loading favorites:', e); }
      
      try {
        const savedCheckout = localStorage.getItem(STORAGE_CHECKOUT_KEY);
        if (savedCheckout) checkoutState = { ...checkoutState, ...JSON.parse(savedCheckout) };
      } catch (e) { console.error('Error loading checkout:', e); }
    }

    function saveState() {
      try {
        localStorage.setItem(STORAGE_CART_KEY, JSON.stringify(cart));
        localStorage.setItem(STORAGE_FAV_KEY, JSON.stringify([...favorites]));
        localStorage.setItem(STORAGE_CHECKOUT_KEY, JSON.stringify(checkoutState));
      } catch (e) { console.error('Error saving state:', e); }
    }

    function setupTelegram() {
      if (window.Telegram?.WebApp) {
        const tg = window.Telegram.WebApp;
        tg.ready();
        tg.expand();
        
        tg.MainButton.setText('–û—Ñ–æ—Ä–º–∏—Ç—å –∑–∞–∫–∞–∑').onClick(() => openCartModal());
        if (cart.length > 0) tg.MainButton.show();
        
        tg.BackButton.onClick(() => {
          if (document.getElementById('cart-modal').open) closeCartModal();
          else if (document.getElementById('product-modal').open) closeProductModal();
        });
      }
    }

    function setupEventListeners() {
      document.getElementById('search-input').addEventListener('input', debounce(filterAndRender, 300));
      
      window.addEventListener('scroll', () => {
        const header = document.getElementById('main-header');
        if (window.scrollY > 10) header.classList.add('scrolled');
        else header.classList.remove('scrolled');
      });

      document.querySelectorAll('.filter-chip').forEach(chip => {
        chip.addEventListener('click', () => {
          document.querySelectorAll('.filter-chip').forEach(c => c.classList.remove('active'));
          chip.classList.add('active');
          currentFilter = chip.dataset.filter;
          filterAndRender();
        });
      });

      document.getElementById('open-cart-btn').addEventListener('click', openCartModal);
    }

    function debounce(func, wait) {
      let timeout;
      return function(...args) {
        clearTimeout(timeout);
        timeout = setTimeout(() => func.apply(this, args), wait);
      };
    }

    // ===== Rendering =====
    function renderUserProfile() {
      const box = document.getElementById('user-profile');
      const user = window.Telegram?.WebApp?.initDataUnsafe?.user;
      
      if (user) {
        const initial = (user.first_name || user.username || 'U').charAt(0).toUpperCase();
        box.innerHTML = `
          <div class="user-avatar">
            ${user.photo_url ? `<img src="${user.photo_url}" alt="" onerror="this.style.display='none'; this.parentElement.textContent='${initial}'">` : initial}
          </div>
          <div class="user-name">${user.first_name || '–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å'}</div>
        `;
      } else {
        box.style.display = 'none';
      }
    }

    function renderCategories() {
      // Categories are rendered as filter chips, already in HTML
    }

    function filterAndRender() {
      const term = document.getElementById('search-input').value.trim().toLowerCase();
      
      let filtered = PRODUCTS.filter(p => {
        const matchesTerm = !term || p.name.toLowerCase().includes(term);
        const matchesFilter = currentFilter === 'all' || 
          (currentFilter === 'cheese' && CHEESE_GROUP_IDS.has(p.group)) ||
          (currentFilter === 'fav' && favorites.has(p.id));
        return hasPrice(p) && matchesTerm && matchesFilter;
      });

      renderProducts(filtered, !term && currentFilter === 'all');
      updateFavoritesBar();
    }

    function renderProducts(products, groupByCategory) {
      const main = document.getElementById('main');
      main.innerHTML = '';

      if (products.length === 0) {
        main.innerHTML = `
          <div class="empty-state">
            <div class="empty-icon">üîç</div>
            <div class="empty-text">–ù–∏—á–µ–≥–æ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ</div>
          </div>
        `;
        return;
      }

      if (groupByCategory) {
        GROUPS.forEach((group, index) => {
          const groupProducts = products.filter(p => p.group === group.id);
          if (groupProducts.length === 0) return;

          const section = document.createElement('section');
          section.className = 'section';
          section.style.animationDelay = `${index * 0.1}s`;
          section.innerHTML = `
            <div class="section-header">
              <div class="section-title">${group.title}</div>
              <div class="section-count">${groupProducts.length}</div>
            </div>
          `;

          const grid = document.createElement('div');
          grid.className = 'product-grid';
          groupProducts.forEach(p => grid.appendChild(createProductCard(p)));
          section.appendChild(grid);
          main.appendChild(section);
        });
      } else {
        const grid = document.createElement('div');
        grid.className = 'product-grid';
        products.forEach(p => grid.appendChild(createProductCard(p)));
        main.appendChild(grid);
      }
    }

    function createProductCard(product) {
      const card = document.createElement('div');
      card.className = 'product-card';
      card.onclick = (e) => {
        if (e.target.closest('.fav-btn')) return;
        openProductModal(product.id);
      };

      const isFavorite = favorites.has(product.id);
      const priceText = getPriceDisplay(product);
      const approxPrice = getApproxPrice(product);

      card.innerHTML = `
        <div class="product-image-wrapper">
          <img class="product-thumb" src="${product.img || DEFAULT_IMG}" 
               alt="${escapeHtml(product.name)}" 
               onerror="this.src='${DEFAULT_IMG}'"
               loading="lazy">
          ${product.pieceWeightGrams ? `<div class="product-badge">‚âà${product.pieceWeightGrams}–≥</div>` : ''}
        </div>
        <div class="product-info">
          <div class="product-name">${product.ico} ${product.name}</div>
          <div class="product-price-row">
            <div>
              <div class="product-price">${priceText}</div>
              ${approxPrice ? `<div class="product-unit">‚âà ${approxPrice} –∑–∞ —à—Ç</div>` : ''}
            </div>
            <button class="fav-btn ${isFavorite ? 'active' : ''}" onclick="toggleFavorite('${product.id}', event)">
              ${isFavorite ? '‚ô•' : '‚ô°'}
            </button>
          </div>
        </div>
      `;

      return card;
    }

    function updateFavoritesBar() {
      const bar = document.getElementById('favorites-bar');
      if (favorites.size === 0) {
        bar.classList.remove('visible');
        return;
      }

      bar.innerHTML = '';
      bar.classList.add('visible');
      
      [...favorites].forEach(id => {
        const product = PRODUCTS.find(p => p.id === id);
        if (!product) return;
        
        const chip = document.createElement('button');
        chip.className = 'fav-chip';
        chip.textContent = product.name;
        chip.onclick = () => openProductModal(id);
        bar.appendChild(chip);
      });
    }

    // ===== Product Modal =====
    function openProductModal(productId) {
      currentProduct = PRODUCTS.find(p => p.id === productId);
      if (!currentProduct) return;

      currentQty = 1;
      document.getElementById('product-qty-display').textContent = '1';

      document.getElementById('product-modal-title').textContent = currentProduct.name;
      document.getElementById('product-modal-description').textContent = currentProduct.description || '';
      document.getElementById('product-modal-image').src = currentProduct.img || DEFAULT_IMG;

      renderWeightSelector();
      renderFlavorSelector();
      updateProductModalPrice();

      document.getElementById('product-modal').showModal();
      if (window.Telegram?.WebApp?.BackButton) window.Telegram.WebApp.BackButton.show();
    }

    function closeProductModal() {
      document.getElementById('product-modal').close();
      currentProduct = null;
      currentVariant = null;
      if (window.Telegram?.WebApp?.BackButton) window.Telegram.WebApp.BackButton.hide();
    }

    function renderWeightSelector() {
      const container = document.getElementById('weight-selector-container');
      container.innerHTML = '';
      
      const rule = VARIANT_RULES[currentProduct.id];
      
      if (rule?.type === 'fixed') {
        // –î–ª—è —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤ –∏—Å–ø–æ–ª—å–∑—É–µ–º —á–∏–ø—Å—ã
        const wrapper = document.createElement('div');
        wrapper.className = 'weight-chips';
        
        rule.options.forEach((opt, idx) => {
          const chip = document.createElement('button');
          chip.className = 'weight-chip' + (idx === 0 ? ' active' : '');
          chip.textContent = opt;
          chip.onclick = () => {
            wrapper.querySelectorAll('.weight-chip').forEach(c => c.classList.remove('active'));
            chip.classList.add('active');
            currentVariant = opt;
            updateProductModalPrice();
          };
          if (idx === 0) currentVariant = opt;
          wrapper.appendChild(chip);
        });
        
        container.appendChild(wrapper);
      } else if (rule?.type === 'weight') {
        // –î–ª—è –≤–µ—Å–æ–≤—ã—Ö —Ç–æ–≤–∞—Ä–æ–≤ (–≤–∫–ª—é—á–∞—è —Å–ª–∏–≤–∫–∏) - —á–∏–ø—Å—ã + —Å–≤–æ–π –≤–µ—Å
        const wrapper = document.createElement('div');
        wrapper.className = 'weight-chips';
        
        // –ü—Ä–µ–¥—É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è –æ—Ç min –¥–æ max —Å —à–∞–≥–æ–º
        const presets = [];
        for (let g = rule.min; g <= Math.min(rule.max, 1000); g += rule.step) {
          presets.push(g);
        }
        // –î–æ–±–∞–≤–ª—è–µ–º 1.5–∫–≥ –∏ 2–∫–≥ –µ—Å–ª–∏ max –ø–æ–∑–≤–æ–ª—è–µ—Ç
        if (rule.max >= 1500 && !presets.includes(1500)) presets.push(1500);
        if (rule.max >= 2000 && !presets.includes(2000)) presets.push(2000);
        
        presets.forEach((g, idx) => {
          const chip = document.createElement('button');
          chip.className = 'weight-chip' + (idx === 0 ? ' active' : '');
          chip.textContent = `${g} –≥`;
          chip.onclick = () => {
            wrapper.querySelectorAll('.weight-chip').forEach(c => c.classList.remove('active'));
            chip.classList.add('active');
            document.getElementById('custom-weight-input').value = '';
            document.getElementById('custom-weight-wrapper').classList.remove('visible');
            currentVariant = `${g} –≥`;
            updateProductModalPrice();
          };
          if (idx === 0) currentVariant = `${g} –≥`;
          wrapper.appendChild(chip);
        });
        
        // –ö–Ω–æ–ø–∫–∞ —Å–≤–æ–µ–≥–æ –≤–µ—Å–∞
        const customChip = document.createElement('button');
        customChip.className = 'weight-chip custom';
        customChip.textContent = '–°–≤–æ–π –≤–µ—Å';
        customChip.onclick = () => {
          wrapper.querySelectorAll('.weight-chip').forEach(c => c.classList.remove('active'));
          customChip.classList.add('active');
          const inputWrap = document.getElementById('custom-weight-wrapper');
          inputWrap.classList.add('visible');
          inputWrap.querySelector('input').focus();
          currentVariant = null; // –ë—É–¥–µ—Ç –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–æ –∏–∑ input
          updateProductModalPrice();
        };
        wrapper.appendChild(customChip);
        
        container.appendChild(wrapper);
        
        // –ü–æ–ª–µ –¥–ª—è —Å–≤–æ–µ–≥–æ –≤–µ—Å–∞
        const inputWrap = document.createElement('div');
        inputWrap.id = 'custom-weight-wrapper';
        inputWrap.className = 'custom-weight-input-wrapper';
        inputWrap.innerHTML = `
          <input type="number" id="custom-weight-input" class="custom-weight-input" 
                 min="${rule.min}" max="${rule.max}" step="${rule.step}" 
                 placeholder="–í–≤–µ–¥–∏—Ç–µ –≤–µ—Å –æ—Ç ${rule.min} –¥–æ ${rule.max} –≥">
          <span style="color: var(--text-tertiary); font-weight: 600;">–≥</span>
        `;
        container.appendChild(inputWrap);
        
        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –≤–≤–æ–¥–∞ —Å–≤–æ–µ–≥–æ –≤–µ—Å–∞
        inputWrap.querySelector('input').addEventListener('input', (e) => {
          const val = parseInt(e.target.value);
          if (val >= rule.min && val <= rule.max) {
            currentVariant = `${val} –≥`;
            updateProductModalPrice();
          }
        });
      } else {
        // –î–µ—Ñ–æ–ª—Ç –¥–ª—è —Ç–æ–≤–∞—Ä–æ–≤ –±–µ–∑ –ø—Ä–∞–≤–∏–ª
        const wrapper = document.createElement('div');
        wrapper.className = 'weight-chips';
        
        if (currentProduct.pricePerKg) {
          [200, 300, 500, 1000].forEach((g, idx) => {
            const chip = document.createElement('button');
            chip.className = 'weight-chip' + (idx === 0 ? ' active' : '');
            chip.textContent = `${g} –≥`;
            chip.onclick = () => {
              wrapper.querySelectorAll('.weight-chip').forEach(c => c.classList.remove('active'));
              chip.classList.add('active');
              currentVariant = `${g} –≥`;
              updateProductModalPrice();
            };
            if (idx === 0) currentVariant = `${g} –≥`;
            wrapper.appendChild(chip);
          });
        } else if (currentProduct.pricePerL) {
          ['0.5 –ª', '1 –ª'].forEach((l, idx) => {
            const chip = document.createElement('button');
            chip.className = 'weight-chip' + (idx === 0 ? ' active' : '');
            chip.textContent = l;
            chip.onclick = () => {
              wrapper.querySelectorAll('.weight-chip').forEach(c => c.classList.remove('active'));
              chip.classList.add('active');
              currentVariant = l;
              updateProductModalPrice();
            };
            if (idx === 0) currentVariant = l;
            wrapper.appendChild(chip);
          });
        } else if (currentProduct.pricePerUnit) {
          const chip = document.createElement('button');
          chip.className = 'weight-chip active';
          chip.textContent = '1 —à—Ç';
          chip.onclick = () => {
            currentVariant = '1 —à—Ç';
            updateProductModalPrice();
          };
          currentVariant = '1 —à—Ç';
          wrapper.appendChild(chip);
        }
        
        container.appendChild(wrapper);
      }
      
      // Hint text
      let hintText = '';
      if (currentProduct.pricePerKg) {
        if (rule?.type === 'weight') {
          hintText = `–®–∞–≥ ${rule.step} –≥. –î–æ—Å—Ç—É–ø–Ω–æ –æ—Ç ${rule.min} –≥ –¥–æ ${rule.max} –≥. `;
        }
        hintText += '–°–∫–∏–¥–∫–∏: 500–≥‚àí5%, 700–≥‚àí10%, 1–∫–≥‚àí15% (–Ω–∞ –∫–∞–∂–¥—É—é –ø–æ–∑–∏—Ü–∏—é –æ—Ç–¥–µ–ª—å–Ω–æ)';
      } else if (currentProduct.pricePerL) {
        hintText = '–í—ã–±–µ—Ä–∏—Ç–µ –æ–±—ä—ë–º';
      }
      document.getElementById('variant-hint').textContent = hintText;
    }

    function renderFlavorSelector() {
      const group = document.getElementById('flavor-group');
      const select = document.getElementById('product-flavor-select');
      
      if (currentProduct.flavors && currentProduct.flavors.length > 0) {
        group.style.display = 'block';
        select.innerHTML = '';
        currentProduct.flavors.forEach(flavor => {
          const option = document.createElement('option');
          option.value = flavor;
          option.textContent = flavor;
          select.appendChild(option);
        });
      } else {
        group.style.display = 'none';
      }
    }

    function adjustQty(delta) {
      currentQty = Math.max(1, currentQty + delta);
      document.getElementById('product-qty-display').textContent = currentQty;
      updateProductModalPrice();
    }

    function updateProductModalPrice() {
      if (!currentProduct || !currentVariant) return;
      
      let variantForCalc = currentVariant;
      
      // –ï—Å–ª–∏ –∞–∫—Ç–∏–≤–µ–Ω —Å–≤–æ–π –≤–µ—Å, –±–µ—Ä–µ–º –µ–≥–æ –∏–∑ –∏–Ω–ø—É—Ç–∞
      const customInput = document.getElementById('custom-weight-input');
      if (customInput && customInput.value && document.getElementById('custom-weight-wrapper')?.classList.contains('visible')) {
        variantForCalc = `${customInput.value} –≥`;
      }
      
      // –î–æ–±–∞–≤–ª—è–µ–º –≤–∫—É—Å –µ—Å–ª–∏ –µ—Å—Ç—å
      const flavorSelect = document.getElementById('product-flavor-select');
      if (flavorSelect && flavorSelect.parentElement.style.display !== 'none' && flavorSelect.value) {
        variantForCalc += ` ¬∑ ${flavorSelect.value}`;
      }

      const price = calculatePrice(currentProduct.id, variantForCalc, currentQty);
      
      document.getElementById('price-value').textContent = formatPrice(price.finalPrice);
      
      const oldPriceEl = document.getElementById('price-old');
      if (price.discountRate > 0) {
        oldPriceEl.style.display = 'inline';
        oldPriceEl.textContent = formatPrice(price.basePrice);
      } else {
        oldPriceEl.style.display = 'none';
      }
    }

    function addToCart() {
      if (!currentProduct || !currentVariant) {
        showToast('–í—ã–±–µ—Ä–∏—Ç–µ –≤–µ—Å —Ç–æ–≤–∞—Ä–∞', 'error');
        return;
      }

      let finalVariant = currentVariant;
      
      // –ü—Ä–æ–≤–µ—Ä—è–µ–º –∫–∞—Å—Ç–æ–º–Ω—ã–π –≤–µ—Å
      const customInput = document.getElementById('custom-weight-input');
      if (customInput && customInput.value && document.getElementById('custom-weight-wrapper')?.classList.contains('visible')) {
        finalVariant = `${customInput.value} –≥`;
      }
      
      // –î–æ–±–∞–≤–ª—è–µ–º –≤–∫—É—Å
      const flavorSelect = document.getElementById('product-flavor-select');
      if (flavorSelect && flavorSelect.parentElement.style.display !== 'none' && flavorSelect.value) {
        finalVariant += ` ¬∑ ${flavorSelect.value}`;
      }

      const existingIndex = cart.findIndex(item => 
        item.id === currentProduct.id && item.variant === finalVariant
      );

      if (existingIndex > -1) {
        cart[existingIndex].qty += currentQty;
      } else {
        cart.push({
          id: currentProduct.id,
          name: currentProduct.name,
          group: currentProduct.group,
          variant: finalVariant,
          qty: currentQty,
          img: currentProduct.img || DEFAULT_IMG
        });
      }

      saveState();
      updateCartUI();
      closeProductModal();
      showToast('–¢–æ–≤–∞—Ä –¥–æ–±–∞–≤–ª–µ–Ω –≤ –∫–æ—Ä–∑–∏–Ω—É', 'success');
      
      if (window.Telegram?.WebApp?.HapticFeedback) {
        window.Telegram.WebApp.HapticFeedback.impactOccurred('medium');
      }
    }

    // ===== Cart =====
    function updateCartUI() {
      const totalCount = cart.reduce((sum, item) => sum + item.qty, 0);
      const totalSum = cart.reduce((sum, item) => {
        const price = calculatePrice(item.id, item.variant, item.qty);
        return sum + price.finalPrice;
      }, 0);

      const btn = document.getElementById('open-cart-btn');
      const countEl = btn.querySelector('.cart-count');
      
      if (cart.length > 0) {
        btn.disabled = false;
        countEl.textContent = totalCount;
        countEl.style.display = 'inline-block';
        btn.querySelector('span:last-child').textContent = formatPrice(totalSum);
        if (window.Telegram?.WebApp?.MainButton) window.Telegram.WebApp.MainButton.show();
      } else {
        btn.disabled = true;
        countEl.textContent = '0';
        countEl.style.display = 'none';
        btn.querySelector('span:last-child').textContent = '‚Üí';
        if (window.Telegram?.WebApp?.MainButton) window.Telegram.WebApp.MainButton.hide();
      }
    }

    function openCartModal() {
      renderCartContents();
      document.getElementById('cart-modal').showModal();
      if (window.Telegram?.WebApp?.BackButton) window.Telegram.WebApp.BackButton.show();
    }

    function closeCartModal() {
      document.getElementById('cart-modal').close();
      if (window.Telegram?.WebApp?.BackButton) window.Telegram.WebApp.BackButton.hide();
    }

    function renderCartContents() {
      const body = document.getElementById('cart-modal-body');
      
      if (cart.length === 0) {
        body.innerHTML = `
          <div class="empty-state">
            <div class="empty-icon">üõí</div>
            <div class="empty-text">–ö–æ—Ä–∑–∏–Ω–∞ –ø—É—Å—Ç–∞</div>
          </div>
        `;
        return;
      }

      let total = 0;
      let totalBase = 0;
      const itemsHtml = cart.map((item, index) => {
        const price = calculatePrice(item.id, item.variant, item.qty);
        total += price.finalPrice;
        totalBase += price.basePrice;
        
        const product = PRODUCTS.find(p => p.id === item.id);
        
        return `
          <div class="cart-item">
            <img src="${item.img || DEFAULT_IMG}" class="cart-item-image" alt="" onerror="this.src='${DEFAULT_IMG}'">
            <div class="cart-item-content">
              <div class="cart-item-name">${product?.ico || 'üßÄ'} ${item.name}</div>
              <div class="cart-item-variant">${escapeHtml(item.variant)}</div>
              <div class="cart-item-price">${formatPrice(price.finalPrice)}</div>
              ${price.discountRate > 0 ? `<div class="cart-item-discount">–°–∫–∏–¥–∫–∞ ${price.discountRate * 100}%</div>` : ''}
            </div>
            <div class="cart-item-controls">
              <div class="qty-control">
                <button class="qty-btn" onclick="changeCartQty(${index}, -1)">‚àí</button>
                <span class="qty-value">${item.qty}</span>
                <button class="qty-btn" onclick="changeCartQty(${index}, 1)">+</button>
              </div>
              <button class="remove-btn" onclick="removeFromCart(${index})">üóë</button>
            </div>
          </div>
        `;
      }).join('');

      const hasDiscount = total < totalBase;
      const hasCheese = cart.some(item => {
        const p = PRODUCTS.find(x => x.id === item.id);
        return p && CHEESE_GROUP_IDS.has(p.group);
      });

      body.innerHTML = `
        <div class="cart-items">
          ${itemsHtml}
        </div>
        
        <div class="cart-summary-section">
          <div class="summary-row">
            <span>–°—É–º–º–∞ –±–µ–∑ —Å–∫–∏–¥–∫–∏</span>
            <span>${formatPrice(totalBase)}</span>
          </div>
          ${hasDiscount ? `
            <div class="summary-row" style="color: var(--success);">
              <span>–°–∫–∏–¥–∫–∞</span>
              <span>‚àí${formatPrice(totalBase - total)}</span>
            </div>
          ` : ''}
          <div class="summary-row total">
            <span>–ò—Ç–æ–≥–æ –∫ –æ–ø–ª–∞—Ç–µ</span>
            <span>${formatPrice(total)}</span>
          </div>
          
          <div class="form-group" style="margin-top: 20px;">
            <label class="form-label">–ü—Ä–æ–º–æ–∫–æ–¥</label>
            <input type="text" class="promo-input" id="checkout-promo" placeholder="–í–≤–µ–¥–∏—Ç–µ –ø—Ä–æ–º–æ–∫–æ–¥" value="${checkoutState.promo || ''}">
          </div>
        </div>

        <div class="checkout-section">
          <div class="section-subtitle">–ö–æ–Ω—Ç–∞–∫—Ç—ã –∏ –¥–æ—Å—Ç–∞–≤–∫–∞</div>
          
          <div class="form-group">
            <label class="form-label">–ì–æ—Ä–æ–¥</label>
            <select class="form-select" id="checkout-city">
              <option value="–ü–µ–Ω–∑–∞" ${checkoutState.city === '–ü–µ–Ω–∑–∞' ? 'selected' : ''}>–ü–µ–Ω–∑–∞</option>
              <option value="–ú–æ—Å–∫–≤–∞" ${checkoutState.city === '–ú–æ—Å–∫–≤–∞' ? 'selected' : ''}>–ú–æ—Å–∫–≤–∞</option>
            </select>
          </div>
          
          <div class="form-group">
            <label class="form-label">–¢–µ–ª–µ—Ñ–æ–Ω</label>
            <input type="tel" class="form-input" id="checkout-phone" placeholder="+7 (999) 999-99-99" value="${checkoutState.phone || ''}">
          </div>
          
          <div class="form-group">
            <label class="form-label">–ê–¥—Ä–µ—Å –¥–æ—Å—Ç–∞–≤–∫–∏</label>
            <textarea class="form-textarea" id="checkout-address" placeholder="–£–ª–∏—Ü–∞, –¥–æ–º, –∫–≤–∞—Ä—Ç–∏—Ä–∞, –ø–æ–¥—ä–µ–∑–¥...">${checkoutState.address || ''}</textarea>
          </div>
          
          <div class="form-group">
            <label class="form-label">–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π</label>
            <textarea class="form-textarea" id="checkout-comment" placeholder="–ü–æ–∂–µ–ª–∞–Ω–∏—è –∫ –∑–∞–∫–∞–∑—É...">${checkoutState.comment || ''}</textarea>
          </div>
          
          <div id="checkout-error" class="error-message"></div>
          
          ${hasCheese ? `
            <div class="weighing-notice">
              –ö–æ–Ω–µ—á–Ω–∞—è —Å—É–º–º–∞ –ø–æ —Å—ã—Ä–∞–º —É—Ç–æ—á–Ω—è–µ—Ç—Å—è –ø–æ—Å–ª–µ —Ñ–∞–∫—Ç–∏—á–µ—Å–∫–æ–≥–æ –≤–∑–≤–µ—à–∏–≤–∞–Ω–∏—è –≤ –¥–µ–Ω—å –¥–æ—Å—Ç–∞–≤–∫–∏
            </div>
          ` : ''}
          
          <button class="btn-primary" onclick="submitOrder()" style="margin-top: 24px;">
            –û—Ñ–æ—Ä–º–∏—Ç—å –∑–∞–∫–∞–∑
          </button>
        </div>
      `;

      // Setup auto-save for form fields
      ['checkout-phone', 'checkout-address', 'checkout-comment', 'checkout-promo', 'checkout-city'].forEach(id => {
        const el = document.getElementById(id);
        if (el) {
          el.addEventListener('input', () => {
            const key = id.replace('checkout-', '');
            checkoutState[key] = el.value;
            saveState();
          });
        }
      });
    }

    function changeCartQty(index, delta) {
      if (!cart[index]) return;
      cart[index].qty += delta;
      if (cart[index].qty <= 0) {
        cart.splice(index, 1);
      }
      saveState();
      updateCartUI();
      renderCartContents();
    }

    function removeFromCart(index) {
      cart.splice(index, 1);
      saveState();
      updateCartUI();
      renderCartContents();
      if (cart.length === 0) setTimeout(closeCartModal, 300);
    }

    // ===== Order Submission =====
    function submitOrder() {
      const phone = document.getElementById('checkout-phone').value.trim();
      const address = document.getElementById('checkout-address').value.trim();
      const city = document.getElementById('checkout-city').value;
      const comment = document.getElementById('checkout-comment').value.trim();
      const promo = document.getElementById('checkout-promo').value.trim().toUpperCase();
      
      const errors = [];
      
      if (!phone || phone.length < 10) {
        errors.push('–£–∫–∞–∂–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π —Ç–µ–ª–µ—Ñ–æ–Ω');
      }
      
      if (!address || address.length < 5) {
        errors.push('–£–∫–∞–∂–∏—Ç–µ –∞–¥—Ä–µ—Å –¥–æ—Å—Ç–∞–≤–∫–∏');
      }

      const errorEl = document.getElementById('checkout-error');
      if (errors.length > 0) {
        errorEl.textContent = errors.join('. ');
        errorEl.classList.add('visible');
        if (window.Telegram?.WebApp?.HapticFeedback) {
          window.Telegram.WebApp.HapticFeedback.notificationOccurred('error');
        }
        return;
      }
      
      errorEl.classList.remove('visible');

      const payload = {
        type: 'cart',
        source: 'miniapp',
        currency: CURRENCY,
        items: [],
        contact: {
          phone: normalizePhone(phone),
          phone_raw: phone,
          address,
          city,
          comment,
          promo
        },
        meta: {
          ts: Date.now(),
          schema_ver: 'v3'
        }
      };

      let total = 0;
      cart.forEach(item => {
        const price = calculatePrice(item.id, item.variant, item.qty);
        total += price.finalPrice;
        
        payload.items.push({
          id: item.id,
          name: item.name,
          group: item.group,
          variant: item.variant,
          qty: item.qty,
          unit_price: price.finalPrice / item.qty,
          line_total: price.finalPrice,
          discount_rate: price.discountRate
        });
      });

      payload.total = total;

      if (window.Telegram?.WebApp?.initDataUnsafe?.user) {
        const u = window.Telegram.WebApp.initDataUnsafe.user;
        payload.telegram = {
          user_id: u.id,
          username: u.username,
          first_name: u.first_name,
          last_name: u.last_name
        };
      }

      axios.post(`${BACKEND}/order`, payload)
        .then(() => {
          showToast('–ó–∞–∫–∞–∑ —É—Å–ø–µ—à–Ω–æ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω!', 'success');
          cart = [];
          saveState();
          updateCartUI();
          closeCartModal();
          
          if (window.Telegram?.WebApp) {
            window.Telegram.WebApp.showAlert('–°–ø–∞—Å–∏–±–æ! –í–∞—à –∑–∞–∫–∞–∑ –ø—Ä–∏–Ω—è—Ç. –ú—ã —Å–≤—è–∂–µ–º—Å—è —Å –≤–∞–º–∏ –¥–ª—è –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è.');
            setTimeout(() => window.Telegram.WebApp.close(), 1500);
          }
        })
        .catch(err => {
          console.error('Order error:', err);
          showToast('–û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –µ—â—ë —Ä–∞–∑.', 'error');
          if (window.Telegram?.WebApp?.HapticFeedback) {
            window.Telegram.WebApp.HapticFeedback.notificationOccurred('error');
          }
        });
    }

    // ===== Price Calculation (–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ: —Å–∫–∏–¥–∫–∞ —Ç–æ–ª—å–∫–æ –Ω–∞ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—É—é –ø–æ–∑–∏—Ü–∏—é) =====
    function calculatePrice(productId, variant, qty) {
      const product = PRODUCTS.find(p => p.id === productId);
      if (!product) return { basePrice: 0, finalPrice: 0, discountRate: 0 };

      let basePrice = 0;
      let weightGrams = 0;
      const isEligibleForDiscount = CHEESE_GROUP_IDS.has(product.group);

      if (product.pricePerKg) {
        weightGrams = extractGrams(variant) || getDefaultWeight(product) || 200;
        const totalWeight = weightGrams * qty;
        basePrice = (totalWeight / 1000) * product.pricePerKg;
        
        // –°–∫–∏–¥–∫–∞ —Å—á–∏—Ç–∞–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –¥–ª—è –æ–±—â–µ–≥–æ –≤–µ—Å–∞ —ç—Ç–æ–π –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–π –ø–æ–∑–∏—Ü–∏–∏
        const discountRate = isEligibleForDiscount ? getDiscountRateForWeight(totalWeight) : 0;
        const finalPrice = Math.round(basePrice * (1 - discountRate));
        
        return {
          basePrice: Math.round(basePrice),
          finalPrice,
          discountRate
        };
      } else if (product.pricePerL) {
        const liters = extractLiters(variant) || 1;
        basePrice = liters * product.pricePerL * qty;
        return {
          basePrice: Math.round(basePrice),
          finalPrice: Math.round(basePrice),
          discountRate: 0
        };
      } else if (product.pricePerUnit) {
        basePrice = product.pricePerUnit * qty;
        return {
          basePrice: Math.round(basePrice),
          finalPrice: Math.round(basePrice),
          discountRate: 0
        };
      }

      return { basePrice: 0, finalPrice: 0, discountRate: 0 };
    }

    // –ù–æ–≤–∞—è —Ñ—É–Ω–∫—Ü–∏—è: —Å–∫–∏–¥–∫–∞ —Ç–æ–ª—å–∫–æ –Ω–∞ –æ—Å–Ω–æ–≤–µ –ø–µ—Ä–µ–¥–∞–Ω–Ω–æ–≥–æ –≤–µ—Å–∞ (–±–µ–∑ —É—á–µ—Ç–∞ –∫–æ—Ä–∑–∏–Ω—ã)
    function getDiscountRateForWeight(totalWeightGrams) {
      let rate = 0;
      for (const threshold of DISCOUNT_THRESHOLDS) {
        if (totalWeightGrams >= threshold.g) rate = threshold.rate;
      }
      return rate;
    }

    function extractGrams(variant) {
      if (!variant) return 0;
      const match = variant.match(/(?:\(|‚âà|~)?\s*(\d+(?:\.\d+)?)\s*(–≥|–∫–≥|–≥—Ä)/i);
      if (!match) return 0;
      const value = parseFloat(match[1]);
      const unit = match[2].toLowerCase();
      return unit === '–∫–≥' ? value * 1000 : value;
    }

    function extractLiters(variant) {
      if (!variant) return 0;
      const match = variant.match(/(\d+(?:\.\d+)?)\s*–ª/i);
      return match ? parseFloat(match[1]) : 0;
    }

    function getDefaultWeight(product) {
      const rule = VARIANT_RULES[product.id];
      if (rule?.defaultWeight) return rule.defaultWeight;
      if (product.pieceWeightGrams) return product.pieceWeightGrams;
      return 200;
    }

    // ===== Utilities =====
    function formatPrice(n) {
      return new Intl.NumberFormat('ru-RU').format(Math.round(n)) + ' ‚ÇΩ';
    }

    function getPriceDisplay(product) {
      if (product.pricePerKg) return formatPrice(product.pricePerKg) + '/–∫–≥';
      if (product.pricePerL) return formatPrice(product.pricePerL) + '/–ª';
      if (product.pricePerUnit) return formatPrice(product.pricePerUnit);
      return '–¶–µ–Ω–∞ –ø–æ –∑–∞–ø—Ä–æ—Å—É';
    }

    function getApproxPrice(product) {
      if (!product.pricePerKg || !product.pieceWeightGrams) return null;
      return formatPrice(product.pricePerKg * product.pieceWeightGrams / 1000);
    }

    function hasPrice(product) {
      return !!(product.pricePerKg || product.pricePerL || product.pricePerUnit);
    }

    function normalizePhone(phone) {
      const digits = phone.replace(/\D/g, '');
      if (digits.length === 11 && (digits.startsWith('7') || digits.startsWith('8'))) {
        return '+7' + digits.slice(1);
      }
      if (digits.length === 10) return '+7' + digits;
      return phone;
    }

    function escapeHtml(str) {
      const div = document.createElement('div');
      div.textContent = str;
      return div.innerHTML;
    }

    function showToast(message, type = 'success') {
      const toast = document.getElementById('toast');
      toast.textContent = message;
      toast.className = `toast ${type} visible`;
      setTimeout(() => {
        toast.classList.remove('visible');
      }, 3000);
    }

    // ===== Global Functions =====
    window.toggleFavorite = function(productId, event) {
      if (event) event.stopPropagation();
      
      if (favorites.has(productId)) {
        favorites.delete(productId);
      } else {
        favorites.add(productId);
      }
      
      saveState();
      filterAndRender();
      
      const btn = event?.target;
      if (btn) {
        btn.classList.toggle('active');
        btn.textContent = favorites.has(productId) ? '‚ô•' : '‚ô°';
      }
    };

    window.changeCartQty = changeCartQty;
    window.removeFromCart = removeFromCart;
    window.closeProductModal = closeProductModal;
    window.closeCartModal = closeCartModal;
    window.addToCart = addToCart;
    window.submitOrder = submitOrder;
    window.adjustQty = adjustQty;
  </script>
</body>
</html>
