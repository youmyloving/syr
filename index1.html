<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="theme-color" content="#1a1a2e">
    <title>–°—ã—Ä–æ–º–∞–Ω–∏—è ‚Äî –∑–∞–∫–∞–∑</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        :root {
            --bg-primary: #0f0f1a;
            --bg-secondary: #1a1a2e;
            --bg-card: #16162a;
            --accent: #ffd700;
            --accent-hover: #ffed4e;
            --text-primary: #ffffff;
            --text-secondary: #a0a0b0;
            --success: #00d084;
            --error: #ff4757;
            --border: #2a2a3e;
            --shadow: 0 8px 32px rgba(0, 0, 0, 0.4);
            --gradient: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            min-height: 100vh;
            overflow-x: hidden;
            line-height: 1.6;
        }

        .container {
            max-width: 480px;
            margin: 0 auto;
            padding: 20px;
            padding-bottom: 100px;
        }

        /* Header */
        .header {
            text-align: center;
            padding: 30px 0;
            position: relative;
        }

        .logo {
            font-size: 2.5rem;
            font-weight: 800;
            background: linear-gradient(135deg, #ffd700 0%, #ffed4e 50%, #ffd700 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            text-shadow: 0 0 30px rgba(255, 215, 0, 0.3);
            margin-bottom: 10px;
            letter-spacing: -1px;
        }

        .subtitle {
            color: var(--text-secondary);
            font-size: 0.95rem;
            font-weight: 400;
        }

        /* Cheese Card */
        .cheese-card {
            background: var(--bg-card);
            border-radius: 24px;
            padding: 24px;
            margin-bottom: 20px;
            border: 1px solid var(--border);
            box-shadow: var(--shadow);
            position: relative;
            overflow: hidden;
        }

        .cheese-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: linear-gradient(90deg, #ffd700, #ffed4e, #ffd700);
        }

        .cheese-image {
            width: 100%;
            height: 200px;
            background: linear-gradient(135deg, #2a2a3e 0%, #1a1a2e 100%);
            border-radius: 16px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 20px;
            position: relative;
            overflow: hidden;
        }

        .cheese-image::after {
            content: 'üßÄ';
            font-size: 5rem;
            filter: drop-shadow(0 4px 8px rgba(0,0,0,0.3));
            animation: float 3s ease-in-out infinite;
        }

        @keyframes float {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }

        .cheese-name {
            font-size: 1.5rem;
            font-weight: 700;
            margin-bottom: 8px;
            color: var(--text-primary);
        }

        .cheese-price {
            font-size: 1.25rem;
            color: var(--accent);
            font-weight: 700;
            margin-bottom: 4px;
        }

        .cheese-price-per-kg {
            font-size: 0.875rem;
            color: var(--text-secondary);
        }

        /* Weight Section */
        .weight-section {
            background: var(--bg-card);
            border-radius: 24px;
            padding: 24px;
            margin-bottom: 20px;
            border: 1px solid var(--border);
        }

        .section-title {
            font-size: 1.1rem;
            font-weight: 600;
            margin-bottom: 16px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .section-title::before {
            content: '‚öñÔ∏è';
        }

        .weight-input-wrapper {
            position: relative;
            margin-bottom: 16px;
        }

        .weight-input {
            width: 100%;
            background: var(--bg-secondary);
            border: 2px solid var(--border);
            border-radius: 16px;
            padding: 20px;
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--text-primary);
            text-align: center;
            transition: all 0.3s ease;
            outline: none;
        }

        .weight-input:focus {
            border-color: var(--accent);
            box-shadow: 0 0 0 4px rgba(255, 215, 0, 0.1);
        }

        .weight-unit {
            position: absolute;
            right: 20px;
            top: 50%;
            transform: translateY(-50%);
            color: var(--text-secondary);
            font-weight: 600;
            font-size: 1.1rem;
            pointer-events: none;
        }

        .weight-hint {
            font-size: 0.875rem;
            color: var(--text-secondary);
            text-align: center;
            line-height: 1.5;
            padding: 0 10px;
        }

        .weight-hint strong {
            color: var(--accent);
        }

        /* Quick Select Buttons */
        .quick-weights {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 10px;
            margin-top: 16px;
        }

        .quick-weight-btn {
            background: var(--bg-secondary);
            border: 2px solid var(--border);
            border-radius: 12px;
            padding: 12px 8px;
            color: var(--text-primary);
            font-weight: 600;
            font-size: 0.9rem;
            cursor: pointer;
            transition: all 0.2s ease;
            text-align: center;
        }

        .quick-weight-btn:hover {
            border-color: var(--accent);
            transform: translateY(-2px);
        }

        .quick-weight-btn.active {
            background: var(--accent);
            color: var(--bg-primary);
            border-color: var(--accent);
        }

        /* Quantity Section */
        .quantity-section {
            background: var(--bg-card);
            border-radius: 24px;
            padding: 24px;
            margin-bottom: 20px;
            border: 1px solid var(--border);
        }

        .quantity-controls {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 20px;
        }

        .quantity-btn {
            width: 56px;
            height: 56px;
            border-radius: 16px;
            border: 2px solid var(--border);
            background: var(--bg-secondary);
            color: var(--text-primary);
            font-size: 1.5rem;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            user-select: none;
        }

        .quantity-btn:hover {
            border-color: var(--accent);
            background: var(--bg-primary);
            transform: scale(1.05);
        }

        .quantity-btn:active {
            transform: scale(0.95);
        }

        .quantity-value {
            font-size: 2rem;
            font-weight: 800;
            min-width: 80px;
            text-align: center;
            color: var(--accent);
        }

        /* Summary */
        .summary {
            background: linear-gradient(135deg, rgba(255, 215, 0, 0.1) 0%, rgba(255, 215, 0, 0.05) 100%);
            border: 2px solid rgba(255, 215, 0, 0.3);
            border-radius: 24px;
            padding: 24px;
            margin-bottom: 20px;
        }

        .summary-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 12px;
            font-size: 0.95rem;
        }

        .summary-row:last-child {
            margin-bottom: 0;
            padding-top: 12px;
            border-top: 1px solid rgba(255, 215, 0, 0.2);
            font-size: 1.25rem;
            font-weight: 700;
        }

        .summary-label {
            color: var(--text-secondary);
        }

        .summary-value {
            color: var(--text-primary);
            font-weight: 600;
        }

        .total-price {
            color: var(--accent);
            font-size: 1.5rem;
        }

        /* Discount Badge */
        .discount-badge {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            background: rgba(0, 208, 132, 0.2);
            color: var(--success);
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 700;
            margin-top: 8px;
        }

        /* Order Button */
        .order-button {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: var(--bg-primary);
            padding: 20px;
            border-top: 1px solid var(--border);
            z-index: 100;
        }

        .order-btn {
            width: 100%;
            max-width: 480px;
            margin: 0 auto;
            display: block;
            background: linear-gradient(135deg, #ffd700 0%, #ffed4e 100%);
            color: #1a1a2e;
            border: none;
            border-radius: 16px;
            padding: 18px;
            font-size: 1.1rem;
            font-weight: 800;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 20px rgba(255, 215, 0, 0.4);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }

        .order-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 30px rgba(255, 215, 0, 0.6);
        }

        .order-btn:active {
            transform: translateY(0);
        }

        .order-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        /* Animations */
        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .cheese-card, .weight-section, .quantity-section, .summary {
            animation: slideUp 0.5s ease-out forwards;
        }

        .weight-section { animation-delay: 0.1s; }
        .quantity-section { animation-delay: 0.2s; }
        .summary { animation-delay: 0.3s; }

        /* Loading State */
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(26, 26, 46, 0.3);
            border-radius: 50%;
            border-top-color: #1a1a2e;
            animation: spin 1s ease-in-out infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Success Message */
        .success-message {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%) scale(0);
            background: var(--bg-card);
            border: 2px solid var(--success);
            border-radius: 24px;
            padding: 40px;
            text-align: center;
            z-index: 1000;
            opacity: 0;
            transition: all 0.3s ease;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
        }

        .success-message.show {
            transform: translate(-50%, -50%) scale(1);
            opacity: 1;
        }

        .success-icon {
            font-size: 4rem;
            margin-bottom: 16px;
        }

        .success-text {
            font-size: 1.25rem;
            font-weight: 700;
            color: var(--success);
            margin-bottom: 8px;
        }

        .success-subtext {
            color: var(--text-secondary);
            font-size: 0.9rem;
        }

        .overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.8);
            z-index: 999;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
        }

        .overlay.show {
            opacity: 1;
            visibility: visible;
        }

        /* Responsive */
        @media (max-width: 380px) {
            .container {
                padding: 15px;
            }
            
            .logo {
                font-size: 2rem;
            }
            
            .quick-weights {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        /* Haptic feedback indicator */
        .haptic-indicator {
            position: fixed;
            top: 20px;
            right: 20px;
            width: 8px;
            height: 8px;
            background: var(--accent);
            border-radius: 50%;
            opacity: 0;
            transition: opacity 0.2s;
        }

        .haptic-indicator.active {
            opacity: 1;
        }
    </style>
</head>
<body>
    <div class="haptic-indicator" id="hapticIndicator"></div>
    
    <div class="container">
        <header class="header">
            <h1 class="logo">–°—ã—Ä–æ–º–∞–Ω–∏—è</h1>
            <p class="subtitle">–ü—Ä–µ–º–∏–∞–ª—å–Ω—ã–π —Å—ã—Ä –Ω–∞ –∑–∞–∫–∞–∑</p>
        </header>

        <div class="cheese-card">
            <div class="cheese-image"></div>
            <h2 class="cheese-name">–ê—Å—Å–æ—Ä—Ç–∏ —Ñ–µ—Ä–º–µ—Ä—Å–∫–∏—Ö —Å—ã—Ä–æ–≤</h2>
            <div class="cheese-price">–æ—Ç 1 200 ‚ÇΩ/–∫–≥</div>
            <div class="cheese-price-per-kg">–¶–µ–Ω–∞ –∑–∞–≤–∏—Å–∏—Ç –æ—Ç –≤—ã–±—Ä–∞–Ω–Ω–æ–≥–æ –≤–µ—Å–∞</div>
        </div>

        <div class="weight-section">
            <h3 class="section-title">–°–≤–æ–π –≤–µ—Å</h3>
            <div class="weight-input-wrapper">
                <input 
                    type="number" 
                    id="weightInput" 
                    class="weight-input" 
                    placeholder="0" 
                    min="100" 
                    step="50"
                    inputmode="numeric"
                >
                <span class="weight-unit">–≥</span>
            </div>
            <p class="weight-hint">
                –ú–æ–∂–Ω–æ —É–∫–∞–∑–∞—Ç—å –∞–±—Å–æ–ª—é—Ç–Ω–æ –ª—é–±–æ–π –≤–µ—Å –≤ –≥—Ä–∞–º–º–∞—Ö ‚Äî –º—ã –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–µ—Ä–µ—Å—á–∏—Ç–∞–µ–º —Å—É–º–º—É, 
                <strong>—Å–∫–∏–¥–∫–∏ –ø–æ –∫–∏–ª–æ–≥—Ä–∞–º–º–∞–º</strong> —Ç–æ–∂–µ —É—á–∏—Ç—ã–≤–∞—é—Ç—Å—è.
            </p>
            
            <div class="quick-weights">
                <button class="quick-weight-btn" data-weight="200">200–≥</button>
                <button class="quick-weight-btn" data-weight="500">500–≥</button>
                <button class="quick-weight-btn" data-weight="1000">1–∫–≥</button>
                <button class="quick-weight-btn" data-weight="2000">2–∫–≥</button>
            </div>
        </div>

        <div class="quantity-section">
            <h3 class="section-title" style="margin-bottom: 20px; text-align: center;">–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ</h3>
            <div class="quantity-controls">
                <button class="quantity-btn" id="decreaseBtn">‚àí</button>
                <div class="quantity-value" id="quantityValue">1</div>
                <button class="quantity-btn" id="increaseBtn">+</button>
            </div>
        </div>

        <div class="summary">
            <div class="summary-row">
                <span class="summary-label">–í–µ—Å –Ω–∞ –ø–æ—Ä—Ü–∏—é</span>
                <span class="summary-value" id="summaryWeight">0 –≥</span>
            </div>
            <div class="summary-row">
                <span class="summary-label">–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ—Ä—Ü–∏–π</span>
                <span class="summary-value" id="summaryQuantity">1</span>
            </div>
            <div class="summary-row">
                <span class="summary-label">–û–±—â–∏–π –≤–µ—Å</span>
                <span class="summary-value" id="summaryTotalWeight">0 –≥</span>
            </div>
            <div class="summary-row" id="discountRow" style="display: none;">
                <span class="summary-label">–°–∫–∏–¥–∫–∞ –∑–∞ –≤–µ—Å</span>
                <span class="summary-value" style="color: var(--success);">‚àí<span id="discountAmount">0</span> ‚ÇΩ</span>
            </div>
            <div class="summary-row">
                <span class="summary-label">–ò—Ç–æ–≥–æ</span>
                <span class="total-price" id="totalPrice">0 ‚ÇΩ</span>
            </div>
            <div id="discountBadge" class="discount-badge" style="display: none;">
                üéÅ –°–∫–∏–¥–∫–∞ –∑–∞ –æ–±—ä–µ–º
            </div>
        </div>
    </div>

    <div class="order-button">
        <button class="order-btn" id="orderBtn">
            <span>–û—Ñ–æ—Ä–º–∏—Ç—å –∑–∞–∫–∞–∑</span>
            <span id="btnPrice">0 ‚ÇΩ</span>
        </button>
    </div>

    <div class="overlay" id="overlay"></div>
    <div class="success-message" id="successMessage">
        <div class="success-icon">‚úÖ</div>
        <div class="success-text">–ó–∞–∫–∞–∑ –æ—Ñ–æ—Ä–º–ª–µ–Ω!</div>
        <div class="success-subtext">–ú—ã —Å–≤—è–∂–µ–º—Å—è —Å –≤–∞–º–∏ –≤ –±–ª–∏–∂–∞–π—à–µ–µ –≤—Ä–µ–º—è</div>
    </div>

    <script>
        // Telegram WebApp initialization
        let tg = window.Telegram?.WebApp;
        
        if (tg) {
            tg.ready();
            tg.expand();
            
            // Set theme colors
            tg.setHeaderColor('#0f0f1a');
            tg.setBackgroundColor('#0f0f1a');
            
            // Enable closing confirmation if there are items in cart
            tg.enableClosingConfirmation();
        }

        // State
        let state = {
            weight: 0,
            quantity: 1,
            basePrice: 1200, // per kg
            discount: 0
        };

        // DOM Elements
        const weightInput = document.getElementById('weightInput');
        const quantityValue = document.getElementById('quantityValue');
        const decreaseBtn = document.getElementById('decreaseBtn');
        const increaseBtn = document.getElementById('increaseBtn');
        const orderBtn = document.getElementById('orderBtn');
        const quickWeightBtns = document.querySelectorAll('.quick-weight-btn');
        const hapticIndicator = document.getElementById('hapticIndicator');

        // Haptic feedback
        function haptic(type = 'light') {
            if (tg?.HapticFeedback) {
                tg.HapticFeedback.impactOccurred(type);
                // Visual indicator
                hapticIndicator.classList.add('active');
                setTimeout(() => hapticIndicator.classList.remove('active'), 100);
            }
        }

        // Calculate price with discounts
        function calculatePrice() {
            const totalWeightKg = (state.weight * state.quantity) / 1000;
            let pricePerKg = state.basePrice;
            let discount = 0;

            // Volume discounts
            if (totalWeightKg >= 5) {
                pricePerKg = state.basePrice * 0.85; // 15% off
                discount = (state.basePrice - pricePerKg) * totalWeightKg;
            } else if (totalWeightKg >= 3) {
                pricePerKg = state.basePrice * 0.90; // 10% off
                discount = (state.basePrice - pricePerKg) * totalWeightKg;
            } else if (totalWeightKg >= 1) {
                pricePerKg = state.basePrice * 0.95; // 5% off
                discount = (state.basePrice - pricePerKg) * totalWeightKg;
            }

            const totalPrice = pricePerKg * totalWeightKg;
            
            return {
                total: Math.round(totalPrice),
                discount: Math.round(discount),
                pricePerKg: Math.round(pricePerKg)
            };
        }

        // Update UI
        function updateUI() {
            const calculation = calculatePrice();
            
            // Update summary
            document.getElementById('summaryWeight').textContent = `${state.weight} –≥`;
            document.getElementById('summaryQuantity').textContent = state.quantity;
            document.getElementById('summaryTotalWeight').textContent = `${state.weight * state.quantity} –≥`;
            document.getElementById('totalPrice').textContent = `${calculation.total.toLocaleString('ru-RU')} ‚ÇΩ`;
            document.getElementById('btnPrice').textContent = `${calculation.total.toLocaleString('ru-RU')} ‚ÇΩ`;

            // Update discount display
            const discountRow = document.getElementById('discountRow');
            const discountBadge = document.getElementById('discountBadge');
            
            if (calculation.discount > 0) {
                discountRow.style.display = 'flex';
                document.getElementById('discountAmount').textContent = calculation.discount.toLocaleString('ru-RU');
                discountBadge.style.display = 'inline-flex';
            } else {
                discountRow.style.display = 'none';
                discountBadge.style.display = 'none';
            }

            // Update button state
            orderBtn.disabled = state.weight < 100;
            
            // Update active quick weight button
            quickWeightBtns.forEach(btn => {
                if (parseInt(btn.dataset.weight) === state.weight) {
                    btn.classList.add('active');
                } else {
                    btn.classList.remove('active');
                }
            });

            // Update MainButton if in Telegram
            if (tg?.MainButton) {
                if (state.weight >= 100) {
                    tg.MainButton.setText(`–ó–∞–∫–∞–∑–∞—Ç—å –Ω–∞ ${calculation.total.toLocaleString('ru-RU')} ‚ÇΩ`);
                    tg.MainButton.show();
                    tg.MainButton.onClick(() => submitOrder());
                } else {
                    tg.MainButton.hide();
                }
            }
        }

        // Weight input handler
        weightInput.addEventListener('input', (e) => {
            let value = parseInt(e.target.value) || 0;
            
            // Limit max weight
            if (value > 10000) value = 10000;
            
            state.weight = value;
            updateUI();
        });

        weightInput.addEventListener('focus', () => {
            haptic('light');
        });

        // Quick weight buttons
        quickWeightBtns.forEach(btn => {
            btn.addEventListener('click', () => {
                haptic('medium');
                const weight = parseInt(btn.dataset.weight);
                state.weight = weight;
                weightInput.value = weight;
                updateUI();
            });
        });

        // Quantity controls
        decreaseBtn.addEventListener('click', () => {
            if (state.quantity > 1) {
                haptic('light');
                state.quantity--;
                quantityValue.textContent = state.quantity;
                updateUI();
            }
        });

        increaseBtn.addEventListener('click', () => {
            if (state.quantity < 20) {
                haptic('light');
                state.quantity++;
                quantityValue.textContent = state.quantity;
                updateUI();
            }
        });

        // Order submission
        function submitOrder() {
            if (state.weight < 100) return;
            
            haptic('heavy');
            
            const calculation = calculatePrice();
            const orderData = {
                weight: state.weight,
                quantity: state.quantity,
                totalWeight: state.weight * state.quantity,
                price: calculation.total,
                discount: calculation.discount,
                timestamp: new Date().toISOString()
            };

            // Show success
            document.getElementById('overlay').classList.add('show');
            document.getElementById('successMessage').classList.add('show');

            // Send data to Telegram
            if (tg) {
                tg.sendData(JSON.stringify(orderData));
                
                // Close after delay
                setTimeout(() => {
                    tg.close();
                }, 2000);
            }

            // Hide success after 3 seconds if not in Telegram
            setTimeout(() => {
                document.getElementById('overlay').classList.remove('show');
                document.getElementById('successMessage').classList.remove('show');
            }, 3000);
        }

        orderBtn.addEventListener('click', submitOrder);

        // Initialize
        updateUI();

        // Keyboard handling for mobile
        weightInput.addEventListener('blur', () => {
            window.scrollTo(0, 0);
        });

        // Prevent zoom on double tap
        let lastTouchEnd = 0;
        document.addEventListener('touchend', (e) => {
            const now = Date.now();
            if (now - lastTouchEnd <= 300) {
                e.preventDefault();
            }
            lastTouchEnd = now;
        }, false);
    </script>
</body>
</html>
