<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover" />
  <title>–°—ã—Ä–æ–º–∞–Ω–∏—è</title>
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  <style>
    :root{
      --bg-color:#F8EFDA;--text-color:#2E2A23;--hint-color:#8A7F6A;--link-color:#8B5E34;
      --button-color:#8B5E34;--button-text-color:#fff;--secondary-bg-color:#FFF6E7;
      --header-bg-color:#FFF9EF;--section-bg-color:#fff;--border-color:#E7D8BF;
      --error-color:#E74C3C;--success-color:#2E8B57;--radius-lg:12px;--shadow:0 6px 16px rgba(0,0,0,.08)
    }
    *{box-sizing:border-box}
    body{margin:0;background:var(--bg-color);color:var(--text-color);font:16px -apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,Helvetica,Arial,sans-serif;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}
    #app{display:flex;flex-direction:column;min-height:100vh}
    header{background:var(--header-bg-color);border-bottom:1px solid var(--border-color);padding:10px;position:sticky;top:0;z-index:3}
    .user-profile{display:flex;align-items:center;gap:10px;margin-bottom:10px}
    .user-avatar{width:32px;height:32px;border-radius:50%;background:var(--secondary-bg-color);display:flex;align-items:center;justify-content:center;color:var(--hint-color);overflow:hidden}
    .user-avatar img{width:100%;height:100%;object-fit:cover}
    .user-name{font-weight:600}
    .search-container{margin-bottom:10px}
    #search-input{width:100%;padding:10px;border:1px solid var(--border-color);border-radius:10px;background:var(--secondary-bg-color);color:var(--text-color)}
    .filters-container{display:flex;gap:10px;align-items:center;flex-wrap:wrap}
    #category-filter{padding:8px;border:1px solid var(--border-color);border-radius:10px;background:var(--secondary-bg-color);color:var(--text-color);flex-grow:1}
    #only-cheese-toggle{display:flex;align-items:center;gap:6px;cursor:pointer;white-space:nowrap}
    main{flex-grow:1;padding:10px 10px 90px}
    .section-divider{margin:20px 0 10px;font-size:15px;font-weight:800;opacity:.9}
    .product-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(160px,1fr));gap:15px}
    .product-card{position:relative;border:1px solid var(--border-color);border-radius:var(--radius-lg);padding:12px;background:var(--section-bg-color);cursor:pointer;display:flex;flex-direction:column;justify-content:space-between;transition:transform .18s ease, box-shadow .18s ease}
    .product-card:hover{transform:translateY(-4px);box-shadow:var(--shadow)}
    .card-media{width:100%;aspect-ratio:1/1;border-radius:10px;background:#fff;display:grid;place-items:center;overflow:hidden;margin-bottom:8px;border:1px solid var(--border-color)}
    .card-media img{width:100%;height:100%;object-fit:cover}
    .fallback-ico{font-size:40px;opacity:.7}
    .name{font-weight:700;font-size:14px;margin-bottom:4px;flex-grow:1}
    .price{color:var(--hint-color);font-size:13px}
    .badge-approx{position:absolute;left:10px;top:10px;background:var(--secondary-bg-color);border:1px solid var(--border-color);border-radius:999px;padding:2px 8px;font-size:11px}
    .fav-btn{position:absolute;right:10px;top:10px;background:#fff;border:1px solid var(--border-color);width:30px;height:30px;border-radius:50%;display:grid;place-items:center;color:#d34a4a}
    .fav-btn.active{background:#ffe5e5;border-color:#ffb9b9}
    .favorites-strip{display:flex;gap:10px;overflow:auto;padding:6px 2px 10px}
    .favorites-title{font-weight:800;font-size:14px;margin:10px 0 6px}
    .mini-card{min-width:130px;max-width:130px}
    .cart-footer{position:sticky;bottom:0;background:var(--header-bg-color);border-top:1px solid var(--border-color);padding:10px;display:flex;justify-content:center;align-items:center;z-index:2}
    #open-cart-btn{background:var(--button-color);color:var(--button-text-color);padding:12px 24px;border-radius:24px;cursor:pointer;border:none;font-weight:700;width:100%;max-width:460px;transition:filter .2s}
    #open-cart-btn:hover{filter:brightness(108%)}
    #open-cart-btn:disabled{background:var(--hint-color);cursor:not-allowed}
    dialog{border:1px solid var(--border-color);border-radius:var(--radius-lg);padding:0;background:var(--section-bg-color);color:var(--text-color);width:90vw;max-width:480px;max-height:86vh;overflow:hidden;box-shadow:0 12px 30px rgba(0,0,0,.18)}
    dialog::backdrop{background:rgba(0,0,0,.5);backdrop-filter:blur(4px)}
    .modal-header{padding:14px 16px;border-bottom:1px solid var(--border-color);display:flex;justify-content:space-between;align-items:center;background:var(--header-bg-color);position:sticky;top:0;z-index:1}
    .modal-header h2{margin:0;font-size:18px}
    .modal-close{background:none;border:none;font-size:24px;cursor:pointer;color:var(--hint-color);padding:0;line-height:1;border-radius:50%;width:32px;height:32px;display:grid;place-items:center}
    .modal-close:hover{background:var(--secondary-bg-color)}
    .modal-body{padding:14px 16px;overflow-y:auto;max-height:68vh}
    .modal-img{width:100%;border-radius:12px;border:1px solid var(--border-color);margin-bottom:8px}
    .description{color:var(--hint-color);font-size:14px}
    .form-group{margin:10px 0}
    .form-group label{display:block;margin-bottom:6px;font-size:14px;font-weight:700}
    .form-group select,.form-group input,.form-group textarea{width:100%;padding:10px;border:1px solid var(--border-color);border-radius:10px;background:var(--secondary-bg-color);color:var(--text-color)}
    .form-row{display:flex;gap:10px}
    .form-row .form-group{flex:1}
    .inline-hint{font-size:12px;color:var(--hint-color);margin-top:4px}
    .price-display{font-size:18px;font-weight:800;text-align:center;margin:12px 0}
    .btn{padding:12px 20px;border:none;border-radius:10px;font-size:16px;font-weight:800;cursor:pointer;width:100%;transition:transform .08s, filter .18s}
    .btn:active{transform:scale(.98)}
    .btn-primary{background:var(--button-color);color:var(--button-text-color)}
    .btn-primary:hover{filter:brightness(108%)}
    .btn-secondary{background:var(--secondary-bg-color);color:var(--text-color);border:1px solid var(--border-color)}
    .btn-secondary:hover{background:#fdeed6}
    .cart-item{display:flex;justify-content:space-between;align-items:center;padding:10px 0;border-bottom:1px solid var(--border-color)}
    .cart-item:last-child{border-bottom:none}
    .cart-item-info{flex:1;padding-right:10px}
    .cart-item-name{font-weight:800}
    .cart-item-variant{font-size:13px;color:var(--hint-color)}
    .cart-item-price{font-size:14px}
    .discount-hint{color:var(--success-color);font-size:12px;margin-top:4px}
    .qty-control{display:flex;align-items:center;border:1px solid var(--border-color);border-radius:10px;overflow:hidden}
    .qty-control button{background:none;border:none;width:32px;height:32px;cursor:pointer;font-size:18px;color:var(--text-color);display:grid;place-items:center}
    .qty-control button:hover{background:var(--secondary-bg-color)}
    .qty-control span{padding:0 10px;min-width:30px;text-align:center}
    .cart-summary{margin-top:16px;padding-top:12px;border-top:2px solid var(--border-color);font-size:18px;font-weight:900;text-align:right}
    .weighing-note{margin-top:6px;font-size:12px;color:var(--hint-color);text-align:right}
    .promo-wrap{display:flex;gap:8px;margin-top:10px}
    .error-text{color:var(--error-color);font-size:13px;margin-top:6px}
  </style>
</head>
<body>
  <div id="app">
    <header>
      <div class="user-profile" id="user-profile"></div>
      <div class="search-container">
        <input type="search" id="search-input" placeholder="–ü–æ–∏—Å–∫ –ø–æ –Ω–∞–∑–≤–∞–Ω–∏—é..." />
      </div>
      <div class="filters-container">
        <select id="category-filter"><option value="">–í—Å–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏</option></select>
        <label id="only-cheese-toggle">
          <input type="checkbox" id="only-cheese-checkbox" />
          <span>–¢–æ–ª—å–∫–æ —Å—ã—Ä—ã</span>
        </label>
      </div>
      <div class="favorites-title" id="favorites-title" style="display:none;">–ò–∑–±—Ä–∞–Ω–Ω–æ–µ</div>
      <div class="favorites-strip" id="favorites-strip" style="display:none;"></div>
    </header>

    <main>
      <div id="product-sections"></div>
    </main>

    <footer class="cart-footer">
      <button id="open-cart-btn" disabled>–ö–æ—Ä–∑–∏–Ω–∞ –ø—É—Å—Ç–∞</button>
    </footer>
  </div>

  <!-- Product modal -->
  <dialog id="product-modal">
    <div class="modal-header">
      <h2 id="product-modal-title"></h2>
      <button class="modal-close" onclick="closeProductModal()">&times;</button>
    </div>
    <div class="modal-body">
      <img id="product-modal-img" class="modal-img" alt="" />
      <p class="description" id="product-modal-description"></p>

      <div class="form-group" id="variant-group">
        <label for="product-variant-select">–í–∞—Ä–∏–∞–Ω—Ç</label>
        <select id="product-variant-select"></select>
        <div class="inline-hint" id="approx-piece-hint" style="display:none"></div>
      </div>

      <div class="form-group" id="custom-weight-group" style="display:none">
        <label for="custom-weight-input">–°–≤–æ–π –≤–µ—Å (–≤ –≥—Ä–∞–º–º–∞—Ö)</label>
        <input type="number" id="custom-weight-input" inputmode="numeric" min="50" step="10" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä, 430" />
        <div class="inline-hint">–ú–æ–∂–Ω–æ —É–∫–∞–∑–∞—Ç—å –ª—é–±–æ–π –≤–µ—Å –≤ –¥–æ–ø—É—Å—Ç–∏–º–æ–º –¥–∏–∞–ø–∞–∑–æ–Ω–µ ‚Äî —Ü–µ–Ω–∞ –ø–µ—Ä–µ—Å—á–∏—Ç–∞–µ—Ç—Å—è.</div>
      </div>

      <div class="form-row" id="qty-row">
        <div class="form-group">
          <label for="product-qty-input">–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ</label>
          <input type="number" id="product-qty-input" value="1" min="1" />
        </div>
      </div>

      <div class="price-display" id="product-modal-price">0 ‚ÇΩ</div>
      <button class="btn btn-primary" id="add-to-cart-btn">–î–æ–±–∞–≤–∏—Ç—å –≤ –∫–æ—Ä–∑–∏–Ω—É</button>
    </div>
  </dialog>

  <!-- Cart + checkout modal -->
  <dialog id="cart-modal">
    <div class="modal-header">
      <h2>–ö–æ—Ä–∑–∏–Ω–∞</h2>
      <button class="modal-close" onclick="closeCartModal()">&times;</button>
    </div>
    <div class="modal-body" id="cart-modal-body"></div>
  </dialog>

  <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
  <script>
  // === BACKEND ENDPOINT ===
  const BACKEND = 'https://puzzlebot-webhook-handler1.onrender.com';

  // --- CONFIG ---
  const CURRENCY = 'RUB';
  const ROUND = Math.round;
  const DISCOUNT_THRESHOLDS = [ { g: 1000, rate: 0.15 }, { g: 700, rate: 0.10 }, { g: 500, rate: 0.05 } ];
  const ONLY_CHEESE_FILTER_DEFAULT = false;
  const PAYLOAD_SCHEMA_VERSION = 'v3';
  const STORAGE_CART_KEY = 'syromania-cart';
  const STORAGE_CHECKOUT_KEY = 'syromania-checkout';
  const STORAGE_FAVS_KEY = 'syromania-favs';
  const STORAGE_PROMO_KEY = 'syromania-promo';

  const fmtRub = (n) => new Intl.NumberFormat('ru-RU').format(n) + ' ‚ÇΩ';

  // --- IMAGES ---
  const IMG = {
    // GitHub raw
    'butter': 'https://raw.githubusercontent.com/youmyloving/syr/main/butter.webp',
    'halloumi-tomato-basil-garlic': 'https://raw.githubusercontent.com/youmyloving/syr/main/halloumi-tomato-basil-garlic.webp',
    'hard-village': 'https://raw.githubusercontent.com/youmyloving/syr/main/hard-village.webp',
    'imeretian': 'https://raw.githubusercontent.com/youmyloving/syr/main/imeretian.webp',
    'kosichka-smoked': 'https://raw.githubusercontent.com/youmyloving/syr/main/kosichka-smoked.webp',
    'mozzarella': 'https://raw.githubusercontent.com/youmyloving/syr/main/mozzarella.webp',
    'mozzarella-2': 'https://raw.githubusercontent.com/youmyloving/syr/main/mozzarella-2.webp',
    'panir-classic': 'https://raw.githubusercontent.com/youmyloving/syr/main/panir-classic.webp',
    'panir-herbs': 'https://raw.githubusercontent.com/youmyloving/syr/main/panir-herbs.webp',
    'panir-smoked': 'https://raw.githubusercontent.com/youmyloving/syr/main/panir-smoked.webp',
    'panir-spicy': 'https://raw.githubusercontent.com/youmyloving/syr/main/panir-spicy.webp',
    'rolls-apricot-cedar': 'https://raw.githubusercontent.com/youmyloving/syr/main/rolls-apricot-cedar.webp',
    'rolls-olives-walnut': 'https://raw.githubusercontent.com/youmyloving/syr/main/rolls-olives-walnut.webp',
    'sandesh-orange': 'https://raw.githubusercontent.com/youmyloving/syr/main/sandesh-orange.webp',
    'sandesh-walnut': 'https://raw.githubusercontent.com/youmyloving/syr/main/sandesh-walnut.webp',
    // Tilda CDN
    'barfi-classic': 'https://static.tildacdn.com/tild3430-3231-4562-b164-366638313434/barfi-classic.webp',
    'barfi-hazelnut': 'https://static.tildacdn.com/tild3065-3332-4466-a536-353130343264/barfi-hazelnut.webp',
    'caciotta': 'https://static.tildacdn.com/tild6165-3265-4834-a236-366661346562/caciotta.webp',
    'chapati-10': 'https://static.tildacdn.com/tild6332-6239-4538-b839-356132356236/chapati-10.webp',
    'cookies-nut': 'https://static.tildacdn.com/tild3035-6230-4434-b363-303434366630/cookies-nut.webp',
    'cream': 'https://static.tildacdn.com/tild3163-3665-4636-a537-303830323163/cream.webp',
    'halloumi': 'https://static.tildacdn.com/tild3161-6362-4130-b134-623331346238/halloumi.webp',
    'halloumi-paprika-oregano': 'https://static.tildacdn.com/tild3133-6165-4134-b335-396662633262/halloumi-paprika-ore.webp',
    'halloumi-tomato-paprika': 'https://static.tildacdn.com/tild3863-3030-4439-a439-653238303862/halloumi-tomato-papr.webp',
    'hard-smoked': 'https://static.tildacdn.com/tild6662-3930-4663-b132-316135626136/hard-smoked.webp',
    'milk-topped': 'https://static.tildacdn.com/tild3839-3163-4066-a633-306366346631/milk-topped.webp',
    'muffin-raisin': 'https://static.tildacdn.com/tild3465-3162-4436-a235-363763383339/muffin-raisin.webp',
    'potato-cake-2': 'https://static.tildacdn.com/tild3961-6133-4632-b162-396333663962/potato-cake-2.webp',
    'spicy-klubok': 'https://static.tildacdn.com/tild3463-6166-4665-a439-323264653939/spicy-klubok.webp',
    'stracciatella': 'https://static.tildacdn.com/tild3832-6430-4462-b663-353438383930/stracciatella.webp',
    'suluguni': 'https://static.tildacdn.com/tild3238-3866-4366-a436-623236363261/suluguni.webp',
    'suluguni-smoked': 'https://static.tildacdn.com/tild6435-3838-4463-b431-353765323333/suluguni-smoked.webp',
    'tvorog': 'https://static.tildacdn.com/tild3136-3730-4134-b466-613138343764/tvorog.webp',
    'tvmassa-raisin': 'https://static.tildacdn.com/tild6630-3237-4430-b461-313634376333/tvorozhnaya-massa_.webp',
    'tvmassa-date': 'https://static.tildacdn.com/tild6334-3636-4432-a132-306531366333/tvorozhnaya-massa_.webp',
    'tvmassa-prune': 'https://static.tildacdn.com/tild3333-3365-4063-a162-306230313233/tvorozhnaya-massa_.webp'
  };

  // --- PRODUCTS (–æ–±–Ω–æ–≤–ª—ë–Ω–Ω—ã–µ —Ü–µ–Ω—ã –∏ –æ–ø–∏—Å–∞–Ω–∏—è) ---
  // displaySection: —Ä–∞–∑–¥–µ–ª –Ω–∞ –≥–ª–∞–≤–Ω–æ–π; cat: —Ñ–∏–ª—å—Ç—Ä –≤ —à–∞–ø–∫–µ
  const PRODUCTS = [
    // ===== –°–´–†–´ =====
    // –ú—è–≥–∫–∏–µ / –ø–æ–∑–∏—Ü–∏–æ–Ω–Ω—ã–µ
    { id:'mozzarella', name:'–ú–æ—Ü–∞—Ä–µ–ª–ª–∞', cat:'–°—ã—Ä—ã', displaySection:'–ú—è–≥–∫–∏–µ —Å—ã—Ä—ã', pricePerKg:2000, ico:'üßÄ',
      description:'–ù–µ–∂–Ω–∞—è —Å–≤–µ–∂–∞—è –º–æ—Ü–∞—Ä–µ–ª–ª–∞. –ù–∏—Ç–∏ —Ç—è–Ω—É—Ç—Å—è, –≤–∫—É—Å –º–æ–ª–æ—á–Ω—ã–π. –°—Ä–æ–∫ —Ö—Ä–∞–Ω–µ–Ω–∏—è: 5‚Äì7 —Å—É—Ç–æ–∫.',
      img:IMG['mozzarella'] || IMG['mozzarella-2'], variantsNote:'1 —à—Ç ‚âà200 –≥', piece:true },
    { id:'buratta', name:'–ë—É—Ä—Ä–∞—Ç–∞', cat:'–°—ã—Ä—ã', displaySection:'–ú—è–≥–∫–∏–µ —Å—ã—Ä—ã', pricePerKg:2100, ico:'üßÄ',
      description:'–ú–µ—à–æ—á–µ–∫ –∏–∑ –º–æ—Ü–∞—Ä–µ–ª–ª—ã c –Ω–∞—á–∏–Ω–∫–æ–π –∏–∑ —Å—Ç—Ä–∞—á–∞—Ç–µ–ª–ª—ã. –ò–¥–µ–∞–ª—å–Ω–∞ –∫ –∑–µ–ª–µ–Ω–∏ –∏ —Ç–æ–º–∞—Ç–∞–º. –°—Ä–æ–∫: 3‚Äì5 —Å—É—Ç–æ–∫.',
      img:IMG['mozzarella-2'], piece:true },
    { id:'stracciatella', name:'–°—Ç—Ä–∞—á–∞—Ç–µ–ª–ª–∞', cat:'–°—ã—Ä—ã', displaySection:'–ú—è–≥–∫–∏–µ —Å—ã—Ä—ã', pricePerKg:2150, ico:'üßÄ',
      description:'–ù–∏—Ç–∏ –º–æ—Ü–∞—Ä–µ–ª–ª—ã –≤ —Å–ª–∏–≤–∫–∞—Ö. –°—Ä–æ–∫ —Ö—Ä–∞–Ω–µ–Ω–∏—è: 5‚Äì7 —Å—É—Ç–æ–∫.',
      img:IMG['stracciatella'] },

    { id:'ricotta', name:'–¢–≤–æ—Ä–æ–∂–Ω—ã–π —Å—ã—Ä (—Ä–∏–∫–æ—Ç—Ç–∞)', cat:'–°—ã—Ä—ã', displaySection:'–ú—è–≥–∫–∏–µ —Å—ã—Ä—ã', pricePerKg:1400, ico:'ü•õ',
      description:'–ù–µ–∂–Ω—ã–π —Å—ã—Ä –¥–ª—è –±—É—Ç–µ—Ä–±—Ä–æ–¥–æ–≤ –∏ –±–ª—é–¥. –°—Ä–æ–∫: 7 —Å—É—Ç–æ–∫.' },
    { id:'ricotta-herbs', name:'–†–∏–∫–æ—Ç—Ç–∞ —Å —É–∫—Ä–æ–ø–æ–º –∏ –∑–µ–ª–µ–Ω—å—é', cat:'–°—ã—Ä—ã', displaySection:'–ú—è–≥–∫–∏–µ —Å—ã—Ä—ã', pricePerKg:1500, ico:'üåø',
      description:'–ù–µ–∂–Ω—ã–π, —Å–≤–µ–∂–∏–π, —É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–π. –°—Ä–æ–∫: 7 —Å—É—Ç–æ–∫.' },

    { id:'caciotta', name:'–ö–∞—á–æ—Ç—Ç–∞', cat:'–°—ã—Ä—ã', displaySection:'–ú—è–≥–∫–∏–µ —Å—ã—Ä—ã', pricePerKg:2200, ico:'üßÄ',
      description:'–ú—è–≥–∫–∏–π –∏—Ç–∞–ª—å—è–Ω—Å–∫–∏–π —Å—ã—Ä.', img:IMG['caciotta'] },
    { id:'caciotta-fenugreek', name:'–ö–∞—á–æ—Ç—Ç–∞ —Å –ø–∞–∂–∏—Ç–Ω–∏–∫–æ–º', cat:'–°—ã—Ä—ã', displaySection:'–ú—è–≥–∫–∏–µ —Å—ã—Ä—ã', pricePerKg:2250, ico:'üåø',
      description:'–û—Ä–µ—Ö–æ–≤—ã–µ –Ω–æ—Ç–∫–∏ –ø–∞–∂–∏—Ç–Ω–∏–∫–∞.' },

    // –†–∞—Å—Å–æ–ª—å–Ω—ã–µ
    { id:'suluguni', name:'–°—É–ª—É–≥—É–Ω–∏', cat:'–°—ã—Ä—ã', displaySection:'–†–∞—Å—Å–æ–ª—å–Ω—ã–µ —Å—ã—Ä—ã', pricePerKg:1700, ico:'üßÄ',
      description:'–£–º–µ—Ä–µ–Ω–Ω–æ —Å–æ–ª—ë–Ω—ã–π, —Å–ª–æ–∏—Å—Ç—ã–π –∏ —ç–ª–∞—Å—Ç–∏—á–Ω—ã–π. –°—Ä–æ–∫: 7 —Å—É—Ç–æ–∫.', img:IMG['suluguni'] },
    { id:'suluguni-smoked', name:'–°—É–ª—É–≥—É–Ω–∏ –∫–æ–ø—á—ë–Ω—ã–π', cat:'–°—ã—Ä—ã', displaySection:'–†–∞—Å—Å–æ–ª—å–Ω—ã–µ —Å—ã—Ä—ã', pricePerKg:1800, ico:'üí®',
      description:'–õ—ë–≥–∫–∞—è –∫–æ–ø—á—ë–Ω–æ—Å—Ç—å, –ø–ª–æ—Ç–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞. –°—Ä–æ–∫: 30 —Å—É—Ç–æ–∫.', img:IMG['suluguni-smoked'] },
    { id:'imeretian', name:'–ò–º–µ—Ä–µ—Ç–∏–Ω—Å–∫–∏–π', cat:'–°—ã—Ä—ã', displaySection:'–†–∞—Å—Å–æ–ª—å–Ω—ã–µ —Å—ã—Ä—ã', pricePerKg:1500, ico:'üßÄ',
      description:'–ü—Ä–µ–∫—Ä–∞—Å–Ω—ã–π —Ä–∞—Å—Å–æ–ª—å–Ω—ã–π —Å—ã—Ä, –∫–æ –≤—Å–µ–º –±–ª—é–¥–∞–º. –°—Ä–æ–∫: 7 —Å—É—Ç–æ–∫.', img:IMG['imeretian'] },
    { id:'imeretian-dill-garlic', name:'–ò–º–µ—Ä–µ—Ç–∏–Ω—Å–∫–∏–π —Å —É–∫—Ä–æ–ø–æ–º –∏ —á–µ—Å–Ω–æ–∫–æ–º', cat:'–°—ã—Ä—ã', displaySection:'–†–∞—Å—Å–æ–ª—å–Ω—ã–µ —Å—ã—Ä—ã', pricePerKg:1600, ico:'üßÑ',
      description:'–°–≤–µ–∂–∏–π —Å –∞—Ä–æ–º–∞—Ç–Ω–æ–π –∑–µ–ª–µ–Ω—å—é –∏ —á–µ—Å–Ω–æ–∫–æ–º. –°—Ä–æ–∫: 7 —Å—É—Ç–æ–∫.' },

    // –•–∞–ª–ª—É–º–∏ (–±—Ä—ã–Ω–∑–æ–≤—ã–µ/–∂–∞—Ä–µ–Ω—ã–µ ‚Äî –æ—Å—Ç–∞–≤–∏–º –≤ —Ä–∞—Å—Å–æ–ª—å–Ω—ã—Ö)
    { id:'halloumi', name:'–•–∞–ª–ª—É–º–∏ (–∫–ª–∞—Å—Å–∏—á–µ—Å–∫–∏–π)', cat:'–°—ã—Ä—ã', displaySection:'–†–∞—Å—Å–æ–ª—å–Ω—ã–µ —Å—ã—Ä—ã', pricePerKg:1950, ico:'üî•',
      description:'–ò–¥–µ–∞–ª–µ–Ω –¥–ª—è –∂–∞—Ä–∫–∏ –∏–ª–∏ –±–µ–∑ –Ω–µ—ë. –°—Ä–æ–∫: 7 —Å—É—Ç–æ–∫.', img:IMG['halloumi'], piece:true },
    { id:'halloumi-paprika-oregano', name:'–•–∞–ª–ª—É–º–∏ —Å –ø–∞–ø—Ä–∏–∫–æ–π –∏ –æ—Ä–µ–≥–∞–Ω–æ', cat:'–°—ã—Ä—ã', displaySection:'–†–∞—Å—Å–æ–ª—å–Ω—ã–µ —Å—ã—Ä—ã', pricePerKg:2100, ico:'üå∂Ô∏è',
      description:'–°—Ä–µ–¥–∏–∑–µ–º–Ω–æ–º–æ—Ä—Å–∫–∏–µ –Ω–æ—Ç–∫–∏, —Ö–æ—Ä–æ—à –Ω–∞ –≥—Ä–∏–ª–µ. –°—Ä–æ–∫: 7 —Å—É—Ç–æ–∫.', img:IMG['halloumi-paprika-oregano'], piece:true },
    { id:'halloumi-tomato-basil-garlic', name:'–•–∞–ª–ª—É–º–∏ —Ç–æ–º–∞—Ç-–±–∞–∑–∏–ª–∏–∫-—á–µ—Å–Ω–æ–∫', cat:'–°—ã—Ä—ã', displaySection:'–†–∞—Å—Å–æ–ª—å–Ω—ã–µ —Å—ã—Ä—ã', pricePerKg:2100, ico:'üçÖ',
      description:'–ê—Ä–æ–º–∞—Ç–Ω—ã–π, –∏–¥–µ–∞–ª–µ–Ω –¥–ª—è –∂–∞—Ä–∫–∏. –°—Ä–æ–∫: 7 —Å—É—Ç–æ–∫.', img:IMG['halloumi-tomato-basil-garlic'], piece:true },
    { id:'halloumi-tomato-paprika', name:'–•–∞–ª–ª—É–º–∏ —Å –≤—è–ª–µ–Ω—ã–º–∏ –ø–æ–º–∏–¥–æ—Ä–∞–º–∏ –∏ –ø–∞–ø—Ä–∏–∫–æ–π', cat:'–°—ã—Ä—ã', displaySection:'–†–∞—Å—Å–æ–ª—å–Ω—ã–µ —Å—ã—Ä—ã', pricePerKg:2100, ico:'üçÖ',
      description:'–Ø—Ä–∫–∏–π –∏ –Ω–∞—Å—ã—â–µ–Ω–Ω—ã–π. –°—Ä–æ–∫: 7 —Å—É—Ç–æ–∫.', img:IMG['halloumi-tomato-paprika'], piece:true },

    // –¢–≤—ë—Ä–¥—ã–µ
    { id:'hard-village', name:'–¢–≤—ë—Ä–¥—ã–π –ø–æ-–¥–µ—Ä–µ–≤–µ–Ω—Å–∫–∏', cat:'–°—ã—Ä—ã', displaySection:'–¢–≤—ë—Ä–¥—ã–µ —Å—ã—Ä—ã', pricePerKg:1600, ico:'üßÄ',
      description:'–ì–æ—Ç–æ–≤–∏—Ç—Å—è –∏–∑ —Ç–≤–æ—Ä–æ–≥–∞ —Å –ø—Ä–∏–ø—Ä–∞–≤–∞–º–∏, –æ–±–∂–∞—Ä–∏–≤–∞–µ—Ç—Å—è. –°—Ä–æ–∫: 7 —Å—É—Ç–æ–∫.', img:IMG['hard-village'] },
    { id:'hard-smoked', name:'–¢–≤—ë—Ä–¥—ã–π –∫–æ–ø—á—ë–Ω—ã–π', cat:'–°—ã—Ä—ã', displaySection:'–¢–≤—ë—Ä–¥—ã–µ —Å—ã—Ä—ã', pricePerKg:1800, ico:'üí®',
      description:'–¢–≤–æ—Ä–æ–≥ —Å –ø—Ä–∏–ø—Ä–∞–≤–∞–º–∏, –æ–±–∂–∞—Ä–µ–Ω –∏ –∑–∞—Ç–µ–º –∫–æ–ø—á—ë–Ω. –°—Ä–æ–∫: –¥–æ 30 —Å—É—Ç–æ–∫.', img:IMG['hard-smoked'] },

    // –°—ã—Ä–Ω—ã–µ —Ä—É–ª–µ—Ç—ã
    { id:'rolls-olives-walnut', name:'–°—ã—Ä–Ω—ã–π —Ä—É–ª–µ—Ç (–º–∞—Å–ª–∏–Ω—ã, –≥—Ä–µ—Ü–∫–∏–π –æ—Ä–µ—Ö)', cat:'–°—ã—Ä—ã', displaySection:'–°—ã—Ä–Ω—ã–µ —Ä—É–ª–µ—Ç—ã', pricePerKg:1700, ico:'ü•ú',
      description:'–ó–∞–∫—É—Å–∫–∞ –∫ –ª—é–±–æ–º—É —Å—Ç–æ–ª—É. –°—Ä–æ–∫: 7 —Å—É—Ç–æ–∫.', img:IMG['rolls-olives-walnut'] },
    { id:'rolls-apricot-cedar', name:'–°—ã—Ä–Ω—ã–π —Ä—É–ª–µ—Ç (–∫—É—Ä–∞–≥–∞, –∫–µ–¥—Ä–æ–≤—ã–π)', cat:'–°—ã—Ä—ã', displaySection:'–°—ã—Ä–Ω—ã–µ —Ä—É–ª–µ—Ç—ã', pricePerKg:1700, ico:'üçë',
      description:'–°–ª–µ–≥–∫–∞ —Å–ª–∞–¥–∫–æ–≤–∞—Ç—ã–π –∑–∞ —Å—á—ë—Ç –∫—É—Ä–∞–≥–∏ –∏ –æ—Ä–µ—Ö–æ–≤. –°—Ä–æ–∫: 7 —Å—É—Ç–æ–∫.', img:IMG['rolls-apricot-cedar'] },

    // –ê–¥—ã–≥–µ–π—Å–∫–∏–µ (–ø–∞–Ω–∏—Ä) ‚Äî –º—è–≥–∫–∏–µ
    { id:'panir-classic', name:'–ê–¥—ã–≥–µ–π—Å–∫–∏–π (–ø–∞–Ω–∏—Ä) –∫–ª–∞—Å—Å–∏—á–µ—Å–∫–∏–π', cat:'–°—ã—Ä—ã', displaySection:'–ú—è–≥–∫–∏–µ —Å—ã—Ä—ã', pricePerKg:1450, ico:'üßÄ',
      description:'–û—á–µ–Ω—å –Ω–µ–∂–Ω—ã–π, –º—è–≥–∫–∏–π, –º–æ–ª–æ—á–Ω—ã–π –≤–∫—É—Å. –°—Ä–æ–∫: 7 —Å—É—Ç–æ–∫.', img:IMG['panir-classic'] },
    { id:'panir-herbs', name:'–ê–¥—ã–≥–µ–π—Å–∫–∏–π —Å –∑–µ–ª–µ–Ω—å—é (–ø–∞–Ω–∏—Ä)', cat:'–°—ã—Ä—ã', displaySection:'–ú—è–≥–∫–∏–µ —Å—ã—Ä—ã', pricePerKg:1600, ico:'üåø',
      description:'–õ—ë–≥–∫–∏–π –∏ —Å–≤–µ–∂–∏–π. –°—Ä–æ–∫: 7 —Å—É—Ç–æ–∫.', img:IMG['panir-herbs'] },
    { id:'panir-spicy', name:'–ê–¥—ã–≥–µ–π—Å–∫–∏–π —Å–æ —Å–ø–µ—Ü–∏—è–º–∏ (–ø–∞–Ω–∏—Ä)', cat:'–°—ã—Ä—ã', displaySection:'–ú—è–≥–∫–∏–µ —Å—ã—Ä—ã', pricePerKg:1650, ico:'üå∂Ô∏è',
      description:'–ù–µ–∂–Ω—ã–π, –∞—Ä–æ–º–∞—Ç–Ω—ã–π, —Å–ø–µ—Ü–∏–∏ –≤ –º–µ—Ä—É. –°—Ä–æ–∫: 7 —Å—É—Ç–æ–∫.', img:IMG['panir-spicy'] },
    { id:'panir-smoked', name:'–ê–¥—ã–≥–µ–π—Å–∫–∏–π –∫–æ–ø—á—ë–Ω—ã–π (–ø–∞–Ω–∏—Ä)', cat:'–°—ã—Ä—ã', displaySection:'–ú—è–≥–∫–∏–µ —Å—ã—Ä—ã', pricePerKg:1700, ico:'üí®',
      description:'–ì–∞—Ä–º–æ–Ω–∏—á–Ω–∞—è –∫–æ–ø—á—ë–Ω–æ—Å—Ç—å, –±–µ–∑ —Ä–µ–∑–∫–æ—Å—Ç–∏. –°—Ä–æ–∫: 30 —Å—É—Ç–æ–∫.', img:IMG['panir-smoked'] },

    // –ö–æ—Å–∏—á–∫–∞
    { id:'kosichka', name:'–°—ã—Ä –∫–æ—Å–∏—á–∫–∞', cat:'–°—ã—Ä—ã', displaySection:'–†–∞—Å—Å–æ–ª—å–Ω—ã–µ —Å—ã—Ä—ã', pricePerKg:1900, ico:'ü•®',
      description:'–°–ª–µ–≥–∫–∞ —Å–æ–ª—ë–Ω—ã–π, –ø–æ–¥—Ö–æ–¥–∏—Ç –∫–æ –≤—Å–µ–º—É. –°—Ä–æ–∫: 7 —Å—É—Ç–æ–∫.' },
    { id:'kosichka-smoked', name:'–°—ã—Ä –∫–æ—Å–∏—á–∫–∞ –∫–æ–ø—á—ë–Ω–∞—è', cat:'–°—ã—Ä—ã', displaySection:'–†–∞—Å—Å–æ–ª—å–Ω—ã–µ —Å—ã—Ä—ã', pricePerKg:2000, ico:'üí®',
      description:'–•–æ–ª–æ–¥–Ω–æ–µ –∫–æ–ø—á–µ–Ω–∏–µ, –ª—ë–≥–∫–∞—è —Å–æ–ª—ë–Ω–æ—Å—Ç—å. –°—Ä–æ–∫: 30 —Å—É—Ç–æ–∫.', img:IMG['kosichka-smoked'] },

    // –ü—Ä—è–Ω—ã–µ –∫–ª—É–±–æ—á–∫–∏ ‚Äî –ø–æ–∑–∏—Ü–∏–æ–Ω–Ω—ã–µ 150 –≥
    { id:'spicy-klubok', name:'–ü—Ä—è–Ω—ã–µ –∫–ª—É–±–æ—á–∫–∏', cat:'–°—ã—Ä—ã', displaySection:'–†–∞—Å—Å–æ–ª—å–Ω—ã–µ —Å—ã—Ä—ã', pricePerKg:1950, ico:'üå∂Ô∏è',
      description:'–ù–µ—Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π –≤–∫—É—Å–Ω—ã–π —Å—ã—Ä, –Ω–µ —Å–∏–ª—å–Ω–æ —Å–æ–ª—ë–Ω—ã–π. –°—Ä–æ–∫: 7 —Å—É—Ç–æ–∫.', img:IMG['spicy-klubok'], piece:true },

    // ===== –ú–û–õ–û–ß–ù–ê–Ø –ü–†–û–î–£–ö–¶–ò–Ø =====
    { id:'milk', name:'–ú–æ–ª–æ–∫–æ', cat:'–ú–æ–ª–æ—á–Ω–∞—è –ø—Ä–æ–¥—É–∫—Ü–∏—è', displaySection:'–ú–æ–ª–æ—á–Ω–∞—è –ø—Ä–æ–¥—É–∫—Ü–∏—è', pricePerL:150,
      ico:'ü•õ', description:'–ú–æ–ª–æ–∫–æ –æ—Ç–±–æ—Ä–Ω–æ–µ —Ü–µ–ª—å–Ω–æ–µ, –æ—Ö–ª–∞–∂–¥—ë–Ω–Ω–æ–µ. –ö–∞–∫ –∏–∑ –¥–µ—Ç—Å—Ç–≤–∞! –°—Ä–æ–∫: 3‚Äì5 —Å—É—Ç–æ–∫.' },
    { id:'milk-topped', name:'–ú–æ–ª–æ–∫–æ —Ç–æ–ø–ª—ë–Ω–æ–µ', cat:'–ú–æ–ª–æ—á–Ω–∞—è –ø—Ä–æ–¥—É–∫—Ü–∏—è', displaySection:'–ú–æ–ª–æ—á–Ω–∞—è –ø—Ä–æ–¥—É–∫—Ü–∏—è', pricePerL:250,
      ico:'ü•õ', description:'–¶–µ–ª—å–Ω–æ–µ —Ç–æ–ø–ª—ë–Ω–æ–µ –º–æ–ª–æ–∫–æ, –≥—É—Å—Ç–æ–≤–∞—Ç–∞—è –∫–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ü–∏—è. –°—Ä–æ–∫: 5‚Äì7 —Å—É—Ç–æ–∫.', img:IMG['milk-topped'] },
    { id:'yogurt', name:'–ô–æ–≥—É—Ä—Ç –∫–ª–∞—Å—Å–∏—á–µ—Å–∫–∏–π', cat:'–ú–æ–ª–æ—á–Ω–∞—è –ø—Ä–æ–¥—É–∫—Ü–∏—è', displaySection:'–ú–æ–ª–æ—á–Ω–∞—è –ø—Ä–æ–¥—É–∫—Ü–∏—è', pricePerL:260,
      ico:'ü•õ', description:'–ù–∞—Å—Ç–æ—è—â–∏–π –π–æ–≥—É—Ä—Ç –∏–∑ –º–æ–ª–æ–∫–∞ –∏ –∑–∞–∫–≤–∞—Å–∫–∏. –°—Ä–æ–∫: 5 —Å—É—Ç–æ–∫.' },
    { id:'ryazhenka', name:'–†—è–∂–µ–Ω–∫–∞', cat:'–ú–æ–ª–æ—á–Ω–∞—è –ø—Ä–æ–¥—É–∫—Ü–∏—è', displaySection:'–ú–æ–ª–æ—á–Ω–∞—è –ø—Ä–æ–¥—É–∫—Ü–∏—è', pricePerL:280,
      ico:'ü•õ', description:'–ù–∞—Ç—É—Ä–∞–ª—å–Ω–∞—è —Ä—è–∂–µ–Ω–∫–∞. –õ—é–±–∏–º–∞—è –¥–µ—Ç—å–º–∏! –°—Ä–æ–∫: –¥–æ 5 —Å—É—Ç–æ–∫.' },
    { id:'mishti-dahi', name:'–ú–∏—Å—Ç—Ö–∏-–î–∞—Ö–∏', cat:'–ú–æ–ª–æ—á–Ω–∞—è –ø—Ä–æ–¥—É–∫—Ü–∏—è', displaySection:'–ú–æ–ª–æ—á–Ω–∞—è –ø—Ä–æ–¥—É–∫—Ü–∏—è', pricePerL:300,
      ico:'ü•õ', description:'–ù–µ–∂–Ω—ã–π –∫–∏—Å–ª–æ–º–æ–ª–æ—á–Ω—ã–π –Ω–∞–ø–∏—Ç–æ–∫. 300 ‚ÇΩ/–ª, 150 ‚ÇΩ/0.5 –ª.' },
    { id:'whey', name:'–°—ã–≤–æ—Ä–æ—Ç–∫–∞', cat:'–ú–æ–ª–æ—á–Ω–∞—è –ø—Ä–æ–¥—É–∫—Ü–∏—è', displaySection:'–ú–æ–ª–æ—á–Ω–∞—è –ø—Ä–æ–¥—É–∫—Ü–∏—è', pricePerL:60,
      ico:'üíß', description:'–ü–æ–ª—É—á–µ–Ω–∞ –ø—Ä–∏ –∏–∑–≥–æ—Ç–æ–≤–ª–µ–Ω–∏–∏ —Ç–≤–æ—Ä–æ–≥–∞/—Å—ã—Ä–∞. –°—Ä–æ–∫: 3 —Å—É—Ç–æ–∫.' },
    { id:'cream', name:'–°–ª–∏–≤–∫–∏ (33‚Äì36%)', cat:'–ú–æ–ª–æ—á–Ω–∞—è –ø—Ä–æ–¥—É–∫—Ü–∏—è', displaySection:'–ú–æ–ª–æ—á–Ω–∞—è –ø—Ä–æ–¥—É–∫—Ü–∏—è', pricePerL:1450,
      ico:'ü•õ', description:'–°–≤–µ–∂–∏–µ —Å–ª–∏–≤–∫–∏. –ù–∞ 3‚Äì4 —Å—É—Ç–∫–∏ –º–æ–≥—É—Ç —Å—Ç–∞—Ç—å —Å–º–µ—Ç–∞–Ω–æ–π. –°—Ä–æ–∫: 5 —Å—É—Ç–æ–∫.', img:IMG['cream'] },
    { id:'tvorog', name:'–¢–≤–æ—Ä–æ–≥', cat:'–ú–æ–ª–æ—á–Ω–∞—è –ø—Ä–æ–¥—É–∫—Ü–∏—è', displaySection:'–ú–æ–ª–æ—á–Ω–∞—è –ø—Ä–æ–¥—É–∫—Ü–∏—è', pricePerKg:700,
      ico:'ü•õ', description:'–ù–µ–∂–Ω—ã–π –≤–∫—É—Å, ¬´–∑—ë—Ä–Ω—ã—à–∫–∏¬ª –∫–∞–∫ –Ω–∞–¥–æ. –° –∑–∞–º–æ—Ä–æ–∑–∫–æ–π –¥—Ä—É–∂–∏—Ç. –°—Ä–æ–∫: 3‚Äì5 —Å—É—Ç–æ–∫.', img:IMG['tvorog'] },
    { id:'butter', name:'–ú–∞—Å–ª–æ —Å–ª–∏–≤–æ—á–Ω–æ–µ (1 —à—Ç ‚âà200 –≥)', cat:'–ú–æ–ª–æ—á–Ω–∞—è –ø—Ä–æ–¥—É–∫—Ü–∏—è', displaySection:'–ú–æ–ª–æ—á–Ω–∞—è –ø—Ä–æ–¥—É–∫—Ü–∏—è', pricePerUnit:360,
      ico:'üßà', description:'–ù–∞—Ç—É—Ä–∞–ª—å–Ω–æ–µ, —Ä—É—á–Ω–æ–µ. –ú–æ–∂–Ω–æ –ª—é–±–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ. –°—Ä–æ–∫: –¥–æ 180 —Å—É—Ç–æ–∫ –ø—Ä–∏ t‚â§+15 ¬∞C.', img:IMG['butter'] },
    { id:'ghee', name:'–¢–æ–ø–ª—ë–Ω–æ–µ –º–∞—Å–ª–æ (–ì–•–ò)', cat:'–ú–æ–ª–æ—á–Ω–∞—è –ø—Ä–æ–¥—É–∫—Ü–∏—è', displaySection:'–ú–æ–ª–æ—á–Ω–∞—è –ø—Ä–æ–¥—É–∫—Ü–∏—è', pricePerKg:2900,
      ico:'üßà', description:'–ß–∏—Å—Ç—ã–π –º–æ–ª–æ—á–Ω—ã–π –∂–∏—Ä (~99%). –ò–¥–µ–∞–ª—å–Ω–æ –¥–ª—è –∂–∞—Ä–∫–∏. –°—Ä–æ–∫ —Ö—Ä–∞–Ω–µ–Ω–∏—è: 10+ –ª–µ—Ç.' },
    { id:'condensed-milk', name:'–í–∞—Ä—ë–Ω–∞—è —Å–≥—É—â—ë–Ω–∫–∞', cat:'–ú–æ–ª–æ—á–Ω–∞—è –ø—Ä–æ–¥—É–∫—Ü–∏—è', displaySection:'–ú–æ–ª–æ—á–Ω–∞—è –ø—Ä–æ–¥—É–∫—Ü–∏—è', pricePerKg:1000,
      ico:'ü•õ', description:'–ú–æ–ª–æ–∫–æ + —Ç—Ä–æ—Å—Ç–Ω–∏–∫–æ–≤—ã–π —Å–∞—Ö–∞—Ä, –≥—É—Å—Ç–∞—è –∏ –∫–∞—Ä–∞–º–µ–ª—å–Ω–∞—è. –°—Ä–æ–∫: 7 —Å—É—Ç–æ–∫.' },

    // ===== –°–õ–ê–î–û–°–¢–ò =====
    { id:'sandesh-orange', name:'–°–∞–Ω–¥–µ—à –∞–ø–µ–ª—å—Å–∏–Ω–æ–≤—ã–π (5 —à—Ç)', cat:'–°–ª–∞–¥–æ—Å—Ç–∏', displaySection:'–°–ª–∞–¥–æ—Å—Ç–∏', pricePerUnit:300, ico:'üçÆ',
      description:'–ú–æ–ª–æ–∫–æ, —Å–∞—Ö–∞—Ä, —Ü–µ–¥—Ä–∞ –∞–ø–µ–ª—å—Å–∏–Ω–∞. –°—Ä–æ–∫: 5 —Å—É—Ç–æ–∫.', img:IMG['sandesh-orange'] },
    { id:'sandesh-walnut', name:'–°–∞–Ω–¥–µ—à —Å –≥—Ä–µ—Ü–∫–∏–º –æ—Ä–µ—Ö–æ–º (5 —à—Ç)', cat:'–°–ª–∞–¥–æ—Å—Ç–∏', displaySection:'–°–ª–∞–¥–æ—Å—Ç–∏', pricePerUnit:300, ico:'üçÆ',
      description:'–ú–æ–ª–æ–∫–æ, —Å–∞—Ö–∞—Ä, –≥—Ä–µ—Ü–∫–∏–π –æ—Ä–µ—Ö. –°—Ä–æ–∫: 5 —Å—É—Ç–æ–∫.', img:IMG['sandesh-walnut'] },
    { id:'sandesh-carob', name:'–°–∞–Ω–¥–µ—à —Å –∫—ç—Ä–æ–±–æ–º (5 —à—Ç)', cat:'–°–ª–∞–¥–æ—Å—Ç–∏', displaySection:'–°–ª–∞–¥–æ—Å—Ç–∏', pricePerUnit:300, ico:'üçÆ',
      description:'–ú–æ–ª–æ–∫–æ, —Å–∞—Ö–∞—Ä, –∫—ç—Ä–æ–± –∏ –∫–æ–∫–æ—Å. –°—Ä–æ–∫: 5 —Å—É—Ç–æ–∫.' },

    { id:'barfi-classic', name:'–ë—É—Ä—Ñ–∏ –∫–ª–∞—Å—Å–∏—á–µ—Å–∫–∏–π (5 —à—Ç)', cat:'–°–ª–∞–¥–æ—Å—Ç–∏', displaySection:'–°–ª–∞–¥–æ—Å—Ç–∏', pricePerUnit:350, ico:'üçÆ',
      description:'–ö–ª–∞—Å—Å–∏—á–µ—Å–∫–∏–π –±—É—Ä—Ñ–∏. –°—Ä–æ–∫: 5 —Å—É—Ç–æ–∫.', img:IMG['barfi-classic'] },
    { id:'barfi-hazelnut', name:'–ë—É—Ä—Ñ–∏ —Ñ—É–Ω–¥—É–∫ (5 —à—Ç)', cat:'–°–ª–∞–¥–æ—Å—Ç–∏', displaySection:'–°–ª–∞–¥–æ—Å—Ç–∏', pricePerUnit:350, ico:'üçÆ',
      description:'–° —Ñ—É–Ω–¥—É–∫–æ–º. –°—Ä–æ–∫: 5 —Å—É—Ç–æ–∫.', img:IMG['barfi-hazelnut'] },
    { id:'barfi-sesame', name:'–ë—É—Ä—Ñ–∏ –∫—É–Ω–∂—É—Ç–Ω—ã–π (7 —à—Ç)', cat:'–°–ª–∞–¥–æ—Å—Ç–∏', displaySection:'–°–ª–∞–¥–æ—Å—Ç–∏', pricePerUnit:490, ico:'üçÆ',
      description:'–° –∫—É–Ω–∂—É—Ç–æ–º. –°—Ä–æ–∫: 5 —Å—É—Ç–æ–∫.' },

    { id:'halva', name:'–•–∞–ª–≤–∞ (0.2 –∫–≥)', cat:'–°–ª–∞–¥–æ—Å—Ç–∏', displaySection:'–°–ª–∞–¥–æ—Å—Ç–∏', pricePerUnit:200, ico:'üçÆ',
      description:'–°–æ—Å—Ç–∞–≤: —Å–∞—Ö–∞—Ä, –≤–æ–¥–∞, —Å–µ–º–µ—á–∫–∏, —Å–ª–∏–≤–æ—á–Ω–æ–µ –º–∞—Å–ª–æ. –°—Ä–æ–∫: 14 –¥–Ω–µ–π.' },

    { id:'potato-cake-5', name:'–ü–∏—Ä–æ–∂–Ω–æ–µ ¬´–ö–∞—Ä—Ç–æ—à–∫–∞¬ª (5 —à—Ç)', cat:'–°–ª–∞–¥–æ—Å—Ç–∏', displaySection:'–°–ª–∞–¥–æ—Å—Ç–∏', pricePerUnit:400, ico:'üç∞',
      description:'–ò–∑ —Ü–µ–ª—å–Ω–æ–∑–µ—Ä–Ω. –º—É–∫–∏, —Å –¥–æ–º–∞—à–Ω–µ–π —Å–≥—É—â—ë–Ω–∫–æ–π.', img:IMG['potato-cake-2'] },
    { id:'potato-cake-2', name:'–ü–∏—Ä–æ–∂–Ω–æ–µ ¬´–ö–∞—Ä—Ç–æ—à–∫–∞¬ª (2 —à—Ç)', cat:'–°–ª–∞–¥–æ—Å—Ç–∏', displaySection:'–°–ª–∞–¥–æ—Å—Ç–∏', pricePerUnit:190, ico:'üç∞',
      description:'–ò–∑ —Ü–µ–ª—å–Ω–æ–∑–µ—Ä–Ω. –º—É–∫–∏, —Å –¥–æ–º–∞—à–Ω–µ–π —Å–≥—É—â—ë–Ω–∫–æ–π.', img:IMG['potato-cake-2'] },

    // ===== –í–´–ü–ï–ß–ö–ê =====
    { id:'cookies-nut', name:'–û—Ä–µ—Ö–æ–≤—ã–µ –ø–∞–ª—å—á–∏–∫–∏', cat:'–í—ã–ø–µ—á–∫–∞', displaySection:'–í—ã–ø–µ—á–∫–∞', pricePerKg:700, ico:'üç™',
      description:'–° —Ö—Ä—É—Å—Ç—è—â–∏–º–∏ –æ—Ä–µ—Ö–∞–º–∏.', img:IMG['cookies-nut'] },
    { id:'cookies-oat', name:'–ü–µ—á–µ–Ω—å–µ –æ–≤—Å—è–Ω–æ–µ', cat:'–í—ã–ø–µ—á–∫–∞', displaySection:'–í—ã–ø–µ—á–∫–∞', pricePerKg:600, ico:'üç™',
      description:'–ü–æ–ª–µ–∑–Ω–æ–µ –æ–≤—Å—è–Ω–æ–µ.' },
    { id:'cookies-carob', name:'–ö—ç—Ä–æ–±–æ–≤—ã–µ –ø–µ—á–µ–Ω—å—è', cat:'–í—ã–ø–µ—á–∫–∞', displaySection:'–í—ã–ø–µ—á–∫–∞', pricePerKg:600, ico:'üç™',
      description:'–ù–∞ —Å–ª–∞–¥–æ—Å—Ç–∏ –∫—ç—Ä–æ–±–∞.' },
    { id:'cookies-sandy', name:'–ü–µ—Å–æ—á–Ω–æ–µ –ø–µ—á–µ–Ω—å–µ', cat:'–í—ã–ø–µ—á–∫–∞', displaySection:'–í—ã–ø–µ—á–∫–∞', pricePerKg:600, ico:'üç™',
      description:'–ö–ª–∞—Å—Å–∏—á–µ—Å–∫–æ–µ –ø–µ—Å–æ—á–Ω–æ–µ.' },

    { id:'muffin-plain', name:'–ö–µ–∫—Å—ã –æ–±—ã—á–Ω—ã–µ', cat:'–í—ã–ø–µ—á–∫–∞', displaySection:'–í—ã–ø–µ—á–∫–∞', pricePerKg:500, ico:'üßÅ',
      description:'–ü—Ä–æ—Å—Ç—ã–µ –∏ –≤–∫—É—Å–Ω—ã–µ.' },
    { id:'muffin-carob', name:'–ö–µ–∫—Å—ã –∫—ç—Ä–æ–±–æ–≤—ã–µ', cat:'–í—ã–ø–µ—á–∫–∞', displaySection:'–í—ã–ø–µ—á–∫–∞', pricePerKg:550, ico:'üßÅ',
      description:'–° –∫—ç—Ä–æ–±–æ–º.' },
    { id:'muffin-raisin', name:'–ö–µ–∫—Å—ã –∏–∑—é–º', cat:'–í—ã–ø–µ—á–∫–∞', displaySection:'–í—ã–ø–µ—á–∫–∞', pricePerKg:550, ico:'üßÅ',
      description:'–° –∏–∑—é–º–æ–º.', img:IMG['muffin-raisin'] },

    { id:'coconut-kuchen-1kg', name:'–ö–æ–∫–æ—Å–æ–≤—ã–π –∫—É—Ö–µ–Ω (1 –∫–≥)', cat:'–í—ã–ø–µ—á–∫–∞', displaySection:'–í—ã–ø–µ—á–∫–∞', pricePerUnit:1800, ico:'üç∞',
      description:'–ü—ã—à–Ω—ã–π –∏ –∞—Ä–æ–º–∞—Ç–Ω—ã–π.' },
    { id:'coconut-kuchen-05kg', name:'–ö–æ–∫–æ—Å–æ–≤—ã–π –∫—É—Ö–µ–Ω (0.5 –∫–≥)', cat:'–í—ã–ø–µ—á–∫–∞', displaySection:'–í—ã–ø–µ—á–∫–∞', pricePerUnit:1000, ico:'üç∞',
      description:'–ü–æ–ª–ø–æ—Ä—Ü–∏–∏ –∫—É—Ö–µ–Ω–∞.' },

    { id:'napoleon-1kg', name:'–¢–æ—Ä—Ç ¬´–ù–∞–ø–æ–ª–µ–æ–Ω¬ª (1+ –∫–≥)', cat:'–í—ã–ø–µ—á–∫–∞', displaySection:'–í—ã–ø–µ—á–∫–∞', pricePerUnit:1300, ico:'üéÇ',
      description:'–ö–ª–∞—Å—Å–∏—á–µ—Å–∫–∏–π —Å–ª–æ—ë–Ω—ã–π —Ç–æ—Ä—Ç.' },
    { id:'napoleon-05kg', name:'–¢–æ—Ä—Ç ¬´–ù–∞–ø–æ–ª–µ–æ–Ω¬ª (0.5+ –∫–≥)', cat:'–í—ã–ø–µ—á–∫–∞', displaySection:'–í—ã–ø–µ—á–∫–∞', pricePerUnit:750, ico:'üéÇ',
      description:'–ü–æ–ª–ø–æ—Ä—Ü–∏–∏ —Ç–æ—Ä—Ç–∞.' },

    { id:'apple-pie', name:'–Ø–±–ª–æ—á–Ω—ã–π –ø–∏—Ä–æ–≥ (900 –≥)', cat:'–í—ã–ø–µ—á–∫–∞', displaySection:'–í—ã–ø–µ—á–∫–∞', pricePerUnit:560, ico:'ü•ß',
      description:'–î–æ–º–∞—à–Ω–∏–π –ø–∏—Ä–æ–≥.' },

    { id:'bliny-10', name:'–ë–ª–∏–Ω—ã (10 —à—Ç)', cat:'–í—ã–ø–µ—á–∫–∞', displaySection:'–í—ã–ø–µ—á–∫–∞', pricePerUnit:330, ico:'ü•û',
      description:'–¢–æ–Ω–∫–∏–µ –±–ª–∏–Ω—ã.' },
    { id:'bliny-5', name:'–ë–ª–∏–Ω—ã (5 —à—Ç)', cat:'–í—ã–ø–µ—á–∫–∞', displaySection:'–í—ã–ø–µ—á–∫–∞', pricePerUnit:220, ico:'ü•û',
      description:'–ü–æ–ª–æ–≤–∏–Ω–∞ –ø–æ—Ä—Ü–∏–∏.' },
    { id:'bliny-tvorog-5', name:'–ë–ª–∏–Ω—ã —Ç–≤–æ—Ä–æ–≥/—Ç–≤–æ—Ä–æ–≥-–∏–∑—é–º (5 —à—Ç)', cat:'–í—ã–ø–µ—á–∫–∞', displaySection:'–í—ã–ø–µ—á–∫–∞', pricePerUnit:300, ico:'ü•û',
      description:'–° –Ω–∞—á–∏–Ω–∫–æ–π.' },

    { id:'syrniki-10', name:'–°—ã—Ä–Ω–∏–∫–∏ (10 —à—Ç)', cat:'–í—ã–ø–µ—á–∫–∞', displaySection:'–í—ã–ø–µ—á–∫–∞', pricePerUnit:520, ico:'ü•û',
      description:'–ù–µ–∂–Ω—ã–µ —Å—ã—Ä–Ω–∏–∫–∏.' },
    { id:'syrniki-5', name:'–°—ã—Ä–Ω–∏–∫–∏ (5 —à—Ç)', cat:'–í—ã–ø–µ—á–∫–∞', displaySection:'–í—ã–ø–µ—á–∫–∞', pricePerUnit:280, ico:'ü•û',
      description:'–ü–æ–ª–æ–≤–∏–Ω–∞ –ø–æ—Ä—Ü–∏–∏.' },

    { id:'chapati-10', name:'–ß–∞–ø–∞—Ç–∏ (10 —à—Ç)', cat:'–í—ã–ø–µ—á–∫–∞', displaySection:'–í—ã–ø–µ—á–∫–∞', pricePerUnit:270, ico:'ü´ì',
      description:'–ü—à–µ–Ω–∏—á–Ω–∞—è –∏ —Ä–∂–∞–Ω–∞—è –º—É–∫–∞, –≤–æ–¥–∞, —Å–æ–ª—å, –º–∞—Å–ª–æ. –°—Ä–æ–∫: 2 —Å—É—Ç–æ–∫.', img:IMG['chapati-10'] },
    { id:'chapati-wholewheat-10', name:'–ß–∞–ø–∞—Ç–∏ (—Ü/–∑ –º—É–∫–∞, 10 —à—Ç)', cat:'–í—ã–ø–µ—á–∫–∞', displaySection:'–í—ã–ø–µ—á–∫–∞', pricePerUnit:320, ico:'ü´ì',
      description:'–ò–∑ —Ü–µ–ª—å–Ω–æ–∑–µ—Ä–Ω–æ–≤–æ–π –º—É–∫–∏.' },
    // –¢–≤–æ—Ä–æ–∂–Ω—ã–µ –º–∞—Å—Å—ã ‚Äî –æ—Ç–¥–µ–ª—å–Ω—ã–º–∏ –∫–∞—Ä—Ç–æ—á–∫–∞–º–∏
    { id:'tvmassa-raisin', name:'–¢–≤–æ—Ä–æ–∂–Ω–∞—è –º–∞—Å—Å–∞ —Å –∏–∑—é–º–æ–º', cat:'–ú–æ–ª–æ—á–Ω–∞—è –ø—Ä–æ–¥—É–∫—Ü–∏—è', displaySection:'–ú–æ–ª–æ—á–Ω–∞—è –ø—Ä–æ–¥—É–∫—Ü–∏—è', pricePerKg:850, ico:'ü•õ',
      description:'–¢–≤–æ—Ä–æ–≥, —Å–ª–∏–≤–∫–∏, —Ç—Ä–æ—Å—Ç–Ω–∏–∫–æ–≤—ã–π —Å–∞—Ö–∞—Ä –∏ –∏–∑—é–º. –°—Ä–æ–∫: 5 —Å—É—Ç–æ–∫.', img:IMG['tvmassa-raisin'] },
    { id:'tvmassa-date', name:'–¢–≤–æ—Ä–æ–∂–Ω–∞—è –º–∞—Å—Å–∞ —Å —Ñ–∏–Ω–∏–∫–∞–º–∏', cat:'–ú–æ–ª–æ—á–Ω–∞—è –ø—Ä–æ–¥—É–∫—Ü–∏—è', displaySection:'–ú–æ–ª–æ—á–Ω–∞—è –ø—Ä–æ–¥—É–∫—Ü–∏—è', pricePerKg:850, ico:'ü•õ',
      description:'–¢–≤–æ—Ä–æ–≥, —Å–ª–∏–≤–∫–∏, —Ç—Ä–æ—Å—Ç–Ω–∏–∫–æ–≤—ã–π —Å–∞—Ö–∞—Ä –∏ —Ñ–∏–Ω–∏–∫–∏. –°—Ä–æ–∫: 5 —Å—É—Ç–æ–∫.', img:IMG['tvmassa-date'] },
    { id:'tvmassa-prune', name:'–¢–≤–æ—Ä–æ–∂–Ω–∞—è –º–∞—Å—Å–∞ —Å —á–µ—Ä–Ω–æ—Å–ª–∏–≤–æ–º', cat:'–ú–æ–ª–æ—á–Ω–∞—è –ø—Ä–æ–¥—É–∫—Ü–∏—è', displaySection:'–ú–æ–ª–æ—á–Ω–∞—è –ø—Ä–æ–¥—É–∫—Ü–∏—è', pricePerKg:850, ico:'ü•õ',
      description:'–¢–≤–æ—Ä–æ–≥, —Å–ª–∏–≤–∫–∏, —Ç—Ä–æ—Å—Ç–Ω–∏–∫–æ–≤—ã–π —Å–∞—Ö–∞—Ä –∏ —á–µ—Ä–Ω–æ—Å–ª–∏–≤. –°—Ä–æ–∫: 5 —Å—É—Ç–æ–∫.', img:IMG['tvmassa-prune'] },
  ];

  // --- VARIANTS (–æ–±–Ω–æ–≤–ª–µ–Ω–æ –ø–æ–¥ –Ω–æ–≤—ã–µ —Ü–µ–Ω—ã/–ª–æ–≥–∏–∫–∏) ---
  const VARIANT_RULES = {
    // –ø–æ–∑–∏—Ü–∏–æ–Ω–Ω—ã–µ: —Å—á–∏—Ç–∞–µ–º –æ—Ç –∫–≥ –ø–æ –≤–µ—Å—É –≤ —Å–∫–æ–±–∫–∞—Ö
    'mozzarella': { type:'fixed', options:['1 —à—Ç (200 –≥)'] },
    'buratta': { type:'fixed', options:['1 —à—Ç (250 –≥)'] },
    'halloumi': { type:'fixed', options:['1 —à—Ç (200 –≥)','1 —à—Ç (250 –≥)'] },
    'halloumi-paprika-oregano': { type:'fixed', options:['1 —à—Ç (200 –≥)','1 —à—Ç (250 –≥)'] },
    'halloumi-tomato-basil-garlic': { type:'fixed', options:['1 —à—Ç (200 –≥)','1 —à—Ç (250 –≥)'] },
    'halloumi-tomato-paprika': { type:'fixed', options:['1 —à—Ç (200 –≥)','1 —à—Ç (250 –≥)'] },
    'kosichka': { type:'fixed', options:['1 —à—Ç (200 –≥)'] },
    'kosichka-smoked': { type:'fixed', options:['1 —à—Ç (200 –≥)'] },
    'spicy-klubok': { type:'fixed', options:['1 —à—Ç (150 –≥)'] },

    // –º—è–≥–∫–∏–µ/—Ç–≤–µ—Ä–¥—ã–µ/—Ä–∞—Å—Å–æ–ª—å–Ω—ã–µ –≤–µ—Å–æ–≤—ã–µ
    'stracciatella': { type:'fixed', options:['200 –≥','250 –≥','300 –≥','500 –≥'] },
    'ricotta': { type:'fixed', options:['200 –≥','250 –≥','300 –≥','450 –≥'] },
    'ricotta-herbs': { type:'fixed', options:['200 –≥','250 –≥','300 –≥','450 –≥'] },
    'caciotta': { type:'weight', unit:'–≥', step:50, min:200, max:1000 },
    'caciotta-fenugreek': { type:'weight', unit:'–≥', step:50, min:200, max:1000 },

    'suluguni': { type:'weight', unit:'–≥', step:100, min:100, max:1000 },
    'suluguni-smoked': { type:'weight', unit:'–≥', step:100, min:100, max:1000 },
    'imeretian': { type:'weight', unit:'–≥', step:100, min:100, max:1000 },
    'imeretian-dill-garlic': { type:'weight', unit:'–≥', step:100, min:100, max:1000 },

    'hard-village': { type:'fixed', options:['200 –≥','300 –≥','400 –≥','500 –≥','1000 –≥'] },
    'hard-smoked': { type:'fixed', options:['200 –≥','300 –≥','400 –≥','500 –≥','1000 –≥'] },

    'rolls-olives-walnut': { type:'weight', unit:'–≥', step:50, min:100, max:1000 },
    'rolls-apricot-cedar': { type:'weight', unit:'–≥', step:50, min:100, max:1000 },

    // –º–æ–ª–æ—á–∫–∞
    'milk': { type:'fixed', options:['0.5 –ª','1 –ª'] },
    'milk-topped': { type:'fixed', options:['0.5 –ª','1 –ª'] },
    'yogurt': { type:'fixed', options:['0.5 –ª','1 –ª'] },
    'ryazhenka': { type:'fixed', options:['0.5 –ª','1 –ª'] },
    'mishti-dahi': { type:'fixed', options:['0.5 –ª','1 –ª'] },
    'whey': { type:'fixed', options:['1 –ª'] },
    'cream': { type:'fixed', options:['0.2 –ª','0.5 –ª','1 –ª'] },
    'tvorog': { type:'weight', unit:'–≥', step:100, min:500, max:2000 },
    'butter': { type:'fixed', options:['1 —à—Ç (200 –≥)'] },
    'ghee': { type:'fixed', options:['200 –≥','500 –≥','1000 –≥'] },
    'condensed-milk': { type:'weight', unit:'–≥', step:100, min:200, max:1000 },

    // —Å–ª–∞–¥–æ—Å—Ç–∏
    'sandesh-orange': { type:'fixed', options:['5 —à—Ç'] },
    'sandesh-walnut': { type:'fixed', options:['5 —à—Ç'] },
    'sandesh-carob': { type:'fixed', options:['5 —à—Ç'] },

    'barfi-classic': { type:'fixed', options:['5 —à—Ç'] },
    'barfi-hazelnut': { type:'fixed', options:['5 —à—Ç'] },
    'barfi-sesame': { type:'fixed', options:['7 —à—Ç'] },
    'halva': { type:'fixed', options:['0.2 –∫–≥'] },

    'potato-cake-5': { type:'fixed', options:['5 —à—Ç'] },
    'potato-cake-2': { type:'fixed', options:['2 —à—Ç'] },

    // –≤—ã–ø–µ—á–∫–∞
    'cookies-nut': { type:'weight', unit:'–≥', step:250, min:250, max:2000 },
    'cookies-oat': { type:'weight', unit:'–≥', step:250, min:250, max:2000 },
    'cookies-carob': { type:'weight', unit:'–≥', step:250, min:250, max:2000 },
    'cookies-sandy': { type:'weight', unit:'–≥', step:250, min:250, max:2000 },

    'muffin-plain': { type:'weight', unit:'–≥', step:250, min:250, max:2000 },
    'muffin-carob': { type:'weight', unit:'–≥', step:250, min:250, max:2000 },
    'muffin-raisin': { type:'weight', unit:'–≥', step:250, min:250, max:2000 },

    'coconut-kuchen-1kg': { type:'fixed', options:['1 –∫–≥'] },
    'coconut-kuchen-05kg': { type:'fixed', options:['0.5 –∫–≥'] },
    'napoleon-1kg': { type:'fixed', options:['1+ –∫–≥'] },
    'napoleon-05kg': { type:'fixed', options:['0.5+ –∫–≥'] },
    'apple-pie': { type:'fixed', options:['900 –≥'] },

    'bliny-10': { type:'fixed', options:['10 —à—Ç'] },
    'bliny-5': { type:'fixed', options:['5 —à—Ç'] },
    'bliny-tvorog-5': { type:'fixed', options:['5 —à—Ç'] },
    'syrniki-10': { type:'fixed', options:['10 —à—Ç'] },
    'syrniki-5': { type:'fixed', options:['5 —à—Ç'] },

    'chapati-10': { type:'fixed', options:['10 —à—Ç'] },
    'chapati-wholewheat-10': { type:'fixed', options:['10 —à—Ç'] },

    // —Ç–≤–æ—Ä–æ–∂–Ω—ã–µ –º–∞—Å—Å—ã
    'tvmassa-raisin': { type:'weight', unit:'–≥', step:100, min:200, max:1000 },
    'tvmassa-date': { type:'weight', unit:'–≥', step:100, min:200, max:1000 },
    'tvmassa-prune': { type:'weight', unit:'–≥', step:100, min:200, max:1000 },
  };

  const SECTION_ORDER = [
    '–†–∞—Å—Å–æ–ª—å–Ω—ã–µ —Å—ã—Ä—ã', '–ú—è–≥–∫–∏–µ —Å—ã—Ä—ã', '–¢–≤—ë—Ä–¥—ã–µ —Å—ã—Ä—ã', '–°—ã—Ä–Ω—ã–µ —Ä—É–ª–µ—Ç—ã',
    '–ú–æ–ª–æ—á–Ω–∞—è –ø—Ä–æ–¥—É–∫—Ü–∏—è', '–°–ª–∞–¥–æ—Å—Ç–∏', '–í—ã–ø–µ—á–∫–∞'
  ];

  // --- STATE ---
  let cart = [];
  let currentProduct = null;
  let filteredProducts = [];
  let favorites = new Set();
  let checkoutState = { phone:'', address:'', comment:'' };
  let appliedPromo = null;

  // --- PROMO CODES (–º–æ–∂–Ω–æ —Ö—Ä–∞–Ω–∏—Ç—å –≤ –∫–æ–¥–µ –∏–ª–∏ –≥—Ä—É–∑–∏—Ç—å —Å BACKEND) ---
  let PROMO_CODES = {
    // –ü—Ä–∏–º–µ—Ä: –¥–µ–π—Å—Ç–≤—É–µ—Ç –Ω–∞ –≤–µ—Å—å –∑–∞–∫–∞–∑
    'SYROLOVE5': { type:'percent', value:5, expires:'2099-12-31' },
    // –§–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–∞—è —Å–∫–∏–¥–∫–∞
    'CHEESE100': { type:'amount', value:100, expires:'2099-12-31' },
  };

  // === INIT ===
  document.addEventListener('DOMContentLoaded', init);

  function init(){
    try{
      loadState();
      setupEventListeners();
      setupTelegramWebApp();
      renderUserProfile();
      populateCategoryFilter();
      document.getElementById('only-cheese-checkbox').checked = ONLY_CHEESE_FILTER_DEFAULT;
      filterAndSearchProducts();
      updateCartUI();
      tryFetchPromoCodes();
      renderFavoritesStrip();
    }catch(e){
      console.error('Init error:', e);
      const c = document.getElementById('product-sections');
      if(c) c.innerHTML = `<p style="color:var(--error-color);text-align:center;padding:20px">–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è. –û–±–Ω–æ–≤–∏—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—É.</p>`;
    }
  }

  function tryFetchPromoCodes(){
    axios.get(`${BACKEND}/promo-codes`).then(r=>{
      if(Array.isArray(r.data)){
        const map = {};
        r.data.forEach(p=>{
          if(p && p.code) map[p.code.toUpperCase()] = { type:p.type||'percent', value:Number(p.value)||0, expires:p.expires||'2099-12-31' };
        });
        if(Object.keys(map).length) PROMO_CODES = map;
      }
    }).catch(()=>{/* ok, –æ—Å—Ç–∞—ë–º—Å—è –Ω–∞ –ª–æ–∫–∞–ª—å–Ω—ã—Ö */});
  }

  function loadState(){
    try{ const s = localStorage.getItem(STORAGE_CART_KEY); if(s) cart = JSON.parse(s)||[] }catch(e){ cart=[] }
    try{ const s = localStorage.getItem(STORAGE_CHECKOUT_KEY); if(s) checkoutState = JSON.parse(s)||checkoutState }catch(e){}
    try{ const s = localStorage.getItem(STORAGE_FAVS_KEY); if(s){ const arr = JSON.parse(s)||[]; favorites = new Set(arr) } }catch(e){}
    try{ const s = localStorage.getItem(STORAGE_PROMO_KEY); if(s) appliedPromo = JSON.parse(s) }catch(e){}
  }
  function saveState(){
    try{ localStorage.setItem(STORAGE_CART_KEY, JSON.stringify(cart)) }catch(e){}
    try{ localStorage.setItem(STORAGE_CHECKOUT_KEY, JSON.stringify(checkoutState)) }catch(e){}
    try{ localStorage.setItem(STORAGE_FAVS_KEY, JSON.stringify(Array.from(favorites))) }catch(e){}
    try{ localStorage.setItem(STORAGE_PROMO_KEY, JSON.stringify(appliedPromo)) }catch(e){}
  }

  // --- TELEGRAM ---
  function setupTelegramWebApp(){
    if(window.Telegram && window.Telegram.WebApp){
      const webApp = window.Telegram.WebApp;
      webApp.ready(); webApp.expand();
      applyTheme();
      webApp.MainButton.setText('–û—Ñ–æ—Ä–º–∏—Ç—å –∑–∞–∫–∞–∑').onClick(()=>openCartModal()).hide();
      webApp.BackButton.onClick(()=>{
        const pm = document.getElementById('product-modal');
        const cm = document.getElementById('cart-modal');
        if(cm.open) closeCartModal(); else if(pm.open) closeProductModal();
      });
    }else{
      applyTheme();
    }
  }
  function applyTheme(){
    const root = document.documentElement;
    root.style.setProperty('--bg-color','#F8EFDA');
    root.style.setProperty('--text-color','#2E2A23');
    root.style.setProperty('--hint-color','#8A7F6A');
    root.style.setProperty('--link-color','#8B5E34');
    root.style.setProperty('--button-color','#8B5E34');
    root.style.setProperty('--button-text-color','#fff');
    root.style.setProperty('--secondary-bg-color','#FFF6E7');
    root.style.setProperty('--header-bg-color','#FFF9EF');
    root.style.setProperty('--section-bg-color','#fff');
    root.style.setProperty('--border-color','#E7D8BF');
  }

  // --- UI ---
  function setupEventListeners(){
    document.getElementById('search-input').addEventListener('input', filterAndSearchProducts);
    document.getElementById('category-filter').addEventListener('change', filterAndSearchProducts);
    document.getElementById('only-cheese-checkbox').addEventListener('change', filterAndSearchProducts);
    document.getElementById('open-cart-btn').addEventListener('click', openCartModal);
    document.getElementById('add-to-cart-btn').addEventListener('click', addToCart);
    document.getElementById('product-variant-select').addEventListener('change', ()=>{
      syncApproxBadgeInModal();
      updateProductModalPrice();
    });
    document.getElementById('product-qty-input').addEventListener('input', updateProductModalPrice);
    document.getElementById('custom-weight-input').addEventListener('input', ()=>{
      // –ø—Ä–∏ –≤–≤–æ–¥–µ —Å–≤–æ–µ–≥–æ –≤–µ—Å–∞ ‚Äî —Å—á–∏—Ç–∞–µ–º –ø–æ –Ω–µ–º—É
      updateProductModalPrice();
    });
  }

  function renderUserProfile(){
    const profile = document.getElementById('user-profile');
    let user=null;
    if(window.Telegram && window.Telegram.WebApp && window.Telegram.WebApp.initDataUnsafe){
      user = window.Telegram.WebApp.initDataUnsafe.user;
    }
    if(user){
      profile.innerHTML = `
        <div class="user-avatar">
          <img src="${user.photo_url || ''}" alt="Avatar" onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';" />
          <span style="display:none;">${(user.first_name||'U').charAt(0).toUpperCase()}</span>
        </div>
        <div class="user-name">${user.first_name||''}</div>
      `;
    }else{
      profile.style.display='none';
    }
  }

  function populateCategoryFilter(){
    const cats = [...new Set(PRODUCTS.map(p=>p.cat))].sort();
    const sel = document.getElementById('category-filter');
    cats.forEach(cat=>{
      const o = document.createElement('option'); o.value=cat; o.textContent=cat; sel.appendChild(o);
    });
  }

  // --- FILTER + RENDER ---
  function filterAndSearchProducts(){
    const q = document.getElementById('search-input').value.toLowerCase();
    const cat = document.getElementById('category-filter').value;
    const onlyCheese = document.getElementById('only-cheese-checkbox').checked;

    filteredProducts = PRODUCTS.filter(p=>{
      const hasPrice = p.pricePerKg || p.pricePerL || p.pricePerUnit;
      if(!hasPrice) return false;
      const mSearch = p.name.toLowerCase().includes(q);
      const mCat = !cat || p.cat===cat;
      const mCheese = !onlyCheese || p.cat==='–°—ã—Ä—ã';
      return mSearch && mCat && mCheese;
    });
    renderSections();
  }

  function renderSections(){
    const host = document.getElementById('product-sections');
    host.innerHTML = '';

    const bySection = {};
    filteredProducts.forEach(p=>{
      (bySection[p.displaySection] ||= []).push(p);
    });

    SECTION_ORDER.forEach(sec=>{
      const items = bySection[sec];
      if(!items || !items.length) return;
      const h = document.createElement('div');
      const title = document.createElement('div'); title.className='section-divider'; title.textContent = sec;
      h.appendChild(title);

      const grid = document.createElement('div'); grid.className='product-grid';
      items.forEach(p=> grid.appendChild(makeProductCard(p)) );
      h.appendChild(grid);
      host.appendChild(h);
    });
  }

  function makeProductCard(product){
    const card = document.createElement('div');
    card.className='product-card';
    card.onclick = (e)=>{
      // –Ω–µ –æ—Ç–∫—Ä—ã–≤–∞—Ç—å –∫–∞—Ä—Ç–æ—á–∫—É –ø—Ä–∏ –∫–ª–∏–∫–µ –Ω–∞ —Å–µ—Ä–¥–µ—á–∫–æ
      if(e.target && e.target.classList.contains('fav-btn')) return;
      openProductModal(product.id);
    };

    // –º–µ–¥–∏–∞
    const media = document.createElement('div'); media.className='card-media';
    if(product.img){
      const img = document.createElement('img'); img.src = product.img; img.alt = product.name; media.appendChild(img);
    }else{
      const ico = document.createElement('div'); ico.className='fallback-ico'; ico.textContent = product.ico || 'üì¶'; media.appendChild(ico);
    }

    // –Ω–∞–∑–≤–∞–Ω–∏–µ + —Ü–µ–Ω–∞
    const nm = document.createElement('div'); nm.className='name'; nm.textContent = product.name;
    const pr = document.createElement('div'); pr.className='price'; pr.textContent = getPriceText(product);

    // –±–µ–π–¥–∂ ‚âà —Ü–µ–Ω–∞ –∑–∞ 1 —à—Ç (–µ—Å–ª–∏ –ø–æ–∑–∏—Ü–∏–æ–Ω–Ω—ã–π)
    const approx = getApproxPieceBadgeText(product);
    if(approx){
      const b = document.createElement('div'); b.className='badge-approx'; b.textContent = approx;
      card.appendChild(b);
    }

    // –∏–∑–±—Ä–∞–Ω–Ω–æ–µ
    const fav = document.createElement('button');
    fav.className = 'fav-btn' + (favorites.has(product.id) ? ' active':'');
    fav.setAttribute('aria-label','–í –∏–∑–±—Ä–∞–Ω–Ω–æ–µ');
    fav.innerHTML = favorites.has(product.id) ? '‚ù§' : '‚ô°';
    fav.onclick = ()=>{
      toggleFavorite(product.id);
      fav.classList.toggle('active');
      fav.innerHTML = favorites.has(product.id) ? '‚ù§' : '‚ô°';
      renderFavoritesStrip(true);
      saveState();
    };

    card.appendChild(media);
    card.appendChild(nm);
    card.appendChild(pr);
    card.appendChild(fav);
    return card;
  }

  // --- FAVORITES ---
  function toggleFavorite(id){
    if(favorites.has(id)) favorites.delete(id); else favorites.add(id);
  }
  function renderFavoritesStrip(soft=false){
    const ids = Array.from(favorites).filter(id=>PRODUCTS.find(p=>p.id===id));
    const strip = document.getElementById('favorites-strip');
    const title = document.getElementById('favorites-title');
    if(!ids.length){
      strip.style.display='none'; title.style.display='none'; strip.innerHTML='';
      return;
    }
    strip.style.display='flex'; title.style.display='block'; strip.innerHTML='';
    ids.slice(0,20).forEach(id=>{
      const p = PRODUCTS.find(x=>x.id===id);
      const c = makeProductCard(p); c.classList.add('mini-card');
      strip.appendChild(c);
    });
    if(!soft){ /* no-op */ }
  }

  // --- PRICE HELPERS ---
  function getPriceText(product){
    if(product.pricePerKg) return `${fmtRub(product.pricePerKg)} / –∫–≥`;
    if(product.pricePerL) return `${fmtRub(product.pricePerL)} / –ª`;
    if(product.pricePerUnit) return `${fmtRub(product.pricePerUnit)}`;
    return '–¶–µ–Ω–∞ –Ω–µ —É–∫–∞–∑–∞–Ω–∞';
  }

  // –±–µ–π–¥–∂ –Ω–∞ –∫–∞—Ä—Ç–æ—á–∫–µ ¬´‚âà —Ü–µ–Ω–∞ –∑–∞ 1 —à—Ç¬ª
  function getApproxPieceBadgeText(product){
    if(!product.pricePerKg) return '';
    const rule = VARIANT_RULES[product.id];
    if(!rule || rule.type!=='fixed') return '';
    // —Å–æ–±–µ—Ä—ë–º –≤–µ—Å–∞ –∏–∑ ¬´(XXX –≥)¬ª
    const weights = (rule.options||[])
      .map(o=>{ const m = o.match(/\((\d+)\s*–≥\)/i); return m? parseInt(m[1],10):null })
      .filter(Boolean);
    if(!weights.length) return '';
    const prices = weights.map(w=> (w/1000) * product.pricePerKg );
    const min = Math.min(...prices), max = Math.max(...prices);
    if(min===max) return `‚âà ${fmtRub(ROUND(min))} / —à—Ç`;
    return `‚âà ${fmtRub(ROUND(min))}‚Äì${fmtRub(ROUND(max))} / —à—Ç`;
  }

  // --- PRODUCT MODAL ---
  function openProductModal(productId){
    currentProduct = PRODUCTS.find(p=>p.id===productId);
    if(!currentProduct) return;
    const modal = document.getElementById('product-modal');
    document.getElementById('product-modal-title').textContent = currentProduct.name;
    const imgEl = document.getElementById('product-modal-img');
    if(currentProduct.img){ imgEl.src = currentProduct.img; imgEl.alt = currentProduct.name; imgEl.style.display='block'; }
    else { imgEl.style.display='none'; }
    document.getElementById('product-modal-description').textContent = currentProduct.description || '';

    renderVariantSelector();
    syncApproxBadgeInModal();
    updateProductModalPrice();

    modal.showModal();
    if(window.Telegram && window.Telegram.WebApp) window.Telegram.WebApp.BackButton.show();
  }

  function closeProductModal(){
    document.getElementById('product-modal').close();
    currentProduct=null;
    if(window.Telegram && window.Telegram.WebApp) window.Telegram.WebApp.BackButton.hide();
  }

  function renderVariantSelector(){
    const select = document.getElementById('product-variant-select');
    const customGroup = document.getElementById('custom-weight-group');
    select.innerHTML = '';

    const rule = VARIANT_RULES[currentProduct.id];
    if(!rule){ select.innerHTML = '<option>–í–∞—Ä–∏–∞–Ω—Ç –Ω–µ –æ–ø—Ä–µ–¥–µ–ª—ë–Ω</option>'; customGroup.style.display='none'; return; }

    if(rule.type==='fixed'){
      (rule.options||[]).forEach(opt=>{
        const o=document.createElement('option'); o.value=opt; o.textContent=opt; select.appendChild(o);
      });
      customGroup.style.display='none';
    }else if(rule.type==='weight'){
      // –≤—ã–ø–∞–¥–∞—é—â–∏–π —Å–ø–∏—Å–æ–∫ —Å –∏–Ω—Ç–µ—Ä–≤–∞–ª–∞–º–∏ + —Ä—É—á–Ω–æ–π –≤–≤–æ–¥
      for(let v=rule.min; v<=rule.max; v+=rule.step){
        const o=document.createElement('option'); o.value=`${v} ${rule.unit}`; o.textContent=`${v} ${rule.unit}`; select.appendChild(o);
      }
      customGroup.style.display='block';
      const cw = document.getElementById('custom-weight-input');
      cw.min = rule.min; cw.max = rule.max; cw.step = rule.step;
      cw.value = '';
    }
  }

  function syncApproxBadgeInModal(){
    const hint = document.getElementById('approx-piece-hint');
    const rule = VARIANT_RULES[currentProduct.id];
    if(!currentProduct.pricePerKg || !rule || rule.type!=='fixed'){ hint.style.display='none'; return; }
    const selVal = document.getElementById('product-variant-select').value || '';
    const m = selVal.match(/\((\d+)\s*–≥\)/i);
    if(!m){ hint.style.display='none'; return; }
    const w = parseInt(m[1],10);
    const price = (w/1000) * currentProduct.pricePerKg;
    hint.textContent = `‚âà ${fmtRub(ROUND(price))} –∑–∞ 1 —à—Ç (–ø–æ –≤—ã–±—Ä–∞–Ω–Ω–æ–º—É –≤–µ—Å—É)`;
    hint.style.display='block';
  }

  function parseVariant(variantString){
    if(!variantString) return null;
    // 1) (200 –≥) –≤ —Å–∫–æ–±–∫–∞—Ö
    let m = variantString.match(/\((\d+(?:[.,]\d+)?)\s*(–≥|–∫–≥|–ª|—à—Ç)\)/i);
    if(m){
      const val = parseFloat(m[1].replace(',','.')); const unit = m[2].toLowerCase();
      return unit==='–≥'?{value:val,unit:'g'}:unit==='–∫–≥'?{value:val,unit:'kg'}:unit==='–ª'?{value:val,unit:'l'}:{value:val,unit:'pc'};
    }
    // 2) –æ–±—ã—á–Ω—ã–π ¬´200 –≥¬ª | ¬´0.5 –∫–≥¬ª | ¬´1 –ª¬ª | ¬´5 —à—Ç¬ª
    m = variantString.match(/^(\d+(?:[.,]\d+)?)\s*(–≥|–∫–≥|–ª|—à—Ç)$/i);
    if(m){
      const val = parseFloat(m[1].replace(',','.')); const unit = m[2].toLowerCase();
      return unit==='–≥'?{value:val,unit:'g'}:unit==='–∫–≥'?{value:val,unit:'kg'}:unit==='–ª'?{value:val,unit:'l'}:{value:val,unit:'pc'};
    }
    // 3) —Å–ø–µ—Ü: ¬´1+ –∫–≥¬ª, ¬´0.5+ –∫–≥¬ª
    m = variantString.match(/^(\d+(?:[.,]\d+)?)\+\s*(–∫–≥|–ª)$/i);
    if(m){
      const val = parseFloat(m[1].replace(',','.')); const unit = m[2].toLowerCase();
      return unit==='–∫–≥'?{value:val,unit:'kg'}:{value:val,unit:'l'};
    }
    return null;
  }

  function getCustomWeightIfAny(){
    const rule = VARIANT_RULES[currentProduct.id];
    if(!rule || rule.type!=='weight') return null;
    const inp = document.getElementById('custom-weight-input');
    const v = parseInt(inp.value,10);
    if(!isFinite(v) || v<=0) return null;
    // –æ–≥—Ä–∞–Ω–∏—á–∏–º –≤ –¥–æ–ø—É—Å—Ç–∏–º—ã—Ö –ø—Ä–µ–¥–µ–ª–∞—Ö
    const vv = Math.max(rule.min, Math.min(rule.max, v));
    return { value: vv, unit:'g' };
  }

  function calculatePrice(productId, variant, qty, customWeightObj){
    const product = PRODUCTS.find(p=>p.id===productId);
    if(!product) return { basePrice:0, finalPrice:0, discountRate:0 };

    const rule = VARIANT_RULES[productId];
    let base=0;

    if(customWeightObj){
      // —Ä—É—á–Ω–æ–π –≤–µ—Å —Ä–∞–±–æ—Ç–∞–µ—Ç —Ç–æ–ª—å–∫–æ –¥–ª—è –∫–≥-—Ç–æ–≤–∞—Ä–æ–≤
      if(product.pricePerKg){
        base = (customWeightObj.value/1000) * product.pricePerKg * qty;
      }else{
        base = 0;
      }
    }else if(rule && rule.type==='fixed' && product.pricePerUnit){
      // —Ñ–∏–∫—Å. —É–ø–∞–∫–æ–≤–∫–∏ –ø–æ —Ü–µ–Ω–µ –∑–∞ —à—Ç—É–∫—É
      base = product.pricePerUnit * qty;
    }else{
      const parsed = parseVariant(variant);
      if(!parsed) return { basePrice:0, finalPrice:0, discountRate:0 };

      if(product.pricePerKg){
        if(parsed.unit==='g') base = (parsed.value/1000) * product.pricePerKg * qty;
        else if(parsed.unit==='kg') base = parsed.value * product.pricePerKg * qty;
        else if(parsed.unit==='pc'){
          const m = (variant||'').match(/\((\d+)\s*–≥\)/i);
          if(m) base = (parseInt(m[1],10)/1000) * product.pricePerKg * qty;
          else base = product.pricePerUnit ? product.pricePerUnit * qty : 0; // fallback
        }else{
          base = 0;
        }
      }else if(product.pricePerL){
        if(parsed.unit==='l') base = parsed.value * product.pricePerL * qty;
        else base = 0;
      }else if(product.pricePerUnit){
        base = product.pricePerUnit * qty;
      }
    }

    const discountRate = getDiscountRateForProduct(productId);
    const finalPrice = ROUND(base * (1 - discountRate));
    return { basePrice: ROUND(base), finalPrice, discountRate };
  }

  function updateProductModalPrice(){
    if(!currentProduct) return;
    const variant = document.getElementById('product-variant-select').value;
    const qty = parseInt(document.getElementById('product-qty-input').value)||1;
    const customW = getCustomWeightIfAny();
    const price = calculatePrice(currentProduct.id, variant, qty, customW);

    // –ø–æ–∫–∞–∑–∞—Ç—å —Ü–µ–Ω—É
    document.getElementById('product-modal-price').textContent = fmtRub(price.finalPrice);
  }

  // --- CART ---
  function addToCart(){
    if(!currentProduct) return;
    const selectVal = document.getElementById('product-variant-select').value;
    const qty = parseInt(document.getElementById('product-qty-input').value)||1;
    const rule = VARIANT_RULES[currentProduct.id];
    let variantLabel = selectVal;

    // –µ—Å–ª–∏ –≤–≤–µ–¥—ë–Ω —Ä—É—á–Ω–æ–π –≤–µ—Å ‚Äî –ø–æ–¥–º–µ–Ω–∏–º –≤–∞—Ä–∏–∞–Ω—Ç
    const cw = getCustomWeightIfAny();
    if(cw){
      variantLabel = `${cw.value} –≥`;
    }

    const idx = cart.findIndex(i=> i.id===currentProduct.id && i.variant===variantLabel);
    if(idx>-1) cart[idx].qty += qty;
    else cart.push({ id:currentProduct.id, name:currentProduct.name, cat:currentProduct.cat, variant:variantLabel, qty });

    saveState();
    updateCartUI();
    closeProductModal();

    if(window.Telegram && window.Telegram.WebApp && window.Telegram.WebApp.HapticFeedback){
      window.Telegram.WebApp.HapticFeedback.impactOccurred('medium');
    }
  }

  function updateCartUI(){
    const totalCount = cart.reduce((s,i)=>s+i.qty,0);
    const totalSum = cart.reduce((s,i)=> s + calculatePrice(i.id, i.variant, i.qty).finalPrice, 0);
    const btn = document.getElementById('open-cart-btn');

    if(cart.length>0){
      let txt = `–ö–æ—Ä–∑–∏–Ω–∞ (${totalCount}) ‚Äî ${fmtRub(totalSum)}`;
      btn.disabled=false; btn.textContent = txt;
      if(window.Telegram && window.Telegram.WebApp) window.Telegram.WebApp.MainButton.show();
    }else{
      btn.disabled=true; btn.textContent='–ö–æ—Ä–∑–∏–Ω–∞ –ø—É—Å—Ç–∞';
      if(window.Telegram && window.Telegram.WebApp) window.Telegram.WebApp.MainButton.hide();
    }
  }

  function openCartModal(){
    renderCartModal();
    document.getElementById('cart-modal').showModal();
    if(window.Telegram && window.Telegram.WebApp) window.Telegram.WebApp.BackButton.show();
  }

  function closeCartModal(){
    document.getElementById('cart-modal').close();
    if(window.Telegram && window.Telegram.WebApp) window.Telegram.WebApp.BackButton.hide();
  }

  function renderCartModal(){
    const body = document.getElementById('cart-modal-body');
    body.innerHTML = '';
    if(cart.length===0){ body.innerHTML='<p>–ö–æ—Ä–∑–∏–Ω–∞ –ø—É—Å—Ç–∞</p>'; return; }

    let subtotal = 0;
    cart.forEach((item, index)=>{
      const price = calculatePrice(item.id, item.variant, item.qty);
      subtotal += price.finalPrice;
      const discountRate = getDiscountRateForProduct(item.id);
      const hint = discountRate>0? `<div class="discount-hint">–°–∫–∏–¥–∫–∞ ${ROUND(discountRate*100)}% –ø—Ä–∏–º–µ–Ω–µ–Ω–∞</div>` : '';

      const row = document.createElement('div'); row.className='cart-item';
      row.innerHTML = `
        <div class="cart-item-info">
          <div class="cart-item-name">${item.name}</div>
          <div class="cart-item-variant">${item.variant}</div>
          <div class="cart-item-price">${fmtRub(price.finalPrice)}</div>
          ${hint}
        </div>
        <div class="cart-item-controls">
          <div class="qty-control">
            <button onclick="changeItemQty(${index},-1)">‚àí</button>
            <span>${item.qty}</span>
            <button onclick="changeItemQty(${index},1)">+</button>
          </div>
        </div>
      `;
      body.appendChild(row);
    });

    // PROMO
    const promoWrap = document.createElement('div');
    promoWrap.className='promo-wrap';
    promoWrap.innerHTML = `
      <input id="promo-input" placeholder="–ü—Ä–æ–º–æ–∫–æ–¥" style="flex:1;padding:10px;border:1px solid var(--border-color);border-radius:10px;background:var(--secondary-bg-color)" />
      <button class="btn btn-secondary" style="width:auto" onclick="applyPromo()">–ü—Ä–∏–º–µ–Ω–∏—Ç—å</button>
    `;
    body.appendChild(promoWrap);
    if(appliedPromo && appliedPromo.code){
      const p = document.createElement('div');
      p.className='inline-hint'; p.textContent = `–ü—Ä–æ–º–æ–∫–æ–¥ –ø—Ä–∏–º–µ–Ω—ë–Ω: ${appliedPromo.code}`;
      body.appendChild(p);
    }

    let total = subtotal;
    if(appliedPromo){
      const now = new Date();
      const exp = new Date(appliedPromo.expires || '2099-12-31');
      if(exp>=now){
        if(appliedPromo.type==='percent') total = Math.max(0, ROUND(total * (1 - appliedPromo.value/100)));
        else if(appliedPromo.type==='amount') total = Math.max(0, total - appliedPromo.value);
      }else{
        appliedPromo = null; saveState();
      }
    }

    const sumDiv = document.createElement('div'); sumDiv.className='cart-summary';
    sumDiv.textContent = `–ò—Ç–æ–≥–æ: ${fmtRub(total)}`;
    body.appendChild(sumDiv);

    // –ü—Ä–∏–º–µ—á–∞–Ω–∏–µ –ø—Ä–æ –≤–∑–≤–µ—à–∏–≤–∞–Ω–∏–µ ‚Äî —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –µ—Å—Ç—å —Å—ã—Ä—ã
    if(hasCheeseInCart()){
      const note = document.createElement('div');
      note.className='weighing-note';
      note.textContent = '–û–∫–æ–Ω—á–∞—Ç–µ–ª—å–Ω–∞—è —Å—É–º–º–∞ –∑–∞–∫–∞–∑–∞ –±—É–¥–µ—Ç —É—Ç–æ—á–Ω–µ–Ω–∞ –ø–æ—Å–ª–µ –≤–∑–≤–µ—à–∏–≤–∞–Ω–∏—è –≤ –¥–µ–Ω—å –¥–æ—Å—Ç–∞–≤–∫–∏ (–¥–ª—è —Å—ã—Ä–æ–≤).';
      body.appendChild(note);
    }

    // –ö–æ–Ω—Ç–∞–∫—Ç—ã
    const checkoutWrap = document.createElement('div');
    checkoutWrap.innerHTML = `
      <div class="section-title" style="font-weight:800;margin:14px 0 8px">–ö–æ–Ω—Ç–∞–∫—Ç—ã –∏ –¥–æ—Å—Ç–∞–≤–∫–∞</div>
      <div class="form-group">
        <label for="checkout-phone">–¢–µ–ª–µ—Ñ–æ–Ω –¥–ª—è —Å–≤—è–∑–∏</label>
        <input type="tel" id="checkout-phone" inputmode="tel" placeholder="+7 999 999-99-99" />
        <div class="inline-hint">–ú–æ–∂–Ω–æ –≤ –ª—é–±–æ–º —Ñ–æ—Ä–º–∞—Ç–µ ‚Äî –ø—Ä–∏–≤–µ–¥—ë–º –∫ —Å—Ç–∞–Ω–¥–∞—Ä—Ç—É.</div>
      </div>
      <div class="form-group">
        <label for="checkout-address">–ê–¥—Ä–µ—Å –¥–æ—Å—Ç–∞–≤–∫–∏</label>
        <textarea id="checkout-address" rows="3" placeholder="–ì–æ—Ä–æ–¥, —É–ª–∏—Ü–∞, –¥–æ–º, –ø–æ–¥—ä–µ–∑–¥/—ç—Ç–∞–∂/–∫–≤."></textarea>
      </div>
      <div class="form-group">
        <label for="checkout-comment">–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π –∫ –∑–∞–∫–∞–∑—É</label>
        <textarea id="checkout-comment" rows="3" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –ø–æ–∑–≤–æ–Ω–∏—Ç—å –ø–µ—Ä–µ–¥ –¥–æ—Å—Ç–∞–≤–∫–æ–π, –±–µ–∑ —á–µ—Å–Ω–æ–∫–∞ –∏ —Ç.–ø."></textarea>
      </div>
      <div id="checkout-errors" class="error-text" style="display:none"></div>
    `;
    body.appendChild(checkoutWrap);

    // –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–∏–º
    document.getElementById('checkout-phone').value = checkoutState.phone||'';
    document.getElementById('checkout-address').value = checkoutState.address||'';
    document.getElementById('checkout-comment').value = checkoutState.comment||'';

    const sendOrderBtn = document.createElement('button');
    sendOrderBtn.className='btn btn-primary'; sendOrderBtn.textContent='–û—Ç–ø—Ä–∞–≤–∏—Ç—å –∑–∞–∫–∞–∑'; sendOrderBtn.onclick=sendOrder;
    body.appendChild(sendOrderBtn);

    // persist inputs
    const phoneEl = document.getElementById('checkout-phone');
    const addrEl = document.getElementById('checkout-address');
    const commEl = document.getElementById('checkout-comment');
    phoneEl.addEventListener('input', ()=>{ checkoutState.phone = phoneEl.value; saveState(); });
    addrEl.addEventListener('input', ()=>{ checkoutState.address = addrEl.value; saveState(); });
    commEl.addEventListener('input', ()=>{ checkoutState.comment = commEl.value; saveState(); });
  }

  function applyPromo(){
    const input = document.getElementById('promo-input');
    const code = (input.value||'').trim().toUpperCase();
    if(!code) return;
    const p = PROMO_CODES[code];
    const errBox = document.getElementById('checkout-errors') || (()=>{ const d=document.createElement('div'); d.id='checkout-errors'; return d })();
    if(!p){ showCheckoutErrors(['–¢–∞–∫–æ–≥–æ –ø—Ä–æ–º–æ–∫–æ–¥–∞ –Ω–µ—Ç –∏–ª–∏ –æ–Ω –Ω–µ –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª–µ–Ω.']); return; }
    appliedPromo = { code, ...p };
    saveState();
    renderCartModal();
  }

  function changeItemQty(index, delta){
    cart[index].qty += delta;
    if(cart[index].qty<=0) cart.splice(index,1);
    saveState(); updateCartUI(); renderCartModal();
  }

  function hasCheeseInCart(){
    return cart.some(i => i.cat==='–°—ã—Ä—ã');
  }

  function getDiscountRateForProduct(productId){
    const product = PRODUCTS.find(p=>p.id===productId);
    if(!product || product.cat!=='–°—ã—Ä—ã') return 0;
    const totalWeightGrams = cart.filter(i=>i.id===productId).reduce((sum,item)=>{
      const parsed = parseVariant(item.variant);
      if(parsed && parsed.unit==='g') return sum + parsed.value * item.qty;
      if(parsed && parsed.unit==='kg') return sum + parsed.value*1000 * item.qty;
      if(parsed && parsed.unit==='pc'){
        const m = item.variant.match(/\((\d+)\s*–≥\)/i);
        if(m) return sum + parseInt(m[1],10)*item.qty;
      }
      return sum;
    }, 0);
    let disc=0;
    for(const t of DISCOUNT_THRESHOLDS) if(totalWeightGrams>=t.g) disc=t.rate;
    return disc;
  }

  // --- CHECKOUT ---
  function normalizePhone(input){
    if(!input) return '';
    const d = (''+input).replace(/\D+/g,'');
    if(d.length===11 && (d.startsWith('7')||d.startsWith('8'))) return '+7'+d.slice(1);
    if(d.length===10) return '+7'+d;
    if((''+input).trim().startsWith('+')) return '+'+d;
    return d? '+'+d : '';
  }
  function getCheckoutData(){
    const phoneRaw = (document.getElementById('checkout-phone').value||'').trim();
    const phone = normalizePhone(phoneRaw);
    const address = (document.getElementById('checkout-address').value||'').trim();
    const comment = (document.getElementById('checkout-comment').value||'').trim();
    checkoutState = { phone:phoneRaw, address, comment }; saveState();
    return { phoneRaw, phone, address, comment };
  }
  function validateCheckout(data){
    const errs=[];
    if(!data.phone) errs.push('–£–∫–∞–∂–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π —Ç–µ–ª–µ—Ñ–æ–Ω –¥–ª—è —Å–≤—è–∑–∏.');
    if(data.address.length<5) errs.push('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, —É–∫–∞–∂–∏—Ç–µ –∞–¥—Ä–µ—Å –¥–æ—Å—Ç–∞–≤–∫–∏.');
    return errs;
  }
  function showCheckoutErrors(arr){
    const box = document.getElementById('checkout-errors');
    if(!arr||!arr.length){ box.style.display='none'; box.textContent=''; return; }
    box.style.display='block'; box.textContent = arr.join(' ');
  }

  function sendOrder(){
    if(!cart.length) return;
    const contact = getCheckoutData();
    const errors = validateCheckout(contact);
    if(errors.length){
      showCheckoutErrors(errors);
      if(window.Telegram && window.Telegram.WebApp && window.Telegram.WebApp.HapticFeedback) window.Telegram.WebApp.HapticFeedback.notificationOccurred('error');
      return;
    }
    showCheckoutErrors([]);

    const payload = {
      type:'cart', source:'miniapp', currency:CURRENCY, items:[], total:0,
      contact:{ phone:contact.phone, phone_raw:contact.phoneRaw, address:contact.address, comment:contact.comment },
      promo: appliedPromo || null,
      meta:{ ts:Date.now(), schema_ver:PAYLOAD_SCHEMA_VERSION }
    };

    let grand=0;
    cart.forEach(item=>{
      const price = calculatePrice(item.id, item.variant, item.qty);
      grand += price.finalPrice;
      payload.items.push({
        id:item.id, name:item.name, cat:item.cat, variant:item.variant, qty:item.qty,
        unit_price_base: price.basePrice/Math.max(item.qty,1),
        discount_rate: price.discountRate,
        unit_price: price.finalPrice/Math.max(item.qty,1),
        line_total: price.finalPrice
      });
    });

    // –ø—Ä–æ–º–æ
    if(appliedPromo){
      const now = new Date();
      const exp = new Date(appliedPromo.expires || '2099-12-31');
      if(exp>=now){
        if(appliedPromo.type==='percent') grand = Math.max(0, ROUND(grand * (1 - appliedPromo.value/100)));
        else if(appliedPromo.type==='amount') grand = Math.max(0, grand - appliedPromo.value);
      }
    }
    payload.total = grand;

    // Telegram info
    if(window.Telegram && window.Telegram.WebApp){
      const tg = window.Telegram.WebApp;
      payload.telegram = { platform: tg.platform, init_data: !!tg.initData };
      if(tg.initDataUnsafe && tg.initDataUnsafe.user){
        payload.telegram.user = {
          id: tg.initDataUnsafe.user.id,
          username: tg.initDataUnsafe.user.username,
          first_name: tg.initDataUnsafe.user.first_name,
          last_name: tg.initDataUnsafe.user.last_name,
        };
      }
    }

    axios.post(`${BACKEND}/order`, payload)
      .then(()=>{
        if(window.Telegram && window.Telegram.WebApp){
          window.Telegram.WebApp.showAlert('–°–ø–∞—Å–∏–±–æ! –í–∞—à –∑–∞–∫–∞–∑ –ø—Ä–∏–Ω—è—Ç. –ú—ã —Å–≤—è–∂–µ–º—Å—è –ø–æ —Ç–µ–ª–µ—Ñ–æ–Ω—É.');
          if(window.Telegram.WebApp.HapticFeedback) window.Telegram.WebApp.HapticFeedback.notificationOccurred('success');
        }else{ alert('–í–∞—à –∑–∞–∫–∞–∑ –ø—Ä–∏–Ω—è—Ç'); }
        cart=[]; saveState(); updateCartUI(); closeCartModal();
        if(window.Telegram && window.Telegram.WebApp) window.Telegram.WebApp.close();
      })
      .catch(()=>{
        if(window.Telegram && window.Telegram.WebApp){
          window.Telegram.WebApp.showAlert('–ù–µ —É–¥–∞–ª–æ—Å—å –æ—Ç–ø—Ä–∞–≤–∏—Ç—å –∑–∞–∫–∞–∑. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç –∏ –ø–æ–ø—Ä–æ–±—É–π—Ç–µ –µ—â—ë —Ä–∞–∑.');
          if(window.Telegram.WebApp.HapticFeedback) window.Telegram.WebApp.HapticFeedback.notificationOccurred('error');
        }else{ alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ –∑–∞–∫–∞–∑–∞'); }
      });
  }
  </script>
</body>
</html>
